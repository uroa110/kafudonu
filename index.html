<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .tab-active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .alert-low { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-blue-50 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">üßÅ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà</h1>
            <p class="text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö ‡∏™‡∏π‡∏ï‡∏£ ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex flex-wrap justify-center mb-8 bg-white rounded-xl shadow-lg p-2">
            <button onclick="showTab('inventory')" id="tab-inventory" class="tab-btn px-4 py-3 rounded-lg font-medium transition-all duration-300 tab-active text-white text-sm">üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</button>
            <button onclick="showTab('stock')" id="tab-stock" class="tab-btn px-4 py-3 rounded-lg font-medium transition-all duration-300 text-gray-600 hover:bg-gray-100 text-sm">‚ö†Ô∏è ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</button>
            <button onclick="showTab('recipes')" id="tab-recipes" class="tab-btn px-4 py-3 rounded-lg font-medium transition-all duration-300 text-gray-600 hover:bg-gray-100 text-sm">üìù ‡∏™‡∏π‡∏ï‡∏£‡∏Ç‡∏ô‡∏°</button>
            <button onclick="showTab('production')" id="tab-production" class="tab-btn px-4 py-3 rounded-lg font-medium transition-all duration-300 text-gray-600 hover:bg-gray-100 text-sm">üè≠ ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</button>
            <button onclick="showTab('sales')" id="tab-sales" class="tab-btn px-4 py-3 rounded-lg font-medium transition-all duration-300 text-gray-600 hover:bg-gray-100 text-sm">üí∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</button>
            <button onclick="showTab('reports')" id="tab-reports" class="tab-btn px-4 py-3 rounded-lg font-medium transition-all duration-300 text-gray-600 hover:bg-gray-100 text-sm">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ</button>
        </div>

        <!-- Stock Monitoring Tab -->
        <div id="stock-tab" class="tab-content hidden">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Stock Alert Settings -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="bg-orange-100 p-2 rounded-lg mr-3">‚öôÔ∏è</span>
                        ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</label>
                            <select id="alert-ingredient" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (‡∏Å‡∏£‡∏±‡∏°)</label>
                            <input type="number" id="min-stock" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" placeholder="100">
                        </div>
                        
                        <button onclick="setStockAlert()" class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-3 px-6 rounded-lg font-medium hover:from-orange-600 hover:to-red-700 transition-all duration-300 transform hover:scale-105">
                            ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                        </button>
                    </div>
                </div>

                <!-- Current Stock Alerts -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="bg-red-100 p-2 rounded-lg mr-3">üö®</span>
                        ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                    </h2>
                    <div id="stock-alerts-list" class="space-y-3">
                        <!-- Stock alerts will be displayed here -->
                    </div>
                </div>
            </div>
            
            <!-- All Inventory Status -->
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-blue-100 p-2 rounded-lg mr-3">üìä</span>
                    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </h2>
                <div id="all-stock-status" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- All stock status will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Inventory Management Tab -->
        <div id="inventory-tab" class="tab-content">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Add Inventory Form -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="bg-blue-100 p-2 rounded-lg mr-3">‚ûï</span>
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</label>
                            <input type="text" id="ingredient-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏õ‡πâ‡∏á‡∏™‡∏≤‡∏•‡∏µ" oninput="showSuggestions(this.value)">
                            <div id="suggestions" class="mt-2 bg-white border rounded-lg shadow-lg hidden"></div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö</label>
                            <select id="ingredient-unit" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="toggleUnitType()">
                                <option value="weight">‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏£‡∏±‡∏°)</option>
                                <option value="piece">‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏¥‡πâ‡∏ô/‡∏ü‡∏≠‡∏á</option>
                            </select>
                        </div>
                        
                        <div id="weight-inputs" class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ñ‡∏∏‡∏á/‡πÅ‡∏û‡πá‡∏Ñ</label>
                                <input type="number" id="ingredient-bags" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="1" oninput="calculateTotal()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏£‡∏±‡∏°‡∏ï‡πà‡∏≠‡∏ñ‡∏∏‡∏á</label>
                                <input type="number" id="grams-per-bag" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="1000" oninput="calculateTotal()">
                            </div>
                        </div>
                        
                        <div id="piece-inputs" class="grid grid-cols-2 gap-4 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô/‡∏ü‡∏≠‡∏á</label>
                                <input type="number" id="ingredient-pieces" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="12" oninput="calculateTotal()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô/‡∏ü‡∏≠‡∏á</label>
                                <input type="number" id="price-per-piece" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="5" step="0.01" oninput="calculateTotal()">
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì: <span id="total-amount" class="font-bold text-blue-600">0</span> <span id="unit-display">‡∏Å‡∏£‡∏±‡∏°</span></p>
                        </div>
                        
                        <div id="weight-price-input" class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="ingredient-price" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="60" oninput="calculateTotal()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                                <input type="date" id="expiry-date" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div id="piece-expiry-input" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                            <input type="date" id="expiry-date-piece" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: <span id="price-per-unit" class="font-bold text-green-600">0.00</span> ‡∏ö‡∏≤‡∏ó/<span id="unit-price-display">‡∏Å‡∏£‡∏±‡∏°</span></p>
                            <p id="total-cost-display" class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: <span id="total-cost-amount" class="font-bold text-blue-600">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        
                        <button onclick="addIngredient()" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 px-6 rounded-lg font-medium hover:from-blue-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105">
                            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
                        </button>
                    </div>
                </div>

                <!-- Inventory List -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="bg-green-100 p-2 rounded-lg mr-3">üìã</span>
                        ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
                    </h2>
                    <div id="inventory-list" class="space-y-3">
                        <!-- Inventory items will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Production Tab -->
        <div id="production-tab" class="tab-content hidden">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Production Form -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="bg-purple-100 p-2 rounded-lg mr-3">üè≠</span>
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï</label>
                            <input type="date" id="production-date" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï</label>
                            <select id="production-recipe" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" onchange="updateProductionInfo()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</label>
                            <div class="flex gap-4 mb-3">
                                <label class="flex items-center">
                                    <input type="radio" name="production-type" value="batch" checked onchange="toggleProductionType()" class="mr-2">
                                    <span class="text-sm">‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∏‡∏î</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="production-type" value="piece" onchange="toggleProductionType()" class="mr-2">
                                    <span class="text-sm">‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô</span>
                                </label>
                            </div>
                        </div>
                        
                        <div id="batch-input" class="production-input">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï</label>
                            <input type="number" id="production-batches" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="1" oninput="updateProductionInfo()">
                            <p class="text-sm text-gray-500 mt-1">1 ‡∏ä‡∏∏‡∏î = <span id="pieces-per-batch">0</span> ‡∏ä‡∏¥‡πâ‡∏ô</p>
                        </div>
                        
                        <div id="piece-input" class="production-input hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï</label>
                            <input type="number" id="production-pieces" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="1" oninput="updateProductionInfo()">
                            <p class="text-sm text-gray-500 mt-1">‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ <span id="recipe-yield-display">0</span> ‡∏ä‡∏¥‡πâ‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏∏‡∏î</p>
                        </div>
                        
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">‡∏£‡∏ß‡∏°‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï: <span id="total-pieces-produced" class="font-bold text-purple-600">0</span> ‡∏ä‡∏¥‡πâ‡∏ô</p>
                            <p class="text-sm text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï: <span id="production-cost" class="font-bold text-red-600">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        
                        <div id="ingredient-check" class="space-y-2">
                            <!-- Ingredient availability check will be displayed here -->
                        </div>
                        
                        <button onclick="recordProduction()" class="w-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white py-3 px-6 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
                        </button>
                    </div>
                </div>

                <!-- Production History -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="bg-indigo-100 p-2 rounded-lg mr-3">üìã</span>
                        ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
                    </h2>
                    <div id="production-list" class="space-y-3">
                        <!-- Production history will be displayed here -->
                    </div>
                </div>
            </div>
            
            <!-- Production Summary -->
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-green-100 p-2 rounded-lg mr-3">üìà</span>
                    ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                </h2>
                <div id="daily-production-summary" class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Daily production summary will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Recipes Tab -->
        <div id="recipes-tab" class="tab-content hidden">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Add Recipe Form -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="bg-yellow-100 p-2 rounded-lg mr-3">üë®‚Äçüç≥</span>
                        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</label>
                            <input type="text" id="recipe-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                            <div class="flex gap-2">
                                <select id="recipe-category" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                                    <option value="‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ">üç™ ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ</option>
                                    <option value="‡πÄ‡∏Ñ‡πâ‡∏Å">üéÇ ‡πÄ‡∏Ñ‡πâ‡∏Å</option>
                                    <option value="‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á">üçû ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á</option>
                                    <option value="‡∏°‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏á">üåà ‡∏°‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏á</option>
                                    <option value="‡∏ó‡∏≤‡∏£‡πå‡∏ï">ü•ß ‡∏ó‡∏≤‡∏£‡πå‡∏ï</option>
                                    <option value="‡πÇ‡∏î‡∏ô‡∏±‡∏ó">üç© ‡πÇ‡∏î‡∏ô‡∏±‡∏ó</option>
                                    <option value="‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á">ü•ê ‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á</option>
                                    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                </select>
                                <button type="button" onclick="showAddCategoryModal()" class="px-4 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 font-medium">+</button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ</label>
                                <input type="number" id="recipe-yield" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500" placeholder="12">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô</label>
                                <input type="number" id="selling-price" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500" placeholder="25">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</label>
                            <div id="recipe-ingredients" class="space-y-2">
                                <div class="flex gap-2">
                                    <select class="flex-1 px-3 py-2 border border-gray-300 rounded-lg ingredient-select">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                                    </select>
                                    <input type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" class="w-24 px-3 py-2 border border-gray-300 rounded-lg ingredient-amount">
                                    <button onclick="addIngredientToRecipe()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: <span id="total-cost" class="font-bold text-yellow-600">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                            <p class="text-sm text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: <span id="cost-per-piece" class="font-bold text-yellow-600">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                            <p class="text-sm text-gray-600">‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: <span id="profit-per-piece" class="font-bold text-green-600">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        
                        <div class="space-y-3">
                            <button onclick="addRecipe()" class="w-full bg-gradient-to-r from-yellow-500 to-orange-600 text-white py-3 px-6 rounded-lg font-medium hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 transform hover:scale-105">
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏π‡∏ï‡∏£
                            </button>
                            <button id="cancel-edit-btn" onclick="cancelEdit()" class="w-full bg-gray-500 text-white py-2 px-6 rounded-lg font-medium hover:bg-gray-600 transition-all duration-300 hidden">
                                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recipe List -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                            <span class="bg-orange-100 p-2 rounded-lg mr-3">üìñ</span>
                            ‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </h2>
                        <div class="flex items-center gap-2">
                            <label class="text-sm font-medium text-gray-700">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°:</label>
                            <select id="category-filter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" onchange="filterRecipesByCategory()">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                            </select>
                        </div>
                    </div>
                    <div id="recipe-list" class="space-y-3">
                        <!-- Recipes will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Sales Tab -->
        <div id="sales-tab" class="tab-content hidden">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Add Sale Form -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="bg-green-100 p-2 rounded-lg mr-3">üí∏</span>
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                            <input type="date" id="sale-date" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" onchange="updateSaleInfo()">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</label>
                            <select id="sale-recipe" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" onchange="updateSaleInfo()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ç‡∏ô‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ</label>
                                <input type="number" id="produced-quantity" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="0" oninput="this.dataset.autoFilled = 'false'; updateSaleInfo()">
                                <p class="text-xs text-blue-500 mt-1">üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ç‡∏ô‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
                                <input type="number" id="remaining-quantity" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="0" oninput="updateSaleInfo()">
                                <p class="text-xs text-gray-500 mt-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏ô‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏¢</p>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ: <span id="sold-quantity" class="font-bold text-blue-600">0</span> ‡∏ä‡∏¥‡πâ‡∏ô</p>
                            <p class="text-sm text-gray-500 text-xs mt-1">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å: ‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ - ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: <span id="sale-revenue" class="font-bold text-green-600">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                            <p class="text-sm text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: <span id="sale-cost" class="font-bold text-red-600">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                            <p class="text-sm text-gray-600">‡∏Å‡∏≥‡πÑ‡∏£: <span id="sale-profit" class="font-bold text-blue-600">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        
                        <button onclick="addSale()" class="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white py-3 px-6 rounded-lg font-medium hover:from-green-600 hover:to-teal-700 transition-all duration-300 transform hover:scale-105">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                        </button>
                    </div>
                </div>

                <!-- Sales History -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover transition-all duration-300">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="bg-blue-100 p-2 rounded-lg mr-3">üìà</span>
                        ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                    </h2>
                    <div id="sales-list" class="space-y-3">
                        <!-- Sales will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports-tab" class="tab-content hidden">
            <!-- Period Selection -->
            <div class="mb-6 bg-white rounded-xl shadow-lg p-4">
                <div class="flex flex-wrap gap-4 items-center justify-center mb-4">
                    <button onclick="setReportPeriod('today')" id="period-today" class="px-4 py-2 rounded-lg font-medium transition-all duration-300 bg-blue-500 text-white">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                    <button onclick="setReportPeriod('week')" id="period-week" class="px-4 py-2 rounded-lg font-medium transition-all duration-300 text-gray-600 hover:bg-gray-100">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</button>
                    <button onclick="setReportPeriod('month')" id="period-month" class="px-4 py-2 rounded-lg font-medium transition-all duration-300 text-gray-600 hover:bg-gray-100">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
                    <button onclick="setReportPeriod('custom-month')" id="period-custom-month" class="px-4 py-2 rounded-lg font-medium transition-all duration-300 text-gray-600 hover:bg-gray-100">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                    <button onclick="setReportPeriod('all')" id="period-all" class="px-4 py-2 rounded-lg font-medium transition-all duration-300 text-gray-600 hover:bg-gray-100">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
                
                <!-- Month Selector -->
                <div id="month-selector" class="hidden">
                    <div class="flex flex-wrap gap-4 items-center justify-center">
                        <div class="flex items-center gap-2">
                            <label class="text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</label>
                            <select id="selected-month" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="updateCustomMonthReport()">
                                <!-- Month options will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="flex items-center gap-2">
                            <label class="text-sm font-medium text-gray-700">‡∏õ‡∏µ:</label>
                            <select id="selected-year" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="updateCustomMonthReport()">
                                <!-- Year options will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Summary Cards -->
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h3>
                        <div class="space-y-2">
                            <p>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°: <span id="total-revenue" class="font-bold">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                            <p>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: <span id="total-costs" class="font-bold">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                            <p>‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏ß‡∏°: <span id="total-profit" class="font-bold">0.00</span> ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">üèÜ ‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3>
                        <div id="best-sellers" class="space-y-2">
                            <!-- Best sellers will be displayed here -->
                        </div>
                    </div>
                </div>
                
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">‚ö†Ô∏è ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</h3>
                        <div id="low-stock" class="space-y-2">
                            <!-- Low stock items will be displayed here -->
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">üìâ ‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏î‡∏µ</h3>
                        <div id="poor-sellers" class="space-y-2">
                            <!-- Poor sellers will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weekly Analysis -->
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-green-100 p-2 rounded-lg mr-3">üìÖ</span>
                    ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
                </h3>
                
                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- Daily Sales Chart -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">üìà ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h4>
                        <div id="daily-sales-chart" class="space-y-3">
                            <!-- Daily sales chart will be displayed here -->
                        </div>
                    </div>
                    
                    <!-- Best Day Analysis -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">üéØ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡∏±‡∏ô‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ/‡πÑ‡∏°‡πà‡∏î‡∏µ</h4>
                        <div id="day-analysis" class="space-y-3">
                            <!-- Day analysis will be displayed here -->
                        </div>
                    </div>
                </div>
                
                <!-- Weekly Menu Performance -->
                <div class="mt-8">
                    <h4 class="text-lg font-semibold text-gray-700 mb-4">üç∞ ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÄ‡∏°‡∏ô‡∏π‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h4>
                    <div id="weekly-menu-performance" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Weekly menu performance will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="category-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-96 max-w-90vw">
            <h3 class="text-xl font-bold text-gray-800 mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <input type="text" id="new-category-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏±‡∏û‡πÄ‡∏Ñ‡πâ‡∏Å">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô</label>
                    <div class="grid grid-cols-6 gap-2">
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="üç∞">üç∞</button>
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="üßÅ">üßÅ</button>
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="üç™">üç™</button>
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="üéÇ">üéÇ</button>
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="üçû">üçû</button>
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="ü•ß">ü•ß</button>
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="üç©">üç©</button>
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="ü•ê">ü•ê</button>
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="üåà">üåà</button>
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="üç´">üç´</button>
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="üç¨">üç¨</button>
                        <button type="button" class="category-icon-btn w-12 h-12 border-2 border-gray-300 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-50 transition-colors" data-icon="üì¶">üì¶</button>
                    </div>
                    <input type="hidden" id="selected-category-icon" value="üç∞">
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="addNewCategory()" class="flex-1 bg-gradient-to-r from-yellow-500 to-orange-600 text-white py-3 px-6 rounded-lg font-medium hover:from-yellow-600 hover:to-orange-700 transition-all duration-300">
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
                </button>
                <button onclick="hideCategoryModal()" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg font-medium hover:bg-gray-600 transition-all duration-300">
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let inventory = JSON.parse(localStorage.getItem('bakery-inventory') || '[]');
        let recipes = JSON.parse(localStorage.getItem('bakery-recipes') || '[]');
        let sales = JSON.parse(localStorage.getItem('bakery-sales') || '[]');
        let production = JSON.parse(localStorage.getItem('bakery-production') || '[]');
        let stockAlerts = JSON.parse(localStorage.getItem('stock-alerts') || '{}');
        let ingredientHistory = JSON.parse(localStorage.getItem('ingredient-history') || '{}');
        let recipeCategories = JSON.parse(localStorage.getItem('recipe-categories') || '[]');
        let currentReportPeriod = 'today';
        let currentCategoryFilter = '';

        // Initialize
        document.getElementById('sale-date').value = new Date().toISOString().split('T')[0];
        document.getElementById('production-date').value = new Date().toISOString().split('T')[0];
        updateDisplays();

        // Tab management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active', 'text-white');
                btn.classList.add('text-gray-600');
            });
            
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            document.getElementById('tab-' + tabName).classList.add('tab-active', 'text-white');
            document.getElementById('tab-' + tabName).classList.remove('text-gray-600');
            
            if (tabName === 'reports') updateReports();
            if (tabName === 'stock') updateStockDisplay();
            if (tabName === 'production') updateProductionDisplay();
        }

        // Stock Alert Management
        function setStockAlert() {
            const ingredientId = document.getElementById('alert-ingredient').value;
            const minStock = parseFloat(document.getElementById('min-stock').value);
            
            if (!ingredientId || minStock <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥');
                return;
            }
            
            const ingredient = inventory.find(item => item.id == ingredientId);
            if (!ingredient) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å');
                return;
            }
            
            stockAlerts[ingredientId] = {
                name: ingredient.name,
                minStock: minStock
            };
            
            saveData();
            updateStockDisplay();
            
            // Clear form
            document.getElementById('alert-ingredient').value = '';
            document.getElementById('min-stock').value = '';
        }

        function removeStockAlert(ingredientId) {
            delete stockAlerts[ingredientId];
            saveData();
            updateStockDisplay();
        }

        function updateStockDisplay() {
            updateStockAlertSelects();
            updateStockAlertsList();
            updateAllStockStatus();
        }

        function updateStockAlertSelects() {
            const select = document.getElementById('alert-ingredient');
            const currentValue = select.value;
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>' + 
                inventory.map(item => `<option value="${item.id}">${item.name}</option>`).join('');
            select.value = currentValue;
        }

        function updateStockAlertsList() {
            const container = document.getElementById('stock-alerts-list');
            const alerts = Object.entries(stockAlerts);
            
            if (alerts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>';
                return;
            }
            
            container.innerHTML = alerts.map(([ingredientId, alert]) => {
                const ingredient = inventory.find(item => item.id == ingredientId);
                const currentStock = ingredient ? (ingredient.amount || ingredient.grams || 0) : 0;
                const isLow = currentStock <= alert.minStock;
                
                return `
                    <div class="border rounded-lg p-4 ${isLow ? 'border-red-300 bg-red-50' : 'border-gray-200'}">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-medium text-gray-800">${alert.name}</h4>
                                <p class="text-sm text-gray-600">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥: ${alert.minStock.toLocaleString()} ‡∏Å‡∏£‡∏±‡∏°</p>
                                <p class="text-sm ${isLow ? 'text-red-600 font-medium' : 'text-gray-600'}">
                                    ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${currentStock.toLocaleString()} ‡∏Å‡∏£‡∏±‡∏°
                                </p>
                            </div>
                            <div class="flex items-center gap-2">
                                ${isLow ? '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full animate-pulse">‚ö†Ô∏è ‡∏ï‡πà‡∏≥</span>' : '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">‚úÖ ‡∏õ‡∏Å‡∏ï‡∏¥</span>'}
                                <button onclick="removeStockAlert('${ingredientId}')" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateAllStockStatus() {
            const container = document.getElementById('all-stock-status');
            
            if (inventory.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8 col-span-full">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</p>';
                return;
            }
            
            container.innerHTML = inventory.map(item => {
                const amount = item.amount || item.grams || 0;
                const alert = stockAlerts[item.id];
                const minStock = alert ? alert.minStock : 50; // Default minimum
                const isLow = amount <= minStock;
                const percentage = Math.min((amount / (minStock * 2)) * 100, 100);
                
                return `
                    <div class="border rounded-lg p-4 ${isLow ? 'border-red-300 bg-red-50' : 'border-gray-200'}">
                        <h4 class="font-medium text-gray-800 mb-2">${item.name}</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</span>
                                <span class="font-medium">${amount.toLocaleString()} ${item.unit || '‡∏Å‡∏£‡∏±‡∏°'}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="h-2 rounded-full transition-all duration-300 ${isLow ? 'bg-red-500' : 'bg-green-500'}" 
                                     style="width: ${percentage}%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥: ${minStock} ‡∏Å‡∏£‡∏±‡∏°</span>
                                <span class="${isLow ? 'text-red-600 font-medium' : 'text-green-600'}">${isLow ? '‡∏ï‡πà‡∏≥' : '‡∏õ‡∏Å‡∏ï‡∏¥'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Auto-suggestions for ingredients
        function showSuggestions(value) {
            const suggestions = document.getElementById('suggestions');
            if (value.length < 2) {
                suggestions.classList.add('hidden');
                return;
            }
            
            const matches = Object.keys(ingredientHistory).filter(name => 
                name.toLowerCase().includes(value.toLowerCase())
            );
            
            if (matches.length > 0) {
                suggestions.innerHTML = matches.map(name => 
                    `<div class="p-2 hover:bg-gray-100 cursor-pointer" onclick="selectSuggestion('${name}')">${name}</div>`
                ).join('');
                suggestions.classList.remove('hidden');
            } else {
                suggestions.classList.add('hidden');
            }
        }

        function selectSuggestion(name) {
            const history = ingredientHistory[name];
            document.getElementById('ingredient-name').value = name;
            
            if (history.unitType === 'piece') {
                document.getElementById('ingredient-unit').value = 'piece';
                document.getElementById('ingredient-pieces').value = 1;
                document.getElementById('price-per-piece').value = history.pricePerPiece;
            } else {
                document.getElementById('ingredient-unit').value = 'weight';
                document.getElementById('ingredient-bags').value = 1;
                document.getElementById('grams-per-bag').value = history.gramsPerBag;
                document.getElementById('ingredient-price').value = history.price;
            }
            
            document.getElementById('suggestions').classList.add('hidden');
            toggleUnitType();
            calculateTotal();
        }

        // Unit type toggle
        function toggleUnitType() {
            const unitType = document.getElementById('ingredient-unit').value;
            const weightInputs = document.getElementById('weight-inputs');
            const pieceInputs = document.getElementById('piece-inputs');
            const weightPriceInput = document.getElementById('weight-price-input');
            const pieceExpiryInput = document.getElementById('piece-expiry-input');
            const unitDisplay = document.getElementById('unit-display');
            const unitPriceDisplay = document.getElementById('unit-price-display');
            
            if (unitType === 'weight') {
                weightInputs.classList.remove('hidden');
                pieceInputs.classList.add('hidden');
                weightPriceInput.classList.remove('hidden');
                pieceExpiryInput.classList.add('hidden');
                unitDisplay.textContent = '‡∏Å‡∏£‡∏±‡∏°';
                unitPriceDisplay.textContent = '‡∏Å‡∏£‡∏±‡∏°';
            } else {
                weightInputs.classList.add('hidden');
                pieceInputs.classList.remove('hidden');
                weightPriceInput.classList.add('hidden');
                pieceExpiryInput.classList.remove('hidden');
                unitDisplay.textContent = '‡∏ä‡∏¥‡πâ‡∏ô';
                unitPriceDisplay.textContent = '‡∏ä‡∏¥‡πâ‡∏ô';
            }
            
            calculateTotal();
        }

        // Calculations
        function calculateTotal() {
            const unitType = document.getElementById('ingredient-unit').value;
            
            if (unitType === 'weight') {
                const bags = parseFloat(document.getElementById('ingredient-bags').value) || 0;
                const gramsPerBag = parseFloat(document.getElementById('grams-per-bag').value) || 0;
                const totalGrams = bags * gramsPerBag;
                const price = parseFloat(document.getElementById('ingredient-price').value) || 0;
                const pricePerGram = totalGrams > 0 ? price / totalGrams : 0;
                
                document.getElementById('total-amount').textContent = totalGrams.toLocaleString();
                document.getElementById('price-per-unit').textContent = pricePerGram.toFixed(4);
                document.getElementById('total-cost-amount').textContent = price.toFixed(2);
            } else {
                const pieces = parseFloat(document.getElementById('ingredient-pieces').value) || 0;
                const pricePerPiece = parseFloat(document.getElementById('price-per-piece').value) || 0;
                const totalCost = pieces * pricePerPiece;
                
                document.getElementById('total-amount').textContent = pieces.toLocaleString();
                document.getElementById('price-per-unit').textContent = pricePerPiece.toFixed(2);
                document.getElementById('total-cost-amount').textContent = totalCost.toFixed(2);
            }
        }

        // Add ingredient
        function addIngredient() {
            const name = document.getElementById('ingredient-name').value.trim();
            const unitType = document.getElementById('ingredient-unit').value;
            
            if (!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö');
                return;
            }
            
            let totalAmount, pricePerUnit, totalCost, expiryDate;
            
            if (unitType === 'weight') {
                const bags = parseFloat(document.getElementById('ingredient-bags').value) || 0;
                const gramsPerBag = parseFloat(document.getElementById('grams-per-bag').value) || 0;
                const price = parseFloat(document.getElementById('ingredient-price').value) || 0;
                expiryDate = document.getElementById('expiry-date').value;
                
                if (bags <= 0 || gramsPerBag <= 0 || price <= 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                    return;
                }
                
                totalAmount = bags * gramsPerBag;
                totalCost = price;
                pricePerUnit = price / totalAmount;
                
                // Update ingredient history
                ingredientHistory[name] = { gramsPerBag, price, unitType: 'weight' };
            } else {
                const pieces = parseFloat(document.getElementById('ingredient-pieces').value) || 0;
                const pricePerPiece = parseFloat(document.getElementById('price-per-piece').value) || 0;
                expiryDate = document.getElementById('expiry-date-piece').value;
                
                if (pieces <= 0 || pricePerPiece <= 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                    return;
                }
                
                totalAmount = pieces;
                totalCost = pieces * pricePerPiece;
                pricePerUnit = pricePerPiece;
                
                // Update ingredient history
                ingredientHistory[name] = { pricePerPiece, unitType: 'piece' };
            }
            
            // Check if ingredient exists
            const existingIndex = inventory.findIndex(item => item.name === name);
            if (existingIndex >= 0) {
                // Merge with existing stock
                const existing = inventory[existingIndex];
                
                // Only merge if same unit type
                if (existing.unitType === unitType) {
                    const newTotalAmount = existing.amount + totalAmount;
                    const newTotalCost = (existing.amount * existing.pricePerUnit) + (totalAmount * pricePerUnit);
                    inventory[existingIndex] = {
                        ...existing,
                        amount: newTotalAmount,
                        pricePerUnit: newTotalCost / newTotalAmount,
                        grams: unitType === 'weight' ? newTotalAmount : existing.grams,
                        expiryDate: expiryDate || existing.expiryDate
                    };
                } else {
                    alert('‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô');
                    return;
                }
            } else {
                // Add new ingredient
                inventory.push({
                    id: Date.now(),
                    name,
                    amount: totalAmount,
                    unitType,
                    unit: unitType === 'weight' ? '‡∏Å‡∏£‡∏±‡∏°' : '‡∏ä‡∏¥‡πâ‡∏ô',
                    pricePerUnit,
                    grams: unitType === 'weight' ? totalAmount : 0, // For backward compatibility
                    pricePerGram: unitType === 'weight' ? pricePerUnit : 0, // For backward compatibility
                    expiryDate,
                    addedDate: new Date().toISOString()
                });
            }
            
            saveData();
            updateDisplays();
            clearIngredientForm();
        }

        function clearIngredientForm() {
            document.getElementById('ingredient-name').value = '';
            document.getElementById('ingredient-unit').value = 'weight';
            document.getElementById('ingredient-bags').value = '';
            document.getElementById('grams-per-bag').value = '';
            document.getElementById('ingredient-price').value = '';
            document.getElementById('ingredient-pieces').value = '';
            document.getElementById('price-per-piece').value = '';
            document.getElementById('expiry-date').value = '';
            document.getElementById('expiry-date-piece').value = '';
            document.getElementById('total-amount').textContent = '0';
            document.getElementById('price-per-unit').textContent = '0.00';
            document.getElementById('total-cost-amount').textContent = '0.00';
            toggleUnitType();
        }

        function clearRecipeForm() {
            document.getElementById('recipe-name').value = '';
            document.getElementById('recipe-yield').value = '';
            document.getElementById('selling-price').value = '';
            
            // Clear ingredient rows except the first one
            document.getElementById('recipe-ingredients').innerHTML = `
                <div class="flex gap-2">
                    <select class="flex-1 px-3 py-2 border border-gray-300 rounded-lg ingredient-select">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                        ${inventory.map(item => `<option value="${item.id}">${item.name}</option>`).join('')}
                    </select>
                    <input type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" class="w-24 px-3 py-2 border border-gray-300 rounded-lg ingredient-amount">
                    <button onclick="addIngredientToRecipe()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">+</button>
                </div>
            `;
            
            // Add event listeners to the new row
            const newRow = document.querySelector('#recipe-ingredients .flex');
            newRow.querySelector('.ingredient-select').addEventListener('change', calculateRecipeCost);
            newRow.querySelector('.ingredient-amount').addEventListener('input', calculateRecipeCost);
            
            // Reset cost calculations
            document.getElementById('total-cost').textContent = '0.00';
            document.getElementById('cost-per-piece').textContent = '0.00';
            document.getElementById('profit-per-piece').textContent = '0.00';
        }

        // Recipe management
        function addIngredientToRecipe() {
            const container = document.getElementById('recipe-ingredients');
            const newRow = document.createElement('div');
            newRow.className = 'flex gap-2';
            newRow.innerHTML = `
                <select class="flex-1 px-3 py-2 border border-gray-300 rounded-lg ingredient-select">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                    ${inventory.map(item => `<option value="${item.id}">${item.name}</option>`).join('')}
                </select>
                <input type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" class="w-24 px-3 py-2 border border-gray-300 rounded-lg ingredient-amount">
                <button onclick="this.parentElement.remove(); calculateRecipeCost()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">-</button>
            `;
            container.appendChild(newRow);
            
            // Add event listeners
            newRow.querySelector('.ingredient-select').addEventListener('change', calculateRecipeCost);
            newRow.querySelector('.ingredient-amount').addEventListener('input', calculateRecipeCost);
        }

        function calculateRecipeCost() {
            const ingredientRows = document.querySelectorAll('#recipe-ingredients .flex');
            let totalCost = 0;
            
            ingredientRows.forEach(row => {
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                if (select.value && amountInput.value) {
                    const ingredient = inventory.find(item => item.id == select.value);
                    const amount = parseFloat(amountInput.value);
                    if (ingredient && amount > 0) {
                        // Handle both old and new data structure
                        const pricePerUnit = ingredient.pricePerUnit || ingredient.pricePerGram || 0;
                        const unitType = ingredient.unitType || 'weight';
                        
                        if (unitType === 'piece') {
                            // For piece-based ingredients, amount is in pieces
                            totalCost += pricePerUnit * amount;
                        } else {
                            // For weight-based ingredients, amount is in grams
                            totalCost += pricePerUnit * amount;
                        }
                    }
                }
            });
            
            const yield = parseFloat(document.getElementById('recipe-yield').value) || 1;
            const sellingPrice = parseFloat(document.getElementById('selling-price').value) || 0;
            const costPerPiece = totalCost / yield;
            const profitPerPiece = sellingPrice - costPerPiece;
            
            document.getElementById('total-cost').textContent = totalCost.toFixed(2);
            document.getElementById('cost-per-piece').textContent = costPerPiece.toFixed(2);
            document.getElementById('profit-per-piece').textContent = profitPerPiece.toFixed(2);
        }

        let editingRecipeId = null;

        function addRecipe() {
            const name = document.getElementById('recipe-name').value.trim();
            const yield = parseFloat(document.getElementById('recipe-yield').value) || 0;
            const sellingPrice = parseFloat(document.getElementById('selling-price').value) || 0;
            
            if (!name || yield <= 0 || sellingPrice <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            const ingredientRows = document.querySelectorAll('#recipe-ingredients .flex');
            const ingredients = [];
            
            ingredientRows.forEach(row => {
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                if (select.value && amountInput.value) {
                    const ingredient = inventory.find(item => item.id == select.value);
                    const amount = parseFloat(amountInput.value);
                    if (ingredient && amount > 0) {
                        const pricePerUnit = ingredient.pricePerUnit || ingredient.pricePerGram || 0;
                        ingredients.push({
                            id: ingredient.id,
                            name: ingredient.name,
                            amount: amount,
                            cost: pricePerUnit * amount
                        });
                    }
                }
            });
            
            if (ingredients.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }
            
            const totalCost = ingredients.reduce((sum, ing) => sum + ing.cost, 0);
            const category = document.getElementById('recipe-category').value;
            const recipeData = {
                name,
                category,
                yield,
                sellingPrice,
                ingredients,
                totalCost,
                costPerPiece: totalCost / yield,
                profitPerPiece: sellingPrice - (totalCost / yield)
            };
            
            if (editingRecipeId) {
                // Update existing recipe
                const recipeIndex = recipes.findIndex(r => r.id === editingRecipeId);
                if (recipeIndex >= 0) {
                    recipes[recipeIndex] = { ...recipeData, id: editingRecipeId };
                }
                editingRecipeId = null;
                document.querySelector('#recipes-tab h2 span').textContent = 'üë®‚Äçüç≥';
                document.querySelector('#recipes-tab h2').innerHTML = document.querySelector('#recipes-tab h2').innerHTML.replace('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏π‡∏ï‡∏£', '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà');
                document.querySelector('#recipes-tab button[onclick="addRecipe()"]').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏π‡∏ï‡∏£';
                document.getElementById('cancel-edit-btn').classList.add('hidden');
            } else {
                // Add new recipe
                recipes.push({ ...recipeData, id: Date.now() });
            }
            
            saveData();
            updateDisplays();
            clearRecipeForm();
        }

        function copyRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            // Create a copy of the recipe with new ID and modified name
            const copiedRecipe = {
                ...recipe,
                id: Date.now(),
                name: recipe.name + ' (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å)'
            };
            
            // Add the copied recipe to the recipes array
            recipes.push(copiedRecipe);
            
            // Save and update displays
            saveData();
            updateDisplays();
            
            // Show success message
            alert(`‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£ "${recipe.name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
        }

        function cancelEdit() {
            editingRecipeId = null;
            
            // Reset form header
            document.querySelector('#recipes-tab h2 span').textContent = 'üë®‚Äçüç≥';
            document.querySelector('#recipes-tab h2').innerHTML = document.querySelector('#recipes-tab h2').innerHTML.replace('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏π‡∏ï‡∏£', '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà');
            document.querySelector('#recipes-tab button[onclick="addRecipe()"]').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏π‡∏ï‡∏£';
            document.getElementById('cancel-edit-btn').classList.add('hidden');
            
            // Clear form
            clearRecipeForm();
        }

        function editRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            editingRecipeId = id;
            
            // Update form header
            document.querySelector('#recipes-tab h2 span').textContent = '‚úèÔ∏è';
            document.querySelector('#recipes-tab h2').innerHTML = document.querySelector('#recipes-tab h2').innerHTML.replace('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà', '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏π‡∏ï‡∏£');
            document.querySelector('#recipes-tab button[onclick="addRecipe()"]').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
            
            // Fill form with recipe data
            document.getElementById('recipe-name').value = recipe.name;
            document.getElementById('recipe-category').value = recipe.category || '';
            document.getElementById('recipe-yield').value = recipe.yield;
            document.getElementById('selling-price').value = recipe.sellingPrice;
            
            // Clear existing ingredient rows
            document.getElementById('recipe-ingredients').innerHTML = `
                <div class="flex gap-2">
                    <select class="flex-1 px-3 py-2 border border-gray-300 rounded-lg ingredient-select">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                        ${inventory.map(item => `<option value="${item.id}">${item.name}</option>`).join('')}
                    </select>
                    <input type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" class="w-24 px-3 py-2 border border-gray-300 rounded-lg ingredient-amount">
                    <button onclick="addIngredientToRecipe()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">+</button>
                </div>
            `;
            
            // Add ingredient rows from recipe
            recipe.ingredients.forEach(ingredient => {
                addIngredientToRecipe();
                const rows = document.querySelectorAll('#recipe-ingredients .flex');
                const lastRow = rows[rows.length - 1];
                lastRow.querySelector('.ingredient-select').value = ingredient.id;
                lastRow.querySelector('.ingredient-amount').value = ingredient.amount;
            });
            
            calculateRecipeCost();
            
            // Show cancel button
            document.getElementById('cancel-edit-btn').classList.remove('hidden');
            
            // Scroll to form
            document.querySelector('#recipes-tab').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelEdit() {
            editingRecipeId = null;
            
            // Reset form header
            document.querySelector('#recipes-tab h2 span').textContent = 'üë®‚Äçüç≥';
            document.querySelector('#recipes-tab h2').innerHTML = document.querySelector('#recipes-tab h2').innerHTML.replace('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏π‡∏ï‡∏£', '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà');
            document.querySelector('#recipes-tab button[onclick="addRecipe()"]').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏π‡∏ï‡∏£';
            document.getElementById('cancel-edit-btn').classList.add('hidden');
            
            // Clear form
            clearRecipeForm();
        }

        // Category Management
        function showAddCategoryModal() {
            document.getElementById('category-modal').classList.remove('hidden');
            document.getElementById('new-category-name').value = '';
            document.getElementById('selected-category-icon').value = 'üç∞';
            
            // Reset icon selection
            document.querySelectorAll('.category-icon-btn').forEach(btn => {
                btn.classList.remove('bg-yellow-100', 'border-yellow-500');
                btn.classList.add('border-gray-300');
            });
            document.querySelector('.category-icon-btn[data-icon="üç∞"]').classList.add('bg-yellow-100', 'border-yellow-500');
            document.querySelector('.category-icon-btn[data-icon="üç∞"]').classList.remove('border-gray-300');
        }

        function hideCategoryModal() {
            document.getElementById('category-modal').classList.add('hidden');
        }

        function addNewCategory() {
            const name = document.getElementById('new-category-name').value.trim();
            const icon = document.getElementById('selected-category-icon').value;
            
            if (!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà');
                return;
            }
            
            // Check if category already exists
            if (recipeCategories.some(cat => cat.name === name)) {
                alert('‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }
            
            recipeCategories.push({ name, icon });
            saveData();
            updateCategorySelects();
            hideCategoryModal();
        }

        function updateCategorySelects() {
            const recipeSelect = document.getElementById('recipe-category');
            const filterSelect = document.getElementById('category-filter');
            
            // Update recipe category select
            const currentRecipeValue = recipeSelect.value;
            recipeSelect.innerHTML = `
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                <option value="‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ">üç™ ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ</option>
                <option value="‡πÄ‡∏Ñ‡πâ‡∏Å">üéÇ ‡πÄ‡∏Ñ‡πâ‡∏Å</option>
                <option value="‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á">üçû ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á</option>
                <option value="‡∏°‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏á">üåà ‡∏°‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏á</option>
                <option value="‡∏ó‡∏≤‡∏£‡πå‡∏ï">ü•ß ‡∏ó‡∏≤‡∏£‡πå‡∏ï</option>
                <option value="‡πÇ‡∏î‡∏ô‡∏±‡∏ó">üç© ‡πÇ‡∏î‡∏ô‡∏±‡∏ó</option>
                <option value="‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á">ü•ê ‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á</option>
                <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                ${recipeCategories.map(cat => `<option value="${cat.name}">${cat.icon} ${cat.name}</option>`).join('')}
            `;
            recipeSelect.value = currentRecipeValue;
            
            // Update filter select
            const currentFilterValue = filterSelect.value;
            const allCategories = new Set();
            
            // Add default categories
            ['‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ', '‡πÄ‡∏Ñ‡πâ‡∏Å', '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á', '‡∏°‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏á', '‡∏ó‡∏≤‡∏£‡πå‡∏ï', '‡πÇ‡∏î‡∏ô‡∏±‡∏ó', '‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'].forEach(cat => allCategories.add(cat));
            
            // Add custom categories
            recipeCategories.forEach(cat => allCategories.add(cat.name));
            
            // Add categories that exist in recipes
            recipes.forEach(recipe => {
                if (recipe.category) allCategories.add(recipe.category);
            });
            
            const categoryIcons = {
                '‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ': 'üç™', '‡πÄ‡∏Ñ‡πâ‡∏Å': 'üéÇ', '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á': 'üçû', '‡∏°‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏á': 'üåà',
                '‡∏ó‡∏≤‡∏£‡πå‡∏ï': 'ü•ß', '‡πÇ‡∏î‡∏ô‡∏±‡∏ó': 'üç©', '‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á': 'ü•ê', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ': 'üì¶'
            };
            
            filterSelect.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>' +
                Array.from(allCategories).map(cat => {
                    const customCat = recipeCategories.find(c => c.name === cat);
                    const icon = customCat ? customCat.icon : (categoryIcons[cat] || 'üì¶');
                    return `<option value="${cat}">${icon} ${cat}</option>`;
                }).join('');
            
            filterSelect.value = currentFilterValue;
        }

        function filterRecipesByCategory() {
            currentCategoryFilter = document.getElementById('category-filter').value;
            updateRecipeDisplay();
        }

        // Update displays
        function updateDisplays() {
            updateInventoryDisplay();
            updateRecipeDisplay();
            updateSalesDisplay();
            updateRecipeSelects();
            updateStockDisplay();
            updateProductionDisplay();
            updateCategorySelects();
        }

        function updateInventoryDisplay() {
            const container = document.getElementById('inventory-list');
            if (inventory.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</p>';
                return;
            }
            
            container.innerHTML = inventory.map(item => {
                // Handle both old and new data structure
                const amount = item.amount || item.grams || 0;
                const unit = item.unit || '‡∏Å‡∏£‡∏±‡∏°';
                const pricePerUnit = item.pricePerUnit || item.pricePerGram || 0;
                const unitType = item.unitType || 'weight';
                
                // For low stock check, use appropriate threshold
                const lowStockThreshold = unitType === 'piece' ? 5 : 100;
                const isLowStock = amount < lowStockThreshold;
                const isExpiringSoon = item.expiryDate && new Date(item.expiryDate) <= new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);
                
                return `
                    <div class="border rounded-lg p-4 ${isLowStock ? 'border-red-300 bg-red-50 alert-low' : 'border-gray-200'} ${isExpiringSoon ? 'border-orange-300 bg-orange-50' : ''}">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-medium text-gray-800">${item.name}</h4>
                                <p class="text-sm text-gray-600">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${amount.toLocaleString()} ${unit}</p>
                                <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤: ${pricePerUnit.toFixed(unitType === 'piece' ? 2 : 4)} ‡∏ö‡∏≤‡∏ó/${unit}</p>
                                ${item.expiryDate ? `<p class="text-sm text-gray-600">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: ${new Date(item.expiryDate).toLocaleDateString('th-TH')}</p>` : ''}
                            </div>
                            <div class="flex gap-2">
                                ${isLowStock ? '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</span>' : ''}
                                ${isExpiringSoon ? '<span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>' : ''}
                                <button onclick="removeIngredient(${item.id})" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateRecipeDisplay() {
            const container = document.getElementById('recipe-list');
            
            // Filter recipes by category
            let filteredRecipes = recipes;
            if (currentCategoryFilter) {
                filteredRecipes = recipes.filter(recipe => recipe.category === currentCategoryFilter);
            }
            
            if (filteredRecipes.length === 0) {
                const message = currentCategoryFilter ? 
                    `‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà "${currentCategoryFilter}"` : 
                    '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£';
                container.innerHTML = `<p class="text-gray-500 text-center py-8">${message}</p>`;
                return;
            }
            
            // Group recipes by category
            const groupedRecipes = {};
            filteredRecipes.forEach(recipe => {
                const category = recipe.category || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ';
                if (!groupedRecipes[category]) {
                    groupedRecipes[category] = [];
                }
                groupedRecipes[category].push(recipe);
            });
            
            const categoryIcons = {
                '‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ': 'üç™', '‡πÄ‡∏Ñ‡πâ‡∏Å': 'üéÇ', '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á': 'üçû', '‡∏°‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏á': 'üåà',
                '‡∏ó‡∏≤‡∏£‡πå‡∏ï': 'ü•ß', '‡πÇ‡∏î‡∏ô‡∏±‡∏ó': 'üç©', '‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á': 'ü•ê', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ': 'üì¶'
            };
            
            container.innerHTML = Object.entries(groupedRecipes).map(([category, categoryRecipes]) => {
                const customCat = recipeCategories.find(c => c.name === category);
                const icon = customCat ? customCat.icon : (categoryIcons[category] || 'üì¶');
                
                return `
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center">
                            <span class="mr-2">${icon}</span>
                            ${category}
                            <span class="ml-2 text-sm font-normal text-gray-500">(${categoryRecipes.length} ‡∏™‡∏π‡∏ï‡∏£)</span>
                        </h3>
                        <div class="space-y-3 pl-6">
                            ${categoryRecipes.map(recipe => `
                                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <h4 class="font-medium text-gray-800">${recipe.name}</h4>
                                            <p class="text-sm text-gray-600">‡πÑ‡∏î‡πâ ${recipe.yield} ‡∏ä‡∏¥‡πâ‡∏ô | ‡∏Ç‡∏≤‡∏¢ ${recipe.sellingPrice} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏¥‡πâ‡∏ô</p>
                                            <p class="text-sm text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${recipe.costPerPiece.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏¥‡πâ‡∏ô</p>
                                            <p class="text-sm text-green-600 font-medium">‡∏Å‡∏≥‡πÑ‡∏£: ${recipe.profitPerPiece.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏¥‡πâ‡∏ô</p>
                                            <div class="mt-2 text-xs text-gray-500">
                                                ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö: ${recipe.ingredients.map(ing => `${ing.name} ${ing.amount}`).join(', ')}
                                            </div>
                                        </div>
                                        <div class="flex gap-2 ml-4">
                                            <button onclick="copyRecipe(${recipe.id})" class="text-blue-500 hover:text-blue-700 p-1" title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£">üìã</button>
                                            <button onclick="editRecipe(${recipe.id})" class="text-green-500 hover:text-green-700 p-1" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏π‡∏ï‡∏£">‚úèÔ∏è</button>
                                            <button onclick="removeRecipe(${recipe.id})" class="text-red-500 hover:text-red-700 p-1" title="‡∏•‡∏ö‡∏™‡∏π‡∏ï‡∏£">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateSalesDisplay() {
            const container = document.getElementById('sales-list');
            if (sales.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>';
                return;
            }
            
            const sortedSales = [...sales].sort((a, b) => new Date(b.date) - new Date(a.date));
            container.innerHTML = sortedSales.slice(0, 10).map(sale => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-medium text-gray-800">${sale.recipeName}</h4>
                            <p class="text-sm text-gray-600">${new Date(sale.date).toLocaleDateString('th-TH')}</p>
                            ${sale.producedQuantity ? `
                                <p class="text-sm text-gray-600">‡∏ú‡∏•‡∏¥‡∏ï: ${sale.producedQuantity} | ‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${sale.remainingQuantity || 0} | ‡∏Ç‡∏≤‡∏¢: ${sale.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</p>
                            ` : `
                                <p class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${sale.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</p>
                            `}
                            <p class="text-sm text-gray-600">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: ${sale.revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                            <p class="text-sm text-green-600 font-medium">‡∏Å‡∏≥‡πÑ‡∏£: ${sale.profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        <button onclick="removeSale(${sale.id})" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function updateRecipeSelects() {
            const selects = document.querySelectorAll('.ingredient-select, #sale-recipe');
            selects.forEach(select => {
                const currentValue = select.value;
                if (select.id === 'sale-recipe') {
                    select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</option>' + 
                        recipes.map(recipe => `<option value="${recipe.id}">${recipe.name}</option>`).join('');
                } else {
                    select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>' + 
                        inventory.map(item => `<option value="${item.id}">${item.name}</option>`).join('');
                }
                select.value = currentValue;
            });
        }

        // Report Period Management
        function setReportPeriod(period) {
            currentReportPeriod = period;
            
            // Update button styles
            document.querySelectorAll('[id^="period-"]').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('text-gray-600', 'hover:bg-gray-100');
            });
            document.getElementById(`period-${period}`).classList.add('bg-blue-500', 'text-white');
            document.getElementById(`period-${period}`).classList.remove('text-gray-600', 'hover:bg-gray-100');
            
            // Show/hide month selector
            const monthSelector = document.getElementById('month-selector');
            if (period === 'custom-month') {
                monthSelector.classList.remove('hidden');
                initializeMonthSelector();
            } else {
                monthSelector.classList.add('hidden');
            }
            
            updateReports();
        }

        function initializeMonthSelector() {
            const monthSelect = document.getElementById('selected-month');
            const yearSelect = document.getElementById('selected-year');
            
            // Thai month names
            const thaiMonths = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];
            
            // Populate months
            monthSelect.innerHTML = thaiMonths.map((month, index) => 
                `<option value="${index}">${month}</option>`
            ).join('');
            
            // Populate years (current year and previous 2 years)
            const currentYear = new Date().getFullYear();
            const years = [];
            for (let i = 0; i < 3; i++) {
                years.push(currentYear - i);
            }
            
            yearSelect.innerHTML = years.map(year => 
                `<option value="${year}">${year + 543}</option>` // Convert to Buddhist Era
            ).join('');
            
            // Set current month and year as default
            const now = new Date();
            monthSelect.value = now.getMonth();
            yearSelect.value = now.getFullYear();
        }

        function updateCustomMonthReport() {
            if (currentReportPeriod === 'custom-month') {
                updateReports();
            }
        }

        function getFilteredSales() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            
            switch (currentReportPeriod) {
                case 'today':
                    return sales.filter(sale => sale.date === today);
                case 'week':
                    const weekStart = new Date(now);
                    weekStart.setDate(now.getDate() - now.getDay());
                    weekStart.setHours(0, 0, 0, 0);
                    return sales.filter(sale => new Date(sale.date) >= weekStart);
                case 'month':
                    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                    return sales.filter(sale => new Date(sale.date) >= monthStart);
                case 'custom-month':
                    const selectedMonth = parseInt(document.getElementById('selected-month').value);
                    const selectedYear = parseInt(document.getElementById('selected-year').value);
                    const customMonthStart = new Date(selectedYear, selectedMonth, 1);
                    const customMonthEnd = new Date(selectedYear, selectedMonth + 1, 0, 23, 59, 59);
                    return sales.filter(sale => {
                        const saleDate = new Date(sale.date);
                        return saleDate >= customMonthStart && saleDate <= customMonthEnd;
                    });
                case 'all':
                default:
                    return sales;
            }
        }

        // Reports
        function updateReports() {
            const filteredSales = getFilteredSales();
            
            // Summary
            const totalRevenue = filteredSales.reduce((sum, sale) => sum + sale.revenue, 0);
            const totalCosts = filteredSales.reduce((sum, sale) => sum + sale.cost, 0);
            const totalProfit = totalRevenue - totalCosts;
            
            document.getElementById('total-revenue').textContent = totalRevenue.toLocaleString('th-TH', {minimumFractionDigits: 2});
            document.getElementById('total-costs').textContent = totalCosts.toLocaleString('th-TH', {minimumFractionDigits: 2});
            document.getElementById('total-profit').textContent = totalProfit.toLocaleString('th-TH', {minimumFractionDigits: 2});
            
            // Best sellers
            const salesByRecipe = {};
            filteredSales.forEach(sale => {
                if (!salesByRecipe[sale.recipeName]) {
                    salesByRecipe[sale.recipeName] = { quantity: 0, revenue: 0 };
                }
                salesByRecipe[sale.recipeName].quantity += sale.quantity;
                salesByRecipe[sale.recipeName].revenue += sale.revenue;
            });
            
            const bestSellers = Object.entries(salesByRecipe)
                .sort((a, b) => b[1].quantity - a[1].quantity)
                .slice(0, 5);
            
            document.getElementById('best-sellers').innerHTML = bestSellers.length > 0 
                ? bestSellers.map(([name, data]) => 
                    `<div class="flex justify-between">
                        <span>${name}</span>
                        <span class="font-medium">${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</span>
                    </div>`
                ).join('')
                : '<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
            
            // Low stock (always show current stock regardless of period)
            const lowStockItems = inventory.filter(item => {
                const amount = item.amount || item.grams || 0;
                const alert = stockAlerts[item.id];
                const minStock = alert ? alert.minStock : 50;
                return amount <= minStock;
            });
            
            document.getElementById('low-stock').innerHTML = lowStockItems.length > 0
                ? lowStockItems.map(item => {
                    const amount = item.amount || item.grams || 0;
                    const unit = item.unit || '‡∏Å‡∏£‡∏±‡∏°';
                    return `<div class="flex justify-between text-red-600">
                        <span>${item.name}</span>
                        <span class="font-medium">${amount.toLocaleString()} ${unit}</span>
                    </div>`;
                }).join('')
                : '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</p>';
            
            // Poor sellers
            const poorSellers = Object.entries(salesByRecipe)
                .sort((a, b) => a[1].quantity - b[1].quantity)
                .slice(0, 3);
            
            document.getElementById('poor-sellers').innerHTML = poorSellers.length > 0
                ? poorSellers.map(([name, data]) => 
                    `<div class="flex justify-between">
                        <span>${name}</span>
                        <span class="font-medium">${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</span>
                    </div>`
                ).join('')
                : '<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
            
            // Weekly Analysis
            updateWeeklyAnalysis();
        }

        function updateWeeklyAnalysis() {
            updateDailySalesChart();
            updateDayAnalysis();
            updateWeeklyMenuPerformance();
        }

        function updateDailySalesChart() {
            const container = document.getElementById('daily-sales-chart');
            const now = new Date();
            const weekStart = new Date(now);
            weekStart.setDate(now.getDate() - now.getDay());
            
            const dailySales = {};
            const dayNames = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
            
            // Initialize all days of the week
            for (let i = 0; i < 7; i++) {
                const date = new Date(weekStart);
                date.setDate(weekStart.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                dailySales[dateStr] = { revenue: 0, quantity: 0, dayName: dayNames[i] };
            }
            
            // Fill with actual sales data
            sales.forEach(sale => {
                const saleDate = new Date(sale.date);
                if (saleDate >= weekStart && saleDate <= now) {
                    const dateStr = sale.date;
                    if (dailySales[dateStr]) {
                        dailySales[dateStr].revenue += sale.revenue;
                        dailySales[dateStr].quantity += sale.quantity;
                    }
                }
            });
            
            const maxRevenue = Math.max(...Object.values(dailySales).map(d => d.revenue), 1);
            
            container.innerHTML = Object.entries(dailySales).map(([date, data]) => {
                const percentage = (data.revenue / maxRevenue) * 100;
                return `
                    <div class="flex items-center gap-3">
                        <div class="w-16 text-sm text-gray-600">${data.dayName}</div>
                        <div class="flex-1 bg-gray-200 rounded-full h-6 relative">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-6 rounded-full transition-all duration-500" 
                                 style="width: ${percentage}%"></div>
                            <div class="absolute inset-0 flex items-center justify-center text-xs font-medium text-white">
                                ${data.revenue.toFixed(0)} ‡∏ö‡∏≤‡∏ó
                            </div>
                        </div>
                        <div class="w-12 text-sm text-gray-600 text-right">${data.quantity}</div>
                    </div>
                `;
            }).join('');
        }

        function updateDayAnalysis() {
            const container = document.getElementById('day-analysis');
            const now = new Date();
            const weekStart = new Date(now);
            weekStart.setDate(now.getDate() - now.getDay());
            
            const dailyData = {};
            const dayNames = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
            
            sales.forEach(sale => {
                const saleDate = new Date(sale.date);
                if (saleDate >= weekStart && saleDate <= now) {
                    const dayOfWeek = saleDate.getDay();
                    const dayName = dayNames[dayOfWeek];
                    
                    if (!dailyData[dayName]) {
                        dailyData[dayName] = { revenue: 0, quantity: 0 };
                    }
                    dailyData[dayName].revenue += sale.revenue;
                    dailyData[dayName].quantity += sale.quantity;
                }
            });
            
            const sortedDays = Object.entries(dailyData).sort((a, b) => b[1].revenue - a[1].revenue);
            const bestDay = sortedDays[0];
            const worstDay = sortedDays[sortedDays.length - 1];
            
            container.innerHTML = `
                ${bestDay ? `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h5 class="font-medium text-green-800 mb-2">üèÜ ‡∏ß‡∏±‡∏ô‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h5>
                        <p class="text-sm text-green-700">${bestDay[0]}</p>
                        <p class="text-sm text-green-600">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: ${bestDay[1].revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                        <p class="text-sm text-green-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${bestDay[1].quantity} ‡∏ä‡∏¥‡πâ‡∏ô</p>
                    </div>
                ` : ''}
                
                ${worstDay && sortedDays.length > 1 ? `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h5 class="font-medium text-red-800 mb-2">üìâ ‡∏ß‡∏±‡∏ô‡∏Ç‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏î‡∏µ</h5>
                        <p class="text-sm text-red-700">${worstDay[0]}</p>
                        <p class="text-sm text-red-600">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: ${worstDay[1].revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                        <p class="text-sm text-red-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${worstDay[1].quantity} ‡∏ä‡∏¥‡πâ‡∏ô</p>
                    </div>
                ` : ''}
                
                ${sortedDays.length === 0 ? '<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</p>' : ''}
            `;
        }

        function updateWeeklyMenuPerformance() {
            const container = document.getElementById('weekly-menu-performance');
            const now = new Date();
            const weekStart = new Date(now);
            weekStart.setDate(now.getDate() - now.getDay());
            
            const menuData = {};
            sales.forEach(sale => {
                const saleDate = new Date(sale.date);
                if (saleDate >= weekStart && saleDate <= now) {
                    if (!menuData[sale.recipeName]) {
                        menuData[sale.recipeName] = { quantity: 0, revenue: 0, profit: 0 };
                    }
                    menuData[sale.recipeName].quantity += sale.quantity;
                    menuData[sale.recipeName].revenue += sale.revenue;
                    menuData[sale.recipeName].profit += sale.profit;
                }
            });
            
            const sortedMenus = Object.entries(menuData).sort((a, b) => b[1].quantity - a[1].quantity);
            
            container.innerHTML = sortedMenus.length > 0 
                ? sortedMenus.map(([name, data]) => `
                    <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-lg p-4">
                        <h5 class="font-medium text-gray-800 mb-2">${name}</h5>
                        <div class="space-y-1 text-sm">
                            <p class="text-gray-600">‡∏Ç‡∏≤‡∏¢: ${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</p>
                            <p class="text-blue-600">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ${data.revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                            <p class="text-green-600">‡∏Å‡∏≥‡πÑ‡∏£: ${data.profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                    </div>
                `).join('')
                : '<p class="text-gray-500 col-span-full text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</p>';
        }

        // Remove functions
        function removeIngredient(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                inventory = inventory.filter(item => item.id !== id);
                saveData();
                updateDisplays();
            }
        }

        function removeRecipe(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                recipes = recipes.filter(recipe => recipe.id !== id);
                saveData();
                updateDisplays();
            }
        }

        function removeSale(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                sales = sales.filter(sale => sale.id !== id);
                saveData();
                updateDisplays();
            }
        }

        // Save data
        function saveData() {
            localStorage.setItem('bakery-inventory', JSON.stringify(inventory));
            localStorage.setItem('bakery-recipes', JSON.stringify(recipes));
            localStorage.setItem('bakery-sales', JSON.stringify(sales));
            localStorage.setItem('bakery-production', JSON.stringify(production));
            localStorage.setItem('stock-alerts', JSON.stringify(stockAlerts));
            localStorage.setItem('ingredient-history', JSON.stringify(ingredientHistory));
            localStorage.setItem('recipe-categories', JSON.stringify(recipeCategories));
        }

        // Sales management
        function updateSaleInfo() {
            const recipeId = document.getElementById('sale-recipe').value;
            const saleDate = document.getElementById('sale-date').value;
            
            if (!recipeId || !saleDate) {
                document.getElementById('produced-quantity').value = '';
                document.getElementById('remaining-quantity').value = '';
                document.getElementById('sold-quantity').textContent = '0';
                document.getElementById('sale-revenue').textContent = '0.00';
                document.getElementById('sale-cost').textContent = '0.00';
                document.getElementById('sale-profit').textContent = '0.00';
                return;
            }
            
            // Auto-fill produced quantity from production data
            const todayProduction = production.filter(prod => 
                prod.recipeId == recipeId && prod.date === saleDate
            );
            
            const totalProduced = todayProduction.reduce((sum, prod) => sum + prod.totalPieces, 0);
            
            // Auto-fill produced quantity if not manually changed
            const producedInput = document.getElementById('produced-quantity');
            if (producedInput.value === '' || producedInput.dataset.autoFilled === 'true') {
                producedInput.value = totalProduced;
                producedInput.dataset.autoFilled = 'true';
            }
            
            const producedQty = parseFloat(producedInput.value) || 0;
            const remainingQty = parseFloat(document.getElementById('remaining-quantity').value) || 0;
            
            // Calculate sold quantity
            const soldQty = Math.max(0, producedQty - remainingQty);
            document.getElementById('sold-quantity').textContent = soldQty;
            
            if (!recipeId || soldQty <= 0) {
                document.getElementById('sale-revenue').textContent = '0.00';
                document.getElementById('sale-cost').textContent = '0.00';
                document.getElementById('sale-profit').textContent = '0.00';
                return;
            }
            
            const recipe = recipes.find(r => r.id == recipeId);
            if (!recipe) return;
            
            const revenue = recipe.sellingPrice * soldQty;
            const cost = recipe.costPerPiece * soldQty;
            const profit = revenue - cost;
            
            document.getElementById('sale-revenue').textContent = revenue.toFixed(2);
            document.getElementById('sale-cost').textContent = cost.toFixed(2);
            document.getElementById('sale-profit').textContent = profit.toFixed(2);
        }

        function addSale() {
            const date = document.getElementById('sale-date').value;
            const recipeId = document.getElementById('sale-recipe').value;
            const producedQty = parseFloat(document.getElementById('produced-quantity').value) || 0;
            const remainingQty = parseFloat(document.getElementById('remaining-quantity').value) || 0;
            
            const soldQty = Math.max(0, producedQty - remainingQty);
            
            if (!date || !recipeId || producedQty <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            if (remainingQty > producedQty) {
                alert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ');
                return;
            }
            
            if (soldQty <= 0) {
                alert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0');
                return;
            }
            
            const recipe = recipes.find(r => r.id == recipeId);
            if (!recipe) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å');
                return;
            }
            
            const revenue = recipe.sellingPrice * soldQty;
            const cost = recipe.costPerPiece * soldQty;
            const profit = revenue - cost;
            
            sales.push({
                id: Date.now(),
                date,
                recipeId: recipe.id,
                recipeName: recipe.name,
                quantity: soldQty,
                producedQuantity: producedQty,
                remainingQuantity: remainingQty,
                revenue,
                cost,
                profit
            });
            
            saveData();
            updateDisplays();
            
            // Clear form
            document.getElementById('produced-quantity').value = '';
            document.getElementById('remaining-quantity').value = '';
            updateSaleInfo();
            
            alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ${recipe.name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n‡∏ú‡∏•‡∏¥‡∏ï: ${producedQty} ‡∏ä‡∏¥‡πâ‡∏ô | ‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${remainingQty} ‡∏ä‡∏¥‡πâ‡∏ô | ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ${soldQty} ‡∏ä‡∏¥‡πâ‡∏ô`);
        }

        // Production functions
        function updateProductionDisplay() {
            updateProductionSelects();
            updateProductionList();
        }

        function updateProductionSelects() {
            const select = document.getElementById('production-recipe');
            const currentValue = select.value;
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</option>' + 
                recipes.map(recipe => `<option value="${recipe.id}">${recipe.name}</option>`).join('');
            select.value = currentValue;
        }

        function updateProductionList() {
            const container = document.getElementById('production-list');
            if (production.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</p>';
                return;
            }
            
            const sortedProduction = [...production].sort((a, b) => new Date(b.date) - new Date(a.date));
            container.innerHTML = sortedProduction.slice(0, 10).map(prod => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-medium text-gray-800">${prod.recipeName}</h4>
                            <p class="text-sm text-gray-600">${new Date(prod.date).toLocaleDateString('th-TH')} | ‡∏ú‡∏•‡∏¥‡∏ï: ${prod.totalPieces} ‡∏ä‡∏¥‡πâ‡∏ô</p>
                            <p class="text-sm text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${prod.cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        <button onclick="removeProduction(${prod.id})" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function toggleProductionType() {
            const batchInput = document.getElementById('batch-input');
            const pieceInput = document.getElementById('piece-input');
            const selectedType = document.querySelector('input[name="production-type"]:checked').value;
            
            if (selectedType === 'batch') {
                batchInput.classList.remove('hidden');
                pieceInput.classList.add('hidden');
            } else {
                batchInput.classList.add('hidden');
                pieceInput.classList.remove('hidden');
            }
            
            updateProductionInfo();
        }

        function updateProductionInfo() {
            const recipeId = document.getElementById('production-recipe').value;
            if (!recipeId) {
                document.getElementById('pieces-per-batch').textContent = '0';
                document.getElementById('recipe-yield-display').textContent = '0';
                document.getElementById('total-pieces-produced').textContent = '0';
                document.getElementById('production-cost').textContent = '0.00';
                document.getElementById('ingredient-check').innerHTML = '';
                return;
            }
            
            const recipe = recipes.find(r => r.id == recipeId);
            if (!recipe) return;
            
            const selectedType = document.querySelector('input[name="production-type"]:checked').value;
            let totalPieces = 0;
            
            if (selectedType === 'batch') {
                const batches = parseFloat(document.getElementById('production-batches').value) || 0;
                totalPieces = batches * recipe.yield;
                document.getElementById('pieces-per-batch').textContent = recipe.yield;
            } else {
                totalPieces = parseFloat(document.getElementById('production-pieces').value) || 0;
                document.getElementById('recipe-yield-display').textContent = recipe.yield;
            }
            
            const batchesNeeded = totalPieces / recipe.yield;
            const totalCost = recipe.totalCost * batchesNeeded;
            
            document.getElementById('total-pieces-produced').textContent = totalPieces;
            document.getElementById('production-cost').textContent = totalCost.toFixed(2);
            
            // Check ingredient availability
            checkIngredientAvailability(recipe, batchesNeeded);
        }

        function checkIngredientAvailability(recipe, batchesNeeded) {
            const container = document.getElementById('ingredient-check');
            const checks = recipe.ingredients.map(ingredient => {
                const needed = ingredient.amount * batchesNeeded;
                const available = inventory.find(item => item.id == ingredient.id);
                const availableAmount = available ? (available.amount || available.grams || 0) : 0;
                const isEnough = availableAmount >= needed;
                
                return `
                    <div class="flex justify-between items-center p-2 rounded ${isEnough ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'}">
                        <span>${ingredient.name}</span>
                        <span class="text-sm">
                            ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£: ${needed.toFixed(1)} | ‡∏°‡∏µ: ${availableAmount.toFixed(1)}
                            ${isEnough ? '‚úÖ' : '‚ùå'}
                        </span>
                    </div>
                `;
            });
            
            container.innerHTML = checks.join('');
        }

        function recordProduction() {
            const date = document.getElementById('production-date').value;
            const recipeId = document.getElementById('production-recipe').value;
            
            if (!date || !recipeId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            const recipe = recipes.find(r => r.id == recipeId);
            if (!recipe) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å');
                return;
            }
            
            const selectedType = document.querySelector('input[name="production-type"]:checked').value;
            let totalPieces = 0;
            
            if (selectedType === 'batch') {
                const batches = parseFloat(document.getElementById('production-batches').value) || 0;
                if (batches <= 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï');
                    return;
                }
                totalPieces = batches * recipe.yield;
            } else {
                totalPieces = parseFloat(document.getElementById('production-pieces').value) || 0;
                if (totalPieces <= 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï');
                    return;
                }
            }
            
            const batchesNeeded = totalPieces / recipe.yield;
            const totalCost = recipe.totalCost * batchesNeeded;
            
            // Check and deduct ingredients
            let canProduce = true;
            const ingredientUpdates = [];
            
            recipe.ingredients.forEach(ingredient => {
                const needed = ingredient.amount * batchesNeeded;
                const available = inventory.find(item => item.id == ingredient.id);
                const availableAmount = available ? (available.amount || available.grams || 0) : 0;
                
                if (availableAmount < needed) {
                    canProduce = false;
                    alert(`‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö ${ingredient.name} ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${needed.toFixed(1)} ‡∏°‡∏µ ${availableAmount.toFixed(1)})`);
                    return;
                }
                
                ingredientUpdates.push({
                    id: ingredient.id,
                    newAmount: availableAmount - needed
                });
            });
            
            if (!canProduce) return;
            
            // Update inventory
            ingredientUpdates.forEach(update => {
                const item = inventory.find(item => item.id == update.id);
                if (item) {
                    item.amount = update.newAmount;
                    if (item.grams !== undefined) item.grams = update.newAmount; // For backward compatibility
                }
            });
            
            // Record production
            production.push({
                id: Date.now(),
                date,
                recipeId: recipe.id,
                recipeName: recipe.name,
                totalPieces,
                cost: totalCost,
                batchesProduced: batchesNeeded
            });
            
            saveData();
            updateDisplays();
            
            // Clear form
            document.getElementById('production-batches').value = '';
            document.getElementById('production-pieces').value = '';
            updateProductionInfo();
            
            alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï ${recipe.name} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${totalPieces} ‡∏ä‡∏¥‡πâ‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
        }

        function removeProduction(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                production = production.filter(prod => prod.id !== id);
                saveData();
                updateDisplays();
            }
        }

        // Category icon selection
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.category-icon-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove selection from all buttons
                    document.querySelectorAll('.category-icon-btn').forEach(b => {
                        b.classList.remove('bg-yellow-100', 'border-yellow-500');
                        b.classList.add('border-gray-300');
                    });
                    
                    // Add selection to clicked button
                    this.classList.add('bg-yellow-100', 'border-yellow-500');
                    this.classList.remove('border-gray-300');
                    
                    // Update hidden input
                    document.getElementById('selected-category-icon').value = this.dataset.icon;
                });
            });
            
            // Add event listeners for recipe form
            document.getElementById('recipe-yield').addEventListener('input', calculateRecipeCost);
            document.getElementById('selling-price').addEventListener('input', calculateRecipeCost);
            
            // Initialize first ingredient row event listeners
            const firstRow = document.querySelector('#recipe-ingredients .flex');
            if (firstRow) {
                firstRow.querySelector('.ingredient-select').addEventListener('change', calculateRecipeCost);
                firstRow.querySelector('.ingredient-amount').addEventListener('input', calculateRecipeCost);
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9686187b454a10e2',t:'MTc1NDA1OTI3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
