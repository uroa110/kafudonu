<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏Ç‡∏ô‡∏°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-50 to-orange-50 min-h-screen">
    <div class="container mx-auto px-3 sm:px-4 py-4 sm:py-6">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-2">üßÅ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏Ç‡∏ô‡∏°</h1>
            <p class="text-gray-600 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å ‡∏™‡∏π‡∏ï‡∏£ ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≥‡πÑ‡∏£</p>
        </div>

        <!-- Navigation -->
        <div class="bg-white rounded-xl shadow-lg p-3 mb-6">
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-2">
                <button onclick="showTab('ingredients')" id="tab-ingredients" class="px-3 py-3 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors text-sm font-medium">
                    <div class="text-lg mb-1">üì¶</div>
                    <div>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</div>
                </button>
                <button onclick="showTab('inventory')" id="tab-inventory" class="px-3 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium">
                    <div class="text-lg mb-1">üìã</div>
                    <div>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                </button>
                <button onclick="showTab('recipes')" id="tab-recipes" class="px-3 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium">
                    <div class="text-lg mb-1">üìù</div>
                    <div>‡∏™‡∏π‡∏ï‡∏£‡∏Ç‡∏ô‡∏°</div>
                </button>
                <button onclick="showTab('production')" id="tab-production" class="px-3 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium">
                    <div class="text-lg mb-1">üè≠</div>
                    <div>‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                </button>
                <button onclick="showTab('sales')" id="tab-sales" class="px-3 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium">
                    <div class="text-lg mb-1">üí∞</div>
                    <div>‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
                </button>
                <button onclick="showTab('reports')" id="tab-reports" class="px-3 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium col-span-2 sm:col-span-1">
                    <div class="text-lg mb-1">üìä</div>
                    <div>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
                </button>
            </div>
        </div>

        <!-- Inventory Tab -->
        <div id="inventory-tab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4 sm:mb-0">üìã ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h2>
                    <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
                        <div class="relative">
                            <input type="text" id="inventory-search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm w-full sm:w-64">
                            <div class="absolute left-3 top-2.5 text-gray-400">üîç</div>
                        </div>
                        <select id="inventory-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm">
                            <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="low">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</option>
                            <option value="expired">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</option>
                            <option value="expiring">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</option>
                        </select>
                        <button onclick="exportInventoryCSV()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm font-medium">
                            üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <div class="text-sm text-blue-600 mb-1">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="text-2xl font-bold text-blue-800" id="total-ingredients">0</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                        <div class="text-sm text-red-600 mb-1">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div>
                        <div class="text-2xl font-bold text-red-800" id="low-stock-count">0</div>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                        <div class="text-sm text-orange-600 mb-1">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</div>
                        <div class="text-2xl font-bold text-orange-800" id="expiring-count">0</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <div class="text-sm text-green-600 mb-1">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å</div>
                        <div class="text-xl font-bold text-green-800" id="stock-value">0 ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                </div>

                <!-- Inventory Table -->
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body">
                            <!-- Inventory rows will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div id="inventory-empty" class="text-center py-12 hidden">
                    <div class="text-6xl mb-4">üì¶</div>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å</h3>
                    <p class="text-gray-500">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö"</p>
                </div>
            </div>
        </div>

        <!-- Ingredients Tab -->
        <div id="ingredients-tab" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                <!-- Add Ingredient Form -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà</h2>
                    <form id="ingredient-form" class="space-y-4">
                        <div class="relative">
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö <span class="text-red-500">*</span></label>
                            <input type="text" id="ingredient-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏õ‡πâ‡∏á‡∏™‡∏≤‡∏•‡∏µ" autocomplete="off" oninput="showIngredientSuggestions()" onfocus="showIngredientSuggestions()" onblur="hideIngredientSuggestions()" required>
                            <div id="ingredient-suggestions" class="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-48 overflow-y-auto hidden">
                                <!-- Suggestions will appear here -->
                            </div>
                        </div>
                        
                        <!-- Simple Input Mode Toggle -->
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <div class="flex items-center justify-between mb-3">
                                <label class="text-sm font-medium text-blue-800">‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡πà‡∏≤‡∏¢</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="simple-mode" class="sr-only peer" onchange="toggleInputMode()">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <p class="text-xs text-blue-600">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ‡πÉ‡∏™‡πà‡πÅ‡∏Ñ‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ñ‡∏∏‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏£‡∏±‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                        </div>
                        
                        <!-- Simple Mode Input -->
                        <div id="simple-input" class="hidden">
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <h3 class="font-medium text-green-800 mb-3">üì¶ ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢</h3>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                    <div>
                                        <label class="block text-sm font-medium text-green-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ñ‡∏∏‡∏á <span class="text-red-500">*</span></label>
                                        <input type="number" id="simple-bags" class="w-full p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-base" placeholder="1" min="0.01" step="0.01" oninput="calculateFromBags()">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-green-700 mb-1">‡∏Å‡∏£‡∏±‡∏°/‡∏ñ‡∏∏‡∏á <span class="text-red-500">*</span></label>
                                        <input type="number" id="simple-grams-per-bag" class="w-full p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-base" placeholder="1000" min="0.01" step="0.01" oninput="calculateFromBags()">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-green-700 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏ñ‡∏∏‡∏á <span class="text-red-500">*</span></label>
                                        <input type="number" id="simple-price-per-bag" class="w-full p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-base" placeholder="60" min="0.01" step="0.01" oninput="calculateFromBags()">
                                    </div>
                                </div>
                                <div class="mt-3 p-3 bg-white rounded-lg border border-green-200">
                                    <div class="text-sm text-green-700">
                                        <div>üìä <strong>‡∏£‡∏ß‡∏°:</strong> <span id="total-grams">0</span> ‡∏Å‡∏£‡∏±‡∏°</div>
                                        <div>üí∞ <strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°:</strong> <span id="total-price">0</span> ‡∏ö‡∏≤‡∏ó</div>
                                        <div>üè∑Ô∏è <strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏±‡∏°:</strong> <span id="price-per-gram">0.00</span> ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏£‡∏±‡∏°</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Advanced Mode Input -->
                        <div id="advanced-input">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó) <span class="text-red-500">*</span></label>
                                    <input type="number" id="ingredient-price" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" placeholder="60" min="0.01" step="0.01" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì <span class="text-red-500">*</span></label>
                                    <input type="number" id="ingredient-quantity" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" placeholder="1000" min="0.01" step="0.01" required>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢ <span class="text-red-500">*</span></label>
                                    <select id="ingredient-unit" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" required>
                                        <option value="‡∏Å‡∏£‡∏±‡∏°">‡∏Å‡∏£‡∏±‡∏°</option>
                                        <option value="‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°">‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°</option>
                                        <option value="‡∏•‡∏¥‡∏ï‡∏£">‡∏•‡∏¥‡∏ï‡∏£</option>
                                        <option value="‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏•‡∏¥‡∏ï‡∏£">‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏•‡∏¥‡∏ï‡∏£</option>
                                        <option value="‡∏ü‡∏≠‡∏á">‡∏ü‡∏≠‡∏á</option>
                                        <option value="‡∏ä‡πâ‡∏≠‡∏ô‡πÇ‡∏ï‡πä‡∏∞">‡∏ä‡πâ‡∏≠‡∏ô‡πÇ‡∏ï‡πä‡∏∞</option>
                                        <option value="‡∏ä‡∏¥‡πâ‡∏ô">‡∏ä‡∏¥‡πâ‡∏ô</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô) <span class="text-red-500">*</span></label>
                                    <input type="number" id="ingredient-min" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" placeholder="100" min="0" step="0.01" required>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                            <input type="date" id="ingredient-expiry" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base">
                        </div>
                        <button type="submit" class="w-full bg-pink-500 text-white py-3 rounded-lg hover:bg-pink-600 transition-colors font-medium">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</button>
                    </form>
                </div>

                <!-- Ingredients List -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h2>
                    <div id="ingredients-list" class="space-y-3 max-h-96 overflow-y-auto">
                        <!-- Ingredients will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Low Stock Alerts -->
            <div class="bg-red-50 border border-red-200 rounded-xl p-6 mt-6" id="low-stock-alert" style="display: none;">
                <h3 class="text-lg font-semibold text-red-800 mb-3">‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</h3>
                <div id="low-stock-list" class="space-y-2"></div>
            </div>
        </div>

        <!-- Recipes Tab -->
        <div id="recipes-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                <!-- Add Recipe Form -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üç∞ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏π‡∏ï‡∏£‡∏Ç‡∏ô‡∏°‡πÉ‡∏´‡∏°‡πà</h2>
                    <form id="recipe-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</label>
                            <input type="text" id="recipe-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡πâ‡∏Å‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡∏´‡∏≠‡∏°">
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="recipe-price" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" placeholder="25">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ</label>
                                <input type="number" id="recipe-yield" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" placeholder="12">
                            </div>
                        </div>
                        
                        <div class="border-t pt-4">
                            <h3 class="font-medium text-gray-700 mb-3">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</h3>
                            <div id="recipe-ingredients" class="space-y-2">
                                <div class="flex flex-col sm:flex-row gap-2">
                                    <select class="flex-1 p-3 border border-gray-300 rounded-lg recipe-ingredient-select text-base">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                                    </select>
                                    <input type="number" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì" class="w-full sm:w-24 p-3 border border-gray-300 rounded-lg recipe-ingredient-amount text-base">
                                    <button type="button" onclick="removeRecipeIngredient(this)" class="px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm font-medium">‡∏•‡∏ö</button>
                                </div>
                            </div>
                            <button type="button" onclick="addRecipeIngredient()" class="mt-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</button>
                        </div>
                        
                        <button type="submit" class="w-full bg-pink-500 text-white py-3 rounded-lg hover:bg-pink-600 transition-colors font-medium">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏π‡∏ï‡∏£</button>
                    </form>
                </div>

                <!-- Recipes List -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üìñ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ï‡∏£‡∏Ç‡∏ô‡∏°</h2>
                    <div id="recipes-list" class="space-y-3 max-h-96 overflow-y-auto">
                        <!-- Recipes will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Production Tab -->
        <div id="production-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                <!-- Production Form -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üè≠ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</h2>
                    <form id="production-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£</label>
                            <select id="production-recipe" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ú‡∏•‡∏¥‡∏ï</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï (‡∏ä‡∏¥‡πâ‡∏ô)</label>
                            <input type="number" id="production-quantity" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" placeholder="12">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï</label>
                            <input type="date" id="production-date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base">
                        </div>
                        <button type="submit" class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors font-medium">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</button>
                    </form>
                </div>

                <!-- Production History -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</h2>
                    <div id="production-history" class="space-y-3 max-h-96 overflow-y-auto">
                        <!-- Production history will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Sales Tab -->
        <div id="sales-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                <!-- Sales Form -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üí∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h2>
                    <form id="sales-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</label>
                            <select id="sales-recipe" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢ (‡∏ä‡∏¥‡πâ‡∏ô)</label>
                            <input type="number" id="sales-quantity" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" placeholder="5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</label>
                            <input type="date" id="sales-date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base">
                        </div>
                        <button type="submit" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors font-medium">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</button>
                    </form>
                </div>

                <!-- Sales History -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h2>
                        <button onclick="toggleSalesSort()" id="sales-sort-btn" class="px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium">
                            üìÖ ‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏Å‡πà‡∏≤
                        </button>
                    </div>
                    <div id="sales-history" class="space-y-3 max-h-96 overflow-y-auto">
                        <!-- Sales history will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                <!-- Profit Summary -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üíπ ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≥‡πÑ‡∏£-‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</h2>
                    <div id="profit-summary" class="space-y-4">
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="text-sm text-green-600">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                            <div class="text-2xl font-bold text-green-800" id="total-revenue">0 ‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <div class="text-sm text-red-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°</div>
                            <div class="text-2xl font-bold text-red-800" id="total-cost">0 ‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="text-sm text-blue-600">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</div>
                            <div class="text-2xl font-bold text-blue-800" id="net-profit">0 ‡∏ö‡∏≤‡∏ó</div>
                        </div>
                    </div>
                </div>

                <!-- Best Selling Items -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üèÜ ‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h2>
                    <div id="best-selling" class="space-y-3">
                        <!-- Best selling items will be displayed here -->
                    </div>
                </div>

                <!-- Ingredient Usage -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üìä ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h2>
                    <div id="ingredient-usage" class="space-y-3">
                        <!-- Ingredient usage will be displayed here -->
                    </div>
                </div>

                <!-- Weekly Report -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h2>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</label>
                        <input type="week" id="report-week" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" onchange="generateWeeklyReport()">
                    </div>
                    
                    <!-- Weekly Report Content -->
                    <div id="weekly-report-content" class="hidden">
                        <!-- Weekly Summary Cards -->
                        <div id="weekly-summary" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <!-- Summary cards will be populated here -->
                        </div>
                        
                        <!-- Daily Sales Chart -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">üìà ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div id="daily-sales-chart" class="space-y-3">
                                    <!-- Daily sales bars will be populated here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Daily Analysis Table -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">üìã ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse border border-gray-300">
                                    <thead>
                                        <tr class="bg-blue-50">
                                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏ß‡∏±‡∏ô</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏ä‡∏¥‡πâ‡∏ô‡∏£‡∏ß‡∏°</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏Å‡∏≥‡πÑ‡∏£</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="daily-analysis-table">
                                        <!-- Daily analysis data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Weekly Insights -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">üí° ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å</h3>
                            <div id="weekly-insights" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Insights will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Popular Items by Day -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">üç∞ ‡πÄ‡∏°‡∏ô‡∏π‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô</h3>
                            <div id="daily-popular-items" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <!-- Daily popular items will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="weekly-report-empty" class="text-center py-8">
                        <div class="text-4xl mb-3">üìä</div>
                        <p class="text-gray-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>
                    </div>
                </div>

                <!-- Monthly Report -->
                <div class="bg-white rounded-xl shadow-lg p-6 col-span-1 lg:col-span-2">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üìÖ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
                        <input type="month" id="report-month" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-base" onchange="generateMonthlyReport()">
                    </div>
                    
                    <!-- Report Content -->
                    <div id="monthly-report-content" class="hidden">
                        <!-- Summary Cards -->
                        <div id="monthly-summary" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <!-- Summary cards will be populated here -->
                        </div>
                        
                        <!-- Best Selling Table -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">üèÜ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ TOP 5</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse border border-gray-300">
                                    <thead>
                                        <tr class="bg-yellow-50">
                                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≤‡∏¢</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏Å‡∏≥‡πÑ‡∏£</th>
                                        </tr>
                                    </thead>
                                    <tbody id="best-selling-table">
                                        <!-- Best selling data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Ingredient Usage Table -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">üì¶ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö TOP 10</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse border border-gray-300">
                                    <thead>
                                        <tr class="bg-blue-50">
                                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">% ‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ingredient-usage-table">
                                        <!-- Ingredient usage data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Sales History Table -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">üí∞ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse border border-gray-300">
                                    <thead>
                                        <tr class="bg-green-50">
                                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                            <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏ä‡∏¥‡πâ‡∏ô</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</th>
                                            <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-700">‡∏Å‡∏≥‡πÑ‡∏£</th>
                                        </tr>
                                    </thead>
                                    <tbody id="monthly-sales-table">
                                        <!-- Monthly sales data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Export Button -->
                        <div class="text-center">
                            <button onclick="exportReportAsImage()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                                üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                            </button>
                        </div>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="monthly-report-empty" class="text-center py-8">
                        <div class="text-4xl mb-3">üìÖ</div>
                        <p class="text-gray-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let ingredients = JSON.parse(localStorage.getItem('ingredients')) || [];
        let recipes = JSON.parse(localStorage.getItem('recipes')) || [];
        let productions = JSON.parse(localStorage.getItem('productions')) || [];
        let sales = JSON.parse(localStorage.getItem('sales')) || [];
        let ingredientHistory = JSON.parse(localStorage.getItem('ingredientHistory')) || [];
        let salesSortNewestFirst = true; // Default to newest first

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            document.getElementById('production-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('sales-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('report-month').value = new Date().toISOString().slice(0, 7);
            
            // Set current week as default
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentWeek = getWeekNumber(today);
            document.getElementById('report-week').value = `${currentYear}-W${currentWeek.toString().padStart(2, '0')}`;
            
            displayIngredients();
            displayRecipes();
            displayProductions();
            displaySales();
            updateReports();
            checkLowStock();
            displayInventory();
            
            // Add event listeners for inventory search and filter
            document.getElementById('inventory-search').addEventListener('input', displayInventory);
            document.getElementById('inventory-filter').addEventListener('change', displayInventory);
        });

        // Ingredient suggestions functions
        function showIngredientSuggestions() {
            const input = document.getElementById('ingredient-name');
            const suggestionsDiv = document.getElementById('ingredient-suggestions');
            const query = input.value.toLowerCase().trim();
            
            if (query.length === 0) {
                // Show all history when input is empty
                displayAllSuggestions();
                return;
            }
            
            // Filter suggestions based on input
            const filteredHistory = ingredientHistory.filter(item => 
                item.name.toLowerCase().includes(query)
            );
            
            if (filteredHistory.length === 0) {
                suggestionsDiv.classList.add('hidden');
                return;
            }
            
            suggestionsDiv.innerHTML = filteredHistory.map(item => {
                const pricePerUnit = item.quantity > 0 ? (item.price / item.quantity).toFixed(4) : '0.0000';
                const bagInfo = item.bags && item.gramsPerBag ? ` (${item.bags} ‡∏ñ‡∏∏‡∏á √ó ${item.gramsPerBag} ‡∏Å‡∏£‡∏±‡∏°)` : '';
                return `
                    <div class="p-3 hover:bg-pink-50 cursor-pointer border-b border-gray-100 last:border-b-0" onclick="selectIngredientSuggestion('${item.name}', ${item.price}, ${item.quantity}, '${item.unit}', ${item.minStock}, '${item.expiry}', ${item.bags || 0}, ${item.gramsPerBag || 0}, ${item.pricePerBag || 0})">
                        <div class="font-medium text-gray-800">${item.name}</div>
                        <div class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤: ${item.price} ‡∏ö‡∏≤‡∏ó / ${item.quantity} ${item.unit}${bagInfo}</div>
                        <div class="text-sm text-blue-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠${item.unit}: ${pricePerUnit} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs text-gray-500">‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${new Date(item.lastUsed).toLocaleDateString('th-TH')}</div>
                    </div>
                `;
            }).join('');
            
            suggestionsDiv.classList.remove('hidden');
        }
        
        function displayAllSuggestions() {
            const suggestionsDiv = document.getElementById('ingredient-suggestions');
            
            if (ingredientHistory.length === 0) {
                suggestionsDiv.classList.add('hidden');
                return;
            }
            
            // Sort by most recently used
            const sortedHistory = [...ingredientHistory].sort((a, b) => new Date(b.lastUsed) - new Date(a.lastUsed));
            
            suggestionsDiv.innerHTML = sortedHistory.slice(0, 10).map(item => {
                const pricePerUnit = item.quantity > 0 ? (item.price / item.quantity).toFixed(4) : '0.0000';
                const bagInfo = item.bags && item.gramsPerBag ? ` (${item.bags} ‡∏ñ‡∏∏‡∏á √ó ${item.gramsPerBag} ‡∏Å‡∏£‡∏±‡∏°)` : '';
                return `
                    <div class="p-3 hover:bg-pink-50 cursor-pointer border-b border-gray-100 last:border-b-0" onclick="selectIngredientSuggestion('${item.name}', ${item.price}, ${item.quantity}, '${item.unit}', ${item.minStock}, '${item.expiry}', ${item.bags || 0}, ${item.gramsPerBag || 0}, ${item.pricePerBag || 0})">
                        <div class="font-medium text-gray-800">${item.name}</div>
                        <div class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤: ${item.price} ‡∏ö‡∏≤‡∏ó / ${item.quantity} ${item.unit}${bagInfo}</div>
                        <div class="text-sm text-blue-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠${item.unit}: ${pricePerUnit} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs text-gray-500">‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${new Date(item.lastUsed).toLocaleDateString('th-TH')}</div>
                    </div>
                `;
            }).join('');
            
            if (sortedHistory.length > 0) {
                suggestionsDiv.classList.remove('hidden');
            }
        }
        
        function selectIngredientSuggestion(name, price, quantity, unit, minStock, expiry, bags = 0, gramsPerBag = 0, pricePerBag = 0) {
            document.getElementById('ingredient-name').value = name;
            document.getElementById('ingredient-price').value = price;
            document.getElementById('ingredient-quantity').value = quantity;
            document.getElementById('ingredient-unit').value = unit;
            document.getElementById('ingredient-min').value = minStock;
            document.getElementById('ingredient-expiry').value = expiry || '';
            
            // Fill simple mode fields if available
            if (bags > 0 && gramsPerBag > 0 && pricePerBag > 0) {
                document.getElementById('simple-bags').value = bags;
                document.getElementById('simple-grams-per-bag').value = gramsPerBag;
                document.getElementById('simple-price-per-bag').value = pricePerBag;
                calculateFromBags();
            }
            
            hideIngredientSuggestions();
        }
        
        function hideIngredientSuggestions() {
            setTimeout(() => {
                document.getElementById('ingredient-suggestions').classList.add('hidden');
            }, 200);
        }
        
        function saveToIngredientHistory(ingredientData) {
            // Check if ingredient already exists in history
            const existingIndex = ingredientHistory.findIndex(item => item.name === ingredientData.name);
            
            const historyItem = {
                name: ingredientData.name,
                price: ingredientData.price,
                quantity: ingredientData.quantity,
                unit: ingredientData.unit,
                minStock: ingredientData.minStock,
                expiry: ingredientData.expiry,
                bags: ingredientData.bags || 0,
                gramsPerBag: ingredientData.gramsPerBag || 0,
                pricePerBag: ingredientData.pricePerBag || 0,
                lastUsed: new Date().toISOString()
            };
            
            if (existingIndex !== -1) {
                // Update existing item
                ingredientHistory[existingIndex] = historyItem;
            } else {
                // Add new item
                ingredientHistory.push(historyItem);
            }
            
            // Keep only last 50 items to prevent storage bloat
            if (ingredientHistory.length > 50) {
                ingredientHistory = ingredientHistory.sort((a, b) => new Date(b.lastUsed) - new Date(a.lastUsed)).slice(0, 50);
            }
            
            localStorage.setItem('ingredientHistory', JSON.stringify(ingredientHistory));
        }

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('bg-pink-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            document.getElementById('tab-' + tabName).classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('tab-' + tabName).classList.add('bg-pink-500', 'text-white');
        }

        // Simple mode functions
        function toggleInputMode() {
            const simpleMode = document.getElementById('simple-mode').checked;
            const simpleInput = document.getElementById('simple-input');
            const advancedInput = document.getElementById('advanced-input');
            
            if (simpleMode) {
                simpleInput.classList.remove('hidden');
                advancedInput.classList.add('hidden');
                // Auto-set unit to ‡∏Å‡∏£‡∏±‡∏° in simple mode
                document.getElementById('ingredient-unit').value = '‡∏Å‡∏£‡∏±‡∏°';
            } else {
                simpleInput.classList.add('hidden');
                advancedInput.classList.remove('hidden');
            }
        }
        
        function calculateFromBags() {
            const bags = parseFloat(document.getElementById('simple-bags').value) || 0;
            const gramsPerBag = parseFloat(document.getElementById('simple-grams-per-bag').value) || 0;
            const pricePerBag = parseFloat(document.getElementById('simple-price-per-bag').value) || 0;
            
            const totalGrams = bags * gramsPerBag;
            const totalPrice = bags * pricePerBag;
            const pricePerGram = totalGrams > 0 ? totalPrice / totalGrams : 0;
            
            document.getElementById('total-grams').textContent = totalGrams.toLocaleString();
            document.getElementById('total-price').textContent = totalPrice.toLocaleString();
            document.getElementById('price-per-gram').textContent = pricePerGram.toFixed(4);
            
            // Auto-fill advanced mode fields
            document.getElementById('ingredient-quantity').value = totalGrams;
            document.getElementById('ingredient-price').value = totalPrice;
            document.getElementById('ingredient-unit').value = '‡∏Å‡∏£‡∏±‡∏°';
        }

        // Ingredient management
        document.getElementById('ingredient-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('ingredient-name').value.trim();
            const minStock = parseFloat(document.getElementById('ingredient-min').value);
            const expiry = document.getElementById('ingredient-expiry').value;
            
            // Check if simple mode is enabled
            const isSimpleMode = document.getElementById('simple-mode').checked;
            
            // Basic validation
            if (!name) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö');
                document.getElementById('ingredient-name').focus();
                return;
            }
            
            if (isNaN(minStock) || minStock < 0) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (0 ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤)');
                document.getElementById('ingredient-min').focus();
                return;
            }
            
            let price, quantity, unit;
            
            if (isSimpleMode) {
                // Simple mode validation
                const bags = parseFloat(document.getElementById('simple-bags').value);
                const gramsPerBag = parseFloat(document.getElementById('simple-grams-per-bag').value);
                const pricePerBag = parseFloat(document.getElementById('simple-price-per-bag').value);
                
                if (!bags || bags <= 0) {
                    alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ñ‡∏∏‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0)');
                    document.getElementById('simple-bags').focus();
                    return;
                }
                
                if (!gramsPerBag || gramsPerBag <= 0) {
                    alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏£‡∏±‡∏°‡∏ï‡πà‡∏≠‡∏ñ‡∏∏‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0)');
                    document.getElementById('simple-grams-per-bag').focus();
                    return;
                }
                
                if (!pricePerBag || pricePerBag <= 0) {
                    alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ñ‡∏∏‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0)');
                    document.getElementById('simple-price-per-bag').focus();
                    return;
                }
                
                // Calculate values from simple mode
                quantity = bags * gramsPerBag;
                price = bags * pricePerBag;
                unit = '‡∏Å‡∏£‡∏±‡∏°';
            } else {
                // Advanced mode validation
                price = parseFloat(document.getElementById('ingredient-price').value);
                quantity = parseFloat(document.getElementById('ingredient-quantity').value);
                unit = document.getElementById('ingredient-unit').value;
                
                if (!price || price <= 0) {
                    alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0)');
                    document.getElementById('ingredient-price').focus();
                    return;
                }
                
                if (!quantity || quantity <= 0) {
                    alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0)');
                    document.getElementById('ingredient-quantity').focus();
                    return;
                }
                
                if (!unit) {
                    alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢');
                    document.getElementById('ingredient-unit').focus();
                    return;
                }
            }
            
            const pricePerUnit = price / quantity;
            
            // Check if ingredient already exists (same name and unit)
            const existingIngredient = ingredients.find(ing => 
                ing.name.toLowerCase() === name.toLowerCase() && ing.unit === unit
            );
            
            if (existingIngredient) {
                // Update existing ingredient - add to stock
                const totalOldValue = existingIngredient.remaining * existingIngredient.pricePerUnit;
                const totalNewValue = quantity * pricePerUnit;
                const totalQuantity = existingIngredient.remaining + quantity;
                
                // Calculate weighted average price per unit
                const newPricePerUnit = (totalOldValue + totalNewValue) / totalQuantity;
                
                existingIngredient.remaining = totalQuantity;
                existingIngredient.pricePerUnit = newPricePerUnit;
                existingIngredient.minStock = minStock; // Update minimum stock
                
                // Update expiry date if new one is provided and is earlier
                if (expiry) {
                    if (!existingIngredient.expiry || new Date(expiry) < new Date(existingIngredient.expiry)) {
                        existingIngredient.expiry = expiry;
                    }
                }
                
                alert(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\nüì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏°: ${(totalQuantity - quantity).toFixed(1)} ${unit}\n‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°: ${quantity} ${unit}\nüìä ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏£‡∏ß‡∏°: ${totalQuantity.toFixed(1)} ${unit}\n\nüí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÉ‡∏´‡∏°‡πà: ${newPricePerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/${unit}`);
            } else {
                // Create new ingredient
                const ingredient = {
                    id: Date.now(),
                    name: name,
                    price: price,
                    quantity: quantity,
                    unit: unit,
                    remaining: quantity,
                    minStock: minStock,
                    expiry: expiry,
                    pricePerUnit: pricePerUnit
                };
                
                ingredients.push(ingredient);
                alert(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\nüì¶ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${quantity} ${unit}\nüí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤: ${pricePerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/${unit}`);
            }
            
            // Save to history for future suggestions
            const isSimpleMode = document.getElementById('simple-mode').checked;
            const historyData = {
                name: name,
                price: price,
                quantity: quantity,
                unit: unit,
                minStock: minStock,
                expiry: expiry
            };
            
            // Add simple mode data if used
            if (isSimpleMode) {
                historyData.bags = parseFloat(document.getElementById('simple-bags').value) || 0;
                historyData.gramsPerBag = parseFloat(document.getElementById('simple-grams-per-bag').value) || 0;
                historyData.pricePerBag = parseFloat(document.getElementById('simple-price-per-bag').value) || 0;
            }
            
            saveToIngredientHistory(historyData);
            
            localStorage.setItem('ingredients', JSON.stringify(ingredients));
            displayIngredients();
            updateRecipeSelects();
            checkLowStock();
            displayInventory();
            this.reset();
            
            // Reset simple mode fields
            document.getElementById('simple-bags').value = '';
            document.getElementById('simple-grams-per-bag').value = '';
            document.getElementById('simple-price-per-bag').value = '';
            document.getElementById('total-grams').textContent = '0';
            document.getElementById('total-price').textContent = '0';
            document.getElementById('price-per-gram').textContent = '0.00';
            
            // Hide suggestions after form reset
            document.getElementById('ingredient-suggestions').classList.add('hidden');
        });

        function displayIngredients() {
            const list = document.getElementById('ingredients-list');
            list.innerHTML = '';
            
            ingredients.forEach(ingredient => {
                const isLowStock = ingredient.remaining <= ingredient.minStock;
                const isExpiringSoon = ingredient.expiry && new Date(ingredient.expiry) <= new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);
                
                const div = document.createElement('div');
                div.className = `p-4 border rounded-lg ${isLowStock ? 'border-red-300 bg-red-50' : 'border-gray-200'}`;
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-800">${ingredient.name}</h3>
                            <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤: ${ingredient.price} ‡∏ö‡∏≤‡∏ó / ${ingredient.quantity} ${ingredient.unit}</p>
                            <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${ingredient.pricePerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/${ingredient.unit}</p>
                            <p class="text-sm ${isLowStock ? 'text-red-600 font-semibold' : 'text-gray-600'}">
                                ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${ingredient.remaining} ${ingredient.unit} ${isLowStock ? '(‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î!)' : ''}
                            </p>
                            ${ingredient.expiry ? `<p class="text-sm ${isExpiringSoon ? 'text-orange-600 font-semibold' : 'text-gray-600'}">
                                ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: ${new Date(ingredient.expiry).toLocaleDateString('th-TH')} ${isExpiringSoon ? '(‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏!)' : ''}
                            </p>` : ''}
                        </div>
                        <button onclick="deleteIngredient(${ingredient.id})" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function deleteIngredient(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                ingredients = ingredients.filter(ing => ing.id !== id);
                localStorage.setItem('ingredients', JSON.stringify(ingredients));
                displayIngredients();
                updateRecipeSelects();
                checkLowStock();
                displayInventory();
            }
        }

        function checkLowStock() {
            const lowStockItems = ingredients.filter(ing => ing.remaining <= ing.minStock);
            const alertDiv = document.getElementById('low-stock-alert');
            const listDiv = document.getElementById('low-stock-list');
            
            if (lowStockItems.length > 0) {
                alertDiv.style.display = 'block';
                listDiv.innerHTML = lowStockItems.map(item => 
                    `<div class="text-red-700">‚Ä¢ ${item.name}: ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${item.remaining} ${item.unit} (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ${item.minStock} ${item.unit})</div>`
                ).join('');
            } else {
                alertDiv.style.display = 'none';
            }
        }

        // Inventory management
        function displayInventory() {
            const searchTerm = document.getElementById('inventory-search').value.toLowerCase();
            const filter = document.getElementById('inventory-filter').value;
            const tableBody = document.getElementById('inventory-table-body');
            const emptyState = document.getElementById('inventory-empty');
            
            let filteredIngredients = ingredients.filter(ingredient => {
                const matchesSearch = ingredient.name.toLowerCase().includes(searchTerm);
                
                if (!matchesSearch) return false;
                
                const isLowStock = ingredient.remaining <= ingredient.minStock;
                const isExpired = ingredient.expiry && new Date(ingredient.expiry) < new Date();
                const isExpiringSoon = ingredient.expiry && new Date(ingredient.expiry) <= new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) && !isExpired;
                
                switch (filter) {
                    case 'low': return isLowStock;
                    case 'expired': return isExpired;
                    case 'expiring': return isExpiringSoon;
                    default: return true;
                }
            });
            
            if (filteredIngredients.length === 0) {
                tableBody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            // Sort by status priority (expired > expiring > low stock > normal)
            filteredIngredients.sort((a, b) => {
                const getStatusPriority = (ingredient) => {
                    const isExpired = ingredient.expiry && new Date(ingredient.expiry) < new Date();
                    const isExpiringSoon = ingredient.expiry && new Date(ingredient.expiry) <= new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) && !isExpired;
                    const isLowStock = ingredient.remaining <= ingredient.minStock;
                    
                    if (isExpired) return 4;
                    if (isExpiringSoon) return 3;
                    if (isLowStock) return 2;
                    return 1;
                };
                
                return getStatusPriority(b) - getStatusPriority(a);
            });
            
            tableBody.innerHTML = filteredIngredients.map(ingredient => {
                const isLowStock = ingredient.remaining <= ingredient.minStock;
                const isExpired = ingredient.expiry && new Date(ingredient.expiry) < new Date();
                const isExpiringSoon = ingredient.expiry && new Date(ingredient.expiry) <= new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) && !isExpired;
                const stockValue = ingredient.remaining * ingredient.pricePerUnit;
                
                let statusBadge = '';
                let rowClass = '';
                
                if (isExpired) {
                    statusBadge = '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded-full">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>';
                    rowClass = 'bg-red-50';
                } else if (isExpiringSoon) {
                    statusBadge = '<span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs font-semibold rounded-full">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>';
                    rowClass = 'bg-orange-50';
                } else if (isLowStock) {
                    statusBadge = '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-semibold rounded-full">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</span>';
                    rowClass = 'bg-yellow-50';
                } else {
                    statusBadge = '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full">‡∏õ‡∏Å‡∏ï‡∏¥</span>';
                }
                
                return `
                    <tr class="${rowClass}">
                        <td class="border border-gray-300 px-4 py-3">
                            <div class="font-medium text-gray-800">${ingredient.name}</div>
                            <div class="text-sm text-gray-600">${ingredient.unit}</div>
                        </td>
                        <td class="border border-gray-300 px-4 py-3 text-center">
                            <div class="font-semibold ${isLowStock ? 'text-red-600' : 'text-gray-800'}">${ingredient.remaining}</div>
                        </td>
                        <td class="border border-gray-300 px-4 py-3 text-center text-gray-600">${ingredient.minStock}</td>
                        <td class="border border-gray-300 px-4 py-3 text-center">${statusBadge}</td>
                        <td class="border border-gray-300 px-4 py-3 text-center text-gray-600">${ingredient.pricePerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</td>
                        <td class="border border-gray-300 px-4 py-3 text-center font-semibold text-green-600">${stockValue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</td>
                        <td class="border border-gray-300 px-4 py-3 text-center text-gray-600">
                            ${ingredient.expiry ? new Date(ingredient.expiry).toLocaleDateString('th-TH') : '-'}
                        </td>
                        <td class="border border-gray-300 px-4 py-3 text-center">
                            <button onclick="adjustStock(${ingredient.id})" class="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 mr-1">
                                ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å
                            </button>
                            <button onclick="deleteIngredient(${ingredient.id})" class="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600">
                                ‡∏•‡∏ö
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            updateInventorySummary();
        }
        
        function updateInventorySummary() {
            const totalIngredients = ingredients.length;
            const lowStockItems = ingredients.filter(ing => ing.remaining <= ing.minStock).length;
            const expiringItems = ingredients.filter(ing => {
                if (!ing.expiry) return false;
                const expiryDate = new Date(ing.expiry);
                const weekFromNow = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);
                return expiryDate <= weekFromNow && expiryDate >= new Date();
            }).length;
            const totalStockValue = ingredients.reduce((sum, ing) => sum + (ing.remaining * ing.pricePerUnit), 0);
            
            document.getElementById('total-ingredients').textContent = totalIngredients;
            document.getElementById('low-stock-count').textContent = lowStockItems;
            document.getElementById('expiring-count').textContent = expiringItems;
            document.getElementById('stock-value').textContent = totalStockValue.toFixed(2).toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
        }
        
        function adjustStock(ingredientId) {
            const ingredient = ingredients.find(ing => ing.id === ingredientId);
            if (!ingredient) return;
            
            const newAmount = prompt(`‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì ${ingredient.name}\n‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${ingredient.remaining} ${ingredient.unit}\n\n‡πÉ‡∏™‡πà‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡πÉ‡∏´‡∏°‡πà:`, ingredient.remaining);
            
            if (newAmount !== null && !isNaN(newAmount) && parseFloat(newAmount) >= 0) {
                ingredient.remaining = parseFloat(newAmount);
                localStorage.setItem('ingredients', JSON.stringify(ingredients));
                displayIngredients();
                displayInventory();
                checkLowStock();
            }
        }
        
        function exportInventoryCSV() {
            if (ingredients.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
                return;
            }
            
            const headers = ['‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö', '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠', '‡∏´‡∏ô‡πà‡∏ß‡∏¢', '‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥', '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠', '‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'];
            
            const csvData = ingredients.map(ingredient => {
                const isLowStock = ingredient.remaining <= ingredient.minStock;
                const isExpired = ingredient.expiry && new Date(ingredient.expiry) < new Date();
                const isExpiringSoon = ingredient.expiry && new Date(ingredient.expiry) <= new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) && !isExpired;
                const stockValue = ingredient.remaining * ingredient.pricePerUnit;
                
                let status = '‡∏õ‡∏Å‡∏ï‡∏¥';
                if (isExpired) status = '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏';
                else if (isExpiringSoon) status = '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏';
                else if (isLowStock) status = '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î';
                
                return [
                    ingredient.name,
                    ingredient.remaining,
                    ingredient.unit,
                    ingredient.minStock,
                    ingredient.pricePerUnit.toFixed(2),
                    stockValue.toFixed(2),
                    ingredient.expiry ? new Date(ingredient.expiry).toLocaleDateString('th-TH') : '-',
                    status
                ];
            });
            
            const csvContent = [headers, ...csvData]
                .map(row => row.map(cell => `"${cell}"`).join(','))
                .join('\n');
            
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `inventory_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Recipe management
        function updateRecipeSelects() {
            const selects = document.querySelectorAll('.recipe-ingredient-select, #production-recipe, #sales-recipe');
            selects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>';
                
                if (select.classList.contains('recipe-ingredient-select')) {
                    ingredients.forEach(ing => {
                        select.innerHTML += `<option value="${ing.id}">${ing.name} (${ing.unit})</option>`;
                    });
                } else {
                    recipes.forEach(recipe => {
                        select.innerHTML += `<option value="${recipe.id}">${recipe.name}</option>`;
                    });
                }
                
                select.value = currentValue;
            });
        }

        function addRecipeIngredient() {
            const container = document.getElementById('recipe-ingredients');
            const div = document.createElement('div');
            div.className = 'flex flex-col sm:flex-row gap-2';
            div.innerHTML = `
                <select class="flex-1 p-3 border border-gray-300 rounded-lg recipe-ingredient-select text-base">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                </select>
                <input type="number" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì" class="w-full sm:w-24 p-3 border border-gray-300 rounded-lg recipe-ingredient-amount text-base">
                <button type="button" onclick="removeRecipeIngredient(this)" class="px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm font-medium">‡∏•‡∏ö</button>
            `;
            container.appendChild(div);
            updateRecipeSelects();
        }

        function removeRecipeIngredient(button) {
            button.parentElement.remove();
        }

        document.getElementById('recipe-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const ingredientRows = document.querySelectorAll('#recipe-ingredients > div');
            const recipeIngredients = [];
            let totalCost = 0;
            
            ingredientRows.forEach(row => {
                const ingredientId = row.querySelector('.recipe-ingredient-select').value;
                const amount = parseFloat(row.querySelector('.recipe-ingredient-amount').value);
                
                if (ingredientId && amount) {
                    const ingredient = ingredients.find(ing => ing.id == ingredientId);
                    const cost = ingredient.pricePerUnit * amount;
                    recipeIngredients.push({
                        ingredientId: parseInt(ingredientId),
                        amount: amount,
                        cost: cost
                    });
                    totalCost += cost;
                }
            });
            
            const recipe = {
                id: Date.now(),
                name: document.getElementById('recipe-name').value,
                price: parseFloat(document.getElementById('recipe-price').value),
                yield: parseInt(document.getElementById('recipe-yield').value),
                ingredients: recipeIngredients,
                totalCost: totalCost,
                costPerPiece: totalCost / parseInt(document.getElementById('recipe-yield').value),
                profitPerPiece: parseFloat(document.getElementById('recipe-price').value) - (totalCost / parseInt(document.getElementById('recipe-yield').value))
            };
            
            recipes.push(recipe);
            localStorage.setItem('recipes', JSON.stringify(recipes));
            displayRecipes();
            updateRecipeSelects();
            this.reset();
            document.getElementById('recipe-ingredients').innerHTML = `
                <div class="flex flex-col sm:flex-row gap-2">
                    <select class="flex-1 p-3 border border-gray-300 rounded-lg recipe-ingredient-select text-base">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                    </select>
                    <input type="number" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì" class="w-full sm:w-24 p-3 border border-gray-300 rounded-lg recipe-ingredient-amount text-base">
                    <button type="button" onclick="removeRecipeIngredient(this)" class="px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm font-medium">‡∏•‡∏ö</button>
                </div>
            `;
            updateRecipeSelects();
        });

        function displayRecipes() {
            const list = document.getElementById('recipes-list');
            list.innerHTML = '';
            
            recipes.forEach(recipe => {
                const div = document.createElement('div');
                div.className = 'p-4 border border-gray-200 rounded-lg';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-800">${recipe.name}</h3>
                            <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢: ${recipe.price} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏¥‡πâ‡∏ô</p>
                            <p class="text-sm text-gray-600">‡πÑ‡∏î‡πâ: ${recipe.yield} ‡∏ä‡∏¥‡πâ‡∏ô</p>
                            <p class="text-sm text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: ${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                            <p class="text-sm text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${recipe.costPerPiece.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                            <p class="text-sm ${recipe.profitPerPiece > 0 ? 'text-green-600' : 'text-red-600'} font-semibold">
                                ‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${recipe.profitPerPiece.toFixed(2)} ‡∏ö‡∏≤‡∏ó
                            </p>
                        </div>
                        <button onclick="deleteRecipe(${recipe.id})" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function deleteRecipe(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                recipes = recipes.filter(recipe => recipe.id !== id);
                localStorage.setItem('recipes', JSON.stringify(recipes));
                displayRecipes();
                updateRecipeSelects();
            }
        }

        // Production management
        document.getElementById('production-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const recipeId = parseInt(document.getElementById('production-recipe').value);
            const quantity = parseInt(document.getElementById('production-quantity').value);
            const date = document.getElementById('production-date').value;
            
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;
            
            // Check if enough ingredients
            let canProduce = true;
            const requiredIngredients = [];
            
            recipe.ingredients.forEach(recipeIng => {
                const ingredient = ingredients.find(ing => ing.id === recipeIng.ingredientId);
                const requiredAmount = (recipeIng.amount / recipe.yield) * quantity;
                requiredIngredients.push({
                    ingredient: ingredient,
                    required: requiredAmount
                });
                
                if (ingredient.remaining < requiredAmount) {
                    canProduce = false;
                }
            });
            
            if (!canProduce) {
                alert('‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï!');
                return;
            }
            
            // Deduct ingredients
            requiredIngredients.forEach(req => {
                const ingredient = ingredients.find(ing => ing.id === req.ingredient.id);
                ingredient.remaining -= req.required;
            });
            
            const production = {
                id: Date.now(),
                recipeId: recipeId,
                recipeName: recipe.name,
                quantity: quantity,
                date: date,
                totalCost: (recipe.totalCost / recipe.yield) * quantity
            };
            
            productions.push(production);
            localStorage.setItem('productions', JSON.stringify(productions));
            localStorage.setItem('ingredients', JSON.stringify(ingredients));
            
            displayProductions();
            displayIngredients();
            displayInventory();
            checkLowStock();
            updateReports();
            this.reset();
        });

        function displayProductions() {
            const list = document.getElementById('production-history');
            list.innerHTML = '';
            
            productions.slice(-10).reverse().forEach(production => {
                const div = document.createElement('div');
                div.className = 'p-3 bg-orange-50 border border-orange-200 rounded-lg';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-medium text-gray-800">${production.recipeName}</h4>
                            <p class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${production.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</p>
                            <p class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date(production.date).toLocaleDateString('th-TH')}</p>
                            <p class="text-sm text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${production.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        <button onclick="deleteProduction(${production.id})" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function deleteProduction(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                productions = productions.filter(prod => prod.id !== id);
                localStorage.setItem('productions', JSON.stringify(productions));
                displayProductions();
                updateReports();
            }
        }

        // Sales management
        document.getElementById('sales-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const recipeId = parseInt(document.getElementById('sales-recipe').value);
            const quantity = parseInt(document.getElementById('sales-quantity').value);
            const date = document.getElementById('sales-date').value;
            
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;
            
            const sale = {
                id: Date.now(),
                recipeId: recipeId,
                recipeName: recipe.name,
                quantity: quantity,
                date: date,
                pricePerPiece: recipe.price,
                totalRevenue: recipe.price * quantity,
                totalCost: recipe.costPerPiece * quantity,
                totalProfit: (recipe.price - recipe.costPerPiece) * quantity
            };
            
            sales.push(sale);
            localStorage.setItem('sales', JSON.stringify(sales));
            displaySales();
            updateReports();
            this.reset();
        });

        function displaySales() {
            const list = document.getElementById('sales-history');
            list.innerHTML = '';
            
            // Sort sales based on current sort preference
            let sortedSales = [...sales];
            if (salesSortNewestFirst) {
                sortedSales.sort((a, b) => new Date(b.date) - new Date(a.date));
            } else {
                sortedSales.sort((a, b) => new Date(a.date) - new Date(b.date));
            }
            
            // Show last 10 items
            sortedSales.slice(0, 10).forEach(sale => {
                const div = document.createElement('div');
                div.className = 'p-3 bg-green-50 border border-green-200 rounded-lg';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-medium text-gray-800">${sale.recipeName}</h4>
                            <p class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${sale.quantity} ‡∏ä‡∏¥‡πâ‡∏ô √ó ${sale.pricePerPiece} ‡∏ö‡∏≤‡∏ó</p>
                            <p class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date(sale.date).toLocaleDateString('th-TH')}</p>
                            <p class="text-sm text-green-600 font-semibold">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ${sale.totalRevenue} ‡∏ö‡∏≤‡∏ó</p>
                            <p class="text-sm text-blue-600">‡∏Å‡∏≥‡πÑ‡∏£: ${sale.totalProfit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        <button onclick="deleteSale(${sale.id})" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }
        
        function toggleSalesSort() {
            salesSortNewestFirst = !salesSortNewestFirst;
            const btn = document.getElementById('sales-sort-btn');
            
            if (salesSortNewestFirst) {
                btn.textContent = 'üìÖ ‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏Å‡πà‡∏≤';
            } else {
                btn.textContent = 'üìÖ ‡πÄ‡∏Å‡πà‡∏≤ ‚Üí ‡πÉ‡∏´‡∏°‡πà';
            }
            
            displaySales();
        }

        function deleteSale(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                sales = sales.filter(sale => sale.id !== id);
                localStorage.setItem('sales', JSON.stringify(sales));
                displaySales();
                updateReports();
            }
        }

        // Reports
        function updateReports() {
            // Profit summary
            const totalRevenue = sales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const totalCost = sales.reduce((sum, sale) => sum + sale.totalCost, 0);
            const netProfit = totalRevenue - totalCost;
            
            document.getElementById('total-revenue').textContent = totalRevenue.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
            document.getElementById('total-cost').textContent = totalCost.toFixed(2).toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
            document.getElementById('net-profit').textContent = netProfit.toFixed(2).toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
            
            // Best selling items
            const salesByRecipe = {};
            sales.forEach(sale => {
                if (!salesByRecipe[sale.recipeName]) {
                    salesByRecipe[sale.recipeName] = { quantity: 0, revenue: 0 };
                }
                salesByRecipe[sale.recipeName].quantity += sale.quantity;
                salesByRecipe[sale.recipeName].revenue += sale.totalRevenue;
            });
            
            const bestSelling = Object.entries(salesByRecipe)
                .sort((a, b) => b[1].quantity - a[1].quantity)
                .slice(0, 5);
            
            const bestSellingDiv = document.getElementById('best-selling');
            bestSellingDiv.innerHTML = bestSelling.map((item, index) => `
                <div class="flex justify-between items-center p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div>
                        <span class="font-medium">${index + 1}. ${item[0]}</span>
                        <div class="text-sm text-gray-600">‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ ${item[1].quantity} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                    </div>
                    <div class="text-right">
                        <div class="font-semibold text-green-600">${item[1].revenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                </div>
            `).join('') || '<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>';
            
            // Ingredient usage
            const ingredientUsage = {};
            productions.forEach(production => {
                const recipe = recipes.find(r => r.id === production.recipeId);
                if (recipe) {
                    recipe.ingredients.forEach(recipeIng => {
                        const ingredient = ingredients.find(ing => ing.id === recipeIng.ingredientId);
                        if (ingredient) {
                            if (!ingredientUsage[ingredient.name]) {
                                ingredientUsage[ingredient.name] = 0;
                            }
                            ingredientUsage[ingredient.name] += (recipeIng.amount / recipe.yield) * production.quantity;
                        }
                    });
                }
            });
            
            const usageDiv = document.getElementById('ingredient-usage');
            const sortedUsage = Object.entries(ingredientUsage)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            usageDiv.innerHTML = sortedUsage.map(item => `
                <div class="flex justify-between items-center p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <span class="font-medium">${item[0]}</span>
                    <span class="text-blue-600 font-semibold">${item[1].toFixed(1)} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                </div>
            `).join('') || '<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</p>';
        }

        function generateMonthlyReport() {
            const month = document.getElementById('report-month').value;
            if (!month) {
                document.getElementById('monthly-report-content').classList.add('hidden');
                document.getElementById('monthly-report-empty').classList.remove('hidden');
                return;
            }
            
            const [year, monthNum] = month.split('-');
            const startDate = new Date(year, monthNum - 1, 1);
            const endDate = new Date(year, monthNum, 0);
            
            // Create month name in Thai
            const thaiMonths = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];
            const monthName = `${thaiMonths[parseInt(monthNum) - 1]} ${parseInt(year) + 543}`;
            
            // Filter data for selected month
            const monthlySales = sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= startDate && saleDate <= endDate;
            });
            
            const monthlyProductions = productions.filter(production => {
                const prodDate = new Date(production.date);
                return prodDate >= startDate && prodDate <= endDate;
            });
            
            // Calculate totals
            const monthlyRevenue = monthlySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const monthlyCost = monthlySales.reduce((sum, sale) => sum + sale.totalCost, 0);
            const monthlyProfit = monthlyRevenue - monthlyCost;
            
            // Show content, hide empty state
            document.getElementById('monthly-report-empty').classList.add('hidden');
            document.getElementById('monthly-report-content').classList.remove('hidden');
            
            // Update summary cards
            const summaryDiv = document.getElementById('monthly-summary');
            summaryDiv.innerHTML = `
                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <div class="text-sm text-green-600 mb-1">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${monthName}</div>
                    <div class="text-2xl font-bold text-green-800">${monthlyRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                    <div class="text-sm text-red-600 mb-1">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
                    <div class="text-2xl font-bold text-red-800">${monthlyCost.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <div class="text-sm text-blue-600 mb-1">‡∏Å‡∏≥‡πÑ‡∏£‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
                    <div class="text-2xl font-bold text-blue-800">${monthlyProfit.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                    <div class="text-sm text-purple-600 mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
                    <div class="text-2xl font-bold text-purple-800">${monthlySales.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
            `;
            
            // Calculate best selling products
            const salesByRecipe = {};
            monthlySales.forEach(sale => {
                if (!salesByRecipe[sale.recipeName]) {
                    salesByRecipe[sale.recipeName] = { 
                        quantity: 0, 
                        revenue: 0, 
                        profit: 0 
                    };
                }
                salesByRecipe[sale.recipeName].quantity += sale.quantity;
                salesByRecipe[sale.recipeName].revenue += sale.totalRevenue;
                salesByRecipe[sale.recipeName].profit += sale.totalProfit;
            });
            
            const bestSelling = Object.entries(salesByRecipe)
                .sort((a, b) => b[1].quantity - a[1].quantity)
                .slice(0, 5);
            
            // Update best selling table
            const bestSellingTable = document.getElementById('best-selling-table');
            if (bestSelling.length > 0) {
                bestSellingTable.innerHTML = bestSelling.map((item, index) => `
                    <tr class="${index % 2 === 0 ? 'bg-white' : 'bg-yellow-25'}">
                        <td class="border border-gray-300 px-4 py-3 text-center font-semibold">${index + 1}</td>
                        <td class="border border-gray-300 px-4 py-3">${item[0]}</td>
                        <td class="border border-gray-300 px-4 py-3 text-center">${item[1].quantity} ‡∏ä‡∏¥‡πâ‡∏ô</td>
                        <td class="border border-gray-300 px-4 py-3 text-center text-green-600 font-semibold">${item[1].revenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                        <td class="border border-gray-300 px-4 py-3 text-center text-blue-600 font-semibold">${item[1].profit.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                    </tr>
                `).join('');
            } else {
                bestSellingTable.innerHTML = `
                    <tr>
                        <td colspan="5" class="border border-gray-300 px-4 py-8 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</td>
                    </tr>
                `;
            }
            
            // Calculate ingredient usage
            const ingredientUsage = {};
            monthlyProductions.forEach(production => {
                const recipe = recipes.find(r => r.id === production.recipeId);
                if (recipe) {
                    recipe.ingredients.forEach(recipeIng => {
                        const ingredient = ingredients.find(ing => ing.id === recipeIng.ingredientId);
                        if (ingredient) {
                            if (!ingredientUsage[ingredient.name]) {
                                ingredientUsage[ingredient.name] = { 
                                    amount: 0, 
                                    cost: 0, 
                                    unit: ingredient.unit 
                                };
                            }
                            const usedAmount = (recipeIng.amount / recipe.yield) * production.quantity;
                            ingredientUsage[ingredient.name].amount += usedAmount;
                            ingredientUsage[ingredient.name].cost += usedAmount * ingredient.pricePerUnit;
                        }
                    });
                }
            });
            
            const sortedUsage = Object.entries(ingredientUsage)
                .sort((a, b) => b[1].cost - a[1].cost)
                .slice(0, 10);
            
            const totalIngredientCost = Object.values(ingredientUsage).reduce((sum, item) => sum + item.cost, 0);
            
            // Update ingredient usage table
            const ingredientUsageTable = document.getElementById('ingredient-usage-table');
            if (sortedUsage.length > 0) {
                ingredientUsageTable.innerHTML = sortedUsage.map((item, index) => {
                    const percentage = totalIngredientCost > 0 ? (item[1].cost / totalIngredientCost * 100) : 0;
                    return `
                        <tr class="${index % 2 === 0 ? 'bg-white' : 'bg-blue-25'}">
                            <td class="border border-gray-300 px-4 py-3">${item[0]}</td>
                            <td class="border border-gray-300 px-4 py-3 text-center">${item[1].amount.toFixed(1)}</td>
                            <td class="border border-gray-300 px-4 py-3 text-center">${item[1].unit}</td>
                            <td class="border border-gray-300 px-4 py-3 text-center text-red-600 font-semibold">${item[1].cost.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                            <td class="border border-gray-300 px-4 py-3 text-center">${percentage.toFixed(1)}%</td>
                        </tr>
                    `;
                }).join('');
            } else {
                ingredientUsageTable.innerHTML = `
                    <tr>
                        <td colspan="5" class="border border-gray-300 px-4 py-8 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</td>
                    </tr>
                `;
            }
            
            // Update monthly sales table
            const monthlySalesTable = document.getElementById('monthly-sales-table');
            if (monthlySales.length > 0) {
                // Sort by date (newest first)
                const sortedSales = [...monthlySales].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                monthlySalesTable.innerHTML = sortedSales.map((sale, index) => `
                    <tr class="${index % 2 === 0 ? 'bg-white' : 'bg-green-25'}">
                        <td class="border border-gray-300 px-4 py-3">${new Date(sale.date).toLocaleDateString('th-TH')}</td>
                        <td class="border border-gray-300 px-4 py-3">${sale.recipeName}</td>
                        <td class="border border-gray-300 px-4 py-3 text-center">${sale.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</td>
                        <td class="border border-gray-300 px-4 py-3 text-center">${sale.pricePerPiece} ‡∏ö‡∏≤‡∏ó</td>
                        <td class="border border-gray-300 px-4 py-3 text-center text-green-600 font-semibold">${sale.totalRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                        <td class="border border-gray-300 px-4 py-3 text-center text-blue-600 font-semibold">${sale.totalProfit.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                    </tr>
                `).join('');
            } else {
                monthlySalesTable.innerHTML = `
                    <tr>
                        <td colspan="6" class="border border-gray-300 px-4 py-8 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</td>
                    </tr>
                `;
            }
        }

        // Helper function to get week number
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        // Weekly Report Generation
        function generateWeeklyReport() {
            const weekInput = document.getElementById('report-week').value;
            if (!weekInput) {
                document.getElementById('weekly-report-content').classList.add('hidden');
                document.getElementById('weekly-report-empty').classList.remove('hidden');
                return;
            }
            
            const [year, week] = weekInput.split('-W');
            const weekNum = parseInt(week);
            
            // Calculate start and end dates of the week
            const jan1 = new Date(year, 0, 1);
            const daysToAdd = (weekNum - 1) * 7;
            const startOfWeek = new Date(jan1.getTime() + daysToAdd * 24 * 60 * 60 * 1000);
            
            // Adjust to Monday (start of week)
            const dayOfWeek = startOfWeek.getDay();
            const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            startOfWeek.setDate(startOfWeek.getDate() + mondayOffset);
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            // Filter sales for the selected week
            const weeklySales = sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= startOfWeek && saleDate <= endOfWeek;
            });
            
            // Show content, hide empty state
            document.getElementById('weekly-report-empty').classList.add('hidden');
            document.getElementById('weekly-report-content').classList.remove('hidden');
            
            // Calculate weekly totals
            const weeklyRevenue = weeklySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const weeklyCost = weeklySales.reduce((sum, sale) => sum + sale.totalCost, 0);
            const weeklyProfit = weeklyRevenue - weeklyCost;
            const totalItems = weeklySales.reduce((sum, sale) => sum + sale.quantity, 0);
            
            // Create Thai week display
            const thaiMonths = [
                '‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.',
                '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'
            ];
            const weekDisplay = `‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà ${weekNum} (${startOfWeek.getDate()} ${thaiMonths[startOfWeek.getMonth()]} - ${endOfWeek.getDate()} ${thaiMonths[endOfWeek.getMonth()]} ${parseInt(year) + 543})`;
            
            // Update summary cards
            const summaryDiv = document.getElementById('weekly-summary');
            summaryDiv.innerHTML = `
                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <div class="text-sm text-green-600 mb-1">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</div>
                    <div class="text-2xl font-bold text-green-800">${weeklyRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <div class="text-sm text-blue-600 mb-1">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</div>
                    <div class="text-2xl font-bold text-blue-800">${weeklyProfit.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                    <div class="text-sm text-purple-600 mb-1">‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <div class="text-2xl font-bold text-purple-800">${totalItems} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                </div>
                <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                    <div class="text-sm text-orange-600 mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
                    <div class="text-2xl font-bold text-orange-800">${weeklySales.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
            `;
            
            // Generate daily analysis
            const dailyData = [];
            const thaiDays = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
            
            for (let i = 0; i < 7; i++) {
                const currentDay = new Date(startOfWeek);
                currentDay.setDate(startOfWeek.getDate() + i);
                
                const dayString = currentDay.toISOString().split('T')[0];
                const daySales = weeklySales.filter(sale => sale.date === dayString);
                
                const dayRevenue = daySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
                const dayProfit = daySales.reduce((sum, sale) => sum + sale.totalProfit, 0);
                const dayItems = daySales.reduce((sum, sale) => sum + sale.quantity, 0);
                
                // Find most popular item for the day
                const itemCounts = {};
                daySales.forEach(sale => {
                    itemCounts[sale.recipeName] = (itemCounts[sale.recipeName] || 0) + sale.quantity;
                });
                
                const mostPopular = Object.entries(itemCounts)
                    .sort((a, b) => b[1] - a[1])[0];
                
                dailyData.push({
                    dayName: thaiDays[currentDay.getDay()],
                    date: currentDay.getDate(),
                    fullDate: dayString,
                    sales: daySales.length,
                    items: dayItems,
                    revenue: dayRevenue,
                    profit: dayProfit,
                    mostPopular: mostPopular ? `${mostPopular[0]} (${mostPopular[1]} ‡∏ä‡∏¥‡πâ‡∏ô)` : '-'
                });
            }
            
            // Create daily sales chart
            const maxRevenue = Math.max(...dailyData.map(d => d.revenue));
            const chartDiv = document.getElementById('daily-sales-chart');
            chartDiv.innerHTML = dailyData.map(day => {
                const percentage = maxRevenue > 0 ? (day.revenue / maxRevenue) * 100 : 0;
                const barColor = day.revenue > 0 ? 'bg-blue-500' : 'bg-gray-200';
                
                return `
                    <div class="flex items-center space-x-3">
                        <div class="w-16 text-sm font-medium text-gray-700">${day.dayName}</div>
                        <div class="flex-1 bg-gray-200 rounded-full h-6 relative">
                            <div class="${barColor} h-6 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
                            <div class="absolute inset-0 flex items-center justify-center text-xs font-semibold text-white">
                                ${day.revenue > 0 ? day.revenue.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó' : ''}
                            </div>
                        </div>
                        <div class="w-20 text-sm text-gray-600 text-right">${day.items} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                    </div>
                `;
            }).join('');
            
            // Update daily analysis table
            const dailyTable = document.getElementById('daily-analysis-table');
            dailyTable.innerHTML = dailyData.map((day, index) => {
                const rowClass = day.revenue > 0 ? (index % 2 === 0 ? 'bg-white' : 'bg-blue-25') : 'bg-gray-50';
                return `
                    <tr class="${rowClass}">
                        <td class="border border-gray-300 px-4 py-3 font-medium">${day.dayName}</td>
                        <td class="border border-gray-300 px-4 py-3 text-center">${day.date}</td>
                        <td class="border border-gray-300 px-4 py-3 text-center">${day.sales}</td>
                        <td class="border border-gray-300 px-4 py-3 text-center">${day.items}</td>
                        <td class="border border-gray-300 px-4 py-3 text-center text-green-600 font-semibold">${day.revenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                        <td class="border border-gray-300 px-4 py-3 text-center text-blue-600 font-semibold">${day.profit.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                        <td class="border border-gray-300 px-4 py-3 text-center text-sm">${day.mostPopular}</td>
                    </tr>
                `;
            }).join('');
            
            // Generate insights
            const bestDay = dailyData.reduce((best, day) => day.revenue > best.revenue ? day : best, dailyData[0]);
            const worstDay = dailyData.reduce((worst, day) => day.revenue < worst.revenue ? day : worst, dailyData[0]);
            const avgDaily = weeklyRevenue / 7;
            const daysWithSales = dailyData.filter(day => day.revenue > 0).length;
            
            // Calculate weekly vs previous week comparison (if data exists)
            const prevWeekStart = new Date(startOfWeek);
            prevWeekStart.setDate(startOfWeek.getDate() - 7);
            const prevWeekEnd = new Date(endOfWeek);
            prevWeekEnd.setDate(endOfWeek.getDate() - 7);
            
            const prevWeekSales = sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= prevWeekStart && saleDate <= prevWeekEnd;
            });
            
            const prevWeekRevenue = prevWeekSales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const revenueChange = prevWeekRevenue > 0 ? ((weeklyRevenue - prevWeekRevenue) / prevWeekRevenue * 100) : 0;
            
            const insightsDiv = document.getElementById('weekly-insights');
            insightsDiv.innerHTML = `
                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                    <h4 class="font-semibold text-yellow-800 mb-2">üèÜ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h4>
                    <p class="text-yellow-700">${bestDay.dayName} (${bestDay.revenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó)</p>
                    <p class="text-sm text-yellow-600">‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ ${bestDay.items} ‡∏ä‡∏¥‡πâ‡∏ô ‡∏à‡∏≤‡∏Å ${bestDay.sales} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                </div>
                <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                    <h4 class="font-semibold text-red-800 mb-2">üìâ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h4>
                    <p class="text-red-700">${worstDay.dayName} (${worstDay.revenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó)</p>
                    <p class="text-sm text-red-600">${worstDay.revenue === 0 ? '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢' : `‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ ${worstDay.items} ‡∏ä‡∏¥‡πâ‡∏ô`}</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h4 class="font-semibold text-blue-800 mb-2">üìä ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h4>
                    <p class="text-blue-700">${avgDaily.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô</p>
                    <p class="text-sm text-blue-600">‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ${daysWithSales}/7 ‡∏ß‡∏±‡∏ô</p>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                    <h4 class="font-semibold text-purple-800 mb-2">üìà ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏Å‡πà‡∏≠‡∏ô</h4>
                    <p class="text-purple-700 ${revenueChange >= 0 ? 'text-green-700' : 'text-red-700'}">
                        ${revenueChange >= 0 ? '‚ÜóÔ∏è' : '‚ÜòÔ∏è'} ${Math.abs(revenueChange).toFixed(1)}%
                    </p>
                    <p class="text-sm text-purple-600">
                        ${revenueChange >= 0 ? '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô' : '‡∏•‡∏î‡∏•‡∏á'} ${Math.abs(weeklyRevenue - prevWeekRevenue).toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó
                    </p>
                </div>
            `;
            
            // Generate popular items by day
            const popularItemsDiv = document.getElementById('daily-popular-items');
            popularItemsDiv.innerHTML = dailyData.filter(day => day.revenue > 0).map(day => {
                const daySales = weeklySales.filter(sale => sale.date === day.fullDate);
                const itemStats = {};
                
                daySales.forEach(sale => {
                    if (!itemStats[sale.recipeName]) {
                        itemStats[sale.recipeName] = { quantity: 0, revenue: 0 };
                    }
                    itemStats[sale.recipeName].quantity += sale.quantity;
                    itemStats[sale.recipeName].revenue += sale.totalRevenue;
                });
                
                const sortedItems = Object.entries(itemStats)
                    .sort((a, b) => b[1].quantity - a[1].quantity)
                    .slice(0, 3);
                
                return `
                    <div class="bg-gradient-to-br from-pink-50 to-orange-50 p-4 rounded-lg border border-pink-200">
                        <h4 class="font-semibold text-gray-800 mb-3">${day.dayName} (${day.date})</h4>
                        <div class="space-y-2">
                            ${sortedItems.map((item, index) => `
                                <div class="flex justify-between items-center text-sm">
                                    <span class="font-medium">${index + 1}. ${item[0]}</span>
                                    <div class="text-right">
                                        <div class="text-blue-600 font-semibold">${item[1].quantity} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                                        <div class="text-green-600 text-xs">${item[1].revenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${sortedItems.length === 0 ? '<p class="text-gray-500 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>' : ''}
                    </div>
                `;
            }).join('') || '<div class="col-span-full text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</div>';
        }

        // Image Export Function
        function exportReportAsImage() {
            const month = document.getElementById('report-month').value;
            if (!month) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô');
                return;
            }
            
            const reportContent = document.getElementById('monthly-report-content');
            if (reportContent.classList.contains('hidden')) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            // Show loading message
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'üì∏ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...';
            button.disabled = true;
            
            // Create month name for filename
            const [year, monthNum] = month.split('-');
            const thaiMonths = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];
            const monthName = `${thaiMonths[parseInt(monthNum) - 1]} ${parseInt(year) + 543}`;
            
            // Create a temporary container for the full report
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            tempContainer.style.top = '0';
            tempContainer.style.width = '1200px'; // Fixed width for consistent layout
            tempContainer.style.backgroundColor = '#ffffff';
            tempContainer.style.padding = '40px';
            tempContainer.style.fontFamily = 'Sarabun, sans-serif';
            tempContainer.style.fontSize = '16px';
            tempContainer.style.lineHeight = '1.5';
            tempContainer.style.color = '#374151';
            
            // Get current report data
            const [currentYear, currentMonthNum] = month.split('-');
            const startDate = new Date(currentYear, currentMonthNum - 1, 1);
            const endDate = new Date(currentYear, currentMonthNum, 0);
            
            const monthlySales = sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= startDate && saleDate <= endDate;
            });
            
            const monthlyProductions = productions.filter(production => {
                const prodDate = new Date(production.date);
                return prodDate >= startDate && prodDate <= endDate;
            });
            
            const monthlyRevenue = monthlySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const monthlyCost = monthlySales.reduce((sum, sale) => sum + sale.totalCost, 0);
            const monthlyProfit = monthlyRevenue - monthlyCost;
            
            // Calculate best selling products
            const salesByRecipe = {};
            monthlySales.forEach(sale => {
                if (!salesByRecipe[sale.recipeName]) {
                    salesByRecipe[sale.recipeName] = { 
                        quantity: 0, 
                        revenue: 0, 
                        profit: 0 
                    };
                }
                salesByRecipe[sale.recipeName].quantity += sale.quantity;
                salesByRecipe[sale.recipeName].revenue += sale.totalRevenue;
                salesByRecipe[sale.recipeName].profit += sale.totalProfit;
            });
            
            const bestSelling = Object.entries(salesByRecipe)
                .sort((a, b) => b[1].quantity - a[1].quantity)
                .slice(0, 5);
            
            // Calculate ingredient usage
            const ingredientUsage = {};
            monthlyProductions.forEach(production => {
                const recipe = recipes.find(r => r.id === production.recipeId);
                if (recipe) {
                    recipe.ingredients.forEach(recipeIng => {
                        const ingredient = ingredients.find(ing => ing.id === recipeIng.ingredientId);
                        if (ingredient) {
                            if (!ingredientUsage[ingredient.name]) {
                                ingredientUsage[ingredient.name] = { 
                                    amount: 0, 
                                    cost: 0, 
                                    unit: ingredient.unit 
                                };
                            }
                            const usedAmount = (recipeIng.amount / recipe.yield) * production.quantity;
                            ingredientUsage[ingredient.name].amount += usedAmount;
                            ingredientUsage[ingredient.name].cost += usedAmount * ingredient.pricePerUnit;
                        }
                    });
                }
            });
            
            const sortedUsage = Object.entries(ingredientUsage)
                .sort((a, b) => b[1].cost - a[1].cost)
                .slice(0, 10);
            
            const totalIngredientCost = Object.values(ingredientUsage).reduce((sum, item) => sum + item.cost, 0);
            
            // Create complete HTML content
            tempContainer.innerHTML = `
                <div style="text-align: center; margin-bottom: 40px; padding: 30px; background: linear-gradient(135deg, #fce7f3 0%, #fed7aa 100%); border-radius: 15px; border: 3px solid #f472b6;">
                    <h1 style="font-size: 36px; font-weight: bold; color: #1f2937; margin-bottom: 15px;">üßÅ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Ç‡∏ô‡∏°</h1>
                    <h2 style="font-size: 24px; color: #374151; margin-bottom: 10px;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${monthName}</h2>
                    <p style="font-size: 16px; color: #6b7280;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: ${new Date().toLocaleDateString('th-TH')}</p>
                </div>
                
                <!-- Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px;">
                    <div style="background: #f0fdf4; padding: 25px; border-radius: 12px; border: 2px solid #bbf7d0; text-align: center;">
                        <div style="font-size: 14px; color: #16a34a; margin-bottom: 8px;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${monthName}</div>
                        <div style="font-size: 28px; font-weight: bold; color: #15803d;">${monthlyRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div style="background: #fef2f2; padding: 25px; border-radius: 12px; border: 2px solid #fecaca; text-align: center;">
                        <div style="font-size: 14px; color: #dc2626; margin-bottom: 8px;">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
                        <div style="font-size: 28px; font-weight: bold; color: #b91c1c;">${monthlyCost.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div style="background: #eff6ff; padding: 25px; border-radius: 12px; border: 2px solid #bfdbfe; text-align: center;">
                        <div style="font-size: 14px; color: #2563eb; margin-bottom: 8px;">‡∏Å‡∏≥‡πÑ‡∏£‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
                        <div style="font-size: 28px; font-weight: bold; color: #1d4ed8;">${monthlyProfit.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div style="background: #faf5ff; padding: 25px; border-radius: 12px; border: 2px solid #d8b4fe; text-align: center;">
                        <div style="font-size: 14px; color: #9333ea; margin-bottom: 8px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
                        <div style="font-size: 28px; font-weight: bold; color: #7c3aed;">${monthlySales.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    </div>
                </div>
                
                <!-- Best Selling Table -->
                <div style="margin-bottom: 40px;">
                    <h3 style="font-size: 22px; font-weight: 600; color: #1f2937; margin-bottom: 20px;">üèÜ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ TOP 5</h3>
                    <table style="width: 100%; border-collapse: collapse; border: 2px solid #d1d5db; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #fef3c7;">
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: left; font-weight: 600; color: #374151;">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: left; font-weight: 600; color: #374151;">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600; color: #374151;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≤‡∏¢</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600; color: #374151;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600; color: #374151;">‡∏Å‡∏≥‡πÑ‡∏£</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${bestSelling.length > 0 ? bestSelling.map((item, index) => `
                                <tr style="background: ${index % 2 === 0 ? '#ffffff' : '#fffbeb'};">
                                    <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600;">${index + 1}</td>
                                    <td style="border: 1px solid #d1d5db; padding: 15px;">${item[0]}</td>
                                    <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center;">${item[1].quantity} ‡∏ä‡∏¥‡πâ‡∏ô</td>
                                    <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center; color: #16a34a; font-weight: 600;">${item[1].revenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                                    <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center; color: #2563eb; font-weight: 600;">${item[1].profit.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                                </tr>
                            `).join('') : `
                                <tr>
                                    <td colspan="5" style="border: 1px solid #d1d5db; padding: 30px; text-align: center; color: #6b7280;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</td>
                                </tr>
                            `}
                        </tbody>
                    </table>
                </div>
                
                <!-- Ingredient Usage Table -->
                <div style="margin-bottom: 40px;">
                    <h3 style="font-size: 22px; font-weight: 600; color: #1f2937; margin-bottom: 20px;">üì¶ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö TOP 10</h3>
                    <table style="width: 100%; border-collapse: collapse; border: 2px solid #d1d5db; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #dbeafe;">
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: left; font-weight: 600; color: #374151;">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600; color: #374151;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600; color: #374151;">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600; color: #374151;">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600; color: #374151;">% ‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedUsage.length > 0 ? sortedUsage.map((item, index) => {
                                const percentage = totalIngredientCost > 0 ? (item[1].cost / totalIngredientCost * 100) : 0;
                                return `
                                    <tr style="background: ${index % 2 === 0 ? '#ffffff' : '#f0f9ff'};">
                                        <td style="border: 1px solid #d1d5db; padding: 15px;">${item[0]}</td>
                                        <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center;">${item[1].amount.toFixed(1)}</td>
                                        <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center;">${item[1].unit}</td>
                                        <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center; color: #dc2626; font-weight: 600;">${item[1].cost.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                                        <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center;">${percentage.toFixed(1)}%</td>
                                    </tr>
                                `;
                            }).join('') : `
                                <tr>
                                    <td colspan="5" style="border: 1px solid #d1d5db; padding: 30px; text-align: center; color: #6b7280;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</td>
                                </tr>
                            `}
                        </tbody>
                    </table>
                </div>
                
                <!-- Monthly Sales Table -->
                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 22px; font-weight: 600; color: #1f2937; margin-bottom: 20px;">üí∞ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3>
                    <table style="width: 100%; border-collapse: collapse; border: 2px solid #d1d5db; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #dcfce7;">
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: left; font-weight: 600; color: #374151;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: left; font-weight: 600; color: #374151;">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600; color: #374151;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600; color: #374151;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏ä‡∏¥‡πâ‡∏ô</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600; color: #374151;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</th>
                                <th style="border: 1px solid #d1d5db; padding: 15px; text-align: center; font-weight: 600; color: #374151;">‡∏Å‡∏≥‡πÑ‡∏£</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${monthlySales.length > 0 ? [...monthlySales].sort((a, b) => new Date(b.date) - new Date(a.date)).map((sale, index) => `
                                <tr style="background: ${index % 2 === 0 ? '#ffffff' : '#f0fdf4'};">
                                    <td style="border: 1px solid #d1d5db; padding: 15px;">${new Date(sale.date).toLocaleDateString('th-TH')}</td>
                                    <td style="border: 1px solid #d1d5db; padding: 15px;">${sale.recipeName}</td>
                                    <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center;">${sale.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</td>
                                    <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center;">${sale.pricePerPiece} ‡∏ö‡∏≤‡∏ó</td>
                                    <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center; color: #16a34a; font-weight: 600;">${sale.totalRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                                    <td style="border: 1px solid #d1d5db; padding: 15px; text-align: center; color: #2563eb; font-weight: 600;">${sale.totalProfit.toFixed(2).toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                                </tr>
                            `).join('') : `
                                <tr>
                                    <td colspan="6" style="border: 1px solid #d1d5db; padding: 30px; text-align: center; color: #6b7280;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</td>
                                </tr>
                            `}
                        </tbody>
                    </table>
                </div>
            `;
            
            // Add to document temporarily
            document.body.appendChild(tempContainer);
            
            // Configure html2canvas options for the temporary container
            const options = {
                backgroundColor: '#ffffff',
                scale: 1.5, // Good quality without being too large
                useCORS: true,
                allowTaint: true,
                width: 1200,
                height: tempContainer.scrollHeight,
                scrollX: 0,
                scrollY: 0,
                logging: false,
                removeContainer: true
            };
            
            // Capture the temporary container
            html2canvas(tempContainer, options).then(canvas => {
                // Create download link
                const link = document.createElement('a');
                link.download = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏°_${year}_${monthNum.padStart(2, '0')}.png`;
                link.href = canvas.toDataURL('image/png', 0.95);
                
                // Trigger download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Remove temporary container
                document.body.removeChild(tempContainer);
                
                // Reset button
                button.textContent = originalText;
                button.disabled = false;
                
                // Show success message
                setTimeout(() => {
                    alert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\nüì∏ ‡πÑ‡∏ü‡∏•‡πå: ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏°_${year}_${monthNum.padStart(2, '0')}.png\nüìÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${monthName}\n\nüñºÔ∏è ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:\n‚Ä¢ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ (‡∏Å‡∏≤‡∏£‡πå‡∏î 4 ‡πÉ‡∏ö)\n‚Ä¢ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ TOP 5 (‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°)\n‚Ä¢ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö TOP 10 (‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°)\n‚Ä¢ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°)\n‚Ä¢ ‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á\n\nüì± ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô!`);
                }, 500);
                
            }).catch(error => {
                console.error('Image export error:', error);
                
                // Remove temporary container
                if (document.body.contains(tempContainer)) {
                    document.body.removeChild(tempContainer);
                }
                
                // Reset button
                button.textContent = originalText;
                button.disabled = false;
                
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            });
        }

        // Initialize selects
        updateRecipeSelects();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'967db6a20190a192',t:'MTc1Mzk3MTM4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
