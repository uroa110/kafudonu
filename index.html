<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bakery Pro - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 to-amber-50 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="bg-gradient-to-r from-orange-500 to-amber-500 rounded-xl shadow-lg p-6 mb-6 text-white">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold mb-2">üßÅ Bakery Pro</h1>
                    <p class="text-orange-100">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</p>
                </div>
                <div class="hidden sm:block text-right">
                    <div class="text-sm text-orange-100">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div>
                    <div class="text-lg font-semibold" id="currentDate"></div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-6">
            <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-3">
                <button onclick="showSection('inventory')" class="nav-btn group bg-blue-50 hover:bg-blue-500 text-blue-600 hover:text-white px-4 py-3 rounded-lg transition-all duration-200 border border-blue-200 hover:border-blue-500">
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-2xl">üì¶</span>
                        <span class="text-sm font-medium">‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                    </div>
                </button>
                <button onclick="showSection('purchase')" class="nav-btn group bg-green-50 hover:bg-green-500 text-green-600 hover:text-white px-4 py-3 rounded-lg transition-all duration-200 border border-green-200 hover:border-green-500">
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-2xl">üõí</span>
                        <span class="text-sm font-medium">‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á</span>
                    </div>
                </button>
                <button onclick="showSection('recipes')" class="nav-btn group bg-purple-50 hover:bg-purple-500 text-purple-600 hover:text-white px-4 py-3 rounded-lg transition-all duration-200 border border-purple-200 hover:border-purple-500">
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-2xl">üìã</span>
                        <span class="text-sm font-medium">‡∏™‡∏π‡∏ï‡∏£</span>
                    </div>
                </button>
                <button onclick="showSection('production')" class="nav-btn group bg-indigo-50 hover:bg-indigo-500 text-indigo-600 hover:text-white px-4 py-3 rounded-lg transition-all duration-200 border border-indigo-200 hover:border-indigo-500">
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-2xl">üè≠</span>
                        <span class="text-sm font-medium">‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</span>
                    </div>
                </button>
                <button onclick="showSection('sales')" class="nav-btn group bg-pink-50 hover:bg-pink-500 text-pink-600 hover:text-white px-4 py-3 rounded-lg transition-all duration-200 border border-pink-200 hover:border-pink-500">
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-2xl">üí∞</span>
                        <span class="text-sm font-medium">‡∏Ç‡∏≤‡∏¢</span>
                    </div>
                </button>
                <button onclick="showSection('reports')" class="nav-btn group bg-teal-50 hover:bg-teal-500 text-teal-600 hover:text-white px-4 py-3 rounded-lg transition-all duration-200 border border-teal-200 hover:border-teal-500">
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-2xl">üìä</span>
                        <span class="text-sm font-medium">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
                    </div>
                </button>

                <button onclick="showSection('pricing')" class="nav-btn group bg-yellow-50 hover:bg-yellow-500 text-yellow-600 hover:text-white px-4 py-3 rounded-lg transition-all duration-200 border border-yellow-200 hover:border-yellow-500">
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-2xl">üí≤</span>
                        <span class="text-sm font-medium">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- Inventory Section -->
        <div id="inventory" class="section bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-blue-800 mb-2">üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                <p class="text-sm text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà -->
                <div class="bg-blue-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-blue-800 border-b border-blue-200 pb-2">
                        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà
                    </h3>
                    <div class="space-y-4">
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-2">üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4>
                            <input type="text" id="itemName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏≠‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå)" class="w-full p-3 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                        </div>
                        
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ -->
                        <div class="bg-white p-4 rounded-lg border border-blue-200">
                            <h4 class="font-medium text-blue-800 mb-3 text-sm">üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ (1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠)</h4>
                            
                            <div class="space-y-3 sm:grid sm:grid-cols-2 sm:gap-3 sm:space-y-0 mb-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</label>
                                    <input type="number" id="packageQuantity" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1000" class="w-full p-2 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                                    <select id="packageUnit" class="w-full p-2 border rounded-lg text-sm" onchange="calculateUnitPrice()">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢</option>
                                        <option value="‡∏Å‡∏£‡∏±‡∏°">‡∏Å‡∏£‡∏±‡∏° (‡∏Å)</option>
                                        <option value="‡∏Å‡∏Å">‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏° (‡∏Å‡∏Å)</option>
                                        <option value="‡∏°‡∏•">‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏•‡∏¥‡∏ï‡∏£ (‡∏°‡∏•)</option>
                                        <option value="‡∏•‡∏¥‡∏ï‡∏£">‡∏•‡∏¥‡∏ï‡∏£ (‡∏•)</option>
                                        <option value="‡∏ä‡πâ‡∏≠‡∏ô‡πÇ‡∏ï‡πä‡∏∞">‡∏ä‡πâ‡∏≠‡∏ô‡πÇ‡∏ï‡πä‡∏∞ (tbsp)</option>
                                        <option value="‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤">‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤ (tsp)</option>
                                        <option value="‡∏ñ‡πâ‡∏ß‡∏¢">‡∏ñ‡πâ‡∏ß‡∏¢‡∏ï‡∏ß‡∏á (cup)</option>
                                        <option value="‡∏ü‡∏≠‡∏á">‡∏ü‡∏≠‡∏á (‡πÑ‡∏Ç‡πà)</option>
                                        <option value="‡∏ä‡∏¥‡πâ‡∏ô">‡∏ä‡∏¥‡πâ‡∏ô</option>
                                        <option value="‡πÅ‡∏û‡πá‡∏Ñ">‡πÅ‡∏û‡πá‡∏Ñ</option>
                                        <option value="‡∏Ç‡∏ß‡∏î">‡∏Ç‡∏ß‡∏î</option>
                                        <option value="‡∏ã‡∏≠‡∏á">‡∏ã‡∏≠‡∏á</option>
                                        <option value="‡∏Å‡∏•‡πà‡∏≠‡∏á">‡∏Å‡∏•‡πà‡∏≠‡∏á</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="block text-xs font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</label>
                                <input type="number" id="packagePrice" placeholder="‡πÄ‡∏ä‡πà‡∏ô 39" class="w-full p-2 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                                <p class="text-xs text-blue-600 mt-1">üí° ‡πÄ‡∏ä‡πà‡∏ô: ‡πÅ‡∏õ‡πâ‡∏á 1 ‡∏ñ‡∏∏‡∏á 1000 ‡∏Å‡∏£‡∏±‡∏° ‡∏£‡∏≤‡∏Ñ‡∏≤ 39 ‡∏ö‡∏≤‡∏ó</p>
                            </div>
                            
                            <!-- Price Calculation Display -->
                            <div id="priceCalculation" class="hidden p-3 bg-green-100 rounded-lg border border-green-300">
                                <h5 class="font-medium text-green-800 mb-2 text-sm">üí∞ ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</h5>
                                <div id="calculationText" class="text-xs text-green-700"></div>
                                <div id="unitPriceResult" class="text-sm font-bold text-green-800 mt-2"></div>
                            </div>
                        </div>
                        
                        <!-- ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô -->
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-2">üìä ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</h4>
                            <input type="number" id="initialStock" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5 (‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á 5 ‡∏ñ‡∏∏‡∏á)" class="w-full p-3 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                            <p class="text-xs text-gray-500 mt-1">‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</p>
                        </div>
                        
                        <button onclick="addInventoryItem()" id="addItemBtn" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 disabled:bg-gray-400 text-sm font-medium" disabled>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</button>
                    </div>
                </div>
                
                <!-- ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô -->
                <div class="bg-white rounded-lg p-4 border-2 border-blue-100">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                        <h3 class="text-lg font-semibold text-gray-800">
                            üìã ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                        </h3>
                        <div class="text-sm text-gray-600">
                            <span id="inventoryCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </div>
                    </div>
                    
                    <!-- Search and Filter Section -->
                    <div class="mb-4 space-y-3">
                        <!-- Search Box -->
                        <div class="relative">
                            <input type="text" id="inventorySearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö... (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏õ‡πâ‡∏á, ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•, ‡πÑ‡∏Ç‡πà)" 
                                   class="w-full p-3 pl-10 border rounded-lg text-sm bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   oninput="searchInventory()">
                            <div class="absolute left-3 top-3 text-gray-400">
                                üîç
                            </div>
                            <button onclick="clearInventorySearch()" id="clearSearchBtn" 
                                    class="absolute right-3 top-3 text-gray-400 hover:text-gray-600 hidden">
                                ‚úï
                            </button>
                        </div>
                        
                        <!-- Quick Filters -->
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterInventory('all')" class="filter-btn active px-3 py-1 rounded-full text-xs bg-blue-500 text-white hover:bg-blue-600">
                                ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterInventory('low-stock')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                ‚ö†Ô∏è ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterInventory('powder')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üåæ ‡πÅ‡∏õ‡πâ‡∏á/‡∏ú‡∏á
                            </button>
                            <button onclick="filterInventory('liquid')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                ü•õ ‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß
                            </button>
                            <button onclick="filterInventory('dairy')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üßà ‡∏ô‡∏°/‡πÄ‡∏ô‡∏¢
                            </button>
                            <button onclick="filterInventory('sweet')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üçØ ‡∏´‡∏ß‡∏≤‡∏ô
                            </button>
                        </div>
                        
                        <!-- Sort Options -->
                        <div class="flex items-center gap-2 text-sm">
                            <span class="text-gray-600">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°:</span>
                            <select id="inventorySort" onchange="sortInventory()" class="px-2 py-1 border rounded text-xs bg-white">
                                <option value="name-asc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Å-‡∏Æ)</option>
                                <option value="name-desc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Æ-‡∏Å)</option>
                                <option value="stock-low">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ô‡πâ‡∏≠‡∏¢-‡∏°‡∏≤‡∏Å</option>
                                <option value="stock-high">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏°‡∏≤‡∏Å-‡∏ô‡πâ‡∏≠‡∏¢</option>
                                <option value="updated-new">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                                <option value="updated-old">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                            </select>
                        </div>
                        
                        <!-- Search Suggestions -->
                        <div id="searchSuggestions" class="hidden">
                            <div class="text-xs text-gray-600 mb-2">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:</div>
                            <div id="suggestionsList" class="flex flex-wrap gap-1">
                                <!-- Suggestions will be shown here -->
                            </div>
                        </div>
                        
                        <!-- Search Results Info -->
                        <div id="searchResults" class="hidden text-sm text-blue-600 bg-blue-50 p-2 rounded">
                            <!-- Search results info will be shown here -->
                        </div>
                    </div>
                    
                    <div id="inventoryList" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Inventory items will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Purchase Section -->
        <div id="purchase" class="section bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-green-800 mb-2">üõí ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á</h2>
                <p class="text-sm text-gray-600">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö -->
                <div class="bg-green-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-green-800 border-b border-green-200 pb-2">
                        üõçÔ∏è ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
                    </h3>
                    <div class="space-y-4">
                        <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</label>
                            <select id="purchaseItem" class="w-full p-3 border rounded-lg text-sm" onchange="updatePurchaseInfo()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                            </select>
                        </div>
                        
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ -->
                        <div id="purchaseInfo" class="hidden bg-white p-4 rounded-lg border border-green-200">
                            <h4 class="font-medium text-green-800 mb-3 text-sm">üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</h4>
                            <div id="packageDetails" class="text-sm text-green-700 mb-3">
                                <!-- Package details will be shown here -->
                            </div>
                            
                            <div class="space-y-3 sm:grid sm:grid-cols-2 sm:gap-3 sm:space-y-0">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠ (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠)</label>
                                    <input type="number" id="purchaseQuantity" placeholder="‡πÄ‡∏ä‡πà‡∏ô 3" class="w-full p-2 border rounded-lg text-sm" oninput="calculatePurchaseConversion()">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</label>
                                    <div class="p-2 border rounded-lg bg-gray-50 flex items-center">
                                        <span id="purchaseUnitDisplay" class="text-gray-600 text-sm">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Conversion Display -->
                            <div id="purchaseConversion" class="hidden mt-3 p-3 bg-blue-100 rounded-lg border border-blue-300">
                                <h5 class="font-medium text-blue-800 mb-2 text-sm">üîÑ ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢</h5>
                                <div id="conversionCalculation" class="text-xs text-blue-700"></div>
                                <div id="totalQuantityResult" class="text-sm font-bold text-blue-800 mt-2"></div>
                                <div id="totalCostResult" class="text-sm font-medium text-green-800 mt-1"></div>
                            </div>
                        </div>
                        
                        <!-- ‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                            <input type="text" id="supplier" placeholder="‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢" class="w-full p-3 border rounded-lg text-sm">
                        </div>
                        
                        <button onclick="makePurchase()" id="makePurchaseBtn" class="w-full bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 disabled:bg-gray-400 text-sm font-medium" disabled>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
                    </div>
                </div>
                
                <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ -->
                <div class="bg-white rounded-lg p-4 border-2 border-green-100">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
                        üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠
                    </h3>
                    <div id="purchaseHistory" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Purchase history will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Production Section -->
        <div id="production" class="section bg-gradient-to-br from-indigo-50 to-purple-100 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-indigo-800 mb-2">üè≠ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</h2>
                <p class="text-sm text-gray-600">‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï -->
                <div class="bg-indigo-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-indigo-800 border-b border-indigo-200 pb-2">
                        üìã ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
                    </h3>
                    <div class="space-y-3">
                        <input type="date" id="productionDate" class="w-full p-3 border rounded-lg text-sm" value="">
                        <select id="productionRecipe" class="w-full p-3 border rounded-lg text-sm" onchange="updateProductionInfo()">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ú‡∏•‡∏¥‡∏ï</option>
                        </select>
                        <input type="number" id="productionQuantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï" class="w-full p-3 border rounded-lg text-sm" oninput="calculateIngredientNeeds()">
                        
                        <div id="ingredientNeeds" class="hidden bg-white p-4 rounded-lg border border-indigo-200">
                            <h4 class="font-semibold text-indigo-800 mb-2 text-sm">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ:</h4>
                            <div id="ingredientsList" class="space-y-2 mb-3">
                                <!-- Ingredients needed will be shown here -->
                            </div>
                            <div id="stockCheck" class="text-sm">
                                <!-- Stock availability check will be shown here -->
                            </div>
                        </div>
                        
                        <button onclick="startProduction()" id="startProductionBtn" class="w-full bg-indigo-500 text-white p-3 rounded-lg hover:bg-indigo-600 disabled:bg-gray-400 text-sm font-medium" disabled>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</button>
                    </div>
                    
                    <div class="mt-6 p-4 bg-white rounded-lg border border-indigo-200">
                        <h4 class="font-semibold text-indigo-800 mb-2 text-sm">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                        <div id="todayProduction" class="space-y-1">
                            <!-- Today's production summary will be shown here -->
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï -->
                <div class="bg-white rounded-lg p-4 border-2 border-indigo-100">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
                        üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
                    </h3>
                    <div id="productionHistory" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Production history will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Recipes Section -->
        <div id="recipes" class="section bg-gradient-to-br from-purple-50 to-pink-100 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-purple-800 mb-2">üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h2>
                <p class="text-sm text-gray-600">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà -->
                <div class="bg-purple-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-purple-800 border-b border-purple-200 pb-2">
                        ‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà
                    </h3>
                    <div class="space-y-4">
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏π‡∏ï‡∏£</label>
                                <input type="text" id="recipeName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï" class="w-full p-3 border rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                                <select id="recipeCategory" class="w-full p-3 border rounded-lg text-sm">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                                    <option value="‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á">üçû ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á</option>
                                    <option value="‡πÇ‡∏î‡∏ô‡∏±‡∏ó">üç© ‡πÇ‡∏î‡∏ô‡∏±‡∏ó</option>
                                    <option value="‡πÄ‡∏Ñ‡πâ‡∏Å">üéÇ ‡πÄ‡∏Ñ‡πâ‡∏Å</option>
                                    <option value="‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ">üç™ ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ</option>
                                    <option value="‡∏°‡∏±‡∏ü‡∏ü‡∏¥‡∏ô">üßÅ ‡∏°‡∏±‡∏ü‡∏ü‡∏¥‡∏ô</option>
                                    <option value="‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á">ü•ê ‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á</option>
                                    <option value="‡∏û‡∏≤‡∏¢">ü•ß ‡∏û‡∏≤‡∏¢</option>
                                    <option value="‡∏Ç‡∏ô‡∏°‡πÑ‡∏ó‡∏¢">üçÆ ‡∏Ç‡∏ô‡∏°‡πÑ‡∏ó‡∏¢</option>
                                    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üç∞ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ</label>
                                <input type="number" id="recipeYield" placeholder="‡πÑ‡∏î‡πâ‡∏Å‡∏µ‡πà‡∏ä‡∏¥‡πâ‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢" class="w-full p-3 border rounded-lg text-sm">
                            </div>
                        </div>
                        
                        <!-- ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
                        <div class="bg-white p-3 rounded-lg border border-blue-200">
                            <h4 class="font-medium text-blue-800 mb-2 text-sm">üßÅ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</h4>
                            <select id="baseRecipe" class="w-full p-2 border rounded-lg text-sm" onchange="loadBaseRecipe()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</option>
                            </select>
                            <p class="text-xs text-blue-600 mt-1">‡πÄ‡∏ä‡πà‡∏ô: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£ "‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤" ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ "‡πÇ‡∏î‡∏ô‡∏±‡∏ó‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï"</p>
                        </div>
                        
                        <!-- ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ -->
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="font-medium text-sm text-gray-700">üßÇ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</h4>
                                <button onclick="clearAllIngredients()" class="text-red-500 hover:text-red-700 text-xs">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                            </div>
                            <div id="recipeIngredients" class="space-y-2">
                                <div class="ingredient-row flex gap-2">
                                    <select class="ingredient-select flex-1 p-2 border rounded text-sm">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                                    </select>
                                    <input type="number" class="ingredient-amount w-20 sm:w-24 p-2 border rounded text-sm" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                                    <button onclick="addIngredientRow()" class="bg-purple-500 text-white px-2 sm:px-3 py-2 rounded hover:bg-purple-600 text-sm">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row gap-2">
                            <button onclick="createRecipe()" id="createRecipeBtn" class="flex-1 bg-purple-500 text-white p-3 rounded-lg hover:bg-purple-600 text-sm font-medium">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£</button>
                            <button onclick="updateRecipe()" id="updateRecipeBtn" class="flex-1 bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 text-sm font-medium hidden">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏π‡∏ï‡∏£</button>
                            <button onclick="cancelEdit()" id="cancelEditBtn" class="bg-gray-500 text-white px-4 py-3 rounded-lg hover:bg-gray-600 text-sm font-medium hidden">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
                <div class="bg-white rounded-lg p-4 border-2 border-purple-100">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                        <h3 class="text-lg font-semibold text-gray-800">
                            üìö ‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </h3>
                        <div class="text-sm text-gray-600">
                            <span id="recipesCount">0</span> ‡∏™‡∏π‡∏ï‡∏£
                        </div>
                    </div>
                    
                    <!-- Filter and View Options -->
                    <div class="mb-4 space-y-3">
                        <!-- Category Filter -->
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterRecipes('all')" class="recipe-filter-btn active px-3 py-1 rounded-full text-xs bg-purple-500 text-white hover:bg-purple-600">
                                ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterRecipes('‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üçû ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á
                            </button>
                            <button onclick="filterRecipes('‡πÇ‡∏î‡∏ô‡∏±‡∏ó')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üç© ‡πÇ‡∏î‡∏ô‡∏±‡∏ó
                            </button>
                            <button onclick="filterRecipes('‡πÄ‡∏Ñ‡πâ‡∏Å')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üéÇ ‡πÄ‡∏Ñ‡πâ‡∏Å
                            </button>
                            <button onclick="filterRecipes('‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üç™ ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ
                            </button>
                            <button onclick="filterRecipes('‡∏≠‡∏∑‡πà‡∏ô‡πÜ')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üç∞ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                            </button>
                        </div>
                        
                        <!-- View Toggle -->
                        <div class="flex items-center gap-2 text-sm">
                            <span class="text-gray-600">‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á:</span>
                            <button onclick="toggleRecipeView('compact')" id="compactViewBtn" class="px-3 py-1 rounded text-xs bg-purple-500 text-white hover:bg-purple-600">
                                üìã ‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠
                            </button>
                            <button onclick="toggleRecipeView('detailed')" id="detailedViewBtn" class="px-3 py-1 rounded text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üìÑ ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </button>
                        </div>
                    </div>
                    
                    <div id="recipesList" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Recipes will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Sales Section -->
        <div id="sales" class="section bg-gradient-to-br from-pink-50 to-rose-100 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-pink-800 mb-2">üí∞ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h2>
                <p class="text-sm text-gray-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
                <div class="bg-pink-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-pink-800 border-b border-pink-200 pb-2">
                        üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <select id="saleProduct" class="w-full p-3 border rounded-lg text-sm" onchange="updateSaleInfo()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                            </select>
                        </div>
                        
                        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
                        <div id="productInfo" class="hidden bg-white p-3 rounded-lg border border-pink-200">
                            <div id="productDetails" class="text-sm text-pink-700">
                                <!-- Product details will be shown here -->
                            </div>
                        </div>
                        

                        
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏¢ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                                <input type="number" id="remainingStock" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5 (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á)" class="w-full p-3 border rounded-lg text-sm" oninput="calculateFromRemaining()">
                                <p class="text-xs text-blue-600 mt-1">üí° ‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</label>
                                <input type="number" id="saleQuantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢" class="w-full p-3 border rounded-lg text-sm" oninput="calculateSaleTotal()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="salePrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢" class="w-full p-3 border rounded-lg text-sm" oninput="calculateSaleTotal()">
                            </div>
                        </div>
                        
                        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì -->
                        <div id="saleCalculation" class="hidden bg-green-100 p-3 rounded-lg border border-green-300">
                            <h5 class="font-medium text-green-800 mb-2 text-sm">üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h5>
                            <div id="saleDetails" class="text-sm text-green-700">
                                <!-- Sale calculation will be shown here -->
                            </div>
                        </div>
                        
                        <button onclick="recordSale()" id="recordSaleBtn" class="w-full bg-pink-500 text-white p-3 rounded-lg hover:bg-pink-600 text-sm font-medium" disabled>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</button>
                    </div>
                    
                    <div class="mt-6 p-4 bg-white rounded-lg border border-pink-200">
                        <h4 class="font-semibold text-pink-800 text-sm mb-2">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                        <div id="todaySummary" class="space-y-1">
                            <div class="flex justify-between text-sm">
                                <span>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢:</span>
                                <span id="todayRevenue" class="font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï:</span>
                                <span id="todayProductionCost" class="font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="flex justify-between text-sm border-t pt-1">
                                <span>‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
                                <span id="todayNetProfit" class="font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="text-xs text-gray-600 mt-2">
                                <div>üí° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å: ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
                <div class="space-y-4">
                    <!-- ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
                    <div class="bg-white rounded-lg p-4 border-2 border-blue-100">
                        <h3 class="text-lg font-semibold mb-4 text-blue-800 border-b border-blue-200 pb-2">
                            üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                        </h3>
                        <div id="productStock" class="space-y-2 max-h-40 overflow-y-auto">
                            <!-- Product stock will be displayed here -->
                        </div>
                    </div>
                    
                    <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
                    <div class="bg-white rounded-lg p-4 border-2 border-pink-100">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
                            üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                        </h3>
                        <div id="salesHistory" class="space-y-3 max-h-40 overflow-y-auto">
                            <!-- Sales history will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section bg-gradient-to-br from-teal-50 to-cyan-100 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-teal-800 mb-2">üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h2>
                <p class="text-sm text-gray-600">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
            </div>
            
            <!-- Report Navigation -->
            <div class="mb-6">
                <div class="flex flex-wrap gap-2">
                    <button onclick="showReport('daily')" class="report-btn bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 text-sm">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
                    <button onclick="showReport('weekly')" class="report-btn bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 text-sm">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
                    <button onclick="showReport('monthly')" class="report-btn bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 text-sm">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                </div>
            </div>
            
            <!-- Daily Report -->
            <div id="dailyReport" class="report-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Date Selection -->
                    <div class="bg-teal-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-teal-800">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</h3>
                        <input type="date" id="dailyReportDate" class="w-full p-3 border rounded-lg text-sm" onchange="generateDailyReport()">
                        <div id="dailyStats" class="mt-4 space-y-3">
                            <!-- Daily statistics will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Daily Charts -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">üìà ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3>
                        <div id="dailyTopProducts" class="space-y-2">
                            <!-- Top products will be shown here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Weekly Report -->
            <div id="weeklyReport" class="report-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Week Selection -->
                    <div class="bg-teal-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-teal-800">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h3>
                        <input type="week" id="weeklyReportWeek" class="w-full p-3 border rounded-lg text-sm" onchange="generateWeeklyReport()">
                        <div id="weeklyStats" class="mt-4 space-y-3">
                            <!-- Weekly statistics will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Weekly Analysis -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
                        <div id="weeklyDayAnalysis" class="space-y-2">
                            <!-- Daily analysis within week will be shown here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Monthly Report -->
            <div id="monthlyReport" class="report-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Month Selection -->
                    <div class="bg-teal-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-teal-800">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                        <input type="month" id="monthlyReportMonth" class="w-full p-3 border rounded-lg text-sm" onchange="generateMonthlyReport()">
                        <div id="monthlyStats" class="mt-4 space-y-3">
                            <!-- Monthly statistics will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Monthly Trends -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                        <div id="monthlyTrends" class="space-y-2">
                            <!-- Monthly trends will be shown here -->
                        </div>
                    </div>
                </div>
                
                <!-- Cost Analysis -->
                <div class="mt-6 bg-red-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-red-800">üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡πÑ‡∏£</h3>
                    <div id="costAnalysisReport" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Cost analysis will be shown here -->
                    </div>
                </div>
                
                <!-- Customer Analysis -->
                <div class="mt-6 bg-purple-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-purple-800">üë• ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
                    <div id="customerAnalysis" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Customer analysis will be shown here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Pricing Section -->
        <div id="pricing" class="section bg-gradient-to-br from-yellow-50 to-amber-100 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-yellow-800 mb-2">üí≤ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</h2>
                <p class="text-sm text-gray-600">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ -->
                <div class="bg-yellow-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-yellow-800 border-b border-yellow-200 pb-2">
                        üè∑Ô∏è ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <select id="pricingProduct" class="w-full p-3 border rounded-lg text-sm" onchange="updatePricingInfo()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                            </select>
                        </div>
                        
                        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô -->
                        <div id="costInfo" class="hidden bg-white p-4 rounded-lg border border-yellow-200">
                            <h4 class="font-medium text-yellow-800 mb-3 text-sm">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h4>
                            <div id="costDetails" class="text-sm text-yellow-700 space-y-2">
                                <!-- Cost details will be shown here -->
                            </div>
                        </div>
                        
                        <!-- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ -->
                        <div id="pricingSection" class="hidden space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <h4 class="font-medium text-blue-800 mb-3 text-sm">üí∞ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</h4>
                                
                                <!-- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ -->
                                <div class="mb-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="radio" name="pricingMethod" value="markup" class="mr-2" onchange="updatePricingMethod()" checked>
                                            <span class="text-sm">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≥‡πÑ‡∏£ (Markup)</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="pricingMethod" value="margin" class="mr-2" onchange="updatePricingMethod()">
                                            <span class="text-sm">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£ (Margin)</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="pricingMethod" value="fixed" class="mr-2" onchange="updatePricingMethod()">
                                            <span class="text-sm">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Markup Method -->
                                <div id="markupMethod" class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≥‡πÑ‡∏£ (%)</label>
                                        <input type="number" id="markupPercent" placeholder="‡πÄ‡∏ä‡πà‡∏ô 100 (‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á 100%)" class="w-full p-2 border rounded-lg text-sm" oninput="calculatePriceFromMarkup()">
                                        <p class="text-xs text-blue-600 mt-1">üí° 100% = ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ 2 ‡πÄ‡∏ó‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</p>
                                    </div>
                                </div>
                                
                                <!-- Margin Method -->
                                <div id="marginMethod" class="hidden space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£ (%)</label>
                                        <input type="number" id="marginPercent" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50 (‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á 50%)" class="w-full p-2 border rounded-lg text-sm" oninput="calculatePriceFromMargin()">
                                        <p class="text-xs text-blue-600 mt-1">üí° 50% = ‡∏Å‡∏≥‡πÑ‡∏£ 50% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</p>
                                    </div>
                                </div>
                                
                                <!-- Fixed Price Method -->
                                <div id="fixedMethod" class="hidden space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                                        <input type="number" id="fixedPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" class="w-full p-2 border rounded-lg text-sm" oninput="calculateProfitFromFixed()">
                                    </div>
                                </div>
                                
                                <!-- ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì -->
                                <div id="pricingResult" class="hidden mt-4 p-3 bg-green-100 rounded-lg border border-green-300">
                                    <h5 class="font-medium text-green-800 mb-2 text-sm">üìà ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h5>
                                    <div id="pricingCalculation" class="text-sm text-green-700 space-y-1">
                                        <!-- Pricing calculation will be shown here -->
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="savePricing()" id="savePricingBtn" class="w-full bg-yellow-500 text-white p-3 rounded-lg hover:bg-yellow-600 text-sm font-medium" disabled>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</button>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ -->
                <div class="bg-white rounded-lg p-4 border-2 border-yellow-100">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                        <h3 class="text-lg font-semibold text-gray-800">
                            üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢
                        </h3>
                        <div class="text-sm text-gray-600">
                            <span id="pricingCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </div>
                    </div>
                    
                    <!-- Filter Options -->
                    <div class="mb-4">
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterPricing('all')" class="pricing-filter-btn active px-3 py-1 rounded-full text-xs bg-yellow-500 text-white hover:bg-yellow-600">
                                ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterPricing('high-profit')" class="pricing-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏π‡∏á (>50%)
                            </button>
                            <button onclick="filterPricing('medium-profit')" class="pricing-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üìä ‡∏Å‡∏≥‡πÑ‡∏£‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (20-50%)
                            </button>
                            <button onclick="filterPricing('low-profit')" class="pricing-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                ‚ö†Ô∏è ‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≥ (<20%)
                            </button>
                        </div>
                    </div>
                    
                    <div id="pricingList" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Pricing list will be displayed here -->
                    </div>
                </div>
            </div>
        </div>


    </div>

    <script>
        // Data storage
        let inventory = JSON.parse(localStorage.getItem('bakery_inventory') || '[]');
        let purchases = JSON.parse(localStorage.getItem('bakery_purchases') || '[]');
        let recipes = JSON.parse(localStorage.getItem('bakery_recipes') || '[]');
        let productions = JSON.parse(localStorage.getItem('bakery_productions') || '[]');
        let sales = JSON.parse(localStorage.getItem('bakery_sales') || '[]');
        let productStock = JSON.parse(localStorage.getItem('bakery_product_stock') || '{}');

        let productPricing = JSON.parse(localStorage.getItem('bakery_product_pricing') || '{}');
        
        // Search and filter state
        let currentFilter = 'all';
        let currentSearchTerm = '';
        let filteredInventory = [];
        
        // Recipe filter and view state
        let currentRecipeFilter = 'all';
        let currentRecipeView = 'compact';
        let filteredRecipes = [];
        
        // Pricing filter state
        let currentPricingFilter = 'all';
        let filteredPricing = [];

        // Navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName).classList.remove('hidden');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'bg-green-500', 'bg-purple-500', 'bg-indigo-500', 'bg-pink-500', 'bg-teal-500', 'bg-orange-500', 'text-white');
                btn.classList.add('bg-gray-50', 'hover:bg-gray-100');
            });
            
            // Add active state to clicked button
            const targetBtn = event.target.closest('.nav-btn');
            if (targetBtn) {
                targetBtn.classList.remove('bg-gray-50', 'hover:bg-gray-100');
                if (sectionName === 'inventory') targetBtn.classList.add('bg-blue-500', 'text-white');
                if (sectionName === 'purchase') targetBtn.classList.add('bg-green-500', 'text-white');
                if (sectionName === 'recipes') targetBtn.classList.add('bg-purple-500', 'text-white');
                if (sectionName === 'production') targetBtn.classList.add('bg-indigo-500', 'text-white');
                if (sectionName === 'sales') targetBtn.classList.add('bg-pink-500', 'text-white');
                if (sectionName === 'reports') targetBtn.classList.add('bg-teal-500', 'text-white');
    
                if (sectionName === 'pricing') targetBtn.classList.add('bg-yellow-500', 'text-white');
            }
            
            // Refresh data when switching sections
            if (sectionName === 'inventory') updateInventoryDisplay();
            if (sectionName === 'purchase') updatePurchaseOptions();
            if (sectionName === 'recipes') updateRecipeOptions();
            if (sectionName === 'production') updateProductionOptions();
            if (sectionName === 'sales') updateSalesOptions();
            if (sectionName === 'reports') initializeReports();

            if (sectionName === 'pricing') updatePricingOptions();
        }

        // Price calculation function
        function calculateUnitPrice() {
            const packageQuantity = parseFloat(document.getElementById('packageQuantity').value);
            const packageUnit = document.getElementById('packageUnit').value;
            const packagePrice = parseFloat(document.getElementById('packagePrice').value);
            const priceCalculation = document.getElementById('priceCalculation');
            const calculationText = document.getElementById('calculationText');
            const unitPriceResult = document.getElementById('unitPriceResult');
            const addItemBtn = document.getElementById('addItemBtn');

            // Check if all required fields are filled
            const itemName = document.getElementById('itemName').value.trim();
            const initialStock = parseFloat(document.getElementById('initialStock').value);

            if (packageQuantity && packageUnit && packagePrice) {
                // Calculate unit price
                const unitPrice = packagePrice / packageQuantity;
                
                // Show calculation
                priceCalculation.classList.remove('hidden');
                calculationText.innerHTML = `
                    <div>üìä ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</div>
                    <div>‡∏£‡∏≤‡∏Ñ‡∏≤ ${packagePrice} ‡∏ö‡∏≤‡∏ó √∑ ${packageQuantity} ${packageUnit} = ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${packageUnit}</div>
                `;
                unitPriceResult.textContent = `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${packageUnit}`;
                
                // Enable button if all fields are filled
                if (itemName && initialStock > 0) {
                    addItemBtn.disabled = false;
                } else {
                    addItemBtn.disabled = true;
                }
            } else {
                // Hide calculation
                priceCalculation.classList.add('hidden');
                addItemBtn.disabled = true;
            }
        }

        // Inventory Management
        function addInventoryItem() {
            const name = document.getElementById('itemName').value.trim();
            const packageQuantity = parseFloat(document.getElementById('packageQuantity').value);
            const packageUnit = document.getElementById('packageUnit').value;
            const packagePrice = parseFloat(document.getElementById('packagePrice').value);
            const initialStock = parseFloat(document.getElementById('initialStock').value);

            if (!name || !packageQuantity || !packageUnit || !packagePrice || !initialStock) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            // Calculate unit price
            const unitPrice = packagePrice / packageQuantity;
            
            // Calculate total quantity in stock (initial stock √ó package quantity)
            const totalQuantity = initialStock * packageQuantity;

            const existingItem = inventory.find(item => item.name === name);
            if (existingItem) {
                // Update existing item
                existingItem.quantity += totalQuantity;
                existingItem.packageQuantity = packageQuantity;
                existingItem.packageUnit = packageUnit;
                existingItem.packagePrice = packagePrice;
                existingItem.unitPrice = unitPrice;
                existingItem.lastUpdated = new Date().toLocaleDateString('th-TH');
            } else {
                // Create new item
                const newItem = {
                    id: Date.now(),
                    name,
                    quantity: totalQuantity,
                    unit: packageUnit,
                    packageQuantity,
                    packageUnit,
                    packagePrice,
                    unitPrice,
                    lastUpdated: new Date().toLocaleDateString('th-TH')
                };
                
                inventory.push(newItem);
            }

            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            updateInventoryDisplay();
            
            // Clear form
            document.getElementById('itemName').value = '';
            document.getElementById('packageQuantity').value = '';
            document.getElementById('packageUnit').value = '';
            document.getElementById('packagePrice').value = '';
            document.getElementById('initialStock').value = '';
            document.getElementById('priceCalculation').classList.add('hidden');
            document.getElementById('addItemBtn').disabled = true;
            
            alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:\n‚Ä¢ ${initialStock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ √ó ${packageQuantity} ${packageUnit} = ${totalQuantity} ${packageUnit}\n‚Ä¢ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${packageUnit}`);
        }

        // Search and Filter Functions
        function searchInventory() {
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase().trim();
            const clearBtn = document.getElementById('clearSearchBtn');
            
            currentSearchTerm = searchTerm;
            
            // Show/hide clear button
            if (searchTerm) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }
            
            // Show suggestions if search term is not empty but no exact matches
            showSearchSuggestions(searchTerm);
            
            // Apply current filter and search
            applyInventoryFilter();
        }

        function clearInventorySearch() {
            document.getElementById('inventorySearch').value = '';
            document.getElementById('clearSearchBtn').classList.add('hidden');
            document.getElementById('searchSuggestions').classList.add('hidden');
            document.getElementById('searchResults').classList.add('hidden');
            currentSearchTerm = '';
            applyInventoryFilter();
        }

        function showSearchSuggestions(searchTerm) {
            const suggestionsDiv = document.getElementById('searchSuggestions');
            const suggestionsList = document.getElementById('suggestionsList');
            
            if (!searchTerm) {
                suggestionsDiv.classList.add('hidden');
                return;
            }
            
            // Find similar items using fuzzy matching
            const suggestions = findSimilarItems(searchTerm);
            
            if (suggestions.length > 0) {
                suggestionsDiv.classList.remove('hidden');
                suggestionsList.innerHTML = suggestions.map(suggestion => `
                    <button onclick="applySuggestion('${suggestion}')" 
                            class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors">
                        ${suggestion}
                    </button>
                `).join('');
            } else {
                suggestionsDiv.classList.add('hidden');
            }
        }

        function findSimilarItems(searchTerm) {
            if (!searchTerm || searchTerm.length < 2) return [];
            
            const suggestions = new Set();
            
            // Common ingredient keywords and their variations
            const ingredientKeywords = {
                '‡πÅ‡∏õ‡πâ‡∏á': ['‡πÅ‡∏õ‡πâ‡∏á‡∏™‡∏≤‡∏•‡∏µ', '‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏≠‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå', '‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏Ñ‡πâ‡∏Å', '‡πÅ‡∏õ‡πâ‡∏á‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á', '‡πÅ‡∏õ‡πâ‡∏á‡∏°‡∏±‡∏ô'],
                '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•': ['‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ó‡∏£‡∏≤‡∏¢', '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏õ‡πà‡∏ô', '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÑ‡∏≠‡∏ã‡∏¥‡πà‡∏á', '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÅ‡∏î‡∏á'],
                '‡πÄ‡∏ô‡∏¢': ['‡πÄ‡∏ô‡∏¢‡∏à‡∏∑‡∏î', '‡πÄ‡∏ô‡∏¢‡πÄ‡∏Ñ‡πá‡∏°', '‡πÄ‡∏ô‡∏¢‡∏Ç‡∏≤‡∏ß', '‡∏°‡∏≤‡∏Å‡∏≤‡∏£‡∏µ‡∏ô'],
                '‡∏ô‡∏°': ['‡∏ô‡∏°‡∏™‡∏î', '‡∏ô‡∏°‡∏Ç‡πâ‡∏ô‡∏´‡∏ß‡∏≤‡∏ô', '‡∏ô‡∏°‡∏Ç‡πâ‡∏ô‡∏à‡∏∑‡∏î', '‡∏ô‡∏°‡∏ú‡∏á', '‡∏ß‡∏¥‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡∏Ñ‡∏£‡∏µ‡∏°'],
                '‡πÑ‡∏Ç‡πà': ['‡πÑ‡∏Ç‡πà‡πÑ‡∏Å‡πà', '‡πÑ‡∏Ç‡πà‡πÅ‡∏î‡∏á', '‡πÑ‡∏Ç‡πà‡∏Ç‡∏≤‡∏ß'],
                '‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï': ['‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏ä‡∏¥‡∏õ', '‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡∏ú‡∏á', '‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡πÅ‡∏ó‡πà‡∏á'],
                '‡∏ß‡∏ô‡∏¥‡∏•‡∏•‡∏≤': ['‡∏ß‡∏ô‡∏¥‡∏•‡∏•‡∏≤‡πÄ‡∏≠‡∏™‡πÄ‡∏ã‡πâ‡∏ô‡∏™‡πå', '‡∏ß‡∏ô‡∏¥‡∏•‡∏•‡∏≤‡∏™‡∏Å‡∏±‡∏î'],
                '‡πÄ‡∏Å‡∏•‡∏∑‡∏≠': ['‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏õ‡πà‡∏ô', '‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏ó‡∏∞‡πÄ‡∏•'],
                '‡∏ú‡∏á‡∏ü‡∏π': ['‡πÄ‡∏ö‡∏Å‡∏Å‡∏¥‡πâ‡∏á‡πÇ‡∏ã‡∏î‡∏≤', '‡∏ú‡∏á‡∏ü‡∏π‡πÄ‡∏Ñ‡πâ‡∏Å'],
                '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô': ['‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏û‡∏∑‡∏ä', '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏Ñ‡∏≤‡πÇ‡∏ô‡∏•‡∏≤', '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏°‡∏∞‡∏Å‡∏≠‡∏Å']
            };
            
            // Search in existing inventory
            inventory.forEach(item => {
                const itemName = item.name.toLowerCase();
                
                // Exact match or contains search term
                if (itemName.includes(searchTerm)) {
                    suggestions.add(item.name);
                }
                
                // Fuzzy matching for typos
                if (calculateSimilarity(itemName, searchTerm) > 0.6) {
                    suggestions.add(item.name);
                }
            });
            
            // Search in keyword suggestions
            Object.entries(ingredientKeywords).forEach(([keyword, variations]) => {
                if (keyword.includes(searchTerm) || searchTerm.includes(keyword)) {
                    variations.forEach(variation => {
                        // Only suggest if not already in inventory
                        if (!inventory.some(item => item.name.toLowerCase().includes(variation.toLowerCase()))) {
                            suggestions.add(variation);
                        }
                    });
                }
                
                variations.forEach(variation => {
                    if (variation.toLowerCase().includes(searchTerm) || 
                        calculateSimilarity(variation.toLowerCase(), searchTerm) > 0.6) {
                        suggestions.add(variation);
                    }
                });
            });
            
            return Array.from(suggestions).slice(0, 8); // Limit to 8 suggestions
        }

        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = levenshteinDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }

        function levenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }

        function applySuggestion(suggestion) {
            document.getElementById('inventorySearch').value = suggestion;
            currentSearchTerm = suggestion.toLowerCase();
            document.getElementById('searchSuggestions').classList.add('hidden');
            document.getElementById('clearSearchBtn').classList.remove('hidden');
            applyInventoryFilter();
        }

        function filterInventory(filterType) {
            currentFilter = filterType;
            
            // Update filter button styles
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-blue-500', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            applyInventoryFilter();
        }

        function applyInventoryFilter() {
            let filtered = [...inventory];
            
            // Apply search filter
            if (currentSearchTerm) {
                filtered = filtered.filter(item => {
                    const itemName = item.name.toLowerCase();
                    const unit = item.unit.toLowerCase();
                    
                    return itemName.includes(currentSearchTerm) || 
                           unit.includes(currentSearchTerm) ||
                           calculateSimilarity(itemName, currentSearchTerm) > 0.5;
                });
            }
            
            // Apply category filter
            if (currentFilter !== 'all') {
                filtered = filtered.filter(item => {
                    const itemName = item.name.toLowerCase();
                    
                    switch (currentFilter) {
                        case 'low-stock':
                            const packagesLeft = Math.floor(item.quantity / item.packageQuantity);
                            return packagesLeft < 1;
                        case 'powder':
                            return itemName.includes('‡πÅ‡∏õ‡πâ‡∏á') || itemName.includes('‡∏ú‡∏á') || 
                                   itemName.includes('‡πÇ‡∏Å‡πÇ‡∏Å‡πâ') || itemName.includes('‡∏ú‡∏á‡∏ü‡∏π');
                        case 'liquid':
                            return item.unit.includes('‡∏°‡∏•') || item.unit.includes('‡∏•‡∏¥‡∏ï‡∏£') || 
                                   itemName.includes('‡∏ô‡πâ‡∏≥') || itemName.includes('‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô') ||
                                   itemName.includes('‡πÄ‡∏≠‡∏™‡πÄ‡∏ã‡πâ‡∏ô‡∏™‡πå');
                        case 'dairy':
                            return itemName.includes('‡∏ô‡∏°') || itemName.includes('‡πÄ‡∏ô‡∏¢') || 
                                   itemName.includes('‡∏Ñ‡∏£‡∏µ‡∏°') || itemName.includes('‡∏ä‡∏µ‡∏™') ||
                                   itemName.includes('‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï');
                        case 'sweet':
                            return itemName.includes('‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•') || itemName.includes('‡∏ô‡πâ‡∏≥‡∏ú‡∏∂‡πâ‡∏á') || 
                                   itemName.includes('‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï') || itemName.includes('‡∏´‡∏ß‡∏≤‡∏ô') ||
                                   itemName.includes('‡πÑ‡∏ã‡∏£‡∏±‡∏õ');
                        default:
                            return true;
                    }
                });
            }
            
            filteredInventory = filtered;
            
            // Apply sorting
            sortInventory();
            
            // Show search results info
            showSearchResults();
        }

        function sortInventory() {
            const sortType = document.getElementById('inventorySort').value;
            
            filteredInventory.sort((a, b) => {
                switch (sortType) {
                    case 'name-asc':
                        return a.name.localeCompare(b.name, 'th');
                    case 'name-desc':
                        return b.name.localeCompare(a.name, 'th');
                    case 'stock-low':
                        return a.quantity - b.quantity;
                    case 'stock-high':
                        return b.quantity - a.quantity;
                    case 'updated-new':
                        return new Date(b.lastUpdated) - new Date(a.lastUpdated);
                    case 'updated-old':
                        return new Date(a.lastUpdated) - new Date(b.lastUpdated);
                    default:
                        return 0;
                }
            });
            
            updateInventoryDisplay();
        }

        function showSearchResults() {
            const searchResults = document.getElementById('searchResults');
            const totalItems = inventory.length;
            const filteredCount = filteredInventory.length;
            
            if (currentSearchTerm || currentFilter !== 'all') {
                searchResults.classList.remove('hidden');
                
                let message = `‡∏û‡∏ö ${filteredCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                if (currentSearchTerm) {
                    message += ` ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "${currentSearchTerm}"`;
                }
                if (currentFilter !== 'all') {
                    const filterNames = {
                        'low-stock': '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î',
                        'powder': '‡πÅ‡∏õ‡πâ‡∏á/‡∏ú‡∏á',
                        'liquid': '‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß',
                        'dairy': '‡∏ô‡∏°/‡πÄ‡∏ô‡∏¢',
                        'sweet': '‡∏´‡∏ß‡∏≤‡∏ô'
                    };
                    message += ` ‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î "${filterNames[currentFilter]}"`;
                }
                message += ` ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                
                searchResults.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span>üîç ${message}</span>
                        ${(currentSearchTerm || currentFilter !== 'all') ? 
                            '<button onclick="resetAllFilters()" class="text-blue-800 hover:text-blue-900 underline text-xs">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>' : 
                            ''
                        }
                    </div>
                `;
            } else {
                searchResults.classList.add('hidden');
            }
        }

        function resetAllFilters() {
            // Clear search
            document.getElementById('inventorySearch').value = '';
            document.getElementById('clearSearchBtn').classList.add('hidden');
            currentSearchTerm = '';
            
            // Reset filter to 'all'
            currentFilter = 'all';
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            document.querySelector('.filter-btn').classList.add('active', 'bg-blue-500', 'text-white');
            document.querySelector('.filter-btn').classList.remove('bg-gray-200', 'text-gray-700');
            
            // Reset sort
            document.getElementById('inventorySort').value = 'name-asc';
            
            // Hide suggestions and results
            document.getElementById('searchSuggestions').classList.add('hidden');
            document.getElementById('searchResults').classList.add('hidden');
            
            // Apply filters
            applyInventoryFilter();
        }

        function updateInventoryDisplay() {
            const list = document.getElementById('inventoryList');
            const countElement = document.getElementById('inventoryCount');
            
            // Update count
            countElement.textContent = filteredInventory.length;
            
            if (inventory.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á<br>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            if (filteredInventory.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-lg mb-2">üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
                        <div class="text-sm">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏î‡∏π</div>
                        <button onclick="resetAllFilters()" class="mt-3 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm">
                            ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = filteredInventory.map(item => {
                // Calculate how many packages are left
                const packagesLeft = Math.floor(item.quantity / item.packageQuantity);
                const remainingUnits = item.quantity % item.packageQuantity;
                
                // Warning for low stock (less than 1 package or less than 10% of a package)
                const lowStock = packagesLeft < 1 || (packagesLeft === 0 && remainingUnits < item.packageQuantity * 0.1);
                
                // Highlight search term in item name
                let displayName = item.name;
                if (currentSearchTerm) {
                    const regex = new RegExp(`(${currentSearchTerm})`, 'gi');
                    displayName = item.name.replace(regex, '<mark class="bg-yellow-200 px-1 rounded">$1</mark>');
                }
                
                return `
                    <div class="bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden ${lowStock ? 'ring-2 ring-red-200' : ''}">
                        <!-- Header -->
                        <div class="px-4 py-3 bg-gradient-to-r ${lowStock ? 'from-red-50 to-red-100 border-b border-red-200' : 'from-blue-50 to-indigo-50 border-b border-gray-200'}">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full ${lowStock ? 'bg-red-100' : 'bg-blue-100'} flex items-center justify-center">
                                        <span class="text-lg">${lowStock ? '‚ö†Ô∏è' : 'üì¶'}</span>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-lg text-gray-800">${displayName}</h3>
                                        ${lowStock ? '<span class="inline-block px-2 py-1 bg-red-100 text-red-700 text-xs rounded-full font-medium">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</span>' : ''}
                                    </div>
                                </div>
                                <button onclick="removeInventoryItem(${item.id})" class="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="p-4 space-y-4">
                            <!-- Stock Status -->
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <div class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                                    <div class="text-xl font-bold text-gray-800">${item.quantity.toLocaleString()}</div>
                                    <div class="text-sm text-gray-600">${item.unit}</div>
                                </div>
                                <div class="bg-blue-50 rounded-lg p-3">
                                    <div class="text-xs font-medium text-blue-500 uppercase tracking-wide mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</div>
                                    <div class="text-xl font-bold text-blue-700">${packagesLeft}</div>
                                    <div class="text-sm text-blue-600">
                                        ${remainingUnits > 0 ? `+ ${remainingUnits.toLocaleString()} ${item.unit}` : '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠'}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Purchase Information -->
                            <div class="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-lg p-3 border border-indigo-100">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-indigo-600">üí∞</span>
                                    <h4 class="font-medium text-indigo-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</h4>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠:</span>
                                        <span class="font-medium text-gray-800">${item.packageQuantity.toLocaleString()} ${item.unit}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠:</span>
                                        <span class="font-medium text-gray-800">${item.packagePrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                                    </div>
                                    <div class="flex justify-between sm:col-span-2 pt-2 border-t border-indigo-200">
                                        <span class="text-indigo-600 font-medium">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠${item.unit}:</span>
                                        <span class="font-bold text-indigo-700">${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Last Updated -->
                            <div class="flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100">
                                <span>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
                                <span class="font-medium">${item.lastUpdated}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function removeInventoryItem(id) {
            inventory = inventory.filter(item => item.id !== id);
            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            updateInventoryDisplay();
        }

        // Purchase Management
        function updatePurchaseOptions() {
            const select = document.getElementById('purchaseItem');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>' + 
                inventory.map(item => `<option value="${item.name}">${item.name} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${item.quantity.toLocaleString()} ${item.unit})</option>`).join('');
            updatePurchaseHistory();
        }

        function updatePurchaseInfo() {
            const itemName = document.getElementById('purchaseItem').value;
            const purchaseInfo = document.getElementById('purchaseInfo');
            const packageDetails = document.getElementById('packageDetails');
            const purchaseUnitDisplay = document.getElementById('purchaseUnitDisplay');
            const makePurchaseBtn = document.getElementById('makePurchaseBtn');
            
            if (!itemName) {
                purchaseInfo.classList.add('hidden');
                makePurchaseBtn.disabled = true;
                return;
            }
            
            const item = inventory.find(i => i.name === itemName);
            if (!item) return;
            
            // Show purchase info section
            purchaseInfo.classList.remove('hidden');
            
            // Display package details
            packageDetails.innerHTML = `
                <div class="space-y-1">
                    <div><strong>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:</strong> ${item.name}</div>
                    <div><strong>1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ =</strong> ${item.packageQuantity.toLocaleString()} ${item.unit}</div>
                    <div><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠:</strong> ${item.packagePrice} ‡∏ö‡∏≤‡∏ó</div>
                    <div><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠${item.unit}:</strong> ${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${item.unit}</div>
                    <div class="text-blue-600"><strong>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á:</strong> ${item.quantity.toLocaleString()} ${item.unit}</div>
                </div>
            `;
            
            // Set unit display
            purchaseUnitDisplay.textContent = '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠';
            
            // Clear previous calculation
            document.getElementById('purchaseQuantity').value = '';
            document.getElementById('purchaseConversion').classList.add('hidden');
            makePurchaseBtn.disabled = true;
        }

        function calculatePurchaseConversion() {
            const itemName = document.getElementById('purchaseItem').value;
            const purchaseQuantity = parseFloat(document.getElementById('purchaseQuantity').value);
            const purchaseConversion = document.getElementById('purchaseConversion');
            const conversionCalculation = document.getElementById('conversionCalculation');
            const totalQuantityResult = document.getElementById('totalQuantityResult');
            const totalCostResult = document.getElementById('totalCostResult');
            const makePurchaseBtn = document.getElementById('makePurchaseBtn');
            
            if (!itemName || !purchaseQuantity || purchaseQuantity <= 0) {
                purchaseConversion.classList.add('hidden');
                makePurchaseBtn.disabled = true;
                return;
            }
            
            const item = inventory.find(i => i.name === itemName);
            if (!item) return;
            
            // Calculate conversion
            const totalQuantityToAdd = purchaseQuantity * item.packageQuantity;
            const totalCost = purchaseQuantity * item.packagePrice;
            
            // Show conversion
            purchaseConversion.classList.remove('hidden');
            
            conversionCalculation.innerHTML = `
                <div>üìä ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</div>
                <div>${purchaseQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ √ó ${item.packageQuantity.toLocaleString()} ${item.unit}/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ = ${totalQuantityToAdd.toLocaleString()} ${item.unit}</div>
                <div>${purchaseQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ √ó ${item.packagePrice} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ = ${totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
            `;
            
            totalQuantityResult.textContent = `‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ${totalQuantityToAdd.toLocaleString()} ${item.unit}`;
            totalCostResult.textContent = `‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: ${totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            
            // Enable purchase button
            makePurchaseBtn.disabled = false;
        }

        function makePurchase() {
            const itemName = document.getElementById('purchaseItem').value;
            const purchaseQuantity = parseFloat(document.getElementById('purchaseQuantity').value);
            const supplier = document.getElementById('supplier').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

            if (!itemName || !purchaseQuantity || purchaseQuantity <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }

            const item = inventory.find(i => i.name === itemName);
            if (!item) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
                return;
            }

            // Calculate actual quantity to add to inventory
            const actualQuantityToAdd = purchaseQuantity * item.packageQuantity;
            const totalCost = purchaseQuantity * item.packagePrice;

            // Add to inventory
            item.quantity += actualQuantityToAdd;
            item.lastUpdated = new Date().toLocaleDateString('th-TH');

            // Record purchase
            purchases.push({
                id: Date.now(),
                itemName,
                purchaseQuantity: purchaseQuantity,
                packageQuantity: item.packageQuantity,
                packagePrice: item.packagePrice,
                actualQuantityAdded: actualQuantityToAdd,
                unit: item.unit,
                unitPrice: item.unitPrice,
                totalCost: totalCost,
                supplier,
                date: new Date().toLocaleDateString('th-TH'),
                time: new Date().toLocaleTimeString('th-TH')
            });

            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            localStorage.setItem('bakery_purchases', JSON.stringify(purchases));
            
            updatePurchaseHistory();
            updateInventoryDisplay();
            
            // Clear form
            document.getElementById('purchaseQuantity').value = '';
            document.getElementById('supplier').value = '';
            document.getElementById('purchaseConversion').classList.add('hidden');
            document.getElementById('makePurchaseBtn').disabled = true;
            
            alert(`‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
                  `‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö: ${itemName}\n` +
                  `‡∏ã‡∏∑‡πâ‡∏≠: ${purchaseQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠\n` +
                  `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ${actualQuantityToAdd.toLocaleString()} ${item.unit}\n` +
                  `‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà: ${item.quantity.toLocaleString()} ${item.unit}`);
        }

        function updatePurchaseHistory() {
            const list = document.getElementById('purchaseHistory');
            
            if (purchases.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠<br>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            const recentPurchases = purchases.slice(-10).reverse();
            list.innerHTML = recentPurchases.map(purchase => `
                <div class="bg-white border border-green-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden">
                    <!-- Header -->
                    <div class="px-4 py-3 bg-gradient-to-r from-green-50 to-emerald-50 border-b border-green-200">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
                                <span class="text-lg">üõí</span>
                            </div>
                            <div>
                                <h3 class="font-semibold text-lg text-gray-800">${purchase.itemName}</h3>
                                <div class="text-sm text-green-600 font-medium">${purchase.supplier}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-4 space-y-3">
                        <!-- Purchase Details -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-blue-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-blue-500 uppercase tracking-wide mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ã‡∏∑‡πâ‡∏≠</div>
                                <div class="text-lg font-bold text-blue-700">${purchase.purchaseQuantity}</div>
                                <div class="text-sm text-blue-600">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-green-500 uppercase tracking-wide mb-1">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á</div>
                                <div class="text-lg font-bold text-green-700">${purchase.actualQuantityAdded.toLocaleString()}</div>
                                <div class="text-sm text-green-600">${purchase.unit}</div>
                            </div>
                        </div>
                        
                        <!-- Cost Information -->
                        <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-lg p-3 border border-orange-100">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-orange-600">üí∞</span>
                                <h4 class="font-medium text-orange-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h4>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠:</span>
                                    <span class="font-medium text-gray-800">${purchase.packagePrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤/${purchase.unit}:</span>
                                    <span class="font-medium text-gray-800">${purchase.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                                <div class="flex justify-between col-span-2 pt-2 border-t border-orange-200">
                                    <span class="text-orange-600 font-medium">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°:</span>
                                    <span class="font-bold text-orange-700">${purchase.totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Timestamp -->
                        <div class="flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100">
                            <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</span>
                            <span class="font-medium">${purchase.date} ${purchase.time}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Production Management
        function updateProductionOptions() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('productionDate').value = today;
            
            // Update recipe options
            const select = document.getElementById('productionRecipe');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ú‡∏•‡∏¥‡∏ï</option>' + 
                recipes.map(recipe => `<option value="${recipe.name}">${recipe.name} (‡πÑ‡∏î‡πâ ${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢)</option>`).join('');
            
            updateProductionHistory();
            updateTodayProductionSummary();
        }

        function updateProductionInfo() {
            const recipeName = document.getElementById('productionRecipe').value;
            const ingredientNeeds = document.getElementById('ingredientNeeds');
            
            if (!recipeName) {
                ingredientNeeds.classList.add('hidden');
                document.getElementById('startProductionBtn').disabled = true;
                return;
            }
            
            ingredientNeeds.classList.remove('hidden');
            calculateIngredientNeeds();
        }

        function calculateIngredientNeeds() {
            const recipeName = document.getElementById('productionRecipe').value;
            const quantity = parseFloat(document.getElementById('productionQuantity').value) || 0;
            
            if (!recipeName || !quantity) {
                document.getElementById('startProductionBtn').disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === recipeName);
            if (!recipe) return;
            
            const multiplier = quantity / recipe.yield;
            const ingredientsList = document.getElementById('ingredientsList');
            const stockCheck = document.getElementById('stockCheck');
            
            let canProduce = true;
            let stockStatus = [];
            
            const ingredientsHtml = recipe.ingredients.map(ingredient => {
                const needed = ingredient.amount * multiplier;
                const inventoryItem = inventory.find(item => item.name === ingredient.name);
                const available = inventoryItem ? inventoryItem.quantity : 0;
                const sufficient = available >= needed;
                
                if (!sufficient) canProduce = false;
                
                stockStatus.push({
                    name: ingredient.name,
                    needed: needed,
                    available: available,
                    sufficient: sufficient,
                    unit: ingredient.unit
                });
                
                return `
                    <div class="flex justify-between items-center p-2 rounded ${sufficient ? 'bg-green-100' : 'bg-red-100'}">
                        <span>${ingredient.name}</span>
                        <span class="text-sm">
                            ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ: ${needed.toFixed(2)} ${ingredient.unit}
                            ${sufficient ? '‚úÖ' : '‚ùå'}
                        </span>
                    </div>
                `;
            }).join('');
            
            ingredientsList.innerHTML = ingredientsHtml;
            
            // Stock check summary
            const insufficientItems = stockStatus.filter(item => !item.sufficient);
            if (insufficientItems.length > 0) {
                stockCheck.innerHTML = `
                    <div class="text-red-600 font-medium mb-2">‚ö†Ô∏è ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠:</div>
                    ${insufficientItems.map(item => `
                        <div class="text-red-600 text-xs">
                            ‚Ä¢ ${item.name}: ‡∏°‡∏µ ${item.available} ${item.unit} ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${item.needed.toFixed(2)} ${item.unit} 
                            (‡∏Ç‡∏≤‡∏î ${(item.needed - item.available).toFixed(2)} ${item.unit})
                        </div>
                    `).join('')}
                `;
            } else {
                stockCheck.innerHTML = '<div class="text-green-600 font-medium">‚úÖ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>';
            }
            
            document.getElementById('startProductionBtn').disabled = !canProduce;
        }

        function startProduction() {
            const recipeName = document.getElementById('productionRecipe').value;
            const quantity = parseFloat(document.getElementById('productionQuantity').value);
            const productionDate = document.getElementById('productionDate').value;
            
            if (!recipeName || !quantity || !productionDate) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            const recipe = recipes.find(r => r.name === recipeName);
            if (!recipe) return;
            
            const multiplier = quantity / recipe.yield;
            
            // Check stock availability one more time
            let canProduce = true;
            const usedIngredients = [];
            
            // Only check ingredients that are actually in inventory (not base recipe costs)
            for (const ingredient of recipe.ingredients) {
                const needed = ingredient.amount * multiplier;
                const inventoryItem = inventory.find(item => item.name === ingredient.name);
                
                if (!inventoryItem || inventoryItem.quantity < needed) {
                    canProduce = false;
                    break;
                }
                
                usedIngredients.push({
                    name: ingredient.name,
                    amount: needed,
                    unit: ingredient.unit,
                    cost: needed * inventoryItem.unitPrice
                });
            }
            
            if (!canProduce) {
                alert('‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï');
                return;
            }
            
            // Deduct ingredients from inventory
            for (const used of usedIngredients) {
                const inventoryItem = inventory.find(item => item.name === used.name);
                inventoryItem.quantity -= used.amount;
                inventoryItem.lastUpdated = new Date().toLocaleDateString('th-TH');
            }
            
            // Calculate total cost including base recipe cost
            // Use unitPrice from inventory for accurate cost calculation
            const ingredientsCost = usedIngredients.reduce((sum, ingredient) => {
                const inventoryItem = inventory.find(item => item.name === ingredient.name);
                const unitPrice = inventoryItem ? inventoryItem.unitPrice : 0;
                return sum + (ingredient.amount * unitPrice);
            }, 0);
            const baseCostForProduction = recipe.baseCost ? (recipe.baseCost * multiplier) : 0;
            const totalCost = ingredientsCost + baseCostForProduction;
            
            productions.push({
                id: Date.now(),
                recipeName,
                quantity,
                productionDate,
                usedIngredients,
                ingredientsCost,
                baseCost: baseCostForProduction,
                baseRecipeName: recipe.baseRecipeName || null,
                totalCost,
                costPerUnit: totalCost / quantity,
                timestamp: new Date().toLocaleString('th-TH')
            });
            
            // Add to product stock
            if (!productStock[recipeName]) {
                productStock[recipeName] = 0;
            }
            productStock[recipeName] += quantity;
            
            // Save data
            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            localStorage.setItem('bakery_productions', JSON.stringify(productions));
            localStorage.setItem('bakery_product_stock', JSON.stringify(productStock));
            
            // Update displays
            updateInventoryDisplay();
            updateProductionHistory();
            updateTodayProductionSummary();
            
            // Clear form
            document.getElementById('productionQuantity').value = '';
            document.getElementById('ingredientNeeds').classList.add('hidden');
            document.getElementById('startProductionBtn').disabled = true;
            
            // Show detailed cost breakdown
            let message = `‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï ${recipeName} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n`;
            if (baseCostForProduction > 0) {
                message += `üìã ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseCostForProduction.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            }
            if (ingredientsCost > 0) {
                message += `üßÇ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°: ${ingredientsCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            }
            message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${(totalCost / quantity).toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üì¶ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`;
            
            alert(message);
        }

        function updateProductionHistory() {
            const list = document.getElementById('productionHistory');
            const recentProductions = productions.slice(-10).reverse();
            
            list.innerHTML = recentProductions.map(production => `
                <div class="bg-white border border-indigo-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden">
                    <!-- Header -->
                    <div class="px-4 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 border-b border-indigo-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                                    <span class="text-lg">üè≠</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-lg text-gray-800">${production.recipeName}</h3>
                                    <div class="text-sm text-indigo-600 font-medium">${production.productionDate}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-indigo-700">${production.quantity}</div>
                                <div class="text-xs text-indigo-500">‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-4 space-y-3">
                        <!-- Production Stats -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-orange-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-orange-500 uppercase tracking-wide mb-1">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°</div>
                                <div class="text-lg font-bold text-orange-700">${production.totalCost.toFixed(2)}</div>
                                <div class="text-sm text-orange-600">‡∏ö‡∏≤‡∏ó</div>
                            </div>
                            <div class="bg-purple-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-purple-500 uppercase tracking-wide mb-1">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                <div class="text-lg font-bold text-purple-700">${production.costPerUnit.toFixed(2)}</div>
                                <div class="text-sm text-purple-600">‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                        
                        <!-- Cost Breakdown -->
                        ${production.baseCost > 0 ? `
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-3 border border-blue-100">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-blue-600">üìã</span>
                                <h4 class="font-medium text-blue-800">‡πÅ‡∏¢‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h4>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô:</span>
                                    <span class="font-medium text-gray-800">${production.baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°:</span>
                                    <span class="font-medium text-gray-800">${production.ingredientsCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Ingredients Toggle -->
                        <div class="border-t border-gray-100 pt-3">
                            <button onclick="toggleIngredientDetails(${production.id})" class="w-full flex items-center justify-between p-2 text-sm text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 rounded-lg transition-colors">
                                <span class="font-medium">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</span>
                                <svg class="w-4 h-4 transform transition-transform" id="arrow-${production.id}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="details-${production.id}" class="hidden mt-3 bg-gray-50 rounded-lg p-3 border border-gray-200">
                                <div class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-2">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</div>
                                <div class="space-y-2">
                                    ${production.usedIngredients.map(ing => `
                                        <div class="flex justify-between items-center py-1 px-2 bg-white rounded border">
                                            <span class="text-sm font-medium text-gray-700">${ing.name}</span>
                                            <span class="text-sm text-gray-600">${ing.amount.toFixed(2)} ${ing.unit}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Timestamp -->
                        <div class="flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100">
                            <span>‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡∏•‡∏¥‡∏ï</span>
                            <span class="font-medium">${production.timestamp}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleIngredientDetails(productionId) {
            const details = document.getElementById(`details-${productionId}`);
            const arrow = document.getElementById(`arrow-${productionId}`);
            
            details.classList.toggle('hidden');
            
            if (details.classList.contains('hidden')) {
                arrow.style.transform = 'rotate(0deg)';
            } else {
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        function updateTodayProductionSummary() {
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => p.productionDate === today);
            
            const summary = document.getElementById('todayProduction');
            
            if (todayProductions.length === 0) {
                summary.innerHTML = '<p class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>';
                return;
            }
            
            const totalCost = todayProductions.reduce((sum, p) => sum + p.totalCost, 0);
            const productSummary = {};
            
            todayProductions.forEach(p => {
                if (productSummary[p.recipeName]) {
                    productSummary[p.recipeName] += p.quantity;
                } else {
                    productSummary[p.recipeName] = p.quantity;
                }
            });
            
            summary.innerHTML = `
                <div class="text-sm">
                    <div class="font-medium text-indigo-800 mb-1">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï:</div>
                    ${Object.entries(productSummary).map(([name, qty]) => `
                        <div class="flex justify-between">
                            <span>${name}</span>
                            <span>${qty} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                        </div>
                    `).join('')}
                    <div class="border-t mt-2 pt-2 font-medium">
                        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó
                    </div>
                </div>
            `;
        }

        // Recipe Management
        let editingRecipeId = null;

        function updateRecipeOptions() {
            const selects = document.querySelectorAll('.ingredient-select');
            const options = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>' + 
                inventory.map(item => `<option value="${item.name}">${item.name} (${item.unit})</option>`).join('');
            selects.forEach(select => select.innerHTML = options);
            
            // Update base recipe options
            const baseRecipeSelect = document.getElementById('baseRecipe');
            baseRecipeSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</option>' + 
                recipes.map(recipe => `<option value="${recipe.id}">${recipe.name} (${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢)</option>`).join('');
            
            updateRecipesList();
        }

        function loadBaseRecipe() {
            const baseRecipeId = document.getElementById('baseRecipe').value;
            if (!baseRecipeId) {
                // Clear base recipe cost display if no base recipe selected
                const baseCostDisplay = document.getElementById('baseCostDisplay');
                if (baseCostDisplay) baseCostDisplay.remove();
                return;
            }
            
            const baseRecipe = recipes.find(r => r.id == baseRecipeId);
            if (!baseRecipe) return;
            
            // Don't auto-clear ingredients - let user decide
            // Just show the base recipe information
            
            // Load base recipe data only if yield is empty
            if (!document.getElementById('recipeYield').value) {
                document.getElementById('recipeYield').value = baseRecipe.yield;
            }
            
            // Show base recipe cost information
            showBaseCostInfo(baseRecipe);
            
            // Show suggestion to load ingredients
            const suggestion = document.createElement('div');
            suggestion.id = 'loadIngredientsSuggestion';
            suggestion.className = 'bg-yellow-50 p-3 rounded-lg mb-3 border border-yellow-200';
            suggestion.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-sm font-medium text-yellow-800">üí° ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</div>
                        <div class="text-xs text-yellow-600 mt-1">‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="loadBaseIngredients()" class="bg-yellow-500 text-white px-3 py-1 rounded text-xs hover:bg-yellow-600">‡πÇ‡∏´‡∏•‡∏î</button>
                        <button onclick="removeSuggestion()" class="bg-gray-400 text-white px-3 py-1 rounded text-xs hover:bg-gray-500">‡πÑ‡∏°‡πà</button>
                    </div>
                </div>
            `;
            
            // Remove existing suggestion
            const existingSuggestion = document.getElementById('loadIngredientsSuggestion');
            if (existingSuggestion) existingSuggestion.remove();
            
            // Insert suggestion after base cost display
            const baseCostDisplay = document.getElementById('baseCostDisplay');
            if (baseCostDisplay) {
                baseCostDisplay.parentNode.insertBefore(suggestion, baseCostDisplay.nextSibling);
            }
        }

        function loadBaseIngredients() {
            const baseRecipeId = document.getElementById('baseRecipe').value;
            const baseRecipe = recipes.find(r => r.id == baseRecipeId);
            if (!baseRecipe) return;
            
            // Clear existing ingredients except the first row
            const container = document.getElementById('recipeIngredients');
            const ingredientRows = container.querySelectorAll('.ingredient-row');
            ingredientRows.forEach((row, index) => {
                if (index > 0) row.remove();
            });
            
            // Load ingredients
            baseRecipe.ingredients.forEach((ingredient, index) => {
                let row;
                if (index === 0) {
                    // Use first existing row
                    row = ingredientRows[0];
                } else {
                    // Create new rows
                    addIngredientRow();
                    row = container.lastElementChild;
                }
                
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                select.value = ingredient.name;
                amountInput.value = ingredient.amount;
            });
            
            // Remove suggestion
            removeSuggestion();
        }

        function removeSuggestion() {
            const suggestion = document.getElementById('loadIngredientsSuggestion');
            if (suggestion) suggestion.remove();
        }

        function showBaseCostInfo(baseRecipe) {
            // Remove existing base cost display
            const existingDisplay = document.getElementById('baseCostDisplay');
            if (existingDisplay) existingDisplay.remove();
            
            // Create base cost display
            const baseCostDiv = document.createElement('div');
            baseCostDiv.id = 'baseCostDisplay';
            baseCostDiv.className = 'bg-green-50 p-3 rounded-lg mb-3 border border-green-200';
            baseCostDiv.innerHTML = `
                <h4 class="font-medium text-green-800 mb-2">üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4>
                <div class="text-sm text-green-700">
                    <div class="flex justify-between">
                        <span>‡∏™‡∏π‡∏ï‡∏£: ${baseRecipe.name}</span>
                        <span>‡πÑ‡∏î‡πâ: ${baseRecipe.yield} ‡∏ä‡∏¥‡πâ‡∏ô</span>
                    </div>
                    <div class="flex justify-between font-medium">
                        <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°:</span>
                        <span>${baseRecipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between font-medium text-green-800">
                        <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô:</span>
                        <span>${baseRecipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏¥‡πâ‡∏ô</span>
                    </div>
                </div>
                <p class="text-xs text-green-600 mt-2">üí° ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏£‡∏ß‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
            `;
            
            // Insert after base recipe selection
            const baseRecipeContainer = document.querySelector('#baseRecipe').parentElement;
            baseRecipeContainer.parentNode.insertBefore(baseCostDiv, baseRecipeContainer.nextSibling);
        }

        function clearAllIngredients() {
            const container = document.getElementById('recipeIngredients');
            const ingredientRows = container.querySelectorAll('.ingredient-row');
            
            // Remove all rows except the first one
            ingredientRows.forEach((row, index) => {
                if (index > 0) row.remove();
            });
            
            // Clear the first row
            const firstRow = ingredientRows[0];
            firstRow.querySelector('.ingredient-select').value = '';
            firstRow.querySelector('.ingredient-amount').value = '';
        }

        function addIngredientRow() {
            const container = document.getElementById('recipeIngredients');
            const newRow = document.createElement('div');
            newRow.className = 'ingredient-row flex gap-2';
            newRow.innerHTML = `
                <select class="ingredient-select flex-1 p-2 border rounded">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                    ${inventory.map(item => `<option value="${item.name}">${item.name} (${item.unit})</option>`).join('')}
                </select>
                <input type="number" class="ingredient-amount w-24 p-2 border rounded" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                <button onclick="this.parentElement.remove()" class="bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600">-</button>
            `;
            container.appendChild(newRow);
        }

        function createRecipe() {
            const name = document.getElementById('recipeName').value;
            const category = document.getElementById('recipeCategory').value;
            const yield = parseFloat(document.getElementById('recipeYield').value);
            const baseRecipeId = document.getElementById('baseRecipe').value;
            
            if (!name || !yield) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ');
                return;
            }

            const ingredientRows = document.querySelectorAll('.ingredient-row');
            const ingredients = [];
            let additionalCost = 0;
            let baseCost = 0;
            let baseRecipe = null;
            let costBreakdown = [];

            // Calculate base recipe cost if selected
            if (baseRecipeId) {
                baseRecipe = recipes.find(r => r.id == baseRecipeId);
                if (baseRecipe) {
                    // Calculate base cost proportionally based on yield
                    const yieldRatio = yield / baseRecipe.yield;
                    baseCost = baseRecipe.totalCost * yieldRatio;
                }
            }

            // Calculate additional ingredients cost using inventory unit prices
            ingredientRows.forEach(row => {
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                if (select.value && amountInput.value) {
                    const item = inventory.find(i => i.name === select.value);
                    if (!item) {
                        alert(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö "${select.value}" ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á`);
                        return;
                    }
                    
                    const amount = parseFloat(amountInput.value);
                    // Use unitPrice from inventory (price per unit)
                    const cost = amount * item.unitPrice;
                    
                    ingredients.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                    additionalCost += cost;
                    
                    // Add to cost breakdown for detailed display
                    costBreakdown.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                }
            });

            // For base recipe usage, we need at least the base recipe OR additional ingredients
            if (!baseRecipe && ingredients.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }

            const totalCost = baseCost + additionalCost;
            const costPerUnit = totalCost / yield;

            const newRecipe = {
                id: Date.now(),
                name,
                category: category || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
                yield,
                ingredients,
                additionalCost,
                baseCost,
                baseRecipeId: baseRecipeId || null,
                baseRecipeName: baseRecipe ? baseRecipe.name : null,
                totalCost,
                costPerUnit,
                created: new Date().toLocaleDateString('th-TH')
            };

            recipes.push(newRecipe);
            localStorage.setItem('bakery_recipes', JSON.stringify(recipes));
            updateRecipesList();
            
            // Clear form
            clearRecipeForm();
            
            // Show detailed success message with cost breakdown
            let message = `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£ "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n`;
            
            if (baseRecipe) {
                message += `üìã ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseRecipe.name}\n`;
                message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            if (costBreakdown.length > 0) {
                message += `üßÇ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:\n`;
                costBreakdown.forEach(item => {
                    message += `‚Ä¢ ${item.name}: ${item.amount} ${item.unit} √ó ${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó = ${item.cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                });
                message += `\nüí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏£‡∏ß‡∏°: ${additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            message += `üìä ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üìà ‡πÑ‡∏î‡πâ: ${yield} ‡∏ä‡∏¥‡πâ‡∏ô`;
            
            alert(message);
        }

        function clearRecipeForm() {
            document.getElementById('recipeName').value = '';
            document.getElementById('recipeCategory').value = '';
            document.getElementById('recipeYield').value = '';
            document.getElementById('baseRecipe').value = '';
            
            // Remove base cost display
            const baseCostDisplay = document.getElementById('baseCostDisplay');
            if (baseCostDisplay) baseCostDisplay.remove();
            
            // Remove suggestion
            removeSuggestion();
            
            // Clear ingredients
            document.querySelectorAll('.ingredient-row').forEach((row, index) => {
                if (index > 0) row.remove();
            });
            document.querySelector('.ingredient-select').value = '';
            document.querySelector('.ingredient-amount').value = '';
        }

        // Recipe filtering and view functions
        function filterRecipes(category) {
            currentRecipeFilter = category;
            
            // Update filter button styles
            document.querySelectorAll('.recipe-filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-purple-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-purple-500', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            applyRecipeFilter();
        }

        function toggleRecipeView(viewType) {
            currentRecipeView = viewType;
            
            // Update view button styles
            document.querySelectorAll('#compactViewBtn, #detailedViewBtn').forEach(btn => {
                btn.classList.remove('bg-purple-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            if (viewType === 'compact') {
                document.getElementById('compactViewBtn').classList.add('bg-purple-500', 'text-white');
                document.getElementById('compactViewBtn').classList.remove('bg-gray-200', 'text-gray-700');
            } else {
                document.getElementById('detailedViewBtn').classList.add('bg-purple-500', 'text-white');
                document.getElementById('detailedViewBtn').classList.remove('bg-gray-200', 'text-gray-700');
            }
            
            updateRecipesList();
        }

        function applyRecipeFilter() {
            if (currentRecipeFilter === 'all') {
                filteredRecipes = [...recipes];
            } else {
                filteredRecipes = recipes.filter(recipe => 
                    recipe.category === currentRecipeFilter
                );
            }
            
            updateRecipesList();
        }

        function updateRecipesList() {
            const list = document.getElementById('recipesList');
            const countElement = document.getElementById('recipesCount');
            
            // Update count
            countElement.textContent = filteredRecipes.length;
            
            if (recipes.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö<br>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            if (filteredRecipes.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-lg mb-2">üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</div>
                        <div class="text-sm">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏î‡∏π</div>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = filteredRecipes.map(recipe => {
                if (currentRecipeView === 'compact') {
                    return renderCompactRecipe(recipe);
                } else {
                    return renderDetailedRecipe(recipe);
                }
            }).join('');
        }

        function renderCompactRecipe(recipe) {
            const categoryIcon = getCategoryIcon(recipe.category);
            
            return `
                <div class="p-3 border rounded-lg bg-purple-50 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-lg">${categoryIcon}</span>
                                <div class="font-medium text-lg">${recipe.name}</div>
                                <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">${recipe.category}</span>
                            </div>
                            <div class="flex items-center gap-4 text-sm text-gray-600">
                                <span>üìà ‡πÑ‡∏î‡πâ ${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                                <span class="font-medium text-green-600">üí∞ ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                                <span class="text-purple-600">üìä ‡∏£‡∏ß‡∏° ${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                        </div>
                        <div class="flex gap-1 ml-4">
                            <button onclick="viewRecipeDetails(${recipe.id})" class="text-purple-500 hover:text-purple-700 text-xs px-2 py-1 bg-white rounded border">üëÅÔ∏è</button>
                            <button onclick="copyRecipe(${recipe.id})" class="text-blue-500 hover:text-blue-700 text-xs px-2 py-1 bg-white rounded border">üìã</button>
                            <button onclick="editRecipe(${recipe.id})" class="text-green-500 hover:text-green-700 text-xs px-2 py-1 bg-white rounded border">‚úèÔ∏è</button>
                            <button onclick="removeRecipe(${recipe.id})" class="text-red-500 hover:text-red-700 text-xs px-2 py-1 bg-white rounded border">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDetailedRecipe(recipe) {
            const categoryIcon = getCategoryIcon(recipe.category);
            
            // Create detailed cost breakdown display
            let costBreakdown = '';
            
            // Show base recipe cost if exists
            if (recipe.baseRecipeName && recipe.baseCost > 0) {
                costBreakdown = `
                    <div class="text-xs text-blue-600 mt-1">
                        üìã ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${recipe.baseRecipeName} (${recipe.baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó)
                    </div>
                `;
            }
            
            // Show ingredients breakdown
            if (recipe.ingredients && recipe.ingredients.length > 0) {
                costBreakdown += `
                    <div class="text-xs text-orange-600 mt-1">
                        üßÇ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:
                    </div>
                    <div class="text-xs text-gray-600 ml-2">
                `;
                
                recipe.ingredients.forEach(ingredient => {
                    const unitPrice = ingredient.unitPrice || 0;
                    const cost = ingredient.cost || (ingredient.amount * unitPrice);
                    costBreakdown += `
                        <div class="flex justify-between">
                            <span>‚Ä¢ ${ingredient.name} ${ingredient.amount} ${ingredient.unit}</span>
                            <span>${cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    `;
                });
                
                costBreakdown += `</div>`;
                
                if (recipe.additionalCost > 0) {
                    costBreakdown += `
                        <div class="text-xs text-orange-600 mt-1">
                            ‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö: ${recipe.additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó
                        </div>
                    `;
                }
            }
            
            return `
                <div class="p-3 border rounded-lg bg-purple-50">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xl">${categoryIcon}</span>
                        <div class="font-medium text-lg">${recipe.name}</div>
                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">${recipe.category}</span>
                    </div>
                    <div class="text-sm text-gray-600">‡πÑ‡∏î‡πâ ${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ | ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏° ${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    <div class="text-sm text-green-600 font-medium">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    ${costBreakdown}
                    <div class="text-xs text-gray-500 mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${recipe.created}</div>
                    <div class="mt-2 flex gap-2">
                        <button onclick="viewRecipeDetails(${recipe.id})" class="text-purple-500 hover:text-purple-700 text-sm">üëÅÔ∏è ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                        <button onclick="copyRecipe(${recipe.id})" class="text-blue-500 hover:text-blue-700 text-sm">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
                        <button onclick="editRecipe(${recipe.id})" class="text-green-500 hover:text-green-700 text-sm">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button onclick="removeRecipe(${recipe.id})" class="text-red-500 hover:text-red-700 text-sm">üóëÔ∏è ‡∏•‡∏ö‡∏™‡∏π‡∏ï‡∏£</button>
                    </div>
                </div>
            `;
        }

        function getCategoryIcon(category) {
            const icons = {
                '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á': 'üçû',
                '‡πÇ‡∏î‡∏ô‡∏±‡∏ó': 'üç©',
                '‡πÄ‡∏Ñ‡πâ‡∏Å': 'üéÇ',
                '‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ': 'üç™',
                '‡∏°‡∏±‡∏ü‡∏ü‡∏¥‡∏ô': 'üßÅ',
                '‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á': 'ü•ê',
                '‡∏û‡∏≤‡∏¢': 'ü•ß',
                '‡∏Ç‡∏ô‡∏°‡πÑ‡∏ó‡∏¢': 'üçÆ',
                '‡∏≠‡∏∑‡πà‡∏ô‡πÜ': 'üç∞'
            };
            return icons[category] || 'üç∞';
        }

        function updateRecipeOptions() {
            const selects = document.querySelectorAll('.ingredient-select');
            const options = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>' + 
                inventory.map(item => `<option value="${item.name}">${item.name} (${item.unit})</option>`).join('');
            selects.forEach(select => select.innerHTML = options);
            
            // Update base recipe options
            const baseRecipeSelect = document.getElementById('baseRecipe');
            baseRecipeSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</option>' + 
                recipes.map(recipe => `<option value="${recipe.id}">${recipe.name} (${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢)</option>`).join('');
            
            // Initialize filtered recipes and update display
            filteredRecipes = [...recipes];
            updateRecipesList();
        }

        function copyRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            // Reset form to create mode
            resetRecipeForm();
            
            // Fill form with recipe data (with "‡∏™‡∏≥‡πÄ‡∏ô‡∏≤" prefix)
            document.getElementById('recipeName').value = `‡∏™‡∏≥‡πÄ‡∏ô‡∏≤ ${recipe.name}`;
            document.getElementById('recipeCategory').value = recipe.category || '';
            document.getElementById('recipeYield').value = recipe.yield;
            
            // Set base recipe if exists
            if (recipe.baseRecipeId) {
                document.getElementById('baseRecipe').value = recipe.baseRecipeId;
                // Trigger base recipe loading to show cost info
                loadBaseRecipe();
            }
            
            // Clear existing ingredients except first row
            clearAllIngredients();
            
            // Load ingredients
            const container = document.getElementById('recipeIngredients');
            recipe.ingredients.forEach((ingredient, index) => {
                let row;
                if (index === 0) {
                    row = container.querySelector('.ingredient-row');
                } else {
                    addIngredientRow();
                    row = container.lastElementChild;
                }
                
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                select.value = ingredient.name;
                amountInput.value = ingredient.amount;
            });
            
            // Scroll to form
            document.getElementById('recipes').scrollIntoView({ behavior: 'smooth' });
        }

        function editRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            editingRecipeId = id;
            
            // Switch to edit mode
            document.getElementById('createRecipeBtn').classList.add('hidden');
            document.getElementById('updateRecipeBtn').classList.remove('hidden');
            document.getElementById('cancelEditBtn').classList.remove('hidden');
            
            // Fill form with recipe data
            document.getElementById('recipeName').value = recipe.name;
            document.getElementById('recipeCategory').value = recipe.category || '';
            document.getElementById('recipeYield').value = recipe.yield;
            
            // Set base recipe if exists
            if (recipe.baseRecipeId) {
                document.getElementById('baseRecipe').value = recipe.baseRecipeId;
                // Trigger base recipe loading to show cost info
                loadBaseRecipe();
            } else {
                document.getElementById('baseRecipe').value = '';
            }
            
            // Clear existing ingredients except first row
            clearAllIngredients();
            
            // Load ingredients
            const container = document.getElementById('recipeIngredients');
            recipe.ingredients.forEach((ingredient, index) => {
                let row;
                if (index === 0) {
                    row = container.querySelector('.ingredient-row');
                } else {
                    addIngredientRow();
                    row = container.lastElementChild;
                }
                
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                select.value = ingredient.name;
                amountInput.value = ingredient.amount;
            });
            
            // Scroll to form
            document.getElementById('recipes').scrollIntoView({ behavior: 'smooth' });
        }

        function updateRecipe() {
            if (!editingRecipeId) return;
            
            const name = document.getElementById('recipeName').value;
            const category = document.getElementById('recipeCategory').value;
            const yield = parseFloat(document.getElementById('recipeYield').value);
            const baseRecipeId = document.getElementById('baseRecipe').value;
            
            if (!name || !yield) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ');
                return;
            }

            const ingredientRows = document.querySelectorAll('.ingredient-row');
            const ingredients = [];
            let additionalCost = 0;
            let baseCost = 0;
            let baseRecipe = null;
            let costBreakdown = [];

            // Calculate base recipe cost if selected
            if (baseRecipeId) {
                baseRecipe = recipes.find(r => r.id == baseRecipeId);
                if (baseRecipe) {
                    // Calculate base cost proportionally based on yield
                    const yieldRatio = yield / baseRecipe.yield;
                    baseCost = baseRecipe.totalCost * yieldRatio;
                }
            }

            // Calculate additional ingredients cost using inventory unit prices
            ingredientRows.forEach(row => {
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                if (select.value && amountInput.value) {
                    const item = inventory.find(i => i.name === select.value);
                    if (!item) {
                        alert(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö "${select.value}" ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á`);
                        return;
                    }
                    
                    const amount = parseFloat(amountInput.value);
                    // Use unitPrice from inventory (price per unit)
                    const cost = amount * item.unitPrice;
                    
                    ingredients.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                    additionalCost += cost;
                    
                    // Add to cost breakdown for detailed display
                    costBreakdown.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                }
            });

            // For base recipe usage, we need at least the base recipe OR additional ingredients
            if (!baseRecipe && ingredients.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }

            const totalCost = baseCost + additionalCost;
            const costPerUnit = totalCost / yield;

            // Update the recipe
            const recipeIndex = recipes.findIndex(r => r.id === editingRecipeId);
            if (recipeIndex !== -1) {
                recipes[recipeIndex] = {
                    ...recipes[recipeIndex],
                    name,
                    category: category || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
                    yield,
                    ingredients,
                    additionalCost,
                    baseCost,
                    baseRecipeId: baseRecipeId || null,
                    baseRecipeName: baseRecipe ? baseRecipe.name : null,
                    totalCost,
                    costPerUnit,
                    updated: new Date().toLocaleDateString('th-TH')
                };

                localStorage.setItem('bakery_recipes', JSON.stringify(recipes));
                updateRecipesList();
                resetRecipeForm();
                
                // Show detailed success message with cost breakdown
                let message = `‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏π‡∏ï‡∏£ "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n`;
                
                if (baseRecipe) {
                    message += `üìã ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseRecipe.name}\n`;
                    message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
                }
                
                if (costBreakdown.length > 0) {
                    message += `üßÇ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:\n`;
                    costBreakdown.forEach(item => {
                        message += `‚Ä¢ ${item.name}: ${item.amount} ${item.unit} √ó ${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó = ${item.cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                    });
                    message += `\nüí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏£‡∏ß‡∏°: ${additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
                }
                
                message += `üìä ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                message += `üìà ‡πÑ‡∏î‡πâ: ${yield} ‡∏ä‡∏¥‡πâ‡∏ô`;
                
                alert(message);
            }
        }

        function cancelEdit() {
            resetRecipeForm();
        }

        function resetRecipeForm() {
            editingRecipeId = null;
            
            // Switch back to create mode
            document.getElementById('createRecipeBtn').classList.remove('hidden');
            document.getElementById('updateRecipeBtn').classList.add('hidden');
            document.getElementById('cancelEditBtn').classList.add('hidden');
            
            // Clear form
            clearRecipeForm();
        }

        function viewRecipeDetails(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            const categoryIcon = getCategoryIcon(recipe.category);
            let message = `${categoryIcon} ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏ï‡∏£: ${recipe.name}\n`;
            message += `üè∑Ô∏è ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ${recipe.category}\n`;
            message += `üìà ‡πÑ‡∏î‡πâ: ${recipe.yield} ‡∏ä‡∏¥‡πâ‡∏ô\n\n`;
            
            // Show base recipe if exists
            if (recipe.baseRecipeName && recipe.baseCost > 0) {
                message += `üìã ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${recipe.baseRecipeName}\n`;
                message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${recipe.baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            // Show ingredients details
            if (recipe.ingredients && recipe.ingredients.length > 0) {
                message += `üßÇ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:\n`;
                recipe.ingredients.forEach(ingredient => {
                    const unitPrice = ingredient.unitPrice || 0;
                    const cost = ingredient.cost || (ingredient.amount * unitPrice);
                    message += `‚Ä¢ ${ingredient.name}: ${ingredient.amount} ${ingredient.unit}\n`;
                    message += `  ‡∏£‡∏≤‡∏Ñ‡∏≤: ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${ingredient.unit} √ó ${ingredient.amount} = ${cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                });
                message += `\nüí∞ ‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö: ${recipe.additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            message += `üìä ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            message += `üìÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${recipe.created}`;
            
            if (recipe.updated) {
                message += `\nüìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${recipe.updated}`;
            }
            
            alert(message);
        }

        function removeRecipe(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ?')) {
                recipes = recipes.filter(recipe => recipe.id !== id);
                localStorage.setItem('bakery_recipes', JSON.stringify(recipes));
                updateRecipesList();
                updateRecipeOptions(); // Update base recipe options
            }
        }

        // Sales Management
        function updateSalesOptions() {
            const select = document.getElementById('saleProduct');
            
            // Filter recipes to show only those that have been produced (have stock or production history)
            const producedRecipes = recipes.filter(recipe => {
                const stock = productStock[recipe.name] || 0;
                const hasProduction = productions.some(p => p.recipeName === recipe.name);
                return stock > 0 || hasProduction;
            });
            
            if (producedRecipes.length === 0) {
                select.innerHTML = '<option value="">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡πâ‡∏ß</option>';
            } else {
                select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>' + 
                    producedRecipes.map(recipe => {
                        const stock = productStock[recipe.name] || 0;
                        const stockStatus = stock > 0 ? `‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢` : '‡∏´‡∏°‡∏î';
                        return `<option value="${recipe.name}" data-cost="${recipe.costPerUnit}" ${stock === 0 ? 'disabled' : ''}>${recipe.name} (${stockStatus})</option>`;
                    }).join('');
            }
            
            updateSalesHistory();
            updateTodaySummary();
            updateProductStock();
        }

        function updateSaleInfo() {
            const productName = document.getElementById('saleProduct').value;
            const productInfo = document.getElementById('productInfo');
            const productDetails = document.getElementById('productDetails');
            
            if (!productName) {
                productInfo.classList.add('hidden');
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            const stock = productStock[productName] || 0;
            const pricing = productPricing[productName];
            
            if (!recipe) return;
            
            productInfo.classList.remove('hidden');
            
            // Get today's production for this product
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => 
                p.productionDate === today && p.recipeName === productName
            );
            const todayProduced = todayProductions.reduce((sum, p) => sum + p.quantity, 0);
            
            // Auto-fill sale price if pricing is set
            if (pricing && pricing.sellingPrice) {
                document.getElementById('salePrice').value = pricing.sellingPrice.toFixed(2);
            }
            
            let pricingInfo = '';
            if (pricing) {
                pricingInfo = `
                    <div class="text-green-600"><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î:</strong> ${pricing.sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    <div class="text-purple-600"><strong>‡∏Å‡∏≥‡πÑ‡∏£‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á:</strong> ${pricing.profitPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó (${pricing.profitMargin.toFixed(1)}%)</div>
                `;
            } else {
                pricingInfo = '<div class="text-orange-600"><strong>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</strong> - ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>';
            }
            
            productDetails.innerHTML = `
                <div class="space-y-1">
                    <div><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${recipe.name}</div>
                    <div><strong>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</strong> ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    ${pricingInfo}
                    <div class="text-blue-600"><strong>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å:</strong> ${stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    ${todayProduced > 0 ? `<div class="text-green-600"><strong>‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</strong> ${todayProduced} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>` : ''}
                </div>
            `;
            
            // Clear previous calculations
            document.getElementById('saleQuantity').value = '';
            document.getElementById('remainingStock').value = '';
            if (!pricing || !pricing.sellingPrice) {
                document.getElementById('salePrice').value = '';
            }
            document.getElementById('saleCalculation').classList.add('hidden');
            document.getElementById('recordSaleBtn').disabled = true;
        }



        function calculateFromRemaining() {
            const productName = document.getElementById('saleProduct').value;
            const remainingStock = parseFloat(document.getElementById('remainingStock').value);
            
            if (!productName || isNaN(remainingStock) || remainingStock < 0) {
                // Clear sale quantity if invalid input
                document.getElementById('saleQuantity').value = '';
                calculateSaleTotal();
                return;
            }
            
            const currentStock = productStock[productName] || 0;
            
            // Validate that remaining stock doesn't exceed current stock
            if (remainingStock > currentStock) {
                alert(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (${currentStock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢)`);
                document.getElementById('remainingStock').value = '';
                document.getElementById('saleQuantity').value = '';
                calculateSaleTotal();
                return;
            }
            
            // Calculate sold quantity from current stock
            const soldQuantity = Math.max(0, currentStock - remainingStock);
            
            // Update the sale quantity field
            document.getElementById('saleQuantity').value = soldQuantity;
            
            // Trigger calculation
            calculateSaleTotal();
        }

        function calculateSaleTotal() {
            const productName = document.getElementById('saleProduct').value;
            const quantity = parseFloat(document.getElementById('saleQuantity').value);
            const salePrice = parseFloat(document.getElementById('salePrice').value);
            const saleCalculation = document.getElementById('saleCalculation');
            const saleDetails = document.getElementById('saleDetails');
            const recordSaleBtn = document.getElementById('recordSaleBtn');
            
            if (!productName || isNaN(quantity) || isNaN(salePrice) || quantity <= 0 || salePrice <= 0) {
                saleCalculation.classList.add('hidden');
                recordSaleBtn.disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            const stock = productStock[productName] || 0;
            
            if (!recipe) return;
            
            // Check if enough stock
            if (quantity > stock) {
                saleCalculation.classList.remove('hidden');
                saleDetails.innerHTML = `
                    <div class="text-red-600 font-medium">‚ö†Ô∏è ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠!</div>
                    <div class="text-red-600 text-sm">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£: ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ | ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà: ${stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    <div class="text-red-600 text-xs mt-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ</div>
                `;
                recordSaleBtn.disabled = true;
                return;
            }
            
            const totalRevenue = quantity * salePrice;
            const totalCost = quantity * recipe.costPerUnit;
            const profit = totalRevenue - totalCost;
            const profitMargin = totalRevenue > 0 ? ((profit / totalRevenue) * 100).toFixed(1) : '0';
            
            saleCalculation.classList.remove('hidden');
            saleDetails.innerHTML = `
                <div class="space-y-1">
                    <div class="flex justify-between">
                        <span>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢:</span>
                        <span class="font-medium">${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between">
                        <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</span>
                        <span>${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between border-t pt-1">
                        <span>‡∏Å‡∏≥‡πÑ‡∏£:</span>
                        <span class="font-bold ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">${profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between">
                        <span>‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</span>
                        <span class="text-sm">${(profit / quantity).toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between">
                        <span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£:</span>
                        <span class="text-sm">${profitMargin}%</span>
                    </div>
                    <div class="text-blue-600 text-sm mt-2 bg-blue-50 p-2 rounded">
                        üì¶ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏¢: <span class="font-bold">${stock - quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                    </div>
                </div>
            `;
            
            recordSaleBtn.disabled = false;
        }

        function recordSale() {
            const productName = document.getElementById('saleProduct').value;
            const quantity = parseFloat(document.getElementById('saleQuantity').value);
            const salePrice = parseFloat(document.getElementById('salePrice').value);

            if (!productName || !quantity || !salePrice) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            const recipe = recipes.find(r => r.name === productName);
            const stock = productStock[productName] || 0;

            if (!recipe) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }

            if (quantity > stock) {
                alert(`‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠! ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ${stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`);
                return;
            }

            const totalRevenue = quantity * salePrice;
            const totalCost = quantity * recipe.costPerUnit;
            const profit = totalRevenue - totalCost;

            // Deduct from stock
            productStock[productName] = stock - quantity;

            sales.push({
                id: Date.now(),
                productName,
                quantity,
                salePrice,
                totalRevenue,
                totalCost,
                profit,
                date: new Date().toLocaleDateString('th-TH'),
                time: new Date().toLocaleTimeString('th-TH')
            });

            localStorage.setItem('bakery_sales', JSON.stringify(sales));
            localStorage.setItem('bakery_product_stock', JSON.stringify(productStock));
            
            updateSalesHistory();
            updateTodaySummary();
            updateProductStock();
            updateSalesOptions(); // Update stock display in dropdown
            
            // Clear form
            document.getElementById('saleQuantity').value = '';
            document.getElementById('remainingStock').value = '';
            document.getElementById('salePrice').value = '';
            document.getElementById('saleCalculation').classList.add('hidden');
            document.getElementById('recordSaleBtn').disabled = true;
            
            alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
                  `‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${productName}\n` +
                  `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢\n` +
                  `‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: ${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏Å‡∏≥‡πÑ‡∏£: ${profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${productStock[productName]} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`);
        }

        function updateProductStock() {
            const list = document.getElementById('productStock');
            
            if (recipes.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>';
                return;
            }
            
            list.innerHTML = recipes.map(recipe => {
                const stock = productStock[recipe.name] || 0;
                const lowStock = stock < 5; // Warning when stock is less than 5
                
                return `
                    <div class="bg-white border ${lowStock ? 'border-red-200' : 'border-blue-200'} rounded-lg shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden">
                        <div class="px-3 py-2 bg-gradient-to-r ${lowStock ? 'from-red-50 to-red-100' : 'from-blue-50 to-blue-100'} border-b ${lowStock ? 'border-red-200' : 'border-blue-200'}">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 rounded-full ${lowStock ? 'bg-red-100' : 'bg-blue-100'} flex items-center justify-center">
                                        <span class="text-sm">${lowStock ? '‚ö†Ô∏è' : 'üì¶'}</span>
                                    </div>
                                    <h4 class="font-medium text-sm text-gray-800">${recipe.name}</h4>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold ${lowStock ? 'text-red-600' : 'text-blue-600'}">${stock}</div>
                                    <div class="text-xs ${lowStock ? 'text-red-500' : 'text-blue-500'}">‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                </div>
                            </div>
                        </div>
                        <div class="px-3 py-2">
                            <div class="flex justify-between items-center text-xs">
                                <span class="text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢:</span>
                                <span class="font-medium text-gray-800">${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            ${lowStock ? '<div class="text-red-500 text-xs font-medium mt-1">‚ö†Ô∏è ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div>' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateSalesHistory() {
            const list = document.getElementById('salesHistory');
            
            if (sales.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>';
                return;
            }
            
            const recentSales = sales.slice(-10).reverse();
            list.innerHTML = recentSales.map(sale => `
                <div class="bg-white border ${sale.autoGenerated ? 'border-blue-200' : 'border-pink-200'} rounded-xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden">
                    <!-- Header -->
                    <div class="px-4 py-3 bg-gradient-to-r ${sale.autoGenerated ? 'from-blue-50 to-cyan-50 border-b border-blue-200' : 'from-pink-50 to-rose-50 border-b border-pink-200'}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full ${sale.autoGenerated ? 'bg-blue-100' : 'bg-pink-100'} flex items-center justify-center">
                                    <span class="text-lg">${sale.autoGenerated ? 'ü§ñ' : 'üí∞'}</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-lg text-gray-800">${sale.productName}</h3>
                                    ${sale.autoGenerated ? '<div class="text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded-full font-medium">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>' : ''}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold ${sale.profit > 0 ? 'text-green-600' : 'text-red-600'}">${sale.profit.toFixed(2)}</div>
                                <div class="text-xs ${sale.profit > 0 ? 'text-green-500' : 'text-red-500'}">‡∏ö‡∏≤‡∏ó ‡∏Å‡∏≥‡πÑ‡∏£</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-4 space-y-3">
                        <!-- Sale Details -->
                        <div class="grid grid-cols-3 gap-4">
                            <div class="bg-gray-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</div>
                                <div class="text-lg font-bold text-gray-800">${sale.quantity}</div>
                                <div class="text-sm text-gray-600">‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                            </div>
                            <div class="bg-blue-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-blue-500 uppercase tracking-wide mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                <div class="text-lg font-bold text-blue-700">${sale.salePrice.toFixed(2)}</div>
                                <div class="text-sm text-blue-600">‡∏ö‡∏≤‡∏ó</div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-green-500 uppercase tracking-wide mb-1">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</div>
                                <div class="text-lg font-bold text-green-700">${sale.totalRevenue.toFixed(2)}</div>
                                <div class="text-sm text-green-600">‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                        
                        <!-- Profit Analysis -->
                        <div class="bg-gradient-to-r ${sale.profit > 0 ? 'from-green-50 to-emerald-50 border border-green-100' : 'from-red-50 to-pink-50 border border-red-100'} rounded-lg p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="${sale.profit > 0 ? 'text-green-600' : 'text-red-600'}">${sale.profit > 0 ? 'üìà' : 'üìâ'}</span>
                                <h4 class="font-medium ${sale.profit > 0 ? 'text-green-800' : 'text-red-800'}">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≥‡πÑ‡∏£</h4>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢:</span>
                                    <span class="font-medium text-gray-800">${sale.totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</span>
                                    <span class="font-medium text-gray-800">${sale.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                                <div class="flex justify-between col-span-2 pt-2 border-t ${sale.profit > 0 ? 'border-green-200' : 'border-red-200'}">
                                    <span class="${sale.profit > 0 ? 'text-green-600' : 'text-red-600'} font-medium">‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô:</span>
                                    <span class="font-bold ${sale.profit > 0 ? 'text-green-700' : 'text-red-700'}">${sale.profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                            </div>
                        </div>
                        
                        ${sale.note ? `
                        <div class="bg-blue-50 rounded-lg p-2 border border-blue-100">
                            <div class="text-xs font-medium text-blue-600 mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</div>
                            <div class="text-sm text-blue-700">${sale.note}</div>
                        </div>
                        ` : ''}
                        
                        <!-- Timestamp -->
                        <div class="flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100">
                            <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</span>
                            <span class="font-medium">${sale.date} ${sale.time}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateTodaySummary() {
            const today = new Date().toLocaleDateString('th-TH');
            const todayISO = new Date().toISOString().split('T')[0];
            
            // ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            const todaySales = sales.filter(sale => sale.date === today);
            const totalRevenue = todaySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            
            // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            const todayProductions = productions.filter(p => p.productionDate === todayISO);
            const totalProductionCost = todayProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            
            // ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ = ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
            const netProfit = totalRevenue - totalProductionCost;
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            document.getElementById('todayRevenue').textContent = totalRevenue.toFixed(2) + ' ‡∏ö‡∏≤‡∏ó';
            document.getElementById('todayProductionCost').textContent = totalProductionCost.toFixed(2) + ' ‡∏ö‡∏≤‡∏ó';
            
            const netProfitElement = document.getElementById('todayNetProfit');
            netProfitElement.textContent = netProfit.toFixed(2) + ' ‡∏ö‡∏≤‡∏ó';
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô
            if (netProfit > 0) {
                netProfitElement.className = 'font-bold text-green-600';
            } else if (netProfit < 0) {
                netProfitElement.className = 'font-bold text-red-600';
            } else {
                netProfitElement.className = 'font-bold text-gray-600';
            }
        }

        // Reports Management
        function initializeReports() {
            // Set default dates
            const today = new Date();
            document.getElementById('dailyReportDate').value = today.toISOString().split('T')[0];
            
            const year = today.getFullYear();
            const week = getWeekNumber(today);
            document.getElementById('weeklyReportWeek').value = `${year}-W${week.toString().padStart(2, '0')}`;
            
            const month = today.toISOString().slice(0, 7);
            document.getElementById('monthlyReportMonth').value = month;
            
            // Show daily report by default
            showReport('daily');
        }

        function showReport(reportType) {
            // Hide all reports
            document.querySelectorAll('.report-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected report
            document.getElementById(`${reportType}Report`).classList.remove('hidden');
            
            // Update button styles
            document.querySelectorAll('.report-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2');
            });
            event.target.classList.add('ring-2', 'ring-offset-2');
            
            // Generate report
            if (reportType === 'daily') generateDailyReport();
            if (reportType === 'weekly') generateWeeklyReport();
            if (reportType === 'monthly') generateMonthlyReport();
        }

        function generateDailyReport() {
            const selectedDate = document.getElementById('dailyReportDate').value;
            if (!selectedDate) return;
            
            const dateStr = new Date(selectedDate).toLocaleDateString('th-TH');
            const dailySales = sales.filter(sale => sale.date === dateStr);
            const dailyProductions = productions.filter(p => p.productionDate === selectedDate);
            
            // Calculate statistics
            const totalRevenue = dailySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const totalProfit = dailySales.reduce((sum, sale) => sum + sale.profit, 0);
            const totalCost = dailySales.reduce((sum, sale) => sum + sale.totalCost, 0);
            const totalItems = dailySales.reduce((sum, sale) => sum + sale.quantity, 0);
            const productionCost = dailyProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥
            const netProfit = totalRevenue - productionCost;
            
            // Display statistics
            const statsDiv = document.getElementById('dailyStats');
            statsDiv.innerHTML = `
                <div class="space-y-3">
                    <div class="p-3 bg-green-100 rounded-lg">
                        <div class="text-sm text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                        <div class="text-xl font-bold text-green-800">${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-orange-100 rounded-lg">
                        <div class="text-sm text-orange-700">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                        <div class="text-xl font-bold text-orange-800">${productionCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 ${netProfit >= 0 ? 'bg-green-100' : 'bg-red-100'} rounded-lg border-2 ${netProfit >= 0 ? 'border-green-300' : 'border-red-300'}">
                        <div class="text-sm ${netProfit >= 0 ? 'text-green-700' : 'text-red-700'}">
                            ${netProfit >= 0 ? 'üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'}
                        </div>
                        <div class="text-xl font-bold ${netProfit >= 0 ? 'text-green-800' : 'text-red-800'}">${netProfit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'} mt-1">
                            ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
                        </div>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <div class="text-sm text-purple-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</div>
                        <div class="text-xl font-bold text-purple-800">${totalItems} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    </div>
                    <div class="p-3 bg-blue-100 rounded-lg">
                        <div class="text-sm text-blue-700">‡∏Å‡∏≥‡πÑ‡∏£‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
                        <div class="text-xl font-bold text-blue-800">${totalProfit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs text-blue-600 mt-1">
                            ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                        </div>
                    </div>
                </div>
            `;
            
            // Calculate production data for the day
            const productionData = {};
            dailyProductions.forEach(prod => {
                if (productionData[prod.recipeName]) {
                    productionData[prod.recipeName] += prod.quantity;
                } else {
                    productionData[prod.recipeName] = prod.quantity;
                }
            });
            
            // Top products with detailed sales breakdown and production comparison
            const productSales = {};
            dailySales.forEach(sale => {
                if (productSales[sale.productName]) {
                    productSales[sale.productName].quantity += sale.quantity;
                    productSales[sale.productName].revenue += sale.totalRevenue;
                    productSales[sale.productName].profit += sale.profit;
                    productSales[sale.productName].sales.push(sale);
                } else {
                    productSales[sale.productName] = {
                        quantity: sale.quantity,
                        revenue: sale.totalRevenue,
                        profit: sale.profit,
                        sales: [sale]
                    };
                }
            });
            
            // Combine all products (both produced and sold)
            const allProducts = new Set([...Object.keys(productionData), ...Object.keys(productSales)]);
            const productAnalysis = Array.from(allProducts).map(productName => {
                const produced = productionData[productName] || 0;
                const sold = productSales[productName]?.quantity || 0;
                const salesData = productSales[productName];
                const sellThroughRate = produced > 0 ? (sold / produced * 100) : (sold > 0 ? 100 : 0);
                
                return {
                    name: productName,
                    produced,
                    sold,
                    sellThroughRate,
                    revenue: salesData?.revenue || 0,
                    profit: salesData?.profit || 0,
                    sales: salesData?.sales || []
                };
            }).sort((a, b) => b.sold - a.sold);
            
            const topProductsDiv = document.getElementById('dailyTopProducts');
            if (productAnalysis.length === 0) {
                topProductsDiv.innerHTML = '<div class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>';
            } else {
                topProductsDiv.innerHTML = `
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-800 border-b pb-2">üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h4>
                        ${productAnalysis.map((product, index) => {
                            // Determine sell-through performance
                            let performanceColor = 'text-gray-600';
                            let performanceBg = 'bg-gray-50';
                            let performanceIcon = 'üìä';
                            
                            if (product.sellThroughRate >= 80) {
                                performanceColor = 'text-green-600';
                                performanceBg = 'bg-green-50';
                                performanceIcon = 'üî•';
                            } else if (product.sellThroughRate >= 50) {
                                performanceColor = 'text-yellow-600';
                                performanceBg = 'bg-yellow-50';
                                performanceIcon = 'üìà';
                            } else if (product.sellThroughRate > 0) {
                                performanceColor = 'text-orange-600';
                                performanceBg = 'bg-orange-50';
                                performanceIcon = 'üìâ';
                            } else if (product.produced > 0) {
                                performanceColor = 'text-red-600';
                                performanceBg = 'bg-red-50';
                                performanceIcon = '‚ö†Ô∏è';
                            }
                            
                            return `
                                <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition-all duration-200">
                                    <!-- Product Header with Performance -->
                                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-4 py-3 border-b">
                                        <div class="flex justify-between items-center">
                                            <div class="flex items-center gap-3">
                                                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                                                    <span class="text-sm font-bold text-blue-600">${index + 1}</span>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-gray-800">${product.name}</div>
                                                    <div class="text-xs text-blue-600">${product.sales.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ç‡∏≤‡∏¢</div>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="font-bold text-blue-600">${product.sold} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                                <div class="text-sm text-green-600">${product.revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Production vs Sales Analysis -->
                                    <div class="p-4">
                                        <!-- Performance Indicator -->
                                        <div class="mb-4 p-3 ${performanceBg} rounded-lg border border-opacity-20">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <span class="text-lg">${performanceIcon}</span>
                                                    <div>
                                                        <div class="font-medium ${performanceColor}">
                                                            ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ${product.sellThroughRate.toFixed(1)}%
                                                        </div>
                                                        <div class="text-xs text-gray-600">
                                                            ${product.produced > 0 ? 
                                                                `‡∏ú‡∏•‡∏¥‡∏ï ${product.produced} ‡∏Ç‡∏≤‡∏¢ ${product.sold} ‡∏´‡∏ô‡πà‡∏ß‡∏¢` : 
                                                                product.sold > 0 ? '‡∏Ç‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏°' : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢'
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="text-right">
                                                    ${product.produced > product.sold && product.produced > 0 ? `
                                                        <div class="text-xs text-orange-600">
                                                            ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${product.produced - product.sold} ‡∏´‡∏ô‡πà‡∏ß‡∏¢
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                            
                                            <!-- Visual Progress Bar -->
                                            ${product.produced > 0 ? `
                                                <div class="mt-2">
                                                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                                                        <span>‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</span>
                                                        <span>${product.sold}/${product.produced}</span>
                                                    </div>
                                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                                        <div class="h-2 rounded-full transition-all duration-300 ${
                                                            product.sellThroughRate >= 80 ? 'bg-green-500' :
                                                            product.sellThroughRate >= 50 ? 'bg-yellow-500' :
                                                            product.sellThroughRate > 0 ? 'bg-orange-500' : 'bg-red-500'
                                                        }" style="width: ${Math.min(product.sellThroughRate, 100)}%"></div>
                                                    </div>
                                                </div>
                                            ` : ''}
                                        </div>
                                        
                                        <!-- Production & Sales Stats -->
                                        <div class="grid grid-cols-2 gap-4 mb-4">
                                            <div class="bg-indigo-50 rounded-lg p-3 border border-indigo-100">
                                                <div class="flex items-center gap-2 mb-1">
                                                    <span class="text-indigo-600">üè≠</span>
                                                    <div class="text-xs font-medium text-indigo-600 uppercase tracking-wide">‡∏ú‡∏•‡∏¥‡∏ï</div>
                                                </div>
                                                <div class="text-xl font-bold text-indigo-700">${product.produced}</div>
                                                <div class="text-sm text-indigo-600">‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                            </div>
                                            <div class="bg-green-50 rounded-lg p-3 border border-green-100">
                                                <div class="flex items-center gap-2 mb-1">
                                                    <span class="text-green-600">üí∞</span>
                                                    <div class="text-xs font-medium text-green-600 uppercase tracking-wide">‡∏Ç‡∏≤‡∏¢</div>
                                                </div>
                                                <div class="text-xl font-bold text-green-700">${product.sold}</div>
                                                <div class="text-sm text-green-600">‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                            </div>
                                        </div>
                                        
                                        <!-- Sales Details (if any) -->
                                        ${product.sales.length > 0 ? `
                                            <div class="space-y-2">
                                                <div class="text-sm font-medium text-gray-700 border-b pb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
                                                ${product.sales.map(sale => `
                                                    <div class="flex justify-between items-center text-sm py-2 px-3 bg-gray-50 rounded-lg">
                                                        <div class="flex items-center gap-2">
                                                            <span class="text-gray-600">${sale.time}</span>
                                                            ${sale.autoGenerated ? '<span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full">‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>' : ''}
                                                        </div>
                                                        <div class="flex gap-4 text-xs">
                                                            <span class="font-medium">${sale.quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                                                            <span class="text-blue-600">${sale.salePrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                                                            <span class="text-green-600 font-medium">${sale.totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                        
                                        <!-- Summary -->
                                        <div class="mt-4 pt-3 border-t border-gray-200">
                                            <div class="grid grid-cols-3 gap-4 text-center">
                                                <div>
                                                    <div class="text-xs text-gray-500 mb-1">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</div>
                                                    <div class="font-bold text-green-600">${product.revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                                </div>
                                                <div>
                                                    <div class="text-xs text-gray-500 mb-1">‡∏Å‡∏≥‡πÑ‡∏£</div>
                                                    <div class="font-bold ${product.profit > 0 ? 'text-green-600' : 'text-red-600'}">${product.profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                                </div>
                                                <div>
                                                    <div class="text-xs text-gray-500 mb-1">‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</div>
                                                    <div class="font-bold ${performanceColor}">
                                                        ${product.sellThroughRate >= 80 ? '‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°' :
                                                          product.sellThroughRate >= 50 ? '‡∏î‡∏µ' :
                                                          product.sellThroughRate > 0 ? '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' :
                                                          product.produced > 0 ? '‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á' : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
        }

        function generateWeeklyReport() {
            const selectedWeek = document.getElementById('weeklyReportWeek').value;
            if (!selectedWeek) return;
            
            const [year, week] = selectedWeek.split('-W');
            const weekStart = getDateOfWeek(parseInt(year), parseInt(week));
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            // Filter sales for the week
            const weeklySales = sales.filter(sale => {
                const saleDate = parseThaiDate(sale.date);
                return saleDate >= weekStart && saleDate <= weekEnd;
            });
            
            const totalRevenue = weeklySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const totalProfit = weeklySales.reduce((sum, sale) => sum + sale.profit, 0);
            const totalItems = weeklySales.reduce((sum, sale) => sum + sale.quantity, 0);
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
            const weeklyProductions = productions.filter(p => {
                const prodDate = new Date(p.productionDate);
                return prodDate >= weekStart && prodDate <= weekEnd;
            });
            const totalProductionCost = weeklyProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            const netProfit = totalRevenue - totalProductionCost;
            
            // Display statistics
            const statsDiv = document.getElementById('weeklyStats');
            statsDiv.innerHTML = `
                <div class="space-y-3">
                    <div class="p-3 bg-green-100 rounded-lg">
                        <div class="text-sm text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                        <div class="text-xl font-bold text-green-800">${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-orange-100 rounded-lg">
                        <div class="text-sm text-orange-700">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                        <div class="text-xl font-bold text-orange-800">${totalProductionCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 ${netProfit >= 0 ? 'bg-green-100' : 'bg-red-100'} rounded-lg border-2 ${netProfit >= 0 ? 'border-green-300' : 'border-red-300'}">
                        <div class="text-sm ${netProfit >= 0 ? 'text-green-700' : 'text-red-700'}">
                            ${netProfit >= 0 ? 'üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'}
                        </div>
                        <div class="text-xl font-bold ${netProfit >= 0 ? 'text-green-800' : 'text-red-800'}">${netProfit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <div class="text-sm text-purple-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</div>
                        <div class="text-xl font-bold text-purple-800">${totalItems} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    </div>
                    <div class="p-3 bg-gray-100 rounded-lg">
                        <div class="text-sm text-gray-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</div>
                        <div class="text-xl font-bold text-gray-800">${(totalRevenue / 7).toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                </div>
            `;
            
            // Get weekly production data
            const weeklyProductionData = {};
            weeklyProductions.forEach(prod => {
                if (weeklyProductionData[prod.recipeName]) {
                    weeklyProductionData[prod.recipeName] += prod.quantity;
                } else {
                    weeklyProductionData[prod.recipeName] = prod.quantity;
                }
            });

            // Daily analysis within week with product breakdown and production comparison
            const dailyAnalysis = {};
            const days = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
            
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(weekStart);
                currentDate.setDate(currentDate.getDate() + i);
                const dateStr = currentDate.toLocaleDateString('th-TH');
                const dateISO = currentDate.toISOString().split('T')[0];
                const dayName = days[currentDate.getDay()];
                
                const daySales = weeklySales.filter(sale => sale.date === dateStr);
                const dayProductions = weeklyProductions.filter(p => p.productionDate === dateISO);
                const dayRevenue = daySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
                const dayItems = daySales.reduce((sum, sale) => sum + sale.quantity, 0);
                
                // Production data for this day
                const dayProductionData = {};
                dayProductions.forEach(prod => {
                    if (dayProductionData[prod.recipeName]) {
                        dayProductionData[prod.recipeName] += prod.quantity;
                    } else {
                        dayProductionData[prod.recipeName] = prod.quantity;
                    }
                });
                
                // Product breakdown for each day with production comparison
                const dayProductSales = {};
                daySales.forEach(sale => {
                    if (dayProductSales[sale.productName]) {
                        dayProductSales[sale.productName].quantity += sale.quantity;
                        dayProductSales[sale.productName].revenue += sale.totalRevenue;
                    } else {
                        dayProductSales[sale.productName] = {
                            quantity: sale.quantity,
                            revenue: sale.totalRevenue
                        };
                    }
                });
                
                // Combine production and sales data
                const allDayProducts = new Set([...Object.keys(dayProductionData), ...Object.keys(dayProductSales)]);
                const dayProductAnalysis = Array.from(allDayProducts).map(productName => {
                    const produced = dayProductionData[productName] || 0;
                    const sold = dayProductSales[productName]?.quantity || 0;
                    const revenue = dayProductSales[productName]?.revenue || 0;
                    const sellThroughRate = produced > 0 ? (sold / produced * 100) : (sold > 0 ? 100 : 0);
                    
                    return {
                        name: productName,
                        produced,
                        sold,
                        revenue,
                        sellThroughRate
                    };
                }).sort((a, b) => b.sold - a.sold);
                
                dailyAnalysis[dayName] = {
                    date: dateStr,
                    revenue: dayRevenue,
                    items: dayItems,
                    products: dayProductSales,
                    productAnalysis: dayProductAnalysis,
                    salesCount: daySales.length,
                    productionCount: dayProductions.length
                };
            }
            
            const dayAnalysisDiv = document.getElementById('weeklyDayAnalysis');
            dayAnalysisDiv.innerHTML = `
                <div class="space-y-4">
                    <h4 class="font-medium text-gray-800 border-b pb-2">üìÖ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï vs ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢)</h4>
                    ${Object.entries(dailyAnalysis).map(([day, data]) => `
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition-all duration-200">
                            <!-- Day Header -->
                            <div class="bg-gradient-to-r from-teal-50 to-cyan-50 px-4 py-3 border-b">
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center">
                                            <span class="text-sm font-bold text-teal-600">${day.charAt(0)}</span>
                                        </div>
                                        <div>
                                            <div class="font-semibold text-gray-800">${day}</div>
                                            <div class="text-xs text-teal-600">${data.date} ‚Ä¢ ${data.salesCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ç‡∏≤‡∏¢ ‚Ä¢ ${data.productionCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ú‡∏•‡∏¥‡∏ï</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-teal-600">${data.revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                        <div class="text-sm text-gray-600">${data.items} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Product Analysis -->
                            ${data.productAnalysis.length > 0 ? `
                                <div class="p-4">
                                    <div class="space-y-3">
                                        ${data.productAnalysis.map(product => {
                                            // Determine performance styling
                                            let performanceColor = 'text-gray-600';
                                            let performanceBg = 'bg-gray-50';
                                            let performanceIcon = 'üìä';
                                            
                                            if (product.sellThroughRate >= 80) {
                                                performanceColor = 'text-green-600';
                                                performanceBg = 'bg-green-50';
                                                performanceIcon = 'üî•';
                                            } else if (product.sellThroughRate >= 50) {
                                                performanceColor = 'text-yellow-600';
                                                performanceBg = 'bg-yellow-50';
                                                performanceIcon = 'üìà';
                                            } else if (product.sellThroughRate > 0) {
                                                performanceColor = 'text-orange-600';
                                                performanceBg = 'bg-orange-50';
                                                performanceIcon = 'üìâ';
                                            } else if (product.produced > 0) {
                                                performanceColor = 'text-red-600';
                                                performanceBg = 'bg-red-50';
                                                performanceIcon = '‚ö†Ô∏è';
                                            }
                                            
                                            return `
                                                <div class="border border-gray-200 rounded-lg overflow-hidden">
                                                    <!-- Product Header -->
                                                    <div class="bg-gray-50 px-3 py-2 border-b">
                                                        <div class="flex justify-between items-center">
                                                            <div class="font-medium text-gray-800">${product.name}</div>
                                                            <div class="text-sm ${performanceColor} font-medium">
                                                                ${performanceIcon} ${product.sellThroughRate.toFixed(1)}%
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Product Stats -->
                                                    <div class="p-3">
                                                        <div class="grid grid-cols-3 gap-3 mb-3">
                                                            <div class="text-center">
                                                                <div class="text-xs text-gray-500 mb-1">‡∏ú‡∏•‡∏¥‡∏ï</div>
                                                                <div class="font-bold text-indigo-600">${product.produced}</div>
                                                            </div>
                                                            <div class="text-center">
                                                                <div class="text-xs text-gray-500 mb-1">‡∏Ç‡∏≤‡∏¢</div>
                                                                <div class="font-bold text-green-600">${product.sold}</div>
                                                            </div>
                                                            <div class="text-center">
                                                                <div class="text-xs text-gray-500 mb-1">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</div>
                                                                <div class="font-bold text-green-600">${product.revenue.toFixed(2)}</div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Progress Bar -->
                                                        ${product.produced > 0 ? `
                                                            <div class="mt-2">
                                                                <div class="flex justify-between text-xs text-gray-600 mb-1">
                                                                    <span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</span>
                                                                    <span>${product.sold}/${product.produced}</span>
                                                                </div>
                                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                                    <div class="h-2 rounded-full transition-all duration-300 ${
                                                                        product.sellThroughRate >= 80 ? 'bg-green-500' :
                                                                        product.sellThroughRate >= 50 ? 'bg-yellow-500' :
                                                                        product.sellThroughRate > 0 ? 'bg-orange-500' : 'bg-red-500'
                                                                    }" style="width: ${Math.min(product.sellThroughRate, 100)}%"></div>
                                                                </div>
                                                                ${product.produced > product.sold ? `
                                                                    <div class="text-xs text-orange-600 mt-1">
                                                                        ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${product.produced - product.sold} ‡∏´‡∏ô‡πà‡∏ß‡∏¢
                                                                    </div>
                                                                ` : ''}
                                                            </div>
                                                        ` : product.sold > 0 ? `
                                                            <div class="text-xs text-blue-600 bg-blue-50 p-2 rounded">
                                                                ‡∏Ç‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏°
                                                            </div>
                                                        ` : ''}
                                                    </div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            ` : `
                                <div class="p-4 text-center text-gray-500 text-sm">
                                    ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                                </div>
                            `}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateMonthlyReport() {
            const selectedMonth = document.getElementById('monthlyReportMonth').value;
            if (!selectedMonth) return;
            
            const [year, month] = selectedMonth.split('-');
            const monthStart = new Date(parseInt(year), parseInt(month) - 1, 1);
            const monthEnd = new Date(parseInt(year), parseInt(month), 0);
            
            // Filter sales for the month
            const monthlySales = sales.filter(sale => {
                const saleDate = parseThaiDate(sale.date);
                return saleDate >= monthStart && saleDate <= monthEnd;
            });
            
            const totalRevenue = monthlySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const totalProfit = monthlySales.reduce((sum, sale) => sum + sale.profit, 0);
            const totalItems = monthlySales.reduce((sum, sale) => sum + sale.quantity, 0);
            const daysInMonth = monthEnd.getDate();
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
            const monthlyProductions = productions.filter(p => {
                const prodDate = new Date(p.productionDate);
                return prodDate >= monthStart && prodDate <= monthEnd;
            });
            const totalProductionCost = monthlyProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            const netProfit = totalRevenue - totalProductionCost;
            
            // Display statistics
            const statsDiv = document.getElementById('monthlyStats');
            statsDiv.innerHTML = `
                <div class="space-y-3">
                    <div class="p-3 bg-green-100 rounded-lg">
                        <div class="text-sm text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                        <div class="text-xl font-bold text-green-800">${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-orange-100 rounded-lg">
                        <div class="text-sm text-orange-700">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                        <div class="text-xl font-bold text-orange-800">${totalProductionCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 ${netProfit >= 0 ? 'bg-green-100' : 'bg-red-100'} rounded-lg border-2 ${netProfit >= 0 ? 'border-green-300' : 'border-red-300'}">
                        <div class="text-sm ${netProfit >= 0 ? 'text-green-700' : 'text-red-700'}">
                            ${netProfit >= 0 ? 'üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'}
                        </div>
                        <div class="text-xl font-bold ${netProfit >= 0 ? 'text-green-800' : 'text-red-800'}">${netProfit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <div class="text-sm text-purple-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</div>
                        <div class="text-xl font-bold text-purple-800">${totalItems} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    </div>
                    <div class="p-3 bg-gray-100 rounded-lg">
                        <div class="text-sm text-gray-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</div>
                        <div class="text-xl font-bold text-gray-800">${(totalRevenue / daysInMonth).toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                </div>
            `;
            
            // Monthly trends with daily breakdown
            const dailyTrends = {};
            
            // Group sales by date
            monthlySales.forEach(sale => {
                const saleDate = sale.date;
                if (!dailyTrends[saleDate]) {
                    dailyTrends[saleDate] = {
                        revenue: 0,
                        items: 0,
                        products: {},
                        salesCount: 0
                    };
                }
                
                dailyTrends[saleDate].revenue += sale.totalRevenue;
                dailyTrends[saleDate].items += sale.quantity;
                dailyTrends[saleDate].salesCount++;
                
                // Product breakdown
                if (dailyTrends[saleDate].products[sale.productName]) {
                    dailyTrends[saleDate].products[sale.productName].quantity += sale.quantity;
                    dailyTrends[saleDate].products[sale.productName].revenue += sale.totalRevenue;
                } else {
                    dailyTrends[saleDate].products[sale.productName] = {
                        quantity: sale.quantity,
                        revenue: sale.totalRevenue
                    };
                }
            });
            
            // Sort by date (most recent first)
            const sortedDailyTrends = Object.entries(dailyTrends)
                .sort((a, b) => parseThaiDate(b[0]) - parseThaiDate(a[0]))
                .slice(0, 15); // Show last 15 days with sales
            
            const trendsDiv = document.getElementById('monthlyTrends');
            if (sortedDailyTrends.length === 0) {
                trendsDiv.innerHTML = '<div class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>';
            } else {
                trendsDiv.innerHTML = `
                    <div class="space-y-3">
                        <h4 class="font-medium text-gray-800 border-b pb-2">üìà ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (15 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h4>
                        ${sortedDailyTrends.map(([date, data]) => `
                            <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                                <!-- Date Header -->
                                <div class="bg-gradient-to-r from-teal-50 to-cyan-50 px-3 py-2 border-b">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <div class="font-medium text-gray-800">${date}</div>
                                            <div class="text-xs text-teal-600">${data.salesCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-bold text-teal-600">${data.revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                            <div class="text-sm text-gray-600">${data.items} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Product Details -->
                                <div class="p-3">
                                    <div class="text-xs text-gray-500 mb-2">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢:</div>
                                    <div class="space-y-1">
                                        ${Object.entries(data.products)
                                            .sort((a, b) => b[1].quantity - a[1].quantity)
                                            .map(([productName, productData]) => `
                                            <div class="flex justify-between items-center text-sm py-1 px-2 bg-gray-50 rounded">
                                                <span class="text-gray-700">${productName}</span>
                                                <div class="flex gap-3 text-xs">
                                                    <span><strong>${productData.quantity}</strong> ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                                                    <span class="text-green-600"><strong>${productData.revenue.toFixed(2)}</strong> ‡∏ö‡∏≤‡∏ó</span>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        
                        ${Object.keys(dailyTrends).length > 15 ? `
                            <div class="text-center text-sm text-gray-500 py-2">
                                ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å ${Object.keys(dailyTrends).length - 15} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢...
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            // Customer analysis (simplified)
            const productAnalysis = {};
            monthlySales.forEach(sale => {
                if (productAnalysis[sale.productName]) {
                    productAnalysis[sale.productName].quantity += sale.quantity;
                    productAnalysis[sale.productName].revenue += sale.totalRevenue;
                    productAnalysis[sale.productName].profit += sale.profit;
                } else {
                    productAnalysis[sale.productName] = {
                        quantity: sale.quantity,
                        revenue: sale.totalRevenue,
                        profit: sale.profit
                    };
                }
            });
            
            const topProducts = Object.entries(productAnalysis)
                .sort((a, b) => b[1].revenue - a[1].revenue)
                .slice(0, 5);
            
            // Cost Analysis Report
            const costAnalysisDiv = document.getElementById('costAnalysisReport');
            const profitMargin = totalRevenue > 0 ? ((netProfit / totalRevenue) * 100).toFixed(1) : '0';
            const avgDailyProduction = totalProductionCost / daysInMonth;
            const avgDailySales = totalRevenue / daysInMonth;
            
            costAnalysisDiv.innerHTML = `
                <div class="p-3 bg-white rounded border">
                    <h5 class="font-medium text-red-800 mb-2">üí∞ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h5>
                    <div class="text-2xl font-bold ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'}">${profitMargin}%</div>
                    <div class="text-xs text-gray-600 mt-1">
                        ${netProfit >= 0 ? '‡∏Å‡∏≥‡πÑ‡∏£' : '‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô'} ${Math.abs(netProfit).toFixed(2)} ‡∏ö‡∏≤‡∏ó
                    </div>
                </div>
                <div class="p-3 bg-white rounded border">
                    <h5 class="font-medium text-red-800 mb-2">üìà ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</h5>
                    <div class="text-2xl font-bold text-orange-600">${avgDailyProduction.toFixed(2)}</div>
                    <div class="text-xs text-gray-600 mt-1">‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô</div>
                </div>
                <div class="p-3 bg-white rounded border">
                    <h5 class="font-medium text-red-800 mb-2">üíµ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</h5>
                    <div class="text-2xl font-bold text-green-600">${avgDailySales.toFixed(2)}</div>
                    <div class="text-xs text-gray-600 mt-1">‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô</div>
                </div>
            `;
            
            const customerAnalysisDiv = document.getElementById('customerAnalysis');
            customerAnalysisDiv.innerHTML = `
                <div>
                    <h4 class="font-medium text-purple-800 mb-3">üèÜ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ Top 5</h4>
                    <div class="space-y-2">
                        ${topProducts.map((product, index) => `
                            <div class="p-3 bg-white rounded border">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-medium">${index + 1}. ${product[0]}</div>
                                        <div class="text-sm text-gray-600">‡∏Å‡∏≥‡πÑ‡∏£: ${product[1].profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-purple-600">${product[1].revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                        <div class="text-sm text-gray-600">${product[1].quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div>
                    <h4 class="font-medium text-purple-800 mb-3">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</h4>
                    <div class="space-y-2 text-sm">
                        <div class="p-2 bg-white rounded">
                            <strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:</strong> ${topProducts[0] ? topProducts[0][0] : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
                        </div>
                        <div class="p-2 bg-white rounded">
                            <strong>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</strong> ${monthlySales.length > 0 ? (totalRevenue / monthlySales.length).toFixed(2) : '0'} ‡∏ö‡∏≤‡∏ó
                        </div>
                        <div class="p-2 bg-white rounded">
                            <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${monthlySales.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </div>
                        <div class="p-2 bg-white rounded ${netProfit >= 0 ? 'bg-green-50' : 'bg-red-50'}">
                            <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> 
                            <span class="${netProfit >= 0 ? 'text-green-600' : 'text-red-600'} font-medium">
                                ${netProfit >= 0 ? 'üìà ‡∏°‡∏µ‡∏Å‡∏≥‡πÑ‡∏£' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô'} ${Math.abs(netProfit).toFixed(2)} ‡∏ö‡∏≤‡∏ó
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Helper functions for date calculations
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function getDateOfWeek(year, week) {
            // Create January 4th of the given year (always in week 1)
            const jan4 = new Date(year, 0, 4);
            
            // Find the Monday of week 1
            const jan4Day = jan4.getDay() || 7; // Convert Sunday (0) to 7
            const mondayOfWeek1 = new Date(jan4);
            mondayOfWeek1.setDate(jan4.getDate() - jan4Day + 1);
            
            // Calculate the Monday of the requested week
            const mondayOfRequestedWeek = new Date(mondayOfWeek1);
            mondayOfRequestedWeek.setDate(mondayOfWeek1.getDate() + (week - 1) * 7);
            
            return mondayOfRequestedWeek;
        }

        function parseThaiDate(thaiDateStr) {
            // Convert Thai date string back to Date object
            const parts = thaiDateStr.split('/');
            if (parts.length === 3) {
                // Assuming format is DD/MM/YYYY (Thai format)
                const day = parseInt(parts[0]);
                const month = parseInt(parts[1]) - 1; // Month is 0-indexed
                let year = parseInt(parts[2]);
                
                // Check if year is in Buddhist era (> 2500) and convert to Gregorian
                if (year > 2500) {
                    year = year - 543;
                }
                
                return new Date(year, month, day);
            }
            return new Date();
        }

        // Pricing Management
        function updatePricingOptions() {
            const select = document.getElementById('pricingProduct');
            if (select) {
                // Filter recipes to show only those that have been produced (have stock or production history)
                const producedRecipes = recipes.filter(recipe => {
                    const stock = productStock[recipe.name] || 0;
                    const hasProduction = productions.some(p => p.recipeName === recipe.name);
                    return stock > 0 || hasProduction;
                });
                
                if (producedRecipes.length === 0) {
                    select.innerHTML = '<option value="">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡πâ‡∏ß</option>';
                } else {
                    select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>' + 
                        producedRecipes.map(recipe => `<option value="${recipe.name}">${recipe.name} (‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó)</option>`).join('');
                }
            }
            
            // Initialize filtered pricing and update display
            filteredPricing = Object.entries(productPricing).map(([productName, pricing]) => ({
                productName,
                ...pricing
            }));
            updatePricingList();
        }

        function updatePricingInfo() {
            const productName = document.getElementById('pricingProduct').value;
            const costInfo = document.getElementById('costInfo');
            const costDetails = document.getElementById('costDetails');
            const pricingSection = document.getElementById('pricingSection');
            
            if (!productName) {
                costInfo.classList.add('hidden');
                pricingSection.classList.add('hidden');
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) return;
            
            // Show cost information
            costInfo.classList.remove('hidden');
            pricingSection.classList.remove('hidden');
            
            // Display cost breakdown
            let costBreakdown = `
                <div class="flex justify-between">
                    <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</span>
                    <span class="font-bold">${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                </div>
                <div class="flex justify-between">
                    <span>‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£:</span>
                    <span>${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                </div>
                <div class="flex justify-between">
                    <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°:</span>
                    <span>${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                </div>
            `;
            
            // Show base recipe cost if exists
            if (recipe.baseRecipeName && recipe.baseCost > 0) {
                costBreakdown += `
                    <div class="border-t pt-2 mt-2">
                        <div class="text-xs text-blue-600 mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</div>
                        <div class="flex justify-between text-xs">
                            <span>‚Ä¢ ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (${recipe.baseRecipeName}):</span>
                            <span>${recipe.baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>‚Ä¢ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</span>
                            <span>${recipe.additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    </div>
                `;
            }
            
            costDetails.innerHTML = costBreakdown;
            
            // Load existing pricing if available
            const existingPricing = productPricing[productName];
            if (existingPricing) {
                // Set the pricing method
                document.querySelector(`input[name="pricingMethod"][value="${existingPricing.method}"]`).checked = true;
                updatePricingMethod();
                
                // Set the values
                if (existingPricing.method === 'markup') {
                    document.getElementById('markupPercent').value = existingPricing.markupPercent;
                    calculatePriceFromMarkup();
                } else if (existingPricing.method === 'margin') {
                    document.getElementById('marginPercent').value = existingPricing.marginPercent;
                    calculatePriceFromMargin();
                } else if (existingPricing.method === 'fixed') {
                    document.getElementById('fixedPrice').value = existingPricing.sellingPrice;
                    calculateProfitFromFixed();
                }
            } else {
                // Clear form
                clearPricingForm();
            }
        }

        function updatePricingMethod() {
            const method = document.querySelector('input[name="pricingMethod"]:checked').value;
            
            // Hide all method sections
            document.getElementById('markupMethod').classList.add('hidden');
            document.getElementById('marginMethod').classList.add('hidden');
            document.getElementById('fixedMethod').classList.add('hidden');
            document.getElementById('pricingResult').classList.add('hidden');
            
            // Show selected method
            document.getElementById(method + 'Method').classList.remove('hidden');
            
            // Clear inputs
            document.getElementById('markupPercent').value = '';
            document.getElementById('marginPercent').value = '';
            document.getElementById('fixedPrice').value = '';
            
            document.getElementById('savePricingBtn').disabled = true;
        }

        function calculatePriceFromMarkup() {
            const productName = document.getElementById('pricingProduct').value;
            const markupPercent = parseFloat(document.getElementById('markupPercent').value);
            
            if (!productName || isNaN(markupPercent) || markupPercent < 0) {
                document.getElementById('pricingResult').classList.add('hidden');
                document.getElementById('savePricingBtn').disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) return;
            
            const costPerUnit = recipe.costPerUnit;
            const sellingPrice = costPerUnit * (1 + markupPercent / 100);
            const profitPerUnit = sellingPrice - costPerUnit;
            const profitMargin = (profitPerUnit / sellingPrice) * 100;
            
            showPricingResult({
                method: 'markup',
                costPerUnit,
                sellingPrice,
                profitPerUnit,
                profitMargin,
                markupPercent,
                calculation: `‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó √ó (1 + ${markupPercent}%) = ${sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó`
            });
        }

        function calculatePriceFromMargin() {
            const productName = document.getElementById('pricingProduct').value;
            const marginPercent = parseFloat(document.getElementById('marginPercent').value);
            
            if (!productName || isNaN(marginPercent) || marginPercent < 0 || marginPercent >= 100) {
                document.getElementById('pricingResult').classList.add('hidden');
                document.getElementById('savePricingBtn').disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) return;
            
            const costPerUnit = recipe.costPerUnit;
            const sellingPrice = costPerUnit / (1 - marginPercent / 100);
            const profitPerUnit = sellingPrice - costPerUnit;
            const markupPercent = (profitPerUnit / costPerUnit) * 100;
            
            showPricingResult({
                method: 'margin',
                costPerUnit,
                sellingPrice,
                profitPerUnit,
                profitMargin: marginPercent,
                markupPercent,
                calculation: `‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó √∑ (1 - ${marginPercent}%) = ${sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó`
            });
        }

        function calculateProfitFromFixed() {
            const productName = document.getElementById('pricingProduct').value;
            const fixedPrice = parseFloat(document.getElementById('fixedPrice').value);
            
            if (!productName || isNaN(fixedPrice) || fixedPrice <= 0) {
                document.getElementById('pricingResult').classList.add('hidden');
                document.getElementById('savePricingBtn').disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) return;
            
            const costPerUnit = recipe.costPerUnit;
            const sellingPrice = fixedPrice;
            const profitPerUnit = sellingPrice - costPerUnit;
            const profitMargin = sellingPrice > 0 ? (profitPerUnit / sellingPrice) * 100 : 0;
            const markupPercent = costPerUnit > 0 ? (profitPerUnit / costPerUnit) * 100 : 0;
            
            showPricingResult({
                method: 'fixed',
                costPerUnit,
                sellingPrice,
                profitPerUnit,
                profitMargin,
                markupPercent,
                calculation: `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ ${sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó = ‡∏Å‡∏≥‡πÑ‡∏£ ${profitPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó`
            });
        }

        function showPricingResult(data) {
            const pricingResult = document.getElementById('pricingResult');
            const pricingCalculation = document.getElementById('pricingCalculation');
            
            pricingResult.classList.remove('hidden');
            
            const profitColor = data.profitPerUnit > 0 ? 'text-green-700' : 'text-red-700';
            
            pricingCalculation.innerHTML = `
                <div class="font-medium mb-2">üìä ${data.calculation}</div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <div class="text-xs text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</div>
                        <div class="font-bold text-blue-700">${data.sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-600">‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                        <div class="font-bold ${profitColor}">${data.profitPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-600">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£ (Margin)</div>
                        <div class="font-bold ${profitColor}">${data.profitMargin.toFixed(1)}%</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-600">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≥‡πÑ‡∏£ (Markup)</div>
                        <div class="font-bold ${profitColor}">${data.markupPercent.toFixed(1)}%</div>
                    </div>
                </div>
                ${data.profitPerUnit <= 0 ? '<div class="mt-2 text-red-600 text-xs">‚ö†Ô∏è ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ‡∏à‡∏∞‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô!</div>' : ''}
            `;
            
            document.getElementById('savePricingBtn').disabled = false;
        }

        function savePricing() {
            const productName = document.getElementById('pricingProduct').value;
            const methodRadio = document.querySelector('input[name="pricingMethod"]:checked');
            
            if (!productName) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }
            
            if (!methodRadio) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤');
                return;
            }
            
            const method = methodRadio.value;
            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }
            
            let pricingData = {
                productName,
                method,
                costPerUnit: recipe.costPerUnit,
                updated: new Date().toLocaleDateString('th-TH')
            };
            
            // Get pricing data based on method
            if (method === 'markup') {
                const markupPercent = parseFloat(document.getElementById('markupPercent').value);
                if (isNaN(markupPercent) || markupPercent < 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≥‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    return;
                }
                
                const sellingPrice = recipe.costPerUnit * (1 + markupPercent / 100);
                const profitPerUnit = sellingPrice - recipe.costPerUnit;
                const profitMargin = (profitPerUnit / sellingPrice) * 100;
                
                pricingData = {
                    ...pricingData,
                    markupPercent,
                    sellingPrice,
                    profitPerUnit,
                    profitMargin
                };
            } else if (method === 'margin') {
                const marginPercent = parseFloat(document.getElementById('marginPercent').value);
                if (isNaN(marginPercent) || marginPercent < 0 || marginPercent >= 100) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 0-99%');
                    return;
                }
                
                const sellingPrice = recipe.costPerUnit / (1 - marginPercent / 100);
                const profitPerUnit = sellingPrice - recipe.costPerUnit;
                const markupPercent = (profitPerUnit / recipe.costPerUnit) * 100;
                
                pricingData = {
                    ...pricingData,
                    marginPercent,
                    markupPercent,
                    sellingPrice,
                    profitPerUnit,
                    profitMargin: marginPercent
                };
            } else if (method === 'fixed') {
                const sellingPrice = parseFloat(document.getElementById('fixedPrice').value);
                if (isNaN(sellingPrice) || sellingPrice <= 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    return;
                }
                
                const profitPerUnit = sellingPrice - recipe.costPerUnit;
                const profitMargin = sellingPrice > 0 ? (profitPerUnit / sellingPrice) * 100 : 0;
                const markupPercent = recipe.costPerUnit > 0 ? (profitPerUnit / recipe.costPerUnit) * 100 : 0;
                
                pricingData = {
                    ...pricingData,
                    sellingPrice,
                    profitPerUnit,
                    profitMargin,
                    markupPercent
                };
            }
            
            // Save to storage
            productPricing[productName] = pricingData;
            localStorage.setItem('bakery_product_pricing', JSON.stringify(productPricing));
            
            // Update display
            updatePricingOptions();
            
            // Clear form
            clearPricingForm();
            
            alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ "${productName}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
                  `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢: ${pricingData.sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${pricingData.profitPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£: ${pricingData.profitMargin.toFixed(1)}%`);
        }

        function clearPricingForm() {
            const productSelect = document.getElementById('pricingProduct');
            const costInfo = document.getElementById('costInfo');
            const pricingSection = document.getElementById('pricingSection');
            const pricingResult = document.getElementById('pricingResult');
            const savePricingBtn = document.getElementById('savePricingBtn');
            
            if (productSelect) productSelect.value = '';
            if (costInfo) costInfo.classList.add('hidden');
            if (pricingSection) pricingSection.classList.add('hidden');
            if (pricingResult) pricingResult.classList.add('hidden');
            if (savePricingBtn) savePricingBtn.disabled = true;
            
            // Reset to markup method
            const markupRadio = document.querySelector('input[name="pricingMethod"][value="markup"]');
            if (markupRadio) {
                markupRadio.checked = true;
                updatePricingMethod();
            }
        }

        function filterPricing(filterType) {
            currentPricingFilter = filterType;
            
            // Update filter button styles
            document.querySelectorAll('.pricing-filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-yellow-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-yellow-500', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            applyPricingFilter();
        }

        function applyPricingFilter() {
            const allPricing = Object.entries(productPricing).map(([productName, pricing]) => ({
                productName,
                ...pricing
            }));
            
            if (currentPricingFilter === 'all') {
                filteredPricing = allPricing;
            } else {
                filteredPricing = allPricing.filter(pricing => {
                    const margin = pricing.profitMargin || 0;
                    
                    switch (currentPricingFilter) {
                        case 'high-profit':
                            return margin > 50;
                        case 'medium-profit':
                            return margin >= 20 && margin <= 50;
                        case 'low-profit':
                            return margin < 20;
                        default:
                            return true;
                    }
                });
            }
            
            updatePricingList();
        }

        function updatePricingList() {
            const list = document.getElementById('pricingList');
            const countElement = document.getElementById('pricingCount');
            
            // Update count
            countElement.textContent = filteredPricing.length;
            
            if (Object.keys(productPricing).length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢<br>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            if (filteredPricing.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-lg mb-2">üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</div>
                        <div class="text-sm">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏î‡∏π</div>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = filteredPricing.map(pricing => {
                const profitColor = pricing.profitPerUnit > 0 ? 'text-green-600' : 'text-red-600';
                const profitIcon = pricing.profitPerUnit > 0 ? 'üìà' : 'üìâ';
                
                // Determine profit level for styling
                let profitLevel = 'low';
                let profitBg = 'bg-red-50 border-red-200';
                if (pricing.profitMargin > 50) {
                    profitLevel = 'high';
                    profitBg = 'bg-green-50 border-green-200';
                } else if (pricing.profitMargin >= 20) {
                    profitLevel = 'medium';
                    profitBg = 'bg-yellow-50 border-yellow-200';
                }
                
                return `
                    <div class="p-4 border rounded-lg ${profitBg} hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="font-medium text-lg">${pricing.productName}</div>
                                <div class="text-sm text-gray-600 mt-1">
                                    ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${pricing.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢
                                </div>
                                
                                <!-- Pricing Information -->
                                <div class="mt-2 space-y-1">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢:</span>
                                        <span class="font-bold text-blue-600">${pricing.sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm">‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</span>
                                        <span class="font-medium ${profitColor}">${profitIcon} ${pricing.profitPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£:</span>
                                        <span class="font-medium ${profitColor}">${pricing.profitMargin.toFixed(1)}%</span>
                                    </div>
                                </div>
                                
                                <!-- Method Information -->
                                <div class="mt-2 p-2 bg-blue-100 rounded text-xs">
                                    <div class="font-medium text-blue-800">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤:</div>
                                    <div class="text-blue-700">
                                        ${pricing.method === 'markup' ? `Markup ${pricing.markupPercent}%` : 
                                          pricing.method === 'margin' ? `Margin ${pricing.profitMargin.toFixed(1)}%` : 
                                          '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà'}
                                    </div>
                                </div>
                                
                                <div class="text-xs text-gray-500 mt-2">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${pricing.updated}</div>
                            </div>
                            
                            <div class="text-right ml-4">
                                <button onclick="editPricing('${pricing.productName}')" class="text-green-500 hover:text-green-700 p-1 mr-1">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="removePricing('${pricing.productName}')" class="text-red-500 hover:text-red-700 p-1">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function editPricing(productName) {
            // Set the product
            document.getElementById('pricingProduct').value = productName;
            updatePricingInfo();
            
            // Scroll to form
            document.getElementById('pricing').scrollIntoView({ behavior: 'smooth' });
        }

        function removePricing(productName) {
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≠‡∏á "${productName}"?`)) {
                delete productPricing[productName];
                localStorage.setItem('bakery_product_pricing', JSON.stringify(productPricing));
                updatePricingOptions();
            }
        }



        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date in header
            const currentDate = new Date().toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('currentDate').textContent = currentDate;
            
            // Set today's date for production
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('productionDate').value = today;
            
            // Show inventory section by default
            showSection('inventory');
            
            // Initialize filters
            filteredInventory = [...inventory];
            filteredRecipes = [...recipes];
            filteredPricing = Object.entries(productPricing).map(([productName, pricing]) => ({
                productName,
                ...pricing
            }));
            
            // Update all displays
            updateInventoryDisplay();
            updatePurchaseOptions();
            updateRecipeOptions();
            updateProductionOptions();
            updateSalesOptions();

        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96aedb83353745cc',t:'MTc1NDQ4NjY5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
