<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bakery Pro - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 to-amber-50 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
            <h1 class="text-2xl sm:text-3xl font-bold text-orange-800 mb-2">üßÅ Bakery Pro</h1>
            <p class="text-sm sm:text-base text-gray-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</p>
        </div>

        <!-- Navigation -->
        <div class="bg-white rounded-xl shadow-lg p-3 sm:p-4 mb-4 sm:mb-6">
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:flex lg:flex-wrap gap-2">
                <button onclick="showSection('inventory')" class="nav-btn bg-blue-500 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm sm:text-base">
                    <div class="flex flex-col sm:flex-row items-center gap-1">
                        <span>üì¶</span>
                        <span>‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                    </div>
                </button>
                <button onclick="showSection('purchase')" class="nav-btn bg-green-500 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:bg-green-600 transition-colors text-sm sm:text-base">
                    <div class="flex flex-col sm:flex-row items-center gap-1">
                        <span>üõí</span>
                        <span>‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á</span>
                    </div>
                </button>
                <button onclick="showSection('recipes')" class="nav-btn bg-purple-500 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:bg-purple-600 transition-colors text-sm sm:text-base">
                    <div class="flex flex-col sm:flex-row items-center gap-1">
                        <span>üìã</span>
                        <span>‡∏™‡∏π‡∏ï‡∏£</span>
                    </div>
                </button>
                <button onclick="showSection('production')" class="nav-btn bg-indigo-500 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:bg-indigo-600 transition-colors text-sm sm:text-base">
                    <div class="flex flex-col sm:flex-row items-center gap-1">
                        <span>üè≠</span>
                        <span>‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</span>
                    </div>
                </button>
                <button onclick="showSection('sales')" class="nav-btn bg-pink-500 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:bg-pink-600 transition-colors text-sm sm:text-base">
                    <div class="flex flex-col sm:flex-row items-center gap-1">
                        <span>üí∞</span>
                        <span>‡∏Ç‡∏≤‡∏¢</span>
                    </div>
                </button>
                <button onclick="showSection('reports')" class="nav-btn bg-teal-500 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:bg-teal-600 transition-colors text-sm sm:text-base">
                    <div class="flex flex-col sm:flex-row items-center gap-1">
                        <span>üìä</span>
                        <span>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
                    </div>
                </button>
                <button onclick="showSection('costs')" class="nav-btn bg-orange-500 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:bg-orange-600 transition-colors text-sm sm:text-base">
                    <div class="flex flex-col sm:flex-row items-center gap-1">
                        <span>üìà</span>
                        <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- Inventory Section -->
        <div id="inventory" class="section bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-blue-800 mb-2">üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                <p class="text-sm text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà -->
                <div class="bg-blue-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-blue-800 border-b border-blue-200 pb-2">
                        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà
                    </h3>
                    <div class="space-y-4">
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-2">üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4>
                            <input type="text" id="itemName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏≠‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå)" class="w-full p-3 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                        </div>
                        
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ -->
                        <div class="bg-white p-4 rounded-lg border border-blue-200">
                            <h4 class="font-medium text-blue-800 mb-3 text-sm">üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ (1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠)</h4>
                            
                            <div class="space-y-3 sm:grid sm:grid-cols-2 sm:gap-3 sm:space-y-0 mb-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</label>
                                    <input type="number" id="packageQuantity" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1000" class="w-full p-2 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                                    <select id="packageUnit" class="w-full p-2 border rounded-lg text-sm" onchange="calculateUnitPrice()">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢</option>
                                        <option value="‡∏Å‡∏£‡∏±‡∏°">‡∏Å‡∏£‡∏±‡∏° (‡∏Å)</option>
                                        <option value="‡∏Å‡∏Å">‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏° (‡∏Å‡∏Å)</option>
                                        <option value="‡∏°‡∏•">‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏•‡∏¥‡∏ï‡∏£ (‡∏°‡∏•)</option>
                                        <option value="‡∏•‡∏¥‡∏ï‡∏£">‡∏•‡∏¥‡∏ï‡∏£ (‡∏•)</option>
                                        <option value="‡∏ä‡πâ‡∏≠‡∏ô‡πÇ‡∏ï‡πä‡∏∞">‡∏ä‡πâ‡∏≠‡∏ô‡πÇ‡∏ï‡πä‡∏∞ (tbsp)</option>
                                        <option value="‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤">‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤ (tsp)</option>
                                        <option value="‡∏ñ‡πâ‡∏ß‡∏¢">‡∏ñ‡πâ‡∏ß‡∏¢‡∏ï‡∏ß‡∏á (cup)</option>
                                        <option value="‡∏ü‡∏≠‡∏á">‡∏ü‡∏≠‡∏á (‡πÑ‡∏Ç‡πà)</option>
                                        <option value="‡∏ä‡∏¥‡πâ‡∏ô">‡∏ä‡∏¥‡πâ‡∏ô</option>
                                        <option value="‡πÅ‡∏û‡πá‡∏Ñ">‡πÅ‡∏û‡πá‡∏Ñ</option>
                                        <option value="‡∏Ç‡∏ß‡∏î">‡∏Ç‡∏ß‡∏î</option>
                                        <option value="‡∏ã‡∏≠‡∏á">‡∏ã‡∏≠‡∏á</option>
                                        <option value="‡∏Å‡∏•‡πà‡∏≠‡∏á">‡∏Å‡∏•‡πà‡∏≠‡∏á</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="block text-xs font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</label>
                                <input type="number" id="packagePrice" placeholder="‡πÄ‡∏ä‡πà‡∏ô 39" class="w-full p-2 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                                <p class="text-xs text-blue-600 mt-1">üí° ‡πÄ‡∏ä‡πà‡∏ô: ‡πÅ‡∏õ‡πâ‡∏á 1 ‡∏ñ‡∏∏‡∏á 1000 ‡∏Å‡∏£‡∏±‡∏° ‡∏£‡∏≤‡∏Ñ‡∏≤ 39 ‡∏ö‡∏≤‡∏ó</p>
                            </div>
                            
                            <!-- Price Calculation Display -->
                            <div id="priceCalculation" class="hidden p-3 bg-green-100 rounded-lg border border-green-300">
                                <h5 class="font-medium text-green-800 mb-2 text-sm">üí∞ ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</h5>
                                <div id="calculationText" class="text-xs text-green-700"></div>
                                <div id="unitPriceResult" class="text-sm font-bold text-green-800 mt-2"></div>
                            </div>
                        </div>
                        
                        <!-- ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô -->
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-2">üìä ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</h4>
                            <input type="number" id="initialStock" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5 (‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á 5 ‡∏ñ‡∏∏‡∏á)" class="w-full p-3 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                            <p class="text-xs text-gray-500 mt-1">‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</p>
                        </div>
                        
                        <button onclick="addInventoryItem()" id="addItemBtn" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 disabled:bg-gray-400 text-sm font-medium" disabled>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</button>
                    </div>
                </div>
                
                <!-- ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                        <h3 class="text-lg font-semibold text-gray-800">
                            üìã ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                        </h3>
                        <div class="text-sm text-gray-600">
                            <span id="inventoryCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </div>
                    </div>
                    
                    <!-- Search and Filter Section -->
                    <div class="mb-4 space-y-3">
                        <!-- Search Box -->
                        <div class="relative">
                            <input type="text" id="inventorySearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö... (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏õ‡πâ‡∏á, ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•, ‡πÑ‡∏Ç‡πà)" 
                                   class="w-full p-3 pl-10 border rounded-lg text-sm bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   oninput="searchInventory()">
                            <div class="absolute left-3 top-3 text-gray-400">
                                üîç
                            </div>
                            <button onclick="clearInventorySearch()" id="clearSearchBtn" 
                                    class="absolute right-3 top-3 text-gray-400 hover:text-gray-600 hidden">
                                ‚úï
                            </button>
                        </div>
                        
                        <!-- Quick Filters -->
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterInventory('all')" class="filter-btn active px-3 py-1 rounded-full text-xs bg-blue-500 text-white hover:bg-blue-600">
                                ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterInventory('low-stock')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                ‚ö†Ô∏è ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterInventory('powder')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üåæ ‡πÅ‡∏õ‡πâ‡∏á/‡∏ú‡∏á
                            </button>
                            <button onclick="filterInventory('liquid')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                ü•õ ‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß
                            </button>
                            <button onclick="filterInventory('dairy')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üßà ‡∏ô‡∏°/‡πÄ‡∏ô‡∏¢
                            </button>
                            <button onclick="filterInventory('sweet')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üçØ ‡∏´‡∏ß‡∏≤‡∏ô
                            </button>
                        </div>
                        
                        <!-- Sort Options -->
                        <div class="flex items-center gap-2 text-sm">
                            <span class="text-gray-600">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°:</span>
                            <select id="inventorySort" onchange="sortInventory()" class="px-2 py-1 border rounded text-xs bg-white">
                                <option value="name-asc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Å-‡∏Æ)</option>
                                <option value="name-desc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Æ-‡∏Å)</option>
                                <option value="stock-low">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ô‡πâ‡∏≠‡∏¢-‡∏°‡∏≤‡∏Å</option>
                                <option value="stock-high">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏°‡∏≤‡∏Å-‡∏ô‡πâ‡∏≠‡∏¢</option>
                                <option value="updated-new">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                                <option value="updated-old">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                            </select>
                        </div>
                        
                        <!-- Search Suggestions -->
                        <div id="searchSuggestions" class="hidden">
                            <div class="text-xs text-gray-600 mb-2">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:</div>
                            <div id="suggestionsList" class="flex flex-wrap gap-1">
                                <!-- Suggestions will be shown here -->
                            </div>
                        </div>
                        
                        <!-- Search Results Info -->
                        <div id="searchResults" class="hidden text-sm text-blue-600 bg-blue-50 p-2 rounded">
                            <!-- Search results info will be shown here -->
                        </div>
                    </div>
                    
                    <div id="inventoryList" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Inventory items will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Purchase Section -->
        <div id="purchase" class="section bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-green-800 mb-2">üõí ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á</h2>
                <p class="text-sm text-gray-600">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö -->
                <div class="bg-green-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-green-800 border-b border-green-200 pb-2">
                        üõçÔ∏è ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
                    </h3>
                    <div class="space-y-4">
                        <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</label>
                            <select id="purchaseItem" class="w-full p-3 border rounded-lg text-sm" onchange="updatePurchaseInfo()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                            </select>
                        </div>
                        
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ -->
                        <div id="purchaseInfo" class="hidden bg-white p-4 rounded-lg border border-green-200">
                            <h4 class="font-medium text-green-800 mb-3 text-sm">üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</h4>
                            <div id="packageDetails" class="text-sm text-green-700 mb-3">
                                <!-- Package details will be shown here -->
                            </div>
                            
                            <div class="space-y-3 sm:grid sm:grid-cols-2 sm:gap-3 sm:space-y-0">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠ (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠)</label>
                                    <input type="number" id="purchaseQuantity" placeholder="‡πÄ‡∏ä‡πà‡∏ô 3" class="w-full p-2 border rounded-lg text-sm" oninput="calculatePurchaseConversion()">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</label>
                                    <div class="p-2 border rounded-lg bg-gray-50 flex items-center">
                                        <span id="purchaseUnitDisplay" class="text-gray-600 text-sm">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Conversion Display -->
                            <div id="purchaseConversion" class="hidden mt-3 p-3 bg-blue-100 rounded-lg border border-blue-300">
                                <h5 class="font-medium text-blue-800 mb-2 text-sm">üîÑ ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢</h5>
                                <div id="conversionCalculation" class="text-xs text-blue-700"></div>
                                <div id="totalQuantityResult" class="text-sm font-bold text-blue-800 mt-2"></div>
                                <div id="totalCostResult" class="text-sm font-medium text-green-800 mt-1"></div>
                            </div>
                        </div>
                        
                        <!-- ‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                            <input type="text" id="supplier" placeholder="‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢" class="w-full p-3 border rounded-lg text-sm">
                        </div>
                        
                        <button onclick="makePurchase()" id="makePurchaseBtn" class="w-full bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 disabled:bg-gray-400 text-sm font-medium" disabled>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
                    </div>
                </div>
                
                <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
                        üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠
                    </h3>
                    <div id="purchaseHistory" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Purchase history will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Production Section -->
        <div id="production" class="section bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-indigo-800 mb-2">üè≠ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</h2>
                <p class="text-sm text-gray-600">‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï -->
                <div class="bg-indigo-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-indigo-800 border-b border-indigo-200 pb-2">
                        üìã ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
                    </h3>
                    <div class="space-y-3">
                        <input type="date" id="productionDate" class="w-full p-3 border rounded-lg text-sm" value="">
                        <select id="productionRecipe" class="w-full p-3 border rounded-lg text-sm" onchange="updateProductionInfo()">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ú‡∏•‡∏¥‡∏ï</option>
                        </select>
                        <input type="number" id="productionQuantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï" class="w-full p-3 border rounded-lg text-sm" oninput="calculateIngredientNeeds()">
                        
                        <div id="ingredientNeeds" class="hidden bg-white p-4 rounded-lg border border-indigo-200">
                            <h4 class="font-semibold text-indigo-800 mb-2 text-sm">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ:</h4>
                            <div id="ingredientsList" class="space-y-2 mb-3">
                                <!-- Ingredients needed will be shown here -->
                            </div>
                            <div id="stockCheck" class="text-sm">
                                <!-- Stock availability check will be shown here -->
                            </div>
                        </div>
                        
                        <button onclick="startProduction()" id="startProductionBtn" class="w-full bg-indigo-500 text-white p-3 rounded-lg hover:bg-indigo-600 disabled:bg-gray-400 text-sm font-medium" disabled>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</button>
                    </div>
                    
                    <div class="mt-6 p-4 bg-white rounded-lg border border-indigo-200">
                        <h4 class="font-semibold text-indigo-800 mb-2 text-sm">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                        <div id="todayProduction" class="space-y-1">
                            <!-- Today's production summary will be shown here -->
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
                        üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
                    </h3>
                    <div id="productionHistory" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Production history will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Recipes Section -->
        <div id="recipes" class="section bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-purple-800 mb-2">üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h2>
                <p class="text-sm text-gray-600">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà -->
                <div class="bg-purple-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-purple-800 border-b border-purple-200 pb-2">
                        ‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà
                    </h3>
                    <div class="space-y-4">
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏π‡∏ï‡∏£</label>
                                <input type="text" id="recipeName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï" class="w-full p-3 border rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                                <select id="recipeCategory" class="w-full p-3 border rounded-lg text-sm">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                                    <option value="‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á">üçû ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á</option>
                                    <option value="‡πÇ‡∏î‡∏ô‡∏±‡∏ó">üç© ‡πÇ‡∏î‡∏ô‡∏±‡∏ó</option>
                                    <option value="‡πÄ‡∏Ñ‡πâ‡∏Å">üéÇ ‡πÄ‡∏Ñ‡πâ‡∏Å</option>
                                    <option value="‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ">üç™ ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ</option>
                                    <option value="‡∏°‡∏±‡∏ü‡∏ü‡∏¥‡∏ô">üßÅ ‡∏°‡∏±‡∏ü‡∏ü‡∏¥‡∏ô</option>
                                    <option value="‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á">ü•ê ‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á</option>
                                    <option value="‡∏û‡∏≤‡∏¢">ü•ß ‡∏û‡∏≤‡∏¢</option>
                                    <option value="‡∏Ç‡∏ô‡∏°‡πÑ‡∏ó‡∏¢">üçÆ ‡∏Ç‡∏ô‡∏°‡πÑ‡∏ó‡∏¢</option>
                                    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üç∞ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ</label>
                                <input type="number" id="recipeYield" placeholder="‡πÑ‡∏î‡πâ‡∏Å‡∏µ‡πà‡∏ä‡∏¥‡πâ‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢" class="w-full p-3 border rounded-lg text-sm">
                            </div>
                        </div>
                        
                        <!-- ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
                        <div class="bg-white p-3 rounded-lg border border-blue-200">
                            <h4 class="font-medium text-blue-800 mb-2 text-sm">üßÅ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</h4>
                            <select id="baseRecipe" class="w-full p-2 border rounded-lg text-sm" onchange="loadBaseRecipe()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</option>
                            </select>
                            <p class="text-xs text-blue-600 mt-1">‡πÄ‡∏ä‡πà‡∏ô: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£ "‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤" ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ "‡πÇ‡∏î‡∏ô‡∏±‡∏ó‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï"</p>
                        </div>
                        
                        <!-- ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ -->
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="font-medium text-sm text-gray-700">üßÇ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</h4>
                                <button onclick="clearAllIngredients()" class="text-red-500 hover:text-red-700 text-xs">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                            </div>
                            <div id="recipeIngredients" class="space-y-2">
                                <div class="ingredient-row flex gap-2">
                                    <select class="ingredient-select flex-1 p-2 border rounded text-sm">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                                    </select>
                                    <input type="number" class="ingredient-amount w-20 sm:w-24 p-2 border rounded text-sm" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                                    <button onclick="addIngredientRow()" class="bg-purple-500 text-white px-2 sm:px-3 py-2 rounded hover:bg-purple-600 text-sm">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row gap-2">
                            <button onclick="createRecipe()" id="createRecipeBtn" class="flex-1 bg-purple-500 text-white p-3 rounded-lg hover:bg-purple-600 text-sm font-medium">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£</button>
                            <button onclick="updateRecipe()" id="updateRecipeBtn" class="flex-1 bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 text-sm font-medium hidden">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏π‡∏ï‡∏£</button>
                            <button onclick="cancelEdit()" id="cancelEditBtn" class="bg-gray-500 text-white px-4 py-3 rounded-lg hover:bg-gray-600 text-sm font-medium hidden">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                        <h3 class="text-lg font-semibold text-gray-800">
                            üìö ‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </h3>
                        <div class="text-sm text-gray-600">
                            <span id="recipesCount">0</span> ‡∏™‡∏π‡∏ï‡∏£
                        </div>
                    </div>
                    
                    <!-- Filter and View Options -->
                    <div class="mb-4 space-y-3">
                        <!-- Category Filter -->
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterRecipes('all')" class="recipe-filter-btn active px-3 py-1 rounded-full text-xs bg-purple-500 text-white hover:bg-purple-600">
                                ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterRecipes('‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üçû ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á
                            </button>
                            <button onclick="filterRecipes('‡πÇ‡∏î‡∏ô‡∏±‡∏ó')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üç© ‡πÇ‡∏î‡∏ô‡∏±‡∏ó
                            </button>
                            <button onclick="filterRecipes('‡πÄ‡∏Ñ‡πâ‡∏Å')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üéÇ ‡πÄ‡∏Ñ‡πâ‡∏Å
                            </button>
                            <button onclick="filterRecipes('‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üç™ ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ
                            </button>
                            <button onclick="filterRecipes('‡∏≠‡∏∑‡πà‡∏ô‡πÜ')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üç∞ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                            </button>
                        </div>
                        
                        <!-- View Toggle -->
                        <div class="flex items-center gap-2 text-sm">
                            <span class="text-gray-600">‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á:</span>
                            <button onclick="toggleRecipeView('compact')" id="compactViewBtn" class="px-3 py-1 rounded text-xs bg-purple-500 text-white hover:bg-purple-600">
                                üìã ‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠
                            </button>
                            <button onclick="toggleRecipeView('detailed')" id="detailedViewBtn" class="px-3 py-1 rounded text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üìÑ ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </button>
                        </div>
                    </div>
                    
                    <div id="recipesList" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Recipes will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Sales Section -->
        <div id="sales" class="section bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-pink-800 mb-2">üí∞ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h2>
                <p class="text-sm text-gray-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
                <div class="bg-pink-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-pink-800 border-b border-pink-200 pb-2">
                        üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <select id="saleProduct" class="w-full p-3 border rounded-lg text-sm" onchange="updateSaleInfo()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                            </select>
                        </div>
                        
                        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
                        <div id="productInfo" class="hidden bg-white p-3 rounded-lg border border-pink-200">
                            <div id="productDetails" class="text-sm text-pink-700">
                                <!-- Product details will be shown here -->
                            </div>
                        </div>
                        
                        <!-- ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ -->
                        <div id="stockAdjustment" class="hidden bg-blue-50 p-3 rounded-lg border border-blue-200">
                            <h5 class="font-medium text-blue-800 mb-2 text-sm">üì¶ ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</h5>
                            <div class="flex gap-2 items-end">
                                <div class="flex-1">
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á</label>
                                    <input type="number" id="actualStock" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5" class="w-full p-2 border rounded-lg text-sm" oninput="calculateStockAdjustment()">
                                </div>
                                <button onclick="adjustStock()" id="adjustStockBtn" class="bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 text-sm disabled:bg-gray-400" disabled>‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
                            </div>
                            <div id="stockAdjustmentInfo" class="hidden mt-2 text-xs">
                                <!-- Stock adjustment calculation will be shown here -->
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</label>
                                <input type="number" id="saleQuantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢" class="w-full p-3 border rounded-lg text-sm" oninput="calculateSaleTotal()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏¢ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                                <input type="number" id="remainingStock" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5 (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á)" class="w-full p-3 border rounded-lg text-sm" oninput="calculateFromRemaining()">
                                <p class="text-xs text-blue-600 mt-1">üí° ‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="salePrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢" class="w-full p-3 border rounded-lg text-sm" oninput="calculateSaleTotal()">
                        </div>
                        
                        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì -->
                        <div id="saleCalculation" class="hidden bg-green-100 p-3 rounded-lg border border-green-300">
                            <h5 class="font-medium text-green-800 mb-2 text-sm">üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h5>
                            <div id="saleDetails" class="text-sm text-green-700">
                                <!-- Sale calculation will be shown here -->
                            </div>
                        </div>
                        
                        <button onclick="recordSale()" id="recordSaleBtn" class="w-full bg-pink-500 text-white p-3 rounded-lg hover:bg-pink-600 text-sm font-medium" disabled>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</button>
                    </div>
                    
                    <div class="mt-6 p-4 bg-white rounded-lg border border-pink-200">
                        <h4 class="font-semibold text-pink-800 text-sm mb-2">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                        <div id="todaySummary" class="space-y-1">
                            <div class="flex justify-between text-sm">
                                <span>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢:</span>
                                <span id="todayRevenue" class="font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï:</span>
                                <span id="todayProductionCost" class="font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="flex justify-between text-sm border-t pt-1">
                                <span>‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
                                <span id="todayNetProfit" class="font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="text-xs text-gray-600 mt-2">
                                <div>üí° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å: ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
                <div class="space-y-4">
                    <!-- ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-blue-800 border-b border-blue-200 pb-2">
                            üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                        </h3>
                        <div id="productStock" class="space-y-2 max-h-40 overflow-y-auto">
                            <!-- Product stock will be displayed here -->
                        </div>
                    </div>
                    
                    <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
                            üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                        </h3>
                        <div id="salesHistory" class="space-y-3 max-h-40 overflow-y-auto">
                            <!-- Sales history will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-teal-800 mb-2">üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h2>
                <p class="text-sm text-gray-600">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
            </div>
            
            <!-- Report Navigation -->
            <div class="mb-6">
                <div class="flex flex-wrap gap-2">
                    <button onclick="showReport('daily')" class="report-btn bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 text-sm">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
                    <button onclick="showReport('weekly')" class="report-btn bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 text-sm">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
                    <button onclick="showReport('monthly')" class="report-btn bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 text-sm">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                </div>
            </div>
            
            <!-- Daily Report -->
            <div id="dailyReport" class="report-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Date Selection -->
                    <div class="bg-teal-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-teal-800">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</h3>
                        <input type="date" id="dailyReportDate" class="w-full p-3 border rounded-lg text-sm" onchange="generateDailyReport()">
                        <div id="dailyStats" class="mt-4 space-y-3">
                            <!-- Daily statistics will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Daily Charts -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">üìà ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3>
                        <div id="dailyTopProducts" class="space-y-2">
                            <!-- Top products will be shown here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Weekly Report -->
            <div id="weeklyReport" class="report-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Week Selection -->
                    <div class="bg-teal-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-teal-800">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h3>
                        <input type="week" id="weeklyReportWeek" class="w-full p-3 border rounded-lg text-sm" onchange="generateWeeklyReport()">
                        <div id="weeklyStats" class="mt-4 space-y-3">
                            <!-- Weekly statistics will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Weekly Analysis -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
                        <div id="weeklyDayAnalysis" class="space-y-2">
                            <!-- Daily analysis within week will be shown here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Monthly Report -->
            <div id="monthlyReport" class="report-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Month Selection -->
                    <div class="bg-teal-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-teal-800">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                        <input type="month" id="monthlyReportMonth" class="w-full p-3 border rounded-lg text-sm" onchange="generateMonthlyReport()">
                        <div id="monthlyStats" class="mt-4 space-y-3">
                            <!-- Monthly statistics will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Monthly Trends -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                        <div id="monthlyTrends" class="space-y-2">
                            <!-- Monthly trends will be shown here -->
                        </div>
                    </div>
                </div>
                
                <!-- Cost Analysis -->
                <div class="mt-6 bg-red-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-red-800">üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡πÑ‡∏£</h3>
                    <div id="costAnalysisReport" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Cost analysis will be shown here -->
                    </div>
                </div>
                
                <!-- Customer Analysis -->
                <div class="mt-6 bg-purple-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-purple-800">üë• ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
                    <div id="customerAnalysis" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Customer analysis will be shown here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Costs Section -->
        <div id="costs" class="section bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-orange-800 mb-2">üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h2>
                <p class="text-sm text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°‡∏ó‡∏∏‡∏ô</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà -->
                <div class="bg-orange-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-orange-800 border-b border-orange-200 pb-2">
                        üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤</label>
                            <input type="number" id="rentCost" placeholder="‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)" class="w-full p-3 border rounded-lg text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü/‡∏ô‡πâ‡∏≥</label>
                            <input type="number" id="utilityCost" placeholder="‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü/‡∏ô‡πâ‡∏≥ (‡∏ö‡∏≤‡∏ó)" class="w-full p-3 border rounded-lg text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô</label>
                            <input type="number" id="laborCost" placeholder="‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô (‡∏ö‡∏≤‡∏ó)" class="w-full p-3 border rounded-lg text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                            <input type="number" id="otherFixedCost" placeholder="‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏ö‡∏≤‡∏ó)" class="w-full p-3 border rounded-lg text-sm">
                        </div>
                        <button onclick="updateFixedCosts()" class="w-full bg-orange-500 text-white p-3 rounded-lg hover:bg-orange-600 text-sm font-medium">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</button>
                    </div>
                </div>
                
                <!-- ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
                        üìà ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô
                    </h3>
                    <div id="costAnalysis" class="space-y-4">
                        <div class="p-4 bg-orange-100 rounded-lg border border-orange-200">
                            <h4 class="font-semibold text-orange-800 text-sm mb-2">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h4>
                            <p class="text-xl font-bold text-orange-600" id="totalFixedCost">0 ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        
                        <div class="p-4 bg-blue-100 rounded-lg border border-blue-200">
                            <h4 class="font-semibold text-blue-800 text-sm mb-2">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÅ‡∏õ‡∏£‡∏ú‡∏±‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢</h4>
                            <div id="variableCostsList" class="text-sm">
                                <!-- Variable costs per product will be shown here -->
                            </div>
                        </div>
                        
                        <div class="p-4 bg-green-100 rounded-lg border border-green-200">
                            <h4 class="font-semibold text-green-800 text-sm mb-2">‡∏à‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°‡∏ó‡∏∏‡∏ô</h4>
                            <div id="breakEvenAnalysis" class="text-sm">
                                <!-- Break-even analysis will be shown here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let inventory = JSON.parse(localStorage.getItem('bakery_inventory') || '[]');
        let purchases = JSON.parse(localStorage.getItem('bakery_purchases') || '[]');
        let recipes = JSON.parse(localStorage.getItem('bakery_recipes') || '[]');
        let productions = JSON.parse(localStorage.getItem('bakery_productions') || '[]');
        let sales = JSON.parse(localStorage.getItem('bakery_sales') || '[]');
        let productStock = JSON.parse(localStorage.getItem('bakery_product_stock') || '{}');
        let fixedCosts = JSON.parse(localStorage.getItem('bakery_fixed_costs') || '{}');
        
        // Search and filter state
        let currentFilter = 'all';
        let currentSearchTerm = '';
        let filteredInventory = [];
        
        // Recipe filter and view state
        let currentRecipeFilter = 'all';
        let currentRecipeView = 'compact';
        let filteredRecipes = [];

        // Navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName).classList.remove('hidden');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2');
            });
            event.target.classList.add('ring-2', 'ring-offset-2');
            
            // Refresh data when switching sections
            if (sectionName === 'inventory') updateInventoryDisplay();
            if (sectionName === 'purchase') updatePurchaseOptions();
            if (sectionName === 'recipes') updateRecipeOptions();
            if (sectionName === 'production') updateProductionOptions();
            if (sectionName === 'sales') updateSalesOptions();
            if (sectionName === 'reports') initializeReports();
            if (sectionName === 'costs') updateCostAnalysis();
        }

        // Price calculation function
        function calculateUnitPrice() {
            const packageQuantity = parseFloat(document.getElementById('packageQuantity').value);
            const packageUnit = document.getElementById('packageUnit').value;
            const packagePrice = parseFloat(document.getElementById('packagePrice').value);
            const priceCalculation = document.getElementById('priceCalculation');
            const calculationText = document.getElementById('calculationText');
            const unitPriceResult = document.getElementById('unitPriceResult');
            const addItemBtn = document.getElementById('addItemBtn');

            // Check if all required fields are filled
            const itemName = document.getElementById('itemName').value.trim();
            const initialStock = parseFloat(document.getElementById('initialStock').value);

            if (packageQuantity && packageUnit && packagePrice) {
                // Calculate unit price
                const unitPrice = packagePrice / packageQuantity;
                
                // Show calculation
                priceCalculation.classList.remove('hidden');
                calculationText.innerHTML = `
                    <div>üìä ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</div>
                    <div>‡∏£‡∏≤‡∏Ñ‡∏≤ ${packagePrice} ‡∏ö‡∏≤‡∏ó √∑ ${packageQuantity} ${packageUnit} = ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${packageUnit}</div>
                `;
                unitPriceResult.textContent = `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${packageUnit}`;
                
                // Enable button if all fields are filled
                if (itemName && initialStock > 0) {
                    addItemBtn.disabled = false;
                } else {
                    addItemBtn.disabled = true;
                }
            } else {
                // Hide calculation
                priceCalculation.classList.add('hidden');
                addItemBtn.disabled = true;
            }
        }

        // Inventory Management
        function addInventoryItem() {
            const name = document.getElementById('itemName').value.trim();
            const packageQuantity = parseFloat(document.getElementById('packageQuantity').value);
            const packageUnit = document.getElementById('packageUnit').value;
            const packagePrice = parseFloat(document.getElementById('packagePrice').value);
            const initialStock = parseFloat(document.getElementById('initialStock').value);

            if (!name || !packageQuantity || !packageUnit || !packagePrice || !initialStock) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            // Calculate unit price
            const unitPrice = packagePrice / packageQuantity;
            
            // Calculate total quantity in stock (initial stock √ó package quantity)
            const totalQuantity = initialStock * packageQuantity;

            const existingItem = inventory.find(item => item.name === name);
            if (existingItem) {
                // Update existing item
                existingItem.quantity += totalQuantity;
                existingItem.packageQuantity = packageQuantity;
                existingItem.packageUnit = packageUnit;
                existingItem.packagePrice = packagePrice;
                existingItem.unitPrice = unitPrice;
                existingItem.lastUpdated = new Date().toLocaleDateString('th-TH');
            } else {
                // Create new item
                const newItem = {
                    id: Date.now(),
                    name,
                    quantity: totalQuantity,
                    unit: packageUnit,
                    packageQuantity,
                    packageUnit,
                    packagePrice,
                    unitPrice,
                    lastUpdated: new Date().toLocaleDateString('th-TH')
                };
                
                inventory.push(newItem);
            }

            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            updateInventoryDisplay();
            
            // Clear form
            document.getElementById('itemName').value = '';
            document.getElementById('packageQuantity').value = '';
            document.getElementById('packageUnit').value = '';
            document.getElementById('packagePrice').value = '';
            document.getElementById('initialStock').value = '';
            document.getElementById('priceCalculation').classList.add('hidden');
            document.getElementById('addItemBtn').disabled = true;
            
            alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:\n‚Ä¢ ${initialStock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ √ó ${packageQuantity} ${packageUnit} = ${totalQuantity} ${packageUnit}\n‚Ä¢ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${packageUnit}`);
        }

        // Search and Filter Functions
        function searchInventory() {
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase().trim();
            const clearBtn = document.getElementById('clearSearchBtn');
            
            currentSearchTerm = searchTerm;
            
            // Show/hide clear button
            if (searchTerm) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }
            
            // Show suggestions if search term is not empty but no exact matches
            showSearchSuggestions(searchTerm);
            
            // Apply current filter and search
            applyInventoryFilter();
        }

        function clearInventorySearch() {
            document.getElementById('inventorySearch').value = '';
            document.getElementById('clearSearchBtn').classList.add('hidden');
            document.getElementById('searchSuggestions').classList.add('hidden');
            document.getElementById('searchResults').classList.add('hidden');
            currentSearchTerm = '';
            applyInventoryFilter();
        }

        function showSearchSuggestions(searchTerm) {
            const suggestionsDiv = document.getElementById('searchSuggestions');
            const suggestionsList = document.getElementById('suggestionsList');
            
            if (!searchTerm) {
                suggestionsDiv.classList.add('hidden');
                return;
            }
            
            // Find similar items using fuzzy matching
            const suggestions = findSimilarItems(searchTerm);
            
            if (suggestions.length > 0) {
                suggestionsDiv.classList.remove('hidden');
                suggestionsList.innerHTML = suggestions.map(suggestion => `
                    <button onclick="applySuggestion('${suggestion}')" 
                            class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors">
                        ${suggestion}
                    </button>
                `).join('');
            } else {
                suggestionsDiv.classList.add('hidden');
            }
        }

        function findSimilarItems(searchTerm) {
            if (!searchTerm || searchTerm.length < 2) return [];
            
            const suggestions = new Set();
            
            // Common ingredient keywords and their variations
            const ingredientKeywords = {
                '‡πÅ‡∏õ‡πâ‡∏á': ['‡πÅ‡∏õ‡πâ‡∏á‡∏™‡∏≤‡∏•‡∏µ', '‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏≠‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå', '‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏Ñ‡πâ‡∏Å', '‡πÅ‡∏õ‡πâ‡∏á‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á', '‡πÅ‡∏õ‡πâ‡∏á‡∏°‡∏±‡∏ô'],
                '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•': ['‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ó‡∏£‡∏≤‡∏¢', '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏õ‡πà‡∏ô', '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÑ‡∏≠‡∏ã‡∏¥‡πà‡∏á', '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÅ‡∏î‡∏á'],
                '‡πÄ‡∏ô‡∏¢': ['‡πÄ‡∏ô‡∏¢‡∏à‡∏∑‡∏î', '‡πÄ‡∏ô‡∏¢‡πÄ‡∏Ñ‡πá‡∏°', '‡πÄ‡∏ô‡∏¢‡∏Ç‡∏≤‡∏ß', '‡∏°‡∏≤‡∏Å‡∏≤‡∏£‡∏µ‡∏ô'],
                '‡∏ô‡∏°': ['‡∏ô‡∏°‡∏™‡∏î', '‡∏ô‡∏°‡∏Ç‡πâ‡∏ô‡∏´‡∏ß‡∏≤‡∏ô', '‡∏ô‡∏°‡∏Ç‡πâ‡∏ô‡∏à‡∏∑‡∏î', '‡∏ô‡∏°‡∏ú‡∏á', '‡∏ß‡∏¥‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡∏Ñ‡∏£‡∏µ‡∏°'],
                '‡πÑ‡∏Ç‡πà': ['‡πÑ‡∏Ç‡πà‡πÑ‡∏Å‡πà', '‡πÑ‡∏Ç‡πà‡πÅ‡∏î‡∏á', '‡πÑ‡∏Ç‡πà‡∏Ç‡∏≤‡∏ß'],
                '‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï': ['‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏ä‡∏¥‡∏õ', '‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡∏ú‡∏á', '‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡πÅ‡∏ó‡πà‡∏á'],
                '‡∏ß‡∏ô‡∏¥‡∏•‡∏•‡∏≤': ['‡∏ß‡∏ô‡∏¥‡∏•‡∏•‡∏≤‡πÄ‡∏≠‡∏™‡πÄ‡∏ã‡πâ‡∏ô‡∏™‡πå', '‡∏ß‡∏ô‡∏¥‡∏•‡∏•‡∏≤‡∏™‡∏Å‡∏±‡∏î'],
                '‡πÄ‡∏Å‡∏•‡∏∑‡∏≠': ['‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏õ‡πà‡∏ô', '‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏ó‡∏∞‡πÄ‡∏•'],
                '‡∏ú‡∏á‡∏ü‡∏π': ['‡πÄ‡∏ö‡∏Å‡∏Å‡∏¥‡πâ‡∏á‡πÇ‡∏ã‡∏î‡∏≤', '‡∏ú‡∏á‡∏ü‡∏π‡πÄ‡∏Ñ‡πâ‡∏Å'],
                '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô': ['‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏û‡∏∑‡∏ä', '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏Ñ‡∏≤‡πÇ‡∏ô‡∏•‡∏≤', '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏°‡∏∞‡∏Å‡∏≠‡∏Å']
            };
            
            // Search in existing inventory
            inventory.forEach(item => {
                const itemName = item.name.toLowerCase();
                
                // Exact match or contains search term
                if (itemName.includes(searchTerm)) {
                    suggestions.add(item.name);
                }
                
                // Fuzzy matching for typos
                if (calculateSimilarity(itemName, searchTerm) > 0.6) {
                    suggestions.add(item.name);
                }
            });
            
            // Search in keyword suggestions
            Object.entries(ingredientKeywords).forEach(([keyword, variations]) => {
                if (keyword.includes(searchTerm) || searchTerm.includes(keyword)) {
                    variations.forEach(variation => {
                        // Only suggest if not already in inventory
                        if (!inventory.some(item => item.name.toLowerCase().includes(variation.toLowerCase()))) {
                            suggestions.add(variation);
                        }
                    });
                }
                
                variations.forEach(variation => {
                    if (variation.toLowerCase().includes(searchTerm) || 
                        calculateSimilarity(variation.toLowerCase(), searchTerm) > 0.6) {
                        suggestions.add(variation);
                    }
                });
            });
            
            return Array.from(suggestions).slice(0, 8); // Limit to 8 suggestions
        }

        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = levenshteinDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }

        function levenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }

        function applySuggestion(suggestion) {
            document.getElementById('inventorySearch').value = suggestion;
            currentSearchTerm = suggestion.toLowerCase();
            document.getElementById('searchSuggestions').classList.add('hidden');
            document.getElementById('clearSearchBtn').classList.remove('hidden');
            applyInventoryFilter();
        }

        function filterInventory(filterType) {
            currentFilter = filterType;
            
            // Update filter button styles
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-blue-500', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            applyInventoryFilter();
        }

        function applyInventoryFilter() {
            let filtered = [...inventory];
            
            // Apply search filter
            if (currentSearchTerm) {
                filtered = filtered.filter(item => {
                    const itemName = item.name.toLowerCase();
                    const unit = item.unit.toLowerCase();
                    
                    return itemName.includes(currentSearchTerm) || 
                           unit.includes(currentSearchTerm) ||
                           calculateSimilarity(itemName, currentSearchTerm) > 0.5;
                });
            }
            
            // Apply category filter
            if (currentFilter !== 'all') {
                filtered = filtered.filter(item => {
                    const itemName = item.name.toLowerCase();
                    
                    switch (currentFilter) {
                        case 'low-stock':
                            const packagesLeft = Math.floor(item.quantity / item.packageQuantity);
                            return packagesLeft < 1;
                        case 'powder':
                            return itemName.includes('‡πÅ‡∏õ‡πâ‡∏á') || itemName.includes('‡∏ú‡∏á') || 
                                   itemName.includes('‡πÇ‡∏Å‡πÇ‡∏Å‡πâ') || itemName.includes('‡∏ú‡∏á‡∏ü‡∏π');
                        case 'liquid':
                            return item.unit.includes('‡∏°‡∏•') || item.unit.includes('‡∏•‡∏¥‡∏ï‡∏£') || 
                                   itemName.includes('‡∏ô‡πâ‡∏≥') || itemName.includes('‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô') ||
                                   itemName.includes('‡πÄ‡∏≠‡∏™‡πÄ‡∏ã‡πâ‡∏ô‡∏™‡πå');
                        case 'dairy':
                            return itemName.includes('‡∏ô‡∏°') || itemName.includes('‡πÄ‡∏ô‡∏¢') || 
                                   itemName.includes('‡∏Ñ‡∏£‡∏µ‡∏°') || itemName.includes('‡∏ä‡∏µ‡∏™') ||
                                   itemName.includes('‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï');
                        case 'sweet':
                            return itemName.includes('‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•') || itemName.includes('‡∏ô‡πâ‡∏≥‡∏ú‡∏∂‡πâ‡∏á') || 
                                   itemName.includes('‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï') || itemName.includes('‡∏´‡∏ß‡∏≤‡∏ô') ||
                                   itemName.includes('‡πÑ‡∏ã‡∏£‡∏±‡∏õ');
                        default:
                            return true;
                    }
                });
            }
            
            filteredInventory = filtered;
            
            // Apply sorting
            sortInventory();
            
            // Show search results info
            showSearchResults();
        }

        function sortInventory() {
            const sortType = document.getElementById('inventorySort').value;
            
            filteredInventory.sort((a, b) => {
                switch (sortType) {
                    case 'name-asc':
                        return a.name.localeCompare(b.name, 'th');
                    case 'name-desc':
                        return b.name.localeCompare(a.name, 'th');
                    case 'stock-low':
                        return a.quantity - b.quantity;
                    case 'stock-high':
                        return b.quantity - a.quantity;
                    case 'updated-new':
                        return new Date(b.lastUpdated) - new Date(a.lastUpdated);
                    case 'updated-old':
                        return new Date(a.lastUpdated) - new Date(b.lastUpdated);
                    default:
                        return 0;
                }
            });
            
            updateInventoryDisplay();
        }

        function showSearchResults() {
            const searchResults = document.getElementById('searchResults');
            const totalItems = inventory.length;
            const filteredCount = filteredInventory.length;
            
            if (currentSearchTerm || currentFilter !== 'all') {
                searchResults.classList.remove('hidden');
                
                let message = `‡∏û‡∏ö ${filteredCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                if (currentSearchTerm) {
                    message += ` ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "${currentSearchTerm}"`;
                }
                if (currentFilter !== 'all') {
                    const filterNames = {
                        'low-stock': '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î',
                        'powder': '‡πÅ‡∏õ‡πâ‡∏á/‡∏ú‡∏á',
                        'liquid': '‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß',
                        'dairy': '‡∏ô‡∏°/‡πÄ‡∏ô‡∏¢',
                        'sweet': '‡∏´‡∏ß‡∏≤‡∏ô'
                    };
                    message += ` ‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î "${filterNames[currentFilter]}"`;
                }
                message += ` ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                
                searchResults.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span>üîç ${message}</span>
                        ${(currentSearchTerm || currentFilter !== 'all') ? 
                            '<button onclick="resetAllFilters()" class="text-blue-800 hover:text-blue-900 underline text-xs">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>' : 
                            ''
                        }
                    </div>
                `;
            } else {
                searchResults.classList.add('hidden');
            }
        }

        function resetAllFilters() {
            // Clear search
            document.getElementById('inventorySearch').value = '';
            document.getElementById('clearSearchBtn').classList.add('hidden');
            currentSearchTerm = '';
            
            // Reset filter to 'all'
            currentFilter = 'all';
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            document.querySelector('.filter-btn').classList.add('active', 'bg-blue-500', 'text-white');
            document.querySelector('.filter-btn').classList.remove('bg-gray-200', 'text-gray-700');
            
            // Reset sort
            document.getElementById('inventorySort').value = 'name-asc';
            
            // Hide suggestions and results
            document.getElementById('searchSuggestions').classList.add('hidden');
            document.getElementById('searchResults').classList.add('hidden');
            
            // Apply filters
            applyInventoryFilter();
        }

        function updateInventoryDisplay() {
            const list = document.getElementById('inventoryList');
            const countElement = document.getElementById('inventoryCount');
            
            // Update count
            countElement.textContent = filteredInventory.length;
            
            if (inventory.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á<br>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            if (filteredInventory.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-lg mb-2">üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
                        <div class="text-sm">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏î‡∏π</div>
                        <button onclick="resetAllFilters()" class="mt-3 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm">
                            ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = filteredInventory.map(item => {
                // Calculate how many packages are left
                const packagesLeft = Math.floor(item.quantity / item.packageQuantity);
                const remainingUnits = item.quantity % item.packageQuantity;
                
                // Warning for low stock (less than 1 package or less than 10% of a package)
                const lowStock = packagesLeft < 1 || (packagesLeft === 0 && remainingUnits < item.packageQuantity * 0.1);
                
                // Highlight search term in item name
                let displayName = item.name;
                if (currentSearchTerm) {
                    const regex = new RegExp(`(${currentSearchTerm})`, 'gi');
                    displayName = item.name.replace(regex, '<mark class="bg-yellow-200 px-1 rounded">$1</mark>');
                }
                
                return `
                    <div class="p-4 border rounded-lg ${lowStock ? 'bg-red-50 border-red-200' : 'bg-gray-50'} hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="font-medium text-lg">${displayName}</div>
                                
                                <!-- Stock Information -->
                                <div class="mt-2 space-y-1">
                                    <div class="text-sm text-gray-700">
                                        <span class="font-medium">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</span> ${item.quantity.toLocaleString()} ${item.unit}
                                    </div>
                                    <div class="text-sm text-blue-600">
                                        <span class="font-medium">‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö:</span> ${packagesLeft} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠
                                        ${remainingUnits > 0 ? ` + ${remainingUnits.toLocaleString()} ${item.unit}` : ''}
                                    </div>
                                </div>
                                
                                <!-- Package Information -->
                                <div class="mt-2 p-2 bg-blue-100 rounded text-xs">
                                    <div class="font-medium text-blue-800">üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠:</div>
                                    <div class="text-blue-700">
                                        ‚Ä¢ 1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ = ${item.packageQuantity} ${item.unit} = ${item.packagePrice} ‡∏ö‡∏≤‡∏ó
                                    </div>
                                    <div class="text-blue-700">
                                        ‚Ä¢ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ = ${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${item.unit}
                                    </div>
                                </div>
                                
                                <div class="text-xs text-gray-500 mt-2">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${item.lastUpdated}</div>
                            </div>
                            
                            <div class="text-right ml-4">
                                ${lowStock ? '<div class="text-red-500 text-sm font-medium mb-2">‚ö†Ô∏è ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div>' : ''}
                                <button onclick="removeInventoryItem(${item.id})" class="text-red-500 hover:text-red-700 p-1">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function removeInventoryItem(id) {
            inventory = inventory.filter(item => item.id !== id);
            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            updateInventoryDisplay();
        }

        // Purchase Management
        function updatePurchaseOptions() {
            const select = document.getElementById('purchaseItem');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>' + 
                inventory.map(item => `<option value="${item.name}">${item.name} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${item.quantity.toLocaleString()} ${item.unit})</option>`).join('');
            updatePurchaseHistory();
        }

        function updatePurchaseInfo() {
            const itemName = document.getElementById('purchaseItem').value;
            const purchaseInfo = document.getElementById('purchaseInfo');
            const packageDetails = document.getElementById('packageDetails');
            const purchaseUnitDisplay = document.getElementById('purchaseUnitDisplay');
            const makePurchaseBtn = document.getElementById('makePurchaseBtn');
            
            if (!itemName) {
                purchaseInfo.classList.add('hidden');
                makePurchaseBtn.disabled = true;
                return;
            }
            
            const item = inventory.find(i => i.name === itemName);
            if (!item) return;
            
            // Show purchase info section
            purchaseInfo.classList.remove('hidden');
            
            // Display package details
            packageDetails.innerHTML = `
                <div class="space-y-1">
                    <div><strong>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:</strong> ${item.name}</div>
                    <div><strong>1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ =</strong> ${item.packageQuantity.toLocaleString()} ${item.unit}</div>
                    <div><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠:</strong> ${item.packagePrice} ‡∏ö‡∏≤‡∏ó</div>
                    <div><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠${item.unit}:</strong> ${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${item.unit}</div>
                    <div class="text-blue-600"><strong>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á:</strong> ${item.quantity.toLocaleString()} ${item.unit}</div>
                </div>
            `;
            
            // Set unit display
            purchaseUnitDisplay.textContent = '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠';
            
            // Clear previous calculation
            document.getElementById('purchaseQuantity').value = '';
            document.getElementById('purchaseConversion').classList.add('hidden');
            makePurchaseBtn.disabled = true;
        }

        function calculatePurchaseConversion() {
            const itemName = document.getElementById('purchaseItem').value;
            const purchaseQuantity = parseFloat(document.getElementById('purchaseQuantity').value);
            const purchaseConversion = document.getElementById('purchaseConversion');
            const conversionCalculation = document.getElementById('conversionCalculation');
            const totalQuantityResult = document.getElementById('totalQuantityResult');
            const totalCostResult = document.getElementById('totalCostResult');
            const makePurchaseBtn = document.getElementById('makePurchaseBtn');
            
            if (!itemName || !purchaseQuantity || purchaseQuantity <= 0) {
                purchaseConversion.classList.add('hidden');
                makePurchaseBtn.disabled = true;
                return;
            }
            
            const item = inventory.find(i => i.name === itemName);
            if (!item) return;
            
            // Calculate conversion
            const totalQuantityToAdd = purchaseQuantity * item.packageQuantity;
            const totalCost = purchaseQuantity * item.packagePrice;
            
            // Show conversion
            purchaseConversion.classList.remove('hidden');
            
            conversionCalculation.innerHTML = `
                <div>üìä ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</div>
                <div>${purchaseQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ √ó ${item.packageQuantity.toLocaleString()} ${item.unit}/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ = ${totalQuantityToAdd.toLocaleString()} ${item.unit}</div>
                <div>${purchaseQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ √ó ${item.packagePrice} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ = ${totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
            `;
            
            totalQuantityResult.textContent = `‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ${totalQuantityToAdd.toLocaleString()} ${item.unit}`;
            totalCostResult.textContent = `‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: ${totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            
            // Enable purchase button
            makePurchaseBtn.disabled = false;
        }

        function makePurchase() {
            const itemName = document.getElementById('purchaseItem').value;
            const purchaseQuantity = parseFloat(document.getElementById('purchaseQuantity').value);
            const supplier = document.getElementById('supplier').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

            if (!itemName || !purchaseQuantity || purchaseQuantity <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }

            const item = inventory.find(i => i.name === itemName);
            if (!item) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
                return;
            }

            // Calculate actual quantity to add to inventory
            const actualQuantityToAdd = purchaseQuantity * item.packageQuantity;
            const totalCost = purchaseQuantity * item.packagePrice;

            // Add to inventory
            item.quantity += actualQuantityToAdd;
            item.lastUpdated = new Date().toLocaleDateString('th-TH');

            // Record purchase
            purchases.push({
                id: Date.now(),
                itemName,
                purchaseQuantity: purchaseQuantity,
                packageQuantity: item.packageQuantity,
                packagePrice: item.packagePrice,
                actualQuantityAdded: actualQuantityToAdd,
                unit: item.unit,
                unitPrice: item.unitPrice,
                totalCost: totalCost,
                supplier,
                date: new Date().toLocaleDateString('th-TH'),
                time: new Date().toLocaleTimeString('th-TH')
            });

            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            localStorage.setItem('bakery_purchases', JSON.stringify(purchases));
            
            updatePurchaseHistory();
            updateInventoryDisplay();
            
            // Clear form
            document.getElementById('purchaseQuantity').value = '';
            document.getElementById('supplier').value = '';
            document.getElementById('purchaseConversion').classList.add('hidden');
            document.getElementById('makePurchaseBtn').disabled = true;
            
            alert(`‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
                  `‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö: ${itemName}\n` +
                  `‡∏ã‡∏∑‡πâ‡∏≠: ${purchaseQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠\n` +
                  `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ${actualQuantityToAdd.toLocaleString()} ${item.unit}\n` +
                  `‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà: ${item.quantity.toLocaleString()} ${item.unit}`);
        }

        function updatePurchaseHistory() {
            const list = document.getElementById('purchaseHistory');
            
            if (purchases.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠<br>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            const recentPurchases = purchases.slice(-10).reverse();
            list.innerHTML = recentPurchases.map(purchase => `
                <div class="p-3 border rounded-lg bg-green-50 hover:shadow-md transition-shadow">
                    <div class="font-medium">${purchase.itemName}</div>
                    <div class="text-sm text-gray-600 space-y-1">
                        <div>‡∏ã‡∏∑‡πâ‡∏≠: ${purchase.purchaseQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ ‚Üí ‡πÑ‡∏î‡πâ ${purchase.actualQuantityAdded.toLocaleString()} ${purchase.unit}</div>
                        <div>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${purchase.totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-blue-600">‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢: ${purchase.supplier}</div>
                    </div>
                    <div class="text-xs text-gray-500 mt-2">${purchase.date} ${purchase.time}</div>
                </div>
            `).join('');
        }

        // Production Management
        function updateProductionOptions() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('productionDate').value = today;
            
            // Update recipe options
            const select = document.getElementById('productionRecipe');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ú‡∏•‡∏¥‡∏ï</option>' + 
                recipes.map(recipe => `<option value="${recipe.name}">${recipe.name} (‡πÑ‡∏î‡πâ ${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢)</option>`).join('');
            
            updateProductionHistory();
            updateTodayProductionSummary();
        }

        function updateProductionInfo() {
            const recipeName = document.getElementById('productionRecipe').value;
            const ingredientNeeds = document.getElementById('ingredientNeeds');
            
            if (!recipeName) {
                ingredientNeeds.classList.add('hidden');
                document.getElementById('startProductionBtn').disabled = true;
                return;
            }
            
            ingredientNeeds.classList.remove('hidden');
            calculateIngredientNeeds();
        }

        function calculateIngredientNeeds() {
            const recipeName = document.getElementById('productionRecipe').value;
            const quantity = parseFloat(document.getElementById('productionQuantity').value) || 0;
            
            if (!recipeName || !quantity) {
                document.getElementById('startProductionBtn').disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === recipeName);
            if (!recipe) return;
            
            const multiplier = quantity / recipe.yield;
            const ingredientsList = document.getElementById('ingredientsList');
            const stockCheck = document.getElementById('stockCheck');
            
            let canProduce = true;
            let stockStatus = [];
            
            const ingredientsHtml = recipe.ingredients.map(ingredient => {
                const needed = ingredient.amount * multiplier;
                const inventoryItem = inventory.find(item => item.name === ingredient.name);
                const available = inventoryItem ? inventoryItem.quantity : 0;
                const sufficient = available >= needed;
                
                if (!sufficient) canProduce = false;
                
                stockStatus.push({
                    name: ingredient.name,
                    needed: needed,
                    available: available,
                    sufficient: sufficient,
                    unit: ingredient.unit
                });
                
                return `
                    <div class="flex justify-between items-center p-2 rounded ${sufficient ? 'bg-green-100' : 'bg-red-100'}">
                        <span>${ingredient.name}</span>
                        <span class="text-sm">
                            ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ: ${needed.toFixed(2)} ${ingredient.unit}
                            ${sufficient ? '‚úÖ' : '‚ùå'}
                        </span>
                    </div>
                `;
            }).join('');
            
            ingredientsList.innerHTML = ingredientsHtml;
            
            // Stock check summary
            const insufficientItems = stockStatus.filter(item => !item.sufficient);
            if (insufficientItems.length > 0) {
                stockCheck.innerHTML = `
                    <div class="text-red-600 font-medium mb-2">‚ö†Ô∏è ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠:</div>
                    ${insufficientItems.map(item => `
                        <div class="text-red-600 text-xs">
                            ‚Ä¢ ${item.name}: ‡∏°‡∏µ ${item.available} ${item.unit} ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${item.needed.toFixed(2)} ${item.unit} 
                            (‡∏Ç‡∏≤‡∏î ${(item.needed - item.available).toFixed(2)} ${item.unit})
                        </div>
                    `).join('')}
                `;
            } else {
                stockCheck.innerHTML = '<div class="text-green-600 font-medium">‚úÖ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>';
            }
            
            document.getElementById('startProductionBtn').disabled = !canProduce;
        }

        function startProduction() {
            const recipeName = document.getElementById('productionRecipe').value;
            const quantity = parseFloat(document.getElementById('productionQuantity').value);
            const productionDate = document.getElementById('productionDate').value;
            
            if (!recipeName || !quantity || !productionDate) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            const recipe = recipes.find(r => r.name === recipeName);
            if (!recipe) return;
            
            const multiplier = quantity / recipe.yield;
            
            // Check stock availability one more time
            let canProduce = true;
            const usedIngredients = [];
            
            // Only check ingredients that are actually in inventory (not base recipe costs)
            for (const ingredient of recipe.ingredients) {
                const needed = ingredient.amount * multiplier;
                const inventoryItem = inventory.find(item => item.name === ingredient.name);
                
                if (!inventoryItem || inventoryItem.quantity < needed) {
                    canProduce = false;
                    break;
                }
                
                usedIngredients.push({
                    name: ingredient.name,
                    amount: needed,
                    unit: ingredient.unit,
                    cost: needed * inventoryItem.unitPrice
                });
            }
            
            if (!canProduce) {
                alert('‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï');
                return;
            }
            
            // Deduct ingredients from inventory
            for (const used of usedIngredients) {
                const inventoryItem = inventory.find(item => item.name === used.name);
                inventoryItem.quantity -= used.amount;
                inventoryItem.lastUpdated = new Date().toLocaleDateString('th-TH');
            }
            
            // Calculate total cost including base recipe cost
            // Use unitPrice from inventory for accurate cost calculation
            const ingredientsCost = usedIngredients.reduce((sum, ingredient) => {
                const inventoryItem = inventory.find(item => item.name === ingredient.name);
                const unitPrice = inventoryItem ? inventoryItem.unitPrice : 0;
                return sum + (ingredient.amount * unitPrice);
            }, 0);
            const baseCostForProduction = recipe.baseCost ? (recipe.baseCost * multiplier) : 0;
            const totalCost = ingredientsCost + baseCostForProduction;
            
            productions.push({
                id: Date.now(),
                recipeName,
                quantity,
                productionDate,
                usedIngredients,
                ingredientsCost,
                baseCost: baseCostForProduction,
                baseRecipeName: recipe.baseRecipeName || null,
                totalCost,
                costPerUnit: totalCost / quantity,
                timestamp: new Date().toLocaleString('th-TH')
            });
            
            // Add to product stock
            if (!productStock[recipeName]) {
                productStock[recipeName] = 0;
            }
            productStock[recipeName] += quantity;
            
            // Save data
            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            localStorage.setItem('bakery_productions', JSON.stringify(productions));
            localStorage.setItem('bakery_product_stock', JSON.stringify(productStock));
            
            // Update displays
            updateInventoryDisplay();
            updateProductionHistory();
            updateTodayProductionSummary();
            
            // Clear form
            document.getElementById('productionQuantity').value = '';
            document.getElementById('ingredientNeeds').classList.add('hidden');
            document.getElementById('startProductionBtn').disabled = true;
            
            // Show detailed cost breakdown
            let message = `‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï ${recipeName} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n`;
            if (baseCostForProduction > 0) {
                message += `üìã ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseCostForProduction.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            }
            if (ingredientsCost > 0) {
                message += `üßÇ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°: ${ingredientsCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            }
            message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${(totalCost / quantity).toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üì¶ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`;
            
            alert(message);
        }

        function updateProductionHistory() {
            const list = document.getElementById('productionHistory');
            const recentProductions = productions.slice(-10).reverse();
            
            list.innerHTML = recentProductions.map(production => `
                <div class="p-3 border rounded-lg bg-indigo-50">
                    <div class="font-medium">${production.recipeName}</div>
                    <div class="text-sm text-gray-600">
                        ‡∏ú‡∏•‡∏¥‡∏ï: ${production.quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ | ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${production.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó
                    </div>
                    <div class="text-sm text-indigo-600">
                        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${production.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó
                    </div>
                    <div class="text-xs text-gray-500">
                        ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${production.productionDate} | ${production.timestamp}
                    </div>
                    <div class="mt-2">
                        <button onclick="toggleIngredientDetails(${production.id})" class="text-xs text-indigo-600 hover:text-indigo-800">
                            ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
                        </button>
                        <div id="details-${production.id}" class="hidden mt-2 text-xs bg-white p-2 rounded border">
                            ${production.usedIngredients.map(ing => `
                                <div class="flex justify-between">
                                    <span>${ing.name}</span>
                                    <span>${ing.amount.toFixed(2)} ${ing.unit}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleIngredientDetails(productionId) {
            const details = document.getElementById(`details-${productionId}`);
            details.classList.toggle('hidden');
        }

        function updateTodayProductionSummary() {
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => p.productionDate === today);
            
            const summary = document.getElementById('todayProduction');
            
            if (todayProductions.length === 0) {
                summary.innerHTML = '<p class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>';
                return;
            }
            
            const totalCost = todayProductions.reduce((sum, p) => sum + p.totalCost, 0);
            const productSummary = {};
            
            todayProductions.forEach(p => {
                if (productSummary[p.recipeName]) {
                    productSummary[p.recipeName] += p.quantity;
                } else {
                    productSummary[p.recipeName] = p.quantity;
                }
            });
            
            summary.innerHTML = `
                <div class="text-sm">
                    <div class="font-medium text-indigo-800 mb-1">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï:</div>
                    ${Object.entries(productSummary).map(([name, qty]) => `
                        <div class="flex justify-between">
                            <span>${name}</span>
                            <span>${qty} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                        </div>
                    `).join('')}
                    <div class="border-t mt-2 pt-2 font-medium">
                        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó
                    </div>
                </div>
            `;
        }

        // Recipe Management
        let editingRecipeId = null;

        function updateRecipeOptions() {
            const selects = document.querySelectorAll('.ingredient-select');
            const options = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>' + 
                inventory.map(item => `<option value="${item.name}">${item.name} (${item.unit})</option>`).join('');
            selects.forEach(select => select.innerHTML = options);
            
            // Update base recipe options
            const baseRecipeSelect = document.getElementById('baseRecipe');
            baseRecipeSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</option>' + 
                recipes.map(recipe => `<option value="${recipe.id}">${recipe.name} (${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢)</option>`).join('');
            
            updateRecipesList();
        }

        function loadBaseRecipe() {
            const baseRecipeId = document.getElementById('baseRecipe').value;
            if (!baseRecipeId) {
                // Clear base recipe cost display if no base recipe selected
                const baseCostDisplay = document.getElementById('baseCostDisplay');
                if (baseCostDisplay) baseCostDisplay.remove();
                return;
            }
            
            const baseRecipe = recipes.find(r => r.id == baseRecipeId);
            if (!baseRecipe) return;
            
            // Don't auto-clear ingredients - let user decide
            // Just show the base recipe information
            
            // Load base recipe data only if yield is empty
            if (!document.getElementById('recipeYield').value) {
                document.getElementById('recipeYield').value = baseRecipe.yield;
            }
            
            // Show base recipe cost information
            showBaseCostInfo(baseRecipe);
            
            // Show suggestion to load ingredients
            const suggestion = document.createElement('div');
            suggestion.id = 'loadIngredientsSuggestion';
            suggestion.className = 'bg-yellow-50 p-3 rounded-lg mb-3 border border-yellow-200';
            suggestion.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-sm font-medium text-yellow-800">üí° ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</div>
                        <div class="text-xs text-yellow-600 mt-1">‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="loadBaseIngredients()" class="bg-yellow-500 text-white px-3 py-1 rounded text-xs hover:bg-yellow-600">‡πÇ‡∏´‡∏•‡∏î</button>
                        <button onclick="removeSuggestion()" class="bg-gray-400 text-white px-3 py-1 rounded text-xs hover:bg-gray-500">‡πÑ‡∏°‡πà</button>
                    </div>
                </div>
            `;
            
            // Remove existing suggestion
            const existingSuggestion = document.getElementById('loadIngredientsSuggestion');
            if (existingSuggestion) existingSuggestion.remove();
            
            // Insert suggestion after base cost display
            const baseCostDisplay = document.getElementById('baseCostDisplay');
            if (baseCostDisplay) {
                baseCostDisplay.parentNode.insertBefore(suggestion, baseCostDisplay.nextSibling);
            }
        }

        function loadBaseIngredients() {
            const baseRecipeId = document.getElementById('baseRecipe').value;
            const baseRecipe = recipes.find(r => r.id == baseRecipeId);
            if (!baseRecipe) return;
            
            // Clear existing ingredients except the first row
            const container = document.getElementById('recipeIngredients');
            const ingredientRows = container.querySelectorAll('.ingredient-row');
            ingredientRows.forEach((row, index) => {
                if (index > 0) row.remove();
            });
            
            // Load ingredients
            baseRecipe.ingredients.forEach((ingredient, index) => {
                let row;
                if (index === 0) {
                    // Use first existing row
                    row = ingredientRows[0];
                } else {
                    // Create new rows
                    addIngredientRow();
                    row = container.lastElementChild;
                }
                
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                select.value = ingredient.name;
                amountInput.value = ingredient.amount;
            });
            
            // Remove suggestion
            removeSuggestion();
        }

        function removeSuggestion() {
            const suggestion = document.getElementById('loadIngredientsSuggestion');
            if (suggestion) suggestion.remove();
        }

        function showBaseCostInfo(baseRecipe) {
            // Remove existing base cost display
            const existingDisplay = document.getElementById('baseCostDisplay');
            if (existingDisplay) existingDisplay.remove();
            
            // Create base cost display
            const baseCostDiv = document.createElement('div');
            baseCostDiv.id = 'baseCostDisplay';
            baseCostDiv.className = 'bg-green-50 p-3 rounded-lg mb-3 border border-green-200';
            baseCostDiv.innerHTML = `
                <h4 class="font-medium text-green-800 mb-2">üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4>
                <div class="text-sm text-green-700">
                    <div class="flex justify-between">
                        <span>‡∏™‡∏π‡∏ï‡∏£: ${baseRecipe.name}</span>
                        <span>‡πÑ‡∏î‡πâ: ${baseRecipe.yield} ‡∏ä‡∏¥‡πâ‡∏ô</span>
                    </div>
                    <div class="flex justify-between font-medium">
                        <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°:</span>
                        <span>${baseRecipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between font-medium text-green-800">
                        <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô:</span>
                        <span>${baseRecipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏¥‡πâ‡∏ô</span>
                    </div>
                </div>
                <p class="text-xs text-green-600 mt-2">üí° ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏£‡∏ß‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
            `;
            
            // Insert after base recipe selection
            const baseRecipeContainer = document.querySelector('#baseRecipe').parentElement;
            baseRecipeContainer.parentNode.insertBefore(baseCostDiv, baseRecipeContainer.nextSibling);
        }

        function clearAllIngredients() {
            const container = document.getElementById('recipeIngredients');
            const ingredientRows = container.querySelectorAll('.ingredient-row');
            
            // Remove all rows except the first one
            ingredientRows.forEach((row, index) => {
                if (index > 0) row.remove();
            });
            
            // Clear the first row
            const firstRow = ingredientRows[0];
            firstRow.querySelector('.ingredient-select').value = '';
            firstRow.querySelector('.ingredient-amount').value = '';
        }

        function addIngredientRow() {
            const container = document.getElementById('recipeIngredients');
            const newRow = document.createElement('div');
            newRow.className = 'ingredient-row flex gap-2';
            newRow.innerHTML = `
                <select class="ingredient-select flex-1 p-2 border rounded">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                    ${inventory.map(item => `<option value="${item.name}">${item.name} (${item.unit})</option>`).join('')}
                </select>
                <input type="number" class="ingredient-amount w-24 p-2 border rounded" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                <button onclick="this.parentElement.remove()" class="bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600">-</button>
            `;
            container.appendChild(newRow);
        }

        function createRecipe() {
            const name = document.getElementById('recipeName').value;
            const category = document.getElementById('recipeCategory').value;
            const yield = parseFloat(document.getElementById('recipeYield').value);
            const baseRecipeId = document.getElementById('baseRecipe').value;
            
            if (!name || !yield) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ');
                return;
            }

            const ingredientRows = document.querySelectorAll('.ingredient-row');
            const ingredients = [];
            let additionalCost = 0;
            let baseCost = 0;
            let baseRecipe = null;
            let costBreakdown = [];

            // Calculate base recipe cost if selected
            if (baseRecipeId) {
                baseRecipe = recipes.find(r => r.id == baseRecipeId);
                if (baseRecipe) {
                    // Calculate base cost proportionally based on yield
                    const yieldRatio = yield / baseRecipe.yield;
                    baseCost = baseRecipe.totalCost * yieldRatio;
                }
            }

            // Calculate additional ingredients cost using inventory unit prices
            ingredientRows.forEach(row => {
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                if (select.value && amountInput.value) {
                    const item = inventory.find(i => i.name === select.value);
                    if (!item) {
                        alert(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö "${select.value}" ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á`);
                        return;
                    }
                    
                    const amount = parseFloat(amountInput.value);
                    // Use unitPrice from inventory (price per unit)
                    const cost = amount * item.unitPrice;
                    
                    ingredients.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                    additionalCost += cost;
                    
                    // Add to cost breakdown for detailed display
                    costBreakdown.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                }
            });

            // For base recipe usage, we need at least the base recipe OR additional ingredients
            if (!baseRecipe && ingredients.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }

            const totalCost = baseCost + additionalCost;
            const costPerUnit = totalCost / yield;

            const newRecipe = {
                id: Date.now(),
                name,
                category: category || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
                yield,
                ingredients,
                additionalCost,
                baseCost,
                baseRecipeId: baseRecipeId || null,
                baseRecipeName: baseRecipe ? baseRecipe.name : null,
                totalCost,
                costPerUnit,
                created: new Date().toLocaleDateString('th-TH')
            };

            recipes.push(newRecipe);
            localStorage.setItem('bakery_recipes', JSON.stringify(recipes));
            updateRecipesList();
            
            // Clear form
            clearRecipeForm();
            
            // Show detailed success message with cost breakdown
            let message = `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£ "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n`;
            
            if (baseRecipe) {
                message += `üìã ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseRecipe.name}\n`;
                message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            if (costBreakdown.length > 0) {
                message += `üßÇ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:\n`;
                costBreakdown.forEach(item => {
                    message += `‚Ä¢ ${item.name}: ${item.amount} ${item.unit} √ó ${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó = ${item.cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                });
                message += `\nüí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏£‡∏ß‡∏°: ${additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            message += `üìä ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üìà ‡πÑ‡∏î‡πâ: ${yield} ‡∏ä‡∏¥‡πâ‡∏ô`;
            
            alert(message);
        }

        function clearRecipeForm() {
            document.getElementById('recipeName').value = '';
            document.getElementById('recipeCategory').value = '';
            document.getElementById('recipeYield').value = '';
            document.getElementById('baseRecipe').value = '';
            
            // Remove base cost display
            const baseCostDisplay = document.getElementById('baseCostDisplay');
            if (baseCostDisplay) baseCostDisplay.remove();
            
            // Remove suggestion
            removeSuggestion();
            
            // Clear ingredients
            document.querySelectorAll('.ingredient-row').forEach((row, index) => {
                if (index > 0) row.remove();
            });
            document.querySelector('.ingredient-select').value = '';
            document.querySelector('.ingredient-amount').value = '';
        }

        // Recipe filtering and view functions
        function filterRecipes(category) {
            currentRecipeFilter = category;
            
            // Update filter button styles
            document.querySelectorAll('.recipe-filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-purple-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-purple-500', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            applyRecipeFilter();
        }

        function toggleRecipeView(viewType) {
            currentRecipeView = viewType;
            
            // Update view button styles
            document.querySelectorAll('#compactViewBtn, #detailedViewBtn').forEach(btn => {
                btn.classList.remove('bg-purple-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            if (viewType === 'compact') {
                document.getElementById('compactViewBtn').classList.add('bg-purple-500', 'text-white');
                document.getElementById('compactViewBtn').classList.remove('bg-gray-200', 'text-gray-700');
            } else {
                document.getElementById('detailedViewBtn').classList.add('bg-purple-500', 'text-white');
                document.getElementById('detailedViewBtn').classList.remove('bg-gray-200', 'text-gray-700');
            }
            
            updateRecipesList();
        }

        function applyRecipeFilter() {
            if (currentRecipeFilter === 'all') {
                filteredRecipes = [...recipes];
            } else {
                filteredRecipes = recipes.filter(recipe => 
                    recipe.category === currentRecipeFilter
                );
            }
            
            updateRecipesList();
        }

        function updateRecipesList() {
            const list = document.getElementById('recipesList');
            const countElement = document.getElementById('recipesCount');
            
            // Update count
            countElement.textContent = filteredRecipes.length;
            
            if (recipes.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö<br>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            if (filteredRecipes.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-lg mb-2">üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</div>
                        <div class="text-sm">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏î‡∏π</div>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = filteredRecipes.map(recipe => {
                if (currentRecipeView === 'compact') {
                    return renderCompactRecipe(recipe);
                } else {
                    return renderDetailedRecipe(recipe);
                }
            }).join('');
        }

        function renderCompactRecipe(recipe) {
            const categoryIcon = getCategoryIcon(recipe.category);
            
            return `
                <div class="p-3 border rounded-lg bg-purple-50 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-lg">${categoryIcon}</span>
                                <div class="font-medium text-lg">${recipe.name}</div>
                                <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">${recipe.category}</span>
                            </div>
                            <div class="flex items-center gap-4 text-sm text-gray-600">
                                <span>üìà ‡πÑ‡∏î‡πâ ${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                                <span class="font-medium text-green-600">üí∞ ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                                <span class="text-purple-600">üìä ‡∏£‡∏ß‡∏° ${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                        </div>
                        <div class="flex gap-1 ml-4">
                            <button onclick="viewRecipeDetails(${recipe.id})" class="text-purple-500 hover:text-purple-700 text-xs px-2 py-1 bg-white rounded border">üëÅÔ∏è</button>
                            <button onclick="copyRecipe(${recipe.id})" class="text-blue-500 hover:text-blue-700 text-xs px-2 py-1 bg-white rounded border">üìã</button>
                            <button onclick="editRecipe(${recipe.id})" class="text-green-500 hover:text-green-700 text-xs px-2 py-1 bg-white rounded border">‚úèÔ∏è</button>
                            <button onclick="removeRecipe(${recipe.id})" class="text-red-500 hover:text-red-700 text-xs px-2 py-1 bg-white rounded border">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDetailedRecipe(recipe) {
            const categoryIcon = getCategoryIcon(recipe.category);
            
            // Create detailed cost breakdown display
            let costBreakdown = '';
            
            // Show base recipe cost if exists
            if (recipe.baseRecipeName && recipe.baseCost > 0) {
                costBreakdown = `
                    <div class="text-xs text-blue-600 mt-1">
                        üìã ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${recipe.baseRecipeName} (${recipe.baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó)
                    </div>
                `;
            }
            
            // Show ingredients breakdown
            if (recipe.ingredients && recipe.ingredients.length > 0) {
                costBreakdown += `
                    <div class="text-xs text-orange-600 mt-1">
                        üßÇ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:
                    </div>
                    <div class="text-xs text-gray-600 ml-2">
                `;
                
                recipe.ingredients.forEach(ingredient => {
                    const unitPrice = ingredient.unitPrice || 0;
                    const cost = ingredient.cost || (ingredient.amount * unitPrice);
                    costBreakdown += `
                        <div class="flex justify-between">
                            <span>‚Ä¢ ${ingredient.name} ${ingredient.amount} ${ingredient.unit}</span>
                            <span>${cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    `;
                });
                
                costBreakdown += `</div>`;
                
                if (recipe.additionalCost > 0) {
                    costBreakdown += `
                        <div class="text-xs text-orange-600 mt-1">
                            ‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö: ${recipe.additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó
                        </div>
                    `;
                }
            }
            
            return `
                <div class="p-3 border rounded-lg bg-purple-50">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xl">${categoryIcon}</span>
                        <div class="font-medium text-lg">${recipe.name}</div>
                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">${recipe.category}</span>
                    </div>
                    <div class="text-sm text-gray-600">‡πÑ‡∏î‡πâ ${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ | ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏° ${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    <div class="text-sm text-green-600 font-medium">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    ${costBreakdown}
                    <div class="text-xs text-gray-500 mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${recipe.created}</div>
                    <div class="mt-2 flex gap-2">
                        <button onclick="viewRecipeDetails(${recipe.id})" class="text-purple-500 hover:text-purple-700 text-sm">üëÅÔ∏è ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                        <button onclick="copyRecipe(${recipe.id})" class="text-blue-500 hover:text-blue-700 text-sm">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
                        <button onclick="editRecipe(${recipe.id})" class="text-green-500 hover:text-green-700 text-sm">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button onclick="removeRecipe(${recipe.id})" class="text-red-500 hover:text-red-700 text-sm">üóëÔ∏è ‡∏•‡∏ö‡∏™‡∏π‡∏ï‡∏£</button>
                    </div>
                </div>
            `;
        }

        function getCategoryIcon(category) {
            const icons = {
                '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á': 'üçû',
                '‡πÇ‡∏î‡∏ô‡∏±‡∏ó': 'üç©',
                '‡πÄ‡∏Ñ‡πâ‡∏Å': 'üéÇ',
                '‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ': 'üç™',
                '‡∏°‡∏±‡∏ü‡∏ü‡∏¥‡∏ô': 'üßÅ',
                '‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á': 'ü•ê',
                '‡∏û‡∏≤‡∏¢': 'ü•ß',
                '‡∏Ç‡∏ô‡∏°‡πÑ‡∏ó‡∏¢': 'üçÆ',
                '‡∏≠‡∏∑‡πà‡∏ô‡πÜ': 'üç∞'
            };
            return icons[category] || 'üç∞';
        }

        function updateRecipeOptions() {
            const selects = document.querySelectorAll('.ingredient-select');
            const options = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>' + 
                inventory.map(item => `<option value="${item.name}">${item.name} (${item.unit})</option>`).join('');
            selects.forEach(select => select.innerHTML = options);
            
            // Update base recipe options
            const baseRecipeSelect = document.getElementById('baseRecipe');
            baseRecipeSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</option>' + 
                recipes.map(recipe => `<option value="${recipe.id}">${recipe.name} (${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢)</option>`).join('');
            
            // Initialize filtered recipes and update display
            filteredRecipes = [...recipes];
            updateRecipesList();
        }

        function copyRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            // Reset form to create mode
            resetRecipeForm();
            
            // Fill form with recipe data (with "‡∏™‡∏≥‡πÄ‡∏ô‡∏≤" prefix)
            document.getElementById('recipeName').value = `‡∏™‡∏≥‡πÄ‡∏ô‡∏≤ ${recipe.name}`;
            document.getElementById('recipeCategory').value = recipe.category || '';
            document.getElementById('recipeYield').value = recipe.yield;
            
            // Set base recipe if exists
            if (recipe.baseRecipeId) {
                document.getElementById('baseRecipe').value = recipe.baseRecipeId;
                // Trigger base recipe loading to show cost info
                loadBaseRecipe();
            }
            
            // Clear existing ingredients except first row
            clearAllIngredients();
            
            // Load ingredients
            const container = document.getElementById('recipeIngredients');
            recipe.ingredients.forEach((ingredient, index) => {
                let row;
                if (index === 0) {
                    row = container.querySelector('.ingredient-row');
                } else {
                    addIngredientRow();
                    row = container.lastElementChild;
                }
                
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                select.value = ingredient.name;
                amountInput.value = ingredient.amount;
            });
            
            // Scroll to form
            document.getElementById('recipes').scrollIntoView({ behavior: 'smooth' });
        }

        function editRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            editingRecipeId = id;
            
            // Switch to edit mode
            document.getElementById('createRecipeBtn').classList.add('hidden');
            document.getElementById('updateRecipeBtn').classList.remove('hidden');
            document.getElementById('cancelEditBtn').classList.remove('hidden');
            
            // Fill form with recipe data
            document.getElementById('recipeName').value = recipe.name;
            document.getElementById('recipeCategory').value = recipe.category || '';
            document.getElementById('recipeYield').value = recipe.yield;
            
            // Set base recipe if exists
            if (recipe.baseRecipeId) {
                document.getElementById('baseRecipe').value = recipe.baseRecipeId;
                // Trigger base recipe loading to show cost info
                loadBaseRecipe();
            } else {
                document.getElementById('baseRecipe').value = '';
            }
            
            // Clear existing ingredients except first row
            clearAllIngredients();
            
            // Load ingredients
            const container = document.getElementById('recipeIngredients');
            recipe.ingredients.forEach((ingredient, index) => {
                let row;
                if (index === 0) {
                    row = container.querySelector('.ingredient-row');
                } else {
                    addIngredientRow();
                    row = container.lastElementChild;
                }
                
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                select.value = ingredient.name;
                amountInput.value = ingredient.amount;
            });
            
            // Scroll to form
            document.getElementById('recipes').scrollIntoView({ behavior: 'smooth' });
        }

        function updateRecipe() {
            if (!editingRecipeId) return;
            
            const name = document.getElementById('recipeName').value;
            const category = document.getElementById('recipeCategory').value;
            const yield = parseFloat(document.getElementById('recipeYield').value);
            const baseRecipeId = document.getElementById('baseRecipe').value;
            
            if (!name || !yield) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ');
                return;
            }

            const ingredientRows = document.querySelectorAll('.ingredient-row');
            const ingredients = [];
            let additionalCost = 0;
            let baseCost = 0;
            let baseRecipe = null;
            let costBreakdown = [];

            // Calculate base recipe cost if selected
            if (baseRecipeId) {
                baseRecipe = recipes.find(r => r.id == baseRecipeId);
                if (baseRecipe) {
                    // Calculate base cost proportionally based on yield
                    const yieldRatio = yield / baseRecipe.yield;
                    baseCost = baseRecipe.totalCost * yieldRatio;
                }
            }

            // Calculate additional ingredients cost using inventory unit prices
            ingredientRows.forEach(row => {
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                if (select.value && amountInput.value) {
                    const item = inventory.find(i => i.name === select.value);
                    if (!item) {
                        alert(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö "${select.value}" ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á`);
                        return;
                    }
                    
                    const amount = parseFloat(amountInput.value);
                    // Use unitPrice from inventory (price per unit)
                    const cost = amount * item.unitPrice;
                    
                    ingredients.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                    additionalCost += cost;
                    
                    // Add to cost breakdown for detailed display
                    costBreakdown.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                }
            });

            // For base recipe usage, we need at least the base recipe OR additional ingredients
            if (!baseRecipe && ingredients.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }

            const totalCost = baseCost + additionalCost;
            const costPerUnit = totalCost / yield;

            // Update the recipe
            const recipeIndex = recipes.findIndex(r => r.id === editingRecipeId);
            if (recipeIndex !== -1) {
                recipes[recipeIndex] = {
                    ...recipes[recipeIndex],
                    name,
                    category: category || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
                    yield,
                    ingredients,
                    additionalCost,
                    baseCost,
                    baseRecipeId: baseRecipeId || null,
                    baseRecipeName: baseRecipe ? baseRecipe.name : null,
                    totalCost,
                    costPerUnit,
                    updated: new Date().toLocaleDateString('th-TH')
                };

                localStorage.setItem('bakery_recipes', JSON.stringify(recipes));
                updateRecipesList();
                resetRecipeForm();
                
                // Show detailed success message with cost breakdown
                let message = `‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏π‡∏ï‡∏£ "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n`;
                
                if (baseRecipe) {
                    message += `üìã ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseRecipe.name}\n`;
                    message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
                }
                
                if (costBreakdown.length > 0) {
                    message += `üßÇ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:\n`;
                    costBreakdown.forEach(item => {
                        message += `‚Ä¢ ${item.name}: ${item.amount} ${item.unit} √ó ${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó = ${item.cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                    });
                    message += `\nüí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏£‡∏ß‡∏°: ${additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
                }
                
                message += `üìä ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                message += `üìà ‡πÑ‡∏î‡πâ: ${yield} ‡∏ä‡∏¥‡πâ‡∏ô`;
                
                alert(message);
            }
        }

        function cancelEdit() {
            resetRecipeForm();
        }

        function resetRecipeForm() {
            editingRecipeId = null;
            
            // Switch back to create mode
            document.getElementById('createRecipeBtn').classList.remove('hidden');
            document.getElementById('updateRecipeBtn').classList.add('hidden');
            document.getElementById('cancelEditBtn').classList.add('hidden');
            
            // Clear form
            clearRecipeForm();
        }

        function viewRecipeDetails(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            const categoryIcon = getCategoryIcon(recipe.category);
            let message = `${categoryIcon} ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏ï‡∏£: ${recipe.name}\n`;
            message += `üè∑Ô∏è ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ${recipe.category}\n`;
            message += `üìà ‡πÑ‡∏î‡πâ: ${recipe.yield} ‡∏ä‡∏¥‡πâ‡∏ô\n\n`;
            
            // Show base recipe if exists
            if (recipe.baseRecipeName && recipe.baseCost > 0) {
                message += `üìã ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${recipe.baseRecipeName}\n`;
                message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${recipe.baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            // Show ingredients details
            if (recipe.ingredients && recipe.ingredients.length > 0) {
                message += `üßÇ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:\n`;
                recipe.ingredients.forEach(ingredient => {
                    const unitPrice = ingredient.unitPrice || 0;
                    const cost = ingredient.cost || (ingredient.amount * unitPrice);
                    message += `‚Ä¢ ${ingredient.name}: ${ingredient.amount} ${ingredient.unit}\n`;
                    message += `  ‡∏£‡∏≤‡∏Ñ‡∏≤: ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${ingredient.unit} √ó ${ingredient.amount} = ${cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                });
                message += `\nüí∞ ‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö: ${recipe.additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            message += `üìä ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            message += `üìÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${recipe.created}`;
            
            if (recipe.updated) {
                message += `\nüìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${recipe.updated}`;
            }
            
            alert(message);
        }

        function removeRecipe(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ?')) {
                recipes = recipes.filter(recipe => recipe.id !== id);
                localStorage.setItem('bakery_recipes', JSON.stringify(recipes));
                updateRecipesList();
                updateRecipeOptions(); // Update base recipe options
            }
        }

        // Sales Management
        function updateSalesOptions() {
            const select = document.getElementById('saleProduct');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>' + 
                recipes.map(recipe => {
                    const stock = productStock[recipe.name] || 0;
                    return `<option value="${recipe.name}" data-cost="${recipe.costPerUnit}">${recipe.name} (‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢)</option>`;
                }).join('');
            updateSalesHistory();
            updateTodaySummary();
            updateProductStock();
        }

        function updateSaleInfo() {
            const productName = document.getElementById('saleProduct').value;
            const productInfo = document.getElementById('productInfo');
            const productDetails = document.getElementById('productDetails');
            const stockAdjustment = document.getElementById('stockAdjustment');
            
            if (!productName) {
                productInfo.classList.add('hidden');
                stockAdjustment.classList.add('hidden');
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            const stock = productStock[productName] || 0;
            
            if (!recipe) return;
            
            productInfo.classList.remove('hidden');
            stockAdjustment.classList.remove('hidden');
            
            // Get today's production for this product
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => 
                p.productionDate === today && p.recipeName === productName
            );
            const todayProduced = todayProductions.reduce((sum, p) => sum + p.quantity, 0);
            
            productDetails.innerHTML = `
                <div class="space-y-1">
                    <div><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${recipe.name}</div>
                    <div><strong>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</strong> ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    <div class="text-blue-600"><strong>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å:</strong> ${stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    ${todayProduced > 0 ? `<div class="text-green-600"><strong>‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</strong> ${todayProduced} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>` : ''}
                </div>
            `;
            
            // Clear previous calculations
            document.getElementById('actualStock').value = '';
            document.getElementById('saleQuantity').value = '';
            document.getElementById('remainingStock').value = '';
            document.getElementById('salePrice').value = '';
            document.getElementById('saleCalculation').classList.add('hidden');
            document.getElementById('stockAdjustmentInfo').classList.add('hidden');
            document.getElementById('recordSaleBtn').disabled = true;
            document.getElementById('adjustStockBtn').disabled = true;
        }

        function calculateStockAdjustment() {
            const productName = document.getElementById('saleProduct').value;
            const actualStock = parseFloat(document.getElementById('actualStock').value);
            const stockAdjustmentInfo = document.getElementById('stockAdjustmentInfo');
            const adjustStockBtn = document.getElementById('adjustStockBtn');
            
            if (!productName || isNaN(actualStock) || actualStock < 0) {
                stockAdjustmentInfo.classList.add('hidden');
                adjustStockBtn.disabled = true;
                return;
            }
            
            const currentStock = productStock[productName] || 0;
            const difference = actualStock - currentStock;
            
            // Get today's production for calculation
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => 
                p.productionDate === today && p.recipeName === productName
            );
            const todayProduced = todayProductions.reduce((sum, p) => sum + p.quantity, 0);
            
            // Calculate sold quantity (produced today - remaining)
            const soldToday = Math.max(0, todayProduced - actualStock);
            
            stockAdjustmentInfo.classList.remove('hidden');
            
            if (difference === 0) {
                stockAdjustmentInfo.innerHTML = `
                    <div class="text-gray-600">‚úÖ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
                `;
                adjustStockBtn.disabled = true;
            } else {
                let calculationText = '';
                if (todayProduced > 0) {
                    calculationText = `
                        <div class="text-blue-700">üìä ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</div>
                        <div class="text-blue-600">‚Ä¢ ‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: ${todayProduced} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                        <div class="text-blue-600">‚Ä¢ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á: ${actualStock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                        <div class="text-green-600 font-medium">‚Ä¢ ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: ${soldToday} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                        <div class="mt-1 pt-1 border-t border-blue-200">
                    `;
                }
                
                if (difference > 0) {
                    calculationText += `<div class="text-green-600">üìà ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å: +${difference} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>`;
                } else {
                    calculationText += `<div class="text-red-600">üìâ ‡∏•‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${difference} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>`;
                }
                
                if (todayProduced > 0) {
                    calculationText += `</div>`;
                }
                
                stockAdjustmentInfo.innerHTML = calculationText;
                adjustStockBtn.disabled = false;
            }
        }

        function adjustStock() {
            const productName = document.getElementById('saleProduct').value;
            const actualStock = parseFloat(document.getElementById('actualStock').value);
            
            if (!productName || isNaN(actualStock) || actualStock < 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á');
                return;
            }
            
            const currentStock = productStock[productName] || 0;
            const difference = actualStock - currentStock;
            
            // Get today's production for automatic sale recording
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => 
                p.productionDate === today && p.recipeName === productName
            );
            const todayProduced = todayProductions.reduce((sum, p) => sum + p.quantity, 0);
            
            // Calculate sold quantity if there was production today
            const soldToday = Math.max(0, todayProduced - actualStock);
            
            // Update stock
            productStock[productName] = actualStock;
            
            // If there was production today and items were sold, record the sale automatically
            if (soldToday > 0) {
                const recipe = recipes.find(r => r.name === productName);
                if (recipe) {
                    // Use a default selling price (2x cost) for automatic sale recording
                    const defaultSellingPrice = recipe.costPerUnit * 2;
                    const totalRevenue = soldToday * defaultSellingPrice;
                    const totalCost = soldToday * recipe.costPerUnit;
                    const profit = totalRevenue - totalCost;
                    
                    // Record the automatic sale
                    sales.push({
                        id: Date.now(),
                        productName,
                        quantity: soldToday,
                        salePrice: defaultSellingPrice,
                        totalRevenue,
                        totalCost,
                        profit,
                        date: new Date().toLocaleDateString('th-TH'),
                        time: new Date().toLocaleTimeString('th-TH'),
                        autoGenerated: true,
                        note: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å'
                    });
                    
                    localStorage.setItem('bakery_sales', JSON.stringify(sales));
                }
            }
            
            localStorage.setItem('bakery_product_stock', JSON.stringify(productStock));
            
            // Update displays
            updateSaleInfo();
            updateProductStock();
            updateSalesHistory();
            updateTodaySummary();
            updateSalesOptions();
            
            // Show success message
            let message = `‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å ${productName} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n`;
            message += `‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà: ${actualStock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢\n`;
            
            if (difference > 0) {
                message += `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å: +${difference} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`;
            } else if (difference < 0) {
                message += `‡∏•‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${difference} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`;
            }
            
            if (soldToday > 0) {
                message += `\n\nüìä ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:\n`;
                message += `‚Ä¢ ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ${soldToday} ‡∏´‡∏ô‡πà‡∏ß‡∏¢\n`;
                message += `‚Ä¢ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢: ${(recipe.costPerUnit * 2).toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢\n`;
                message += `‚Ä¢ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: ${(soldToday * recipe.costPerUnit * 2).toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                message += `‚Ä¢ ‡∏Å‡∏≥‡πÑ‡∏£: ${(soldToday * recipe.costPerUnit).toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
            }
            
            alert(message);
        }

        function calculateFromRemaining() {
            const productName = document.getElementById('saleProduct').value;
            const remainingStock = parseFloat(document.getElementById('remainingStock').value);
            
            if (!productName || isNaN(remainingStock) || remainingStock < 0) {
                return;
            }
            
            const currentStock = productStock[productName] || 0;
            
            // Get today's production for this product
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => 
                p.productionDate === today && p.recipeName === productName
            );
            const todayProduced = todayProductions.reduce((sum, p) => sum + p.quantity, 0);
            
            // Calculate sold quantity
            let soldQuantity = 0;
            
            if (todayProduced > 0) {
                // If produced today, calculate from production
                soldQuantity = Math.max(0, todayProduced - remainingStock);
            } else {
                // If no production today, calculate from current stock
                soldQuantity = Math.max(0, currentStock - remainingStock);
            }
            
            // Update the sale quantity field
            document.getElementById('saleQuantity').value = soldQuantity;
            
            // Trigger calculation
            calculateSaleTotal();
        }

        function calculateSaleTotal() {
            const productName = document.getElementById('saleProduct').value;
            const quantity = parseFloat(document.getElementById('saleQuantity').value);
            const salePrice = parseFloat(document.getElementById('salePrice').value);
            const saleCalculation = document.getElementById('saleCalculation');
            const saleDetails = document.getElementById('saleDetails');
            const recordSaleBtn = document.getElementById('recordSaleBtn');
            
            if (!productName || !quantity || !salePrice || quantity <= 0 || salePrice <= 0) {
                saleCalculation.classList.add('hidden');
                recordSaleBtn.disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            const stock = productStock[productName] || 0;
            
            if (!recipe) return;
            
            // Check if enough stock
            if (quantity > stock) {
                saleCalculation.classList.remove('hidden');
                saleDetails.innerHTML = `
                    <div class="text-red-600 font-medium">‚ö†Ô∏è ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠!</div>
                    <div class="text-red-600 text-sm">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£: ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ | ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà: ${stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                `;
                recordSaleBtn.disabled = true;
                return;
            }
            
            const totalRevenue = quantity * salePrice;
            const totalCost = quantity * recipe.costPerUnit;
            const profit = totalRevenue - totalCost;
            const profitMargin = ((profit / totalRevenue) * 100).toFixed(1);
            
            saleCalculation.classList.remove('hidden');
            saleDetails.innerHTML = `
                <div class="space-y-1">
                    <div class="flex justify-between">
                        <span>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢:</span>
                        <span class="font-medium">${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between">
                        <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</span>
                        <span>${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between border-t pt-1">
                        <span>‡∏Å‡∏≥‡πÑ‡∏£:</span>
                        <span class="font-bold ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">${profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between">
                        <span>‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</span>
                        <span class="text-sm">${(profit / quantity).toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between">
                        <span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£:</span>
                        <span class="text-sm">${profitMargin}%</span>
                    </div>
                    <div class="text-blue-600 text-sm mt-2">
                        ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${stock - quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢
                    </div>
                </div>
            `;
            
            recordSaleBtn.disabled = false;
        }

        function recordSale() {
            const productName = document.getElementById('saleProduct').value;
            const quantity = parseFloat(document.getElementById('saleQuantity').value);
            const salePrice = parseFloat(document.getElementById('salePrice').value);

            if (!productName || !quantity || !salePrice) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            const recipe = recipes.find(r => r.name === productName);
            const stock = productStock[productName] || 0;

            if (!recipe) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }

            if (quantity > stock) {
                alert(`‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠! ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ${stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`);
                return;
            }

            const totalRevenue = quantity * salePrice;
            const totalCost = quantity * recipe.costPerUnit;
            const profit = totalRevenue - totalCost;

            // Deduct from stock
            productStock[productName] = stock - quantity;

            sales.push({
                id: Date.now(),
                productName,
                quantity,
                salePrice,
                totalRevenue,
                totalCost,
                profit,
                date: new Date().toLocaleDateString('th-TH'),
                time: new Date().toLocaleTimeString('th-TH')
            });

            localStorage.setItem('bakery_sales', JSON.stringify(sales));
            localStorage.setItem('bakery_product_stock', JSON.stringify(productStock));
            
            updateSalesHistory();
            updateTodaySummary();
            updateProductStock();
            updateSalesOptions(); // Update stock display in dropdown
            
            // Clear form
            document.getElementById('saleQuantity').value = '';
            document.getElementById('remainingStock').value = '';
            document.getElementById('salePrice').value = '';
            document.getElementById('saleCalculation').classList.add('hidden');
            document.getElementById('recordSaleBtn').disabled = true;
            
            alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
                  `‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${productName}\n` +
                  `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢\n` +
                  `‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: ${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏Å‡∏≥‡πÑ‡∏£: ${profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${productStock[productName]} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`);
        }

        function updateProductStock() {
            const list = document.getElementById('productStock');
            
            if (recipes.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>';
                return;
            }
            
            list.innerHTML = recipes.map(recipe => {
                const stock = productStock[recipe.name] || 0;
                const lowStock = stock < 5; // Warning when stock is less than 5
                
                return `
                    <div class="flex justify-between items-center p-2 rounded ${lowStock ? 'bg-red-100' : 'bg-blue-100'}">
                        <div>
                            <div class="font-medium text-sm">${recipe.name}</div>
                            <div class="text-xs text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold ${lowStock ? 'text-red-600' : 'text-blue-600'}">${stock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                            ${lowStock ? '<div class="text-red-500 text-xs">‚ö†Ô∏è ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div>' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateSalesHistory() {
            const list = document.getElementById('salesHistory');
            
            if (sales.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>';
                return;
            }
            
            const recentSales = sales.slice(-10).reverse();
            list.innerHTML = recentSales.map(sale => `
                <div class="p-3 border rounded-lg ${sale.autoGenerated ? 'bg-blue-50 border-blue-200' : 'bg-pink-50'}">
                    <div class="flex justify-between items-start">
                        <div class="font-medium">${sale.productName}</div>
                        ${sale.autoGenerated ? '<div class="text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded">ü§ñ ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>' : ''}
                    </div>
                    <div class="text-sm text-gray-600">${sale.quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ √ó ${sale.salePrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó = ${sale.totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    <div class="text-sm ${sale.profit > 0 ? 'text-green-600' : 'text-red-600'} font-medium">‡∏Å‡∏≥‡πÑ‡∏£: ${sale.profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    ${sale.note ? `<div class="text-xs text-blue-600 mt-1">${sale.note}</div>` : ''}
                    <div class="text-xs text-gray-500">${sale.date} ${sale.time}</div>
                </div>
            `).join('');
        }

        function updateTodaySummary() {
            const today = new Date().toLocaleDateString('th-TH');
            const todayISO = new Date().toISOString().split('T')[0];
            
            // ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            const todaySales = sales.filter(sale => sale.date === today);
            const totalRevenue = todaySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            
            // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            const todayProductions = productions.filter(p => p.productionDate === todayISO);
            const totalProductionCost = todayProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            
            // ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ = ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
            const netProfit = totalRevenue - totalProductionCost;
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            document.getElementById('todayRevenue').textContent = totalRevenue.toFixed(2) + ' ‡∏ö‡∏≤‡∏ó';
            document.getElementById('todayProductionCost').textContent = totalProductionCost.toFixed(2) + ' ‡∏ö‡∏≤‡∏ó';
            
            const netProfitElement = document.getElementById('todayNetProfit');
            netProfitElement.textContent = netProfit.toFixed(2) + ' ‡∏ö‡∏≤‡∏ó';
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô
            if (netProfit > 0) {
                netProfitElement.className = 'font-bold text-green-600';
            } else if (netProfit < 0) {
                netProfitElement.className = 'font-bold text-red-600';
            } else {
                netProfitElement.className = 'font-bold text-gray-600';
            }
        }

        // Reports Management
        function initializeReports() {
            // Set default dates
            const today = new Date();
            document.getElementById('dailyReportDate').value = today.toISOString().split('T')[0];
            
            const year = today.getFullYear();
            const week = getWeekNumber(today);
            document.getElementById('weeklyReportWeek').value = `${year}-W${week.toString().padStart(2, '0')}`;
            
            const month = today.toISOString().slice(0, 7);
            document.getElementById('monthlyReportMonth').value = month;
            
            // Show daily report by default
            showReport('daily');
        }

        function showReport(reportType) {
            // Hide all reports
            document.querySelectorAll('.report-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected report
            document.getElementById(`${reportType}Report`).classList.remove('hidden');
            
            // Update button styles
            document.querySelectorAll('.report-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2');
            });
            event.target.classList.add('ring-2', 'ring-offset-2');
            
            // Generate report
            if (reportType === 'daily') generateDailyReport();
            if (reportType === 'weekly') generateWeeklyReport();
            if (reportType === 'monthly') generateMonthlyReport();
        }

        function generateDailyReport() {
            const selectedDate = document.getElementById('dailyReportDate').value;
            if (!selectedDate) return;
            
            const dateStr = new Date(selectedDate).toLocaleDateString('th-TH');
            const dailySales = sales.filter(sale => sale.date === dateStr);
            const dailyProductions = productions.filter(p => p.productionDate === selectedDate);
            
            // Calculate statistics
            const totalRevenue = dailySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const totalProfit = dailySales.reduce((sum, sale) => sum + sale.profit, 0);
            const totalCost = dailySales.reduce((sum, sale) => sum + sale.totalCost, 0);
            const totalItems = dailySales.reduce((sum, sale) => sum + sale.quantity, 0);
            const productionCost = dailyProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥
            const netProfit = totalRevenue - productionCost;
            
            // Display statistics
            const statsDiv = document.getElementById('dailyStats');
            statsDiv.innerHTML = `
                <div class="space-y-3">
                    <div class="p-3 bg-green-100 rounded-lg">
                        <div class="text-sm text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                        <div class="text-xl font-bold text-green-800">${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-orange-100 rounded-lg">
                        <div class="text-sm text-orange-700">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                        <div class="text-xl font-bold text-orange-800">${productionCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 ${netProfit >= 0 ? 'bg-green-100' : 'bg-red-100'} rounded-lg border-2 ${netProfit >= 0 ? 'border-green-300' : 'border-red-300'}">
                        <div class="text-sm ${netProfit >= 0 ? 'text-green-700' : 'text-red-700'}">
                            ${netProfit >= 0 ? 'üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'}
                        </div>
                        <div class="text-xl font-bold ${netProfit >= 0 ? 'text-green-800' : 'text-red-800'}">${netProfit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'} mt-1">
                            ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
                        </div>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <div class="text-sm text-purple-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</div>
                        <div class="text-xl font-bold text-purple-800">${totalItems} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    </div>
                    <div class="p-3 bg-blue-100 rounded-lg">
                        <div class="text-sm text-blue-700">‡∏Å‡∏≥‡πÑ‡∏£‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
                        <div class="text-xl font-bold text-blue-800">${totalProfit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs text-blue-600 mt-1">
                            ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                        </div>
                    </div>
                </div>
            `;
            
            // Top products
            const productSales = {};
            dailySales.forEach(sale => {
                if (productSales[sale.productName]) {
                    productSales[sale.productName].quantity += sale.quantity;
                    productSales[sale.productName].revenue += sale.totalRevenue;
                } else {
                    productSales[sale.productName] = {
                        quantity: sale.quantity,
                        revenue: sale.totalRevenue
                    };
                }
            });
            
            const topProducts = Object.entries(productSales)
                .sort((a, b) => b[1].quantity - a[1].quantity)
                .slice(0, 5);
            
            const topProductsDiv = document.getElementById('dailyTopProducts');
            if (topProducts.length === 0) {
                topProductsDiv.innerHTML = '<div class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>';
            } else {
                topProductsDiv.innerHTML = topProducts.map((product, index) => `
                    <div class="flex justify-between items-center p-2 bg-white rounded border">
                        <div>
                            <div class="font-medium">${index + 1}. ${product[0]}</div>
                            <div class="text-sm text-gray-600">${product[1].revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-blue-600">${product[1].quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function generateWeeklyReport() {
            const selectedWeek = document.getElementById('weeklyReportWeek').value;
            if (!selectedWeek) return;
            
            const [year, week] = selectedWeek.split('-W');
            const weekStart = getDateOfWeek(parseInt(year), parseInt(week));
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            // Filter sales for the week
            const weeklySales = sales.filter(sale => {
                const saleDate = parseThaiDate(sale.date);
                return saleDate >= weekStart && saleDate <= weekEnd;
            });
            
            const totalRevenue = weeklySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const totalProfit = weeklySales.reduce((sum, sale) => sum + sale.profit, 0);
            const totalItems = weeklySales.reduce((sum, sale) => sum + sale.quantity, 0);
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
            const weeklyProductions = productions.filter(p => {
                const prodDate = new Date(p.productionDate);
                return prodDate >= weekStart && prodDate <= weekEnd;
            });
            const totalProductionCost = weeklyProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            const netProfit = totalRevenue - totalProductionCost;
            
            // Display statistics
            const statsDiv = document.getElementById('weeklyStats');
            statsDiv.innerHTML = `
                <div class="space-y-3">
                    <div class="p-3 bg-green-100 rounded-lg">
                        <div class="text-sm text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                        <div class="text-xl font-bold text-green-800">${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-orange-100 rounded-lg">
                        <div class="text-sm text-orange-700">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                        <div class="text-xl font-bold text-orange-800">${totalProductionCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 ${netProfit >= 0 ? 'bg-green-100' : 'bg-red-100'} rounded-lg border-2 ${netProfit >= 0 ? 'border-green-300' : 'border-red-300'}">
                        <div class="text-sm ${netProfit >= 0 ? 'text-green-700' : 'text-red-700'}">
                            ${netProfit >= 0 ? 'üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'}
                        </div>
                        <div class="text-xl font-bold ${netProfit >= 0 ? 'text-green-800' : 'text-red-800'}">${netProfit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <div class="text-sm text-purple-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</div>
                        <div class="text-xl font-bold text-purple-800">${totalItems} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    </div>
                    <div class="p-3 bg-gray-100 rounded-lg">
                        <div class="text-sm text-gray-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</div>
                        <div class="text-xl font-bold text-gray-800">${(totalRevenue / 7).toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                </div>
            `;
            
            // Daily analysis within week
            const dailyAnalysis = {};
            const days = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
            
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(weekStart);
                currentDate.setDate(currentDate.getDate() + i);
                const dateStr = currentDate.toLocaleDateString('th-TH');
                const dayName = days[currentDate.getDay()];
                
                const daySales = weeklySales.filter(sale => sale.date === dateStr);
                const dayRevenue = daySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
                
                dailyAnalysis[dayName] = {
                    date: dateStr,
                    revenue: dayRevenue,
                    items: daySales.reduce((sum, sale) => sum + sale.quantity, 0)
                };
            }
            
            const dayAnalysisDiv = document.getElementById('weeklyDayAnalysis');
            dayAnalysisDiv.innerHTML = Object.entries(dailyAnalysis).map(([day, data]) => `
                <div class="flex justify-between items-center p-2 bg-white rounded border">
                    <div>
                        <div class="font-medium">${day}</div>
                        <div class="text-xs text-gray-500">${data.date}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-teal-600">${data.revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-sm text-gray-600">${data.items} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    </div>
                </div>
            `).join('');
        }

        function generateMonthlyReport() {
            const selectedMonth = document.getElementById('monthlyReportMonth').value;
            if (!selectedMonth) return;
            
            const [year, month] = selectedMonth.split('-');
            const monthStart = new Date(parseInt(year), parseInt(month) - 1, 1);
            const monthEnd = new Date(parseInt(year), parseInt(month), 0);
            
            // Filter sales for the month
            const monthlySales = sales.filter(sale => {
                const saleDate = parseThaiDate(sale.date);
                return saleDate >= monthStart && saleDate <= monthEnd;
            });
            
            const totalRevenue = monthlySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const totalProfit = monthlySales.reduce((sum, sale) => sum + sale.profit, 0);
            const totalItems = monthlySales.reduce((sum, sale) => sum + sale.quantity, 0);
            const daysInMonth = monthEnd.getDate();
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
            const monthlyProductions = productions.filter(p => {
                const prodDate = new Date(p.productionDate);
                return prodDate >= monthStart && prodDate <= monthEnd;
            });
            const totalProductionCost = monthlyProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            const netProfit = totalRevenue - totalProductionCost;
            
            // Display statistics
            const statsDiv = document.getElementById('monthlyStats');
            statsDiv.innerHTML = `
                <div class="space-y-3">
                    <div class="p-3 bg-green-100 rounded-lg">
                        <div class="text-sm text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                        <div class="text-xl font-bold text-green-800">${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-orange-100 rounded-lg">
                        <div class="text-sm text-orange-700">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                        <div class="text-xl font-bold text-orange-800">${totalProductionCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 ${netProfit >= 0 ? 'bg-green-100' : 'bg-red-100'} rounded-lg border-2 ${netProfit >= 0 ? 'border-green-300' : 'border-red-300'}">
                        <div class="text-sm ${netProfit >= 0 ? 'text-green-700' : 'text-red-700'}">
                            ${netProfit >= 0 ? 'üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'}
                        </div>
                        <div class="text-xl font-bold ${netProfit >= 0 ? 'text-green-800' : 'text-red-800'}">${netProfit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <div class="text-sm text-purple-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</div>
                        <div class="text-xl font-bold text-purple-800">${totalItems} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    </div>
                    <div class="p-3 bg-gray-100 rounded-lg">
                        <div class="text-sm text-gray-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</div>
                        <div class="text-xl font-bold text-gray-800">${(totalRevenue / daysInMonth).toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                </div>
            `;
            
            // Monthly trends
            const weeklyTrends = {};
            for (let week = 1; week <= 5; week++) {
                weeklyTrends[`‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà ${week}`] = {
                    revenue: 0,
                    items: 0
                };
            }
            
            monthlySales.forEach(sale => {
                const saleDate = parseThaiDate(sale.date);
                const weekOfMonth = Math.ceil(saleDate.getDate() / 7);
                const weekKey = `‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà ${weekOfMonth}`;
                
                if (weeklyTrends[weekKey]) {
                    weeklyTrends[weekKey].revenue += sale.totalRevenue;
                    weeklyTrends[weekKey].items += sale.quantity;
                }
            });
            
            const trendsDiv = document.getElementById('monthlyTrends');
            trendsDiv.innerHTML = Object.entries(weeklyTrends).map(([week, data]) => `
                <div class="flex justify-between items-center p-2 bg-white rounded border">
                    <div class="font-medium">${week}</div>
                    <div class="text-right">
                        <div class="font-bold text-teal-600">${data.revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-sm text-gray-600">${data.items} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    </div>
                </div>
            `).join('');
            
            // Customer analysis (simplified)
            const productAnalysis = {};
            monthlySales.forEach(sale => {
                if (productAnalysis[sale.productName]) {
                    productAnalysis[sale.productName].quantity += sale.quantity;
                    productAnalysis[sale.productName].revenue += sale.totalRevenue;
                    productAnalysis[sale.productName].profit += sale.profit;
                } else {
                    productAnalysis[sale.productName] = {
                        quantity: sale.quantity,
                        revenue: sale.totalRevenue,
                        profit: sale.profit
                    };
                }
            });
            
            const topProducts = Object.entries(productAnalysis)
                .sort((a, b) => b[1].revenue - a[1].revenue)
                .slice(0, 5);
            
            // Cost Analysis Report
            const costAnalysisDiv = document.getElementById('costAnalysisReport');
            const profitMargin = totalRevenue > 0 ? ((netProfit / totalRevenue) * 100).toFixed(1) : '0';
            const avgDailyProduction = totalProductionCost / daysInMonth;
            const avgDailySales = totalRevenue / daysInMonth;
            
            costAnalysisDiv.innerHTML = `
                <div class="p-3 bg-white rounded border">
                    <h5 class="font-medium text-red-800 mb-2">üí∞ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h5>
                    <div class="text-2xl font-bold ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'}">${profitMargin}%</div>
                    <div class="text-xs text-gray-600 mt-1">
                        ${netProfit >= 0 ? '‡∏Å‡∏≥‡πÑ‡∏£' : '‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô'} ${Math.abs(netProfit).toFixed(2)} ‡∏ö‡∏≤‡∏ó
                    </div>
                </div>
                <div class="p-3 bg-white rounded border">
                    <h5 class="font-medium text-red-800 mb-2">üìà ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</h5>
                    <div class="text-2xl font-bold text-orange-600">${avgDailyProduction.toFixed(2)}</div>
                    <div class="text-xs text-gray-600 mt-1">‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô</div>
                </div>
                <div class="p-3 bg-white rounded border">
                    <h5 class="font-medium text-red-800 mb-2">üíµ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</h5>
                    <div class="text-2xl font-bold text-green-600">${avgDailySales.toFixed(2)}</div>
                    <div class="text-xs text-gray-600 mt-1">‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô</div>
                </div>
            `;
            
            const customerAnalysisDiv = document.getElementById('customerAnalysis');
            customerAnalysisDiv.innerHTML = `
                <div>
                    <h4 class="font-medium text-purple-800 mb-3">üèÜ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ Top 5</h4>
                    <div class="space-y-2">
                        ${topProducts.map((product, index) => `
                            <div class="p-3 bg-white rounded border">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-medium">${index + 1}. ${product[0]}</div>
                                        <div class="text-sm text-gray-600">‡∏Å‡∏≥‡πÑ‡∏£: ${product[1].profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-purple-600">${product[1].revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                        <div class="text-sm text-gray-600">${product[1].quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div>
                    <h4 class="font-medium text-purple-800 mb-3">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</h4>
                    <div class="space-y-2 text-sm">
                        <div class="p-2 bg-white rounded">
                            <strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:</strong> ${topProducts[0] ? topProducts[0][0] : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
                        </div>
                        <div class="p-2 bg-white rounded">
                            <strong>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</strong> ${monthlySales.length > 0 ? (totalRevenue / monthlySales.length).toFixed(2) : '0'} ‡∏ö‡∏≤‡∏ó
                        </div>
                        <div class="p-2 bg-white rounded">
                            <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${monthlySales.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </div>
                        <div class="p-2 bg-white rounded ${netProfit >= 0 ? 'bg-green-50' : 'bg-red-50'}">
                            <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> 
                            <span class="${netProfit >= 0 ? 'text-green-600' : 'text-red-600'} font-medium">
                                ${netProfit >= 0 ? 'üìà ‡∏°‡∏µ‡∏Å‡∏≥‡πÑ‡∏£' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô'} ${Math.abs(netProfit).toFixed(2)} ‡∏ö‡∏≤‡∏ó
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Helper functions for date calculations
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function getDateOfWeek(year, week) {
            const simple = new Date(year, 0, 1 + (week - 1) * 7);
            const dow = simple.getDay();
            const ISOweekStart = simple;
            if (dow <= 4) {
                ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);
            } else {
                ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());
            }
            return ISOweekStart;
        }

        function parseThaiDate(thaiDateStr) {
            // Convert Thai date string back to Date object
            const parts = thaiDateStr.split('/');
            if (parts.length === 3) {
                // Assuming format is DD/MM/YYYY (Thai format)
                const day = parseInt(parts[0]);
                const month = parseInt(parts[1]) - 1; // Month is 0-indexed
                const year = parseInt(parts[2]) - 543; // Convert from Buddhist to Gregorian year
                return new Date(year, month, day);
            }
            return new Date();
        }

        // Cost Analysis Management
        function updateFixedCosts() {
            const rent = parseFloat(document.getElementById('rentCost').value) || 0;
            const utility = parseFloat(document.getElementById('utilityCost').value) || 0;
            const labor = parseFloat(document.getElementById('laborCost').value) || 0;
            const other = parseFloat(document.getElementById('otherFixedCost').value) || 0;
            
            fixedCosts = {
                rent,
                utility,
                labor,
                other,
                total: rent + utility + labor + other,
                updated: new Date().toLocaleDateString('th-TH')
            };
            
            localStorage.setItem('bakery_fixed_costs', JSON.stringify(fixedCosts));
            updateCostAnalysis();
            
            alert(`‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°: ${fixedCosts.total.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`);
        }

        function updateCostAnalysis() {
            // Load fixed costs form
            if (fixedCosts.rent !== undefined) {
                document.getElementById('rentCost').value = fixedCosts.rent;
                document.getElementById('utilityCost').value = fixedCosts.utility;
                document.getElementById('laborCost').value = fixedCosts.labor;
                document.getElementById('otherFixedCost').value = fixedCosts.other;
            }
            
            // Update total fixed cost display
            const totalFixedCost = fixedCosts.total || 0;
            document.getElementById('totalFixedCost').textContent = totalFixedCost.toFixed(2) + ' ‡∏ö‡∏≤‡∏ó';
            
            // Variable costs per product
            const variableCostsList = document.getElementById('variableCostsList');
            if (recipes.length === 0) {
                variableCostsList.innerHTML = '<div class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>';
            } else {
                variableCostsList.innerHTML = recipes.map(recipe => `
                    <div class="flex justify-between items-center py-1">
                        <span>${recipe.name}</span>
                        <span class="font-medium">${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                    </div>
                `).join('');
            }
            
            // Break-even analysis
            const breakEvenAnalysis = document.getElementById('breakEvenAnalysis');
            if (recipes.length === 0 || totalFixedCost === 0) {
                breakEvenAnalysis.innerHTML = '<div class="text-gray-500">‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>';
            } else {
                const analysisHtml = recipes.map(recipe => {
                    // Assume selling price is 2x cost (100% markup) for break-even calculation
                    const assumedSellingPrice = recipe.costPerUnit * 2;
                    const contributionMargin = assumedSellingPrice - recipe.costPerUnit;
                    const breakEvenUnits = contributionMargin > 0 ? Math.ceil(totalFixedCost / contributionMargin) : '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ';
                    const breakEvenRevenue = breakEvenUnits !== '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ' ? (breakEvenUnits * assumedSellingPrice).toFixed(2) : '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ';
                    
                    return `
                        <div class="border-b pb-2 mb-2">
                            <div class="font-medium">${recipe.name}</div>
                            <div class="text-xs space-y-1">
                                <div>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                <div>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏™‡∏°‡∏°‡∏ï‡∏¥ (2x): ${assumedSellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                <div>‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${contributionMargin.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                <div class="font-medium text-green-700">‡∏à‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°‡∏ó‡∏∏‡∏ô: ${breakEvenUnits} ‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                                <div class="font-medium text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏Ñ‡∏∏‡πâ‡∏°‡∏ó‡∏∏‡∏ô: ${breakEvenRevenue} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                breakEvenAnalysis.innerHTML = `
                    <div class="text-xs text-green-600 mb-2">üí° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ 2 ‡πÄ‡∏ó‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</div>
                    ${analysisHtml}
                `;
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date for production
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('productionDate').value = today;
            
            // Show inventory section by default
            showSection('inventory');
            
            // Initialize filters
            filteredInventory = [...inventory];
            filteredRecipes = [...recipes];
            
            // Update all displays
            updateInventoryDisplay();
            updatePurchaseOptions();
            updateRecipeOptions();
            updateProductionOptions();
            updateSalesOptions();
            updateCostAnalysis();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a5a2aaa14dc8d7',t:'MTc1NDM4OTk5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
