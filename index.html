<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bakery Pro - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 via-purple-50 to-pink-100 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="bg-gradient-to-r from-orange-500 to-amber-500 rounded-xl shadow-lg p-6 mb-6 text-white">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold mb-2">üßÅ Bakery Pro</h1>
                    <p class="text-orange-100">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</p>
                </div>
                <div class="hidden sm:block text-right">
                    <div class="text-sm text-orange-100">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div>
                    <div class="text-lg font-semibold" id="currentDate"></div>
                </div>
            </div>
        </div>

        <!-- Navigation Dropdown -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-6">
            <div class="relative">
                <button onclick="toggleNavDropdown()" class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg hover:from-orange-600 hover:to-amber-600 transition-all duration-200">
                    <div class="flex items-center gap-3">
                        <span class="text-xl" id="currentSectionIcon">üì¶</span>
                        <div>
                            <div class="font-semibold text-lg" id="currentSectionName">‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                            <div class="text-sm opacity-90" id="currentSectionCategory">üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</div>
                        </div>
                    </div>
                    <svg class="w-6 h-6 transform transition-transform duration-200" id="dropdownArrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                
                <!-- Dropdown Menu -->
                <div id="navDropdown" class="hidden absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl border border-gray-200 z-50 max-h-96 overflow-y-auto">
                    <!-- ‡∏´‡∏°‡∏ß‡∏î 1: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö -->
                    <div class="border-b border-gray-100">
                        <div class="px-4 py-3 bg-gradient-to-r from-blue-50 to-green-50">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-gradient-to-r from-blue-400 to-green-400 rounded-full"></div>
                                <h3 class="font-semibold text-gray-800">üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
                            </div>
                        </div>
                        <div class="p-2">
                            <button onclick="selectSection('inventory', 'üì¶', '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö')" class="nav-dropdown-btn w-full flex items-center gap-3 p-3 rounded-lg hover:bg-blue-50 transition-colors text-left">
                                <span class="text-xl">üì¶</span>
                                <div>
                                    <div class="font-medium text-gray-800">‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                                    <div class="text-xs text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å</div>
                                </div>
                            </button>
                            <button onclick="selectSection('purchase', 'üõí', '‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á', 'üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö')" class="nav-dropdown-btn w-full flex items-center gap-3 p-3 rounded-lg hover:bg-green-50 transition-colors text-left">
                                <span class="text-xl">üõí</span>
                                <div>
                                    <div class="font-medium text-gray-800">‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á</div>
                                    <div class="text-xs text-gray-600">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</div>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- ‡∏´‡∏°‡∏ß‡∏î 2: ‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤ -->
                    <div class="border-b border-gray-100">
                        <div class="px-4 py-3 bg-gradient-to-r from-purple-50 to-yellow-50">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-gradient-to-r from-purple-400 to-yellow-400 rounded-full"></div>
                                <h3 class="font-semibold text-gray-800">üìã ‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤</h3>
                            </div>
                        </div>
                        <div class="p-2">
                            <button onclick="selectSection('recipes', 'üìã', '‡∏™‡∏π‡∏ï‡∏£', 'üìã ‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤')" class="nav-dropdown-btn w-full flex items-center gap-3 p-3 rounded-lg hover:bg-purple-50 transition-colors text-left">
                                <span class="text-xl">üìã</span>
                                <div>
                                    <div class="font-medium text-gray-800">‡∏™‡∏π‡∏ï‡∏£</div>
                                    <div class="text-xs text-gray-600">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</div>
                                </div>
                            </button>
                            <button onclick="selectSection('pricing', 'üí≤', '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢', 'üìã ‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤')" class="nav-dropdown-btn w-full flex items-center gap-3 p-3 rounded-lg hover:bg-yellow-50 transition-colors text-left">
                                <span class="text-xl">üí≤</span>
                                <div>
                                    <div class="font-medium text-gray-800">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</div>
                                    <div class="text-xs text-gray-600">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£</div>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- ‡∏´‡∏°‡∏ß‡∏î 3: ‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏¢ -->
                    <div class="border-b border-gray-100">
                        <div class="px-4 py-3 bg-gradient-to-r from-indigo-50 to-pink-50">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-gradient-to-r from-indigo-400 to-pink-400 rounded-full"></div>
                                <h3 class="font-semibold text-gray-800">üè™ ‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏¢</h3>
                            </div>
                        </div>
                        <div class="p-2">
                            <button onclick="selectSection('production', 'üè≠', '‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï', 'üè™ ‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏¢')" class="nav-dropdown-btn w-full flex items-center gap-3 p-3 rounded-lg hover:bg-indigo-50 transition-colors text-left">
                                <span class="text-xl">üè≠</span>
                                <div>
                                    <div class="font-medium text-gray-800">‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                                    <div class="text-xs text-gray-600">‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</div>
                                </div>
                            </button>
                            <button onclick="selectSection('sales', 'üí∞', '‡∏Ç‡∏≤‡∏¢', 'üè™ ‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏¢')" class="nav-dropdown-btn w-full flex items-center gap-3 p-3 rounded-lg hover:bg-pink-50 transition-colors text-left">
                                <span class="text-xl">üí∞</span>
                                <div>
                                    <div class="font-medium text-gray-800">‡∏Ç‡∏≤‡∏¢</div>
                                    <div class="text-xs text-gray-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£</div>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- ‡∏´‡∏°‡∏ß‡∏î 4: ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô -->
                    <div>
                        <div class="px-4 py-3 bg-gradient-to-r from-teal-50 to-cyan-50">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-gradient-to-r from-teal-400 to-cyan-400 rounded-full"></div>
                                <h3 class="font-semibold text-gray-800">üíº ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
                            </div>
                        </div>
                        <div class="p-2">
                            <button onclick="selectSection('expenses', 'üíº', '‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà', 'üíº ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô')" class="nav-dropdown-btn w-full flex items-center gap-3 p-3 rounded-lg hover:bg-teal-50 transition-colors text-left">
                                <span class="text-xl">üíº</span>
                                <div>
                                    <div class="font-medium text-gray-800">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</div>
                                    <div class="text-xs text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥ ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ</div>
                                </div>
                            </button>
                            <button onclick="selectSection('reports', 'üìä', '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'üíº ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô')" class="nav-dropdown-btn w-full flex items-center gap-3 p-3 rounded-lg hover:bg-teal-50 transition-colors text-left">
                                <span class="text-xl">üìä</span>
                                <div>
                                    <div class="font-medium text-gray-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
                                    <div class="text-xs text-gray-600">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£</div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Section -->
        <div id="inventory" class="section bg-gradient-to-br from-blue-100 to-indigo-200 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg p-4 mb-6 shadow-md">
                <h2 class="text-xl sm:text-2xl font-bold mb-2">üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                <p class="text-blue-100">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà -->
                <div class="bg-blue-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-blue-800 border-b border-blue-200 pb-2">
                        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà
                    </h3>
                    <div class="space-y-4">
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-2">üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4>
                            <input type="text" id="itemName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏≠‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå)" class="w-full p-3 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                        </div>
                        
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ -->
                        <div class="bg-white p-4 rounded-lg border border-blue-200">
                            <h4 class="font-medium text-blue-800 mb-3 text-sm">üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ (1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠)</h4>
                            
                            <div class="space-y-3 sm:grid sm:grid-cols-2 sm:gap-3 sm:space-y-0 mb-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</label>
                                    <input type="number" id="packageQuantity" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1000" class="w-full p-2 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                                    <select id="packageUnit" class="w-full p-2 border rounded-lg text-sm" onchange="calculateUnitPrice()">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢</option>
                                        <option value="‡∏Å‡∏£‡∏±‡∏°">‡∏Å‡∏£‡∏±‡∏° (‡∏Å)</option>
                                        <option value="‡∏Å‡∏Å">‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏° (‡∏Å‡∏Å)</option>
                                        <option value="‡∏°‡∏•">‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏•‡∏¥‡∏ï‡∏£ (‡∏°‡∏•)</option>
                                        <option value="‡∏•‡∏¥‡∏ï‡∏£">‡∏•‡∏¥‡∏ï‡∏£ (‡∏•)</option>
                                        <option value="‡∏ä‡πâ‡∏≠‡∏ô‡πÇ‡∏ï‡πä‡∏∞">‡∏ä‡πâ‡∏≠‡∏ô‡πÇ‡∏ï‡πä‡∏∞ (tbsp)</option>
                                        <option value="‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤">‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤ (tsp)</option>
                                        <option value="‡∏ñ‡πâ‡∏ß‡∏¢">‡∏ñ‡πâ‡∏ß‡∏¢‡∏ï‡∏ß‡∏á (cup)</option>
                                        <option value="‡∏ü‡∏≠‡∏á">‡∏ü‡∏≠‡∏á (‡πÑ‡∏Ç‡πà)</option>
                                        <option value="‡∏ä‡∏¥‡πâ‡∏ô">‡∏ä‡∏¥‡πâ‡∏ô</option>
                                        <option value="‡πÅ‡∏û‡πá‡∏Ñ">‡πÅ‡∏û‡πá‡∏Ñ</option>
                                        <option value="‡∏Ç‡∏ß‡∏î">‡∏Ç‡∏ß‡∏î</option>
                                        <option value="‡∏ã‡∏≠‡∏á">‡∏ã‡∏≠‡∏á</option>
                                        <option value="‡∏Å‡∏•‡πà‡∏≠‡∏á">‡∏Å‡∏•‡πà‡∏≠‡∏á</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="block text-xs font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</label>
                                <input type="number" id="packagePrice" placeholder="‡πÄ‡∏ä‡πà‡∏ô 39" class="w-full p-2 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                                <p class="text-xs text-blue-600 mt-1">üí° ‡πÄ‡∏ä‡πà‡∏ô: ‡πÅ‡∏õ‡πâ‡∏á 1 ‡∏ñ‡∏∏‡∏á 1000 ‡∏Å‡∏£‡∏±‡∏° ‡∏£‡∏≤‡∏Ñ‡∏≤ 39 ‡∏ö‡∏≤‡∏ó</p>
                            </div>
                            
                            <!-- Price Calculation Display -->
                            <div id="priceCalculation" class="hidden p-3 bg-green-100 rounded-lg border border-green-300">
                                <h5 class="font-medium text-green-800 mb-2 text-sm">üí∞ ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</h5>
                                <div id="calculationText" class="text-xs text-green-700"></div>
                                <div id="unitPriceResult" class="text-sm font-bold text-green-800 mt-2"></div>
                            </div>
                        </div>
                        
                        <!-- ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô -->
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-2">üìä ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</h4>
                            <input type="number" id="initialStock" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5 (‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á 5 ‡∏ñ‡∏∏‡∏á)" class="w-full p-3 border rounded-lg text-sm" oninput="calculateUnitPrice()">
                            <p class="text-xs text-gray-500 mt-1">‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</p>
                        </div>
                        
                        <button onclick="addInventoryItem()" id="addItemBtn" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 disabled:bg-gray-400 text-sm font-medium" disabled>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</button>
                    </div>
                </div>
                
                <!-- ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô -->
                <div class="bg-white rounded-lg p-4 border-2 border-blue-100">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                        <h3 class="text-lg font-semibold text-gray-800">
                            üìã ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                        </h3>
                        <div class="text-sm text-gray-600">
                            <span id="inventoryCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </div>
                    </div>
                    
                    <!-- Search and Filter Section -->
                    <div class="mb-4 space-y-3">
                        <!-- Search Box -->
                        <div class="relative">
                            <input type="text" id="inventorySearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö... (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏õ‡πâ‡∏á, ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•, ‡πÑ‡∏Ç‡πà)" 
                                   class="w-full p-3 pl-10 border rounded-lg text-sm bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   oninput="searchInventory()">
                            <div class="absolute left-3 top-3 text-gray-400">
                                üîç
                            </div>
                            <button onclick="clearInventorySearch()" id="clearSearchBtn" 
                                    class="absolute right-3 top-3 text-gray-400 hover:text-gray-600 hidden">
                                ‚úï
                            </button>
                        </div>
                        
                        <!-- Quick Filters -->
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterInventory('all')" class="filter-btn active px-3 py-1 rounded-full text-xs bg-blue-500 text-white hover:bg-blue-600">
                                ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterInventory('low-stock')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                ‚ö†Ô∏è ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterInventory('powder')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üåæ ‡πÅ‡∏õ‡πâ‡∏á/‡∏ú‡∏á
                            </button>
                            <button onclick="filterInventory('liquid')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                ü•õ ‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß
                            </button>
                            <button onclick="filterInventory('dairy')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üßà ‡∏ô‡∏°/‡πÄ‡∏ô‡∏¢
                            </button>
                            <button onclick="filterInventory('sweet')" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üçØ ‡∏´‡∏ß‡∏≤‡∏ô
                            </button>
                        </div>
                        
                        <!-- Sort Options -->
                        <div class="flex items-center gap-2 text-sm">
                            <span class="text-gray-600">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°:</span>
                            <select id="inventorySort" onchange="sortInventory()" class="px-2 py-1 border rounded text-xs bg-white">
                                <option value="name-asc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Å-‡∏Æ)</option>
                                <option value="name-desc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Æ-‡∏Å)</option>
                                <option value="stock-low">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ô‡πâ‡∏≠‡∏¢-‡∏°‡∏≤‡∏Å</option>
                                <option value="stock-high">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏°‡∏≤‡∏Å-‡∏ô‡πâ‡∏≠‡∏¢</option>
                                <option value="updated-new">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                                <option value="updated-old">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                            </select>
                        </div>
                        
                        <!-- Search Suggestions -->
                        <div id="searchSuggestions" class="hidden">
                            <div class="text-xs text-gray-600 mb-2">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:</div>
                            <div id="suggestionsList" class="flex flex-wrap gap-1">
                                <!-- Suggestions will be shown here -->
                            </div>
                        </div>
                        
                        <!-- Search Results Info -->
                        <div id="searchResults" class="hidden text-sm text-blue-600 bg-blue-50 p-2 rounded">
                            <!-- Search results info will be shown here -->
                        </div>
                    </div>
                    
                    <div id="inventoryList" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Inventory items will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Purchase Section -->
        <div id="purchase" class="section bg-gradient-to-br from-green-100 to-emerald-200 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg p-4 mb-6 shadow-md">
                <h2 class="text-xl sm:text-2xl font-bold mb-2">üõí ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á</h2>
                <p class="text-green-100">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö -->
                <div class="bg-green-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-green-800 border-b border-green-200 pb-2">
                        üõçÔ∏è ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
                    </h3>
                    <div class="space-y-4">
                        <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</label>
                            <select id="purchaseItem" class="w-full p-3 border rounded-lg text-sm" onchange="updatePurchaseInfo()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                            </select>
                        </div>
                        
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ -->
                        <div id="purchaseInfo" class="hidden bg-white p-4 rounded-lg border border-green-200">
                            <h4 class="font-medium text-green-800 mb-3 text-sm">üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</h4>
                            <div id="packageDetails" class="text-sm text-green-700 mb-3">
                                <!-- Package details will be shown here -->
                            </div>
                            
                            <div class="space-y-3 sm:grid sm:grid-cols-2 sm:gap-3 sm:space-y-0">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠ (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠)</label>
                                    <input type="number" id="purchaseQuantity" placeholder="‡πÄ‡∏ä‡πà‡∏ô 3" class="w-full p-2 border rounded-lg text-sm" oninput="calculatePurchaseConversion()">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</label>
                                    <div class="p-2 border rounded-lg bg-gray-50 flex items-center">
                                        <span id="purchaseUnitDisplay" class="text-gray-600 text-sm">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Conversion Display -->
                            <div id="purchaseConversion" class="hidden mt-3 p-3 bg-blue-100 rounded-lg border border-blue-300">
                                <h5 class="font-medium text-blue-800 mb-2 text-sm">üîÑ ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢</h5>
                                <div id="conversionCalculation" class="text-xs text-blue-700"></div>
                                <div id="totalQuantityResult" class="text-sm font-bold text-blue-800 mt-2"></div>
                                <div id="totalCostResult" class="text-sm font-medium text-green-800 mt-1"></div>
                            </div>
                        </div>
                        
                        <!-- ‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                            <input type="text" id="supplier" placeholder="‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢" class="w-full p-3 border rounded-lg text-sm">
                        </div>
                        
                        <button onclick="makePurchase()" id="makePurchaseBtn" class="w-full bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 disabled:bg-gray-400 text-sm font-medium" disabled>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
                    </div>
                </div>
                
                <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ -->
                <div class="bg-white rounded-lg p-4 border-2 border-green-100">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
                        üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠
                    </h3>
                    <div id="purchaseHistory" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Purchase history will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Production Section -->
        <div id="production" class="section bg-gradient-to-br from-indigo-100 to-purple-200 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg p-4 mb-6 shadow-md">
                <h2 class="text-xl sm:text-2xl font-bold mb-2">üè≠ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</h2>
                <p class="text-indigo-100">‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï -->
                <div class="bg-indigo-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-indigo-800 border-b border-indigo-200 pb-2">
                        üìã ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
                    </h3>
                    <div class="space-y-3">
                        <input type="date" id="productionDate" class="w-full p-3 border rounded-lg text-sm" value="">
                        
                        <!-- Recipe Search and Filter -->
                        <div class="space-y-3">
                            <!-- Category Filter -->
                            <div class="flex flex-wrap gap-2">
                                <button onclick="filterProductionRecipes('all')" class="production-recipe-filter-btn active px-3 py-1 rounded-full text-xs bg-indigo-500 text-white hover:bg-indigo-600">
                                    ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                                </button>
                                <button onclick="filterProductionRecipes('‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á')" class="production-recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                    üçû ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á
                                </button>
                                <button onclick="filterProductionRecipes('‡πÇ‡∏î‡∏ô‡∏±‡∏ó')" class="production-recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                    üç© ‡πÇ‡∏î‡∏ô‡∏±‡∏ó
                                </button>
                                <button onclick="filterProductionRecipes('‡πÄ‡∏Ñ‡πâ‡∏Å')" class="production-recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                    üéÇ ‡πÄ‡∏Ñ‡πâ‡∏Å
                                </button>
                                <button onclick="filterProductionRecipes('‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ')" class="production-recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                    üç™ ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ
                                </button>
                                <button onclick="filterProductionRecipes('‡∏≠‡∏∑‡πà‡∏ô‡πÜ')" class="production-recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                    üç∞ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                                </button>
                            </div>
                            
                            <!-- Recipe Search -->
                            <div class="relative">
                                <input type="text" id="productionRecipeSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏π‡∏ï‡∏£... (‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï, ‡∏ß‡∏ô‡∏¥‡∏•‡∏•‡∏≤, ‡∏Ñ‡∏£‡∏µ‡∏°)" 
                                       class="w-full p-3 pl-10 border rounded-lg text-sm bg-white shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
                                       oninput="searchProductionRecipes()" 
                                       onfocus="showProductionRecipeDropdown()"
                                       onblur="hideProductionRecipeDropdown()">
                                <div class="absolute left-3 top-3 text-gray-400">
                                    üîç
                                </div>
                                <button onclick="clearProductionRecipeSearch()" id="clearProductionSearchBtn" 
                                        class="absolute right-3 top-3 text-gray-400 hover:text-gray-600 hidden">
                                    ‚úï
                                </button>
                                
                                <!-- Recipe Dropdown -->
                                <div id="productionRecipeDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-64 overflow-y-auto">
                                    <div id="productionRecipeList" class="p-2">
                                        <!-- Recipe options will be shown here -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Selected Recipe Display -->
                            <div id="selectedRecipeDisplay" class="hidden bg-indigo-50 p-3 rounded-lg border border-indigo-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium text-indigo-800" id="selectedRecipeName"></div>
                                        <div class="text-sm text-indigo-600" id="selectedRecipeDetails"></div>
                                    </div>
                                    <button onclick="clearSelectedRecipe()" class="text-indigo-500 hover:text-indigo-700 p-1">
                                        ‚úï
                                    </button>
                                </div>
                            </div>
                        </div>
                        <input type="number" id="productionQuantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï" class="w-full p-3 border rounded-lg text-sm" oninput="calculateIngredientNeeds()">
                        
                        <div id="ingredientNeeds" class="hidden bg-white p-4 rounded-lg border border-indigo-200">
                            <h4 class="font-semibold text-indigo-800 mb-2 text-sm">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ:</h4>
                            <div id="ingredientsList" class="space-y-2 mb-3">
                                <!-- Ingredients needed will be shown here -->
                            </div>
                            <div id="stockCheck" class="text-sm">
                                <!-- Stock availability check will be shown here -->
                            </div>
                        </div>
                        
                        <button onclick="startProduction()" id="startProductionBtn" class="w-full bg-indigo-500 text-white p-3 rounded-lg hover:bg-indigo-600 disabled:bg-gray-400 text-sm font-medium" disabled>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</button>
                    </div>
                    
                    <div class="mt-6 p-4 bg-white rounded-lg border border-indigo-200">
                        <h4 class="font-semibold text-indigo-800 mb-2 text-sm">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                        <div id="todayProduction" class="space-y-1">
                            <!-- Today's production summary will be shown here -->
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï -->
                <div class="bg-white rounded-lg p-4 border-2 border-indigo-100">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
                        üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
                    </h3>
                    <div id="productionHistory" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Production history will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Recipes Section -->
        <div id="recipes" class="section bg-gradient-to-br from-purple-100 to-pink-200 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg p-4 mb-6 shadow-md">
                <h2 class="text-xl sm:text-2xl font-bold mb-2">üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h2>
                <p class="text-purple-100">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà -->
                <div class="bg-purple-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-purple-800 border-b border-purple-200 pb-2">
                        ‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà
                    </h3>
                    <div class="space-y-4">
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏π‡∏ï‡∏£</label>
                                <input type="text" id="recipeName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï" class="w-full p-3 border rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                                <select id="recipeCategory" class="w-full p-3 border rounded-lg text-sm">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                                    <option value="‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á">üçû ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á</option>
                                    <option value="‡πÇ‡∏î‡∏ô‡∏±‡∏ó">üç© ‡πÇ‡∏î‡∏ô‡∏±‡∏ó</option>
                                    <option value="‡πÄ‡∏Ñ‡πâ‡∏Å">üéÇ ‡πÄ‡∏Ñ‡πâ‡∏Å</option>
                                    <option value="‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ">üç™ ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ</option>
                                    <option value="‡∏°‡∏±‡∏ü‡∏ü‡∏¥‡∏ô">üßÅ ‡∏°‡∏±‡∏ü‡∏ü‡∏¥‡∏ô</option>
                                    <option value="‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á">ü•ê ‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á</option>
                                    <option value="‡∏û‡∏≤‡∏¢">ü•ß ‡∏û‡∏≤‡∏¢</option>
                                    <option value="‡∏Ç‡∏ô‡∏°‡πÑ‡∏ó‡∏¢">üçÆ ‡∏Ç‡∏ô‡∏°‡πÑ‡∏ó‡∏¢</option>
                                    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üç∞ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ</label>
                                <input type="number" id="recipeYield" placeholder="‡πÑ‡∏î‡πâ‡∏Å‡∏µ‡πà‡∏ä‡∏¥‡πâ‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢" class="w-full p-3 border rounded-lg text-sm">
                            </div>
                        </div>
                        
                        <!-- ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
                        <div class="bg-white p-3 rounded-lg border border-blue-200">
                            <h4 class="font-medium text-blue-800 mb-2 text-sm">üßÅ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</h4>
                            <select id="baseRecipe" class="w-full p-2 border rounded-lg text-sm" onchange="loadBaseRecipe()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</option>
                            </select>
                            <p class="text-xs text-blue-600 mt-1">‡πÄ‡∏ä‡πà‡∏ô: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£ "‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤" ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ "‡πÇ‡∏î‡∏ô‡∏±‡∏ó‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï"</p>
                        </div>
                        
                        <!-- ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ -->
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="font-medium text-sm text-gray-700">üßÇ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</h4>
                                <button onclick="clearAllIngredients()" class="text-red-500 hover:text-red-700 text-xs">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                            </div>
                            <div id="recipeIngredients" class="space-y-2">
                                <div class="ingredient-row flex gap-2">
                                    <select class="ingredient-select flex-1 p-2 border rounded text-sm">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                                    </select>
                                    <input type="number" class="ingredient-amount w-20 sm:w-24 p-2 border rounded text-sm" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                                    <button onclick="addIngredientRow()" class="bg-purple-500 text-white px-2 sm:px-3 py-2 rounded hover:bg-purple-600 text-sm">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row gap-2">
                            <button onclick="createRecipe()" id="createRecipeBtn" class="flex-1 bg-purple-500 text-white p-3 rounded-lg hover:bg-purple-600 text-sm font-medium">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£</button>
                            <button onclick="updateRecipe()" id="updateRecipeBtn" class="flex-1 bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 text-sm font-medium hidden">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏π‡∏ï‡∏£</button>
                            <button onclick="cancelEdit()" id="cancelEditBtn" class="bg-gray-500 text-white px-4 py-3 rounded-lg hover:bg-gray-600 text-sm font-medium hidden">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
                <div class="bg-white rounded-lg p-4 border-2 border-purple-100">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                        <h3 class="text-lg font-semibold text-gray-800">
                            üìö ‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </h3>
                        <div class="text-sm text-gray-600">
                            <span id="recipesCount">0</span> ‡∏™‡∏π‡∏ï‡∏£
                        </div>
                    </div>
                    
                    <!-- Filter and View Options -->
                    <div class="mb-4 space-y-3">
                        <!-- Category Filter -->
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterRecipes('all')" class="recipe-filter-btn active px-3 py-1 rounded-full text-xs bg-purple-500 text-white hover:bg-purple-600">
                                ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterRecipes('‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üçû ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á
                            </button>
                            <button onclick="filterRecipes('‡πÇ‡∏î‡∏ô‡∏±‡∏ó')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üç© ‡πÇ‡∏î‡∏ô‡∏±‡∏ó
                            </button>
                            <button onclick="filterRecipes('‡πÄ‡∏Ñ‡πâ‡∏Å')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üéÇ ‡πÄ‡∏Ñ‡πâ‡∏Å
                            </button>
                            <button onclick="filterRecipes('‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üç™ ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ
                            </button>
                            <button onclick="filterRecipes('‡∏≠‡∏∑‡πà‡∏ô‡πÜ')" class="recipe-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üç∞ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                            </button>
                        </div>
                        
                        <!-- View Toggle -->
                        <div class="flex items-center gap-2 text-sm">
                            <span class="text-gray-600">‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á:</span>
                            <button onclick="toggleRecipeView('compact')" id="compactViewBtn" class="px-3 py-1 rounded text-xs bg-purple-500 text-white hover:bg-purple-600">
                                üìã ‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠
                            </button>
                            <button onclick="toggleRecipeView('detailed')" id="detailedViewBtn" class="px-3 py-1 rounded text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üìÑ ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </button>
                        </div>
                    </div>
                    
                    <div id="recipesList" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Recipes will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Sales Section -->
        <div id="sales" class="section bg-gradient-to-br from-pink-100 to-rose-200 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="bg-gradient-to-r from-pink-600 to-rose-600 text-white rounded-lg p-4 mb-6 shadow-md">
                <h2 class="text-xl sm:text-2xl font-bold mb-2">üí∞ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h2>
                <p class="text-pink-100">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÇ‡∏î‡∏¢‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
                <div class="bg-pink-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-pink-800 border-b border-pink-200 pb-2">
                        üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <select id="saleProduct" class="w-full p-3 border rounded-lg text-sm" onchange="updateSaleInfo()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                            </select>
                        </div>
                        
                        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ -->
                        <div id="todayProductionList" class="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-4">
                            <h4 class="font-medium text-blue-800 mb-3 text-sm">üè≠ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                            <div id="todayProductionItems" class="space-y-2">
                                <!-- Today's production items will be shown here -->
                            </div>
                        </div>

                        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
                        <div id="productInfo" class="hidden bg-white p-3 rounded-lg border border-pink-200 mb-4">
                            <div id="productDetails" class="text-sm text-pink-700">
                                <!-- Product details will be shown here -->
                            </div>
                        </div>
                        
                        <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
                        <div class="bg-white p-4 rounded-lg border border-pink-200 space-y-4">
                            <h4 class="font-medium text-pink-800 text-sm border-b border-pink-200 pb-2">üìù ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h4>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ï‡∏≠‡∏ô‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô)</label>
                                    <input type="number" id="remainingQuantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠" class="w-full p-3 border rounded-lg text-sm" oninput="calculateSoldQuantity()">
                                    <p class="text-xs text-blue-600 mt-1">üí° ‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                                    <input type="number" id="salePrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢" class="w-full p-3 border rounded-lg text-sm" oninput="calculateSaleTotal()">
                                </div>
                            </div>
                            
                            <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì -->
                            <div id="saleCalculation" class="hidden bg-green-100 p-3 rounded-lg border border-green-300">
                                <h5 class="font-medium text-green-800 mb-2 text-sm">üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h5>
                                <div id="saleDetails" class="text-sm text-green-700">
                                    <!-- Sale calculation will be shown here -->
                                </div>
                            </div>
                            
                            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
                            <button onclick="recordSale()" id="recordSaleBtn" class="w-full bg-pink-500 text-white p-3 rounded-lg hover:bg-pink-600 text-sm font-medium disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors" disabled>
                                <span class="flex items-center justify-center gap-2">
                                    <span>üí∞</span>
                                    <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</span>
                                </span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-white rounded-lg border border-pink-200">
                        <h4 class="font-semibold text-pink-800 text-sm mb-2">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                        <div id="todaySummary" class="space-y-1">
                            <div class="flex justify-between text-sm">
                                <span>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢:</span>
                                <span id="todayRevenue" class="font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï:</span>
                                <span id="todayProductionCost" class="font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="flex justify-between text-sm border-t pt-1">
                                <span>‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
                                <span id="todayNetProfit" class="font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="text-xs text-gray-600 mt-2">
                                <div>üí° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å: ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
                <div class="bg-white rounded-lg p-4 border-2 border-pink-100">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
                        üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                    </h3>
                    <div id="salesHistory" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Sales history will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Expenses Section -->
        <div id="expenses" class="section bg-gradient-to-br from-slate-100 to-gray-200 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="bg-gradient-to-r from-slate-600 to-gray-600 text-white rounded-lg p-4 mb-6 shadow-md">
                <h2 class="text-xl sm:text-2xl font-bold mb-2">üíº ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</h2>
                <p class="text-slate-100">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥ ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏≠‡∏∑‡πà‡∏ô‡πÜ</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà -->
                <div class="bg-slate-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-slate-800 border-b border-slate-200 pb-2">
                        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà
                    </h3>
                    <div class="space-y-4">
                        <!-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</label>
                            <select id="expenseType" class="w-full p-3 border rounded-lg text-sm" onchange="updateExpenseTypeInfo()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="rent">üè† ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô/‡∏ö‡πâ‡∏≤‡∏ô</option>
                                <option value="utilities">‚ö° ‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ (‡πÑ‡∏ü/‡∏ô‡πâ‡∏≥/‡πÅ‡∏Å‡πä‡∏™)</option>
                                <option value="insurance">üõ°Ô∏è ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢</option>
                                <option value="equipment">üîß ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>
                                <option value="license">üìã ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï/‡∏†‡∏≤‡∏©‡∏µ</option>
                                <option value="marketing">üì¢ ‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤/‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î</option>
                                <option value="salary">üë• ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á</option>
                                <option value="maintenance">üî® ‡∏Ñ‡πà‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤</option>
                                <option value="other">üìù ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            </select>
                        </div>
                        
                        <!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                            <input type="text" id="expenseDescription" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°" class="w-full p-3 border rounded-lg text-sm">
                        </div>
                        
                        <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="expenseAmount" placeholder="‡πÄ‡∏ä‡πà‡∏ô 15000" class="w-full p-3 border rounded-lg text-sm" oninput="calculateExpenseImpact()">
                        </div>
                        
                        <!-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="expenseFrequency" value="monthly" class="mr-2" onchange="updateExpenseFrequency()" checked>
                                    <span class="text-sm">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="expenseFrequency" value="yearly" class="mr-2" onchange="updateExpenseFrequency()">
                                    <span class="text-sm">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ (‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡πà‡∏≠‡∏õ‡∏µ)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="expenseFrequency" value="one-time" class="mr-2" onchange="updateExpenseFrequency()">
                                    <span class="text-sm">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ)</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢</label>
                            <input type="date" id="expenseDate" class="w-full p-3 border rounded-lg text-sm" value="">
                        </div>
                        
                        <!-- ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö -->
                        <div id="expenseImpact" class="hidden bg-orange-100 p-3 rounded-lg border border-orange-300">
                            <h5 class="font-medium text-orange-800 mb-2 text-sm">üìä ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h5>
                            <div id="impactCalculation" class="text-sm text-orange-700">
                                <!-- Impact calculation will be shown here -->
                            </div>
                        </div>
                        
                        <button onclick="addExpense()" id="addExpenseBtn" class="w-full bg-slate-500 text-white p-3 rounded-lg hover:bg-slate-600 disabled:bg-gray-400 text-sm font-medium" disabled>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</button>
                    </div>
                </div>
                
                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ -->
                <div class="bg-white rounded-lg p-4 border-2 border-slate-100">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                        <h3 class="text-lg font-semibold text-gray-800">
                            üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢
                        </h3>
                        <div class="text-sm text-gray-600">
                            <span id="expensesCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </div>
                    </div>
                    
                    <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô -->
                    <div class="mb-4 p-4 bg-gradient-to-r from-red-50 to-orange-50 rounded-lg border border-red-200">
                        <h4 class="font-medium text-red-800 mb-3 text-sm">üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h4>
                        <div id="monthlyExpensesSummary" class="space-y-2">
                            <!-- Monthly expenses summary will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Filter Options -->
                    <div class="mb-4">
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterExpenses('all')" class="expense-filter-btn active px-3 py-1 rounded-full text-xs bg-slate-500 text-white hover:bg-slate-600">
                                ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterExpenses('monthly')" class="expense-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üìÖ ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                            </button>
                            <button onclick="filterExpenses('yearly')" class="expense-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üìÜ ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
                            </button>
                            <button onclick="filterExpenses('rent')" class="expense-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üè† ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤
                            </button>
                            <button onclick="filterExpenses('utilities')" class="expense-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                ‚ö° ‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ
                            </button>
                        </div>
                    </div>
                    
                    <div id="expensesList" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Expenses list will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section bg-gradient-to-br from-teal-100 to-cyan-200 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="bg-gradient-to-r from-teal-600 to-cyan-600 text-white rounded-lg p-4 mb-6 shadow-md">
                <h2 class="text-xl sm:text-2xl font-bold mb-2">üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h2>
                <p class="text-teal-100">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
            </div>
            
            <!-- Report Navigation -->
            <div class="mb-6">
                <div class="flex flex-wrap gap-2">
                    <button onclick="showReport('daily')" class="report-btn bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 text-sm">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
                    <button onclick="showReport('weekly')" class="report-btn bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 text-sm">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
                    <button onclick="showReport('monthly')" class="report-btn bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 text-sm">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                </div>
            </div>
            
            <!-- Daily Report -->
            <div id="dailyReport" class="report-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Date Selection -->
                    <div class="bg-teal-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-teal-800">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</h3>
                        <input type="date" id="dailyReportDate" class="w-full p-3 border rounded-lg text-sm" onchange="generateDailyReport()">
                        
                        <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
                        <div id="dailyStatsTable" class="mt-4 bg-white rounded-lg border border-teal-200 overflow-hidden">
                            <div class="bg-teal-100 px-4 py-2 border-b border-teal-200">
                                <h4 class="font-medium text-teal-800">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h4>
                            </div>
                            <div id="dailyStats" class="p-4">
                                <!-- Daily statistics will be shown here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Daily Charts -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">üìà ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h3>
                        
                        <!-- Performance Chart -->
                        <div id="dailyPerformanceChart" class="mb-6 bg-white rounded-lg border border-gray-200 p-4">
                            <h4 class="font-medium text-gray-800 mb-3 text-sm">üéØ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4>
                            <div id="performanceChartContent" class="space-y-2">
                                <!-- Performance chart will be shown here -->
                            </div>
                        </div>
                        
                        <!-- Top Products Table -->
                        <div id="dailyTopProductsTable" class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                            <div class="bg-gray-100 px-4 py-2 border-b border-gray-200">
                                <h4 class="font-medium text-gray-800">üèÜ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ Top 5</h4>
                            </div>
                            <div id="dailyTopProducts" class="p-4">
                                <!-- Top products will be shown here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Weekly Report -->
            <div id="weeklyReport" class="report-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Week Selection -->
                    <div class="bg-teal-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-teal-800">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h3>
                        <input type="week" id="weeklyReportWeek" class="w-full p-3 border rounded-lg text-sm" onchange="generateWeeklyReport()">
                        <div id="weeklyStats" class="mt-4 space-y-3">
                            <!-- Weekly statistics will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Weekly Analysis -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
                        <div id="weeklyDayAnalysis" class="space-y-2">
                            <!-- Daily analysis within week will be shown here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Monthly Report -->
            <div id="monthlyReport" class="report-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Month Selection -->
                    <div class="bg-teal-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-teal-800">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                        <input type="month" id="monthlyReportMonth" class="w-full p-3 border rounded-lg text-sm" onchange="generateMonthlyReport()">
                        <div id="monthlyStats" class="mt-4 space-y-3">
                            <!-- Monthly statistics will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Monthly Trends -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                        <div id="monthlyTrends" class="space-y-2">
                            <!-- Monthly trends will be shown here -->
                        </div>
                    </div>
                </div>
                
                <!-- Cost Analysis -->
                <div class="mt-6 bg-red-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-red-800">üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡πÑ‡∏£</h3>
                    <div id="costAnalysisReport" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Cost analysis will be shown here -->
                    </div>
                </div>
                
                <!-- Customer Analysis -->
                <div class="mt-6 bg-purple-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-purple-800">üë• ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
                    <div id="customerAnalysis" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Customer analysis will be shown here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Pricing Section -->
        <div id="pricing" class="section bg-gradient-to-br from-yellow-100 to-amber-200 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 hidden">
            <div class="bg-gradient-to-r from-yellow-600 to-amber-600 text-white rounded-lg p-4 mb-6 shadow-md">
                <h2 class="text-xl sm:text-2xl font-bold mb-2">üí≤ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</h2>
                <p class="text-yellow-100">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
            </div>
            
            <div class="space-y-6 lg:grid lg:grid-cols-2 lg:gap-6 lg:space-y-0">
                <!-- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ -->
                <div class="bg-yellow-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 text-yellow-800 border-b border-yellow-200 pb-2">
                        üè∑Ô∏è ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <select id="pricingProduct" class="w-full p-3 border rounded-lg text-sm" onchange="updatePricingInfo()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                            </select>
                        </div>
                        
                        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô -->
                        <div id="costInfo" class="hidden bg-white p-4 rounded-lg border border-yellow-200">
                            <h4 class="font-medium text-yellow-800 mb-3 text-sm">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h4>
                            <div id="costDetails" class="text-sm text-yellow-700 space-y-2">
                                <!-- Cost details will be shown here -->
                            </div>
                        </div>
                        
                        <!-- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ -->
                        <div id="pricingSection" class="hidden space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <h4 class="font-medium text-blue-800 mb-3 text-sm">üí∞ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</h4>
                                
                                <!-- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ -->
                                <div class="mb-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="radio" name="pricingMethod" value="markup" class="mr-2" onchange="updatePricingMethod()" checked>
                                            <span class="text-sm">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≥‡πÑ‡∏£ (Markup)</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="pricingMethod" value="margin" class="mr-2" onchange="updatePricingMethod()">
                                            <span class="text-sm">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£ (Margin)</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="pricingMethod" value="fixed" class="mr-2" onchange="updatePricingMethod()">
                                            <span class="text-sm">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Markup Method -->
                                <div id="markupMethod" class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≥‡πÑ‡∏£ (%)</label>
                                        <input type="number" id="markupPercent" placeholder="‡πÄ‡∏ä‡πà‡∏ô 100 (‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á 100%)" class="w-full p-2 border rounded-lg text-sm" oninput="calculatePriceFromMarkup()">
                                        <p class="text-xs text-blue-600 mt-1">üí° 100% = ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ 2 ‡πÄ‡∏ó‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</p>
                                    </div>
                                </div>
                                
                                <!-- Margin Method -->
                                <div id="marginMethod" class="hidden space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£ (%)</label>
                                        <input type="number" id="marginPercent" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50 (‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á 50%)" class="w-full p-2 border rounded-lg text-sm" oninput="calculatePriceFromMargin()">
                                        <p class="text-xs text-blue-600 mt-1">üí° 50% = ‡∏Å‡∏≥‡πÑ‡∏£ 50% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</p>
                                    </div>
                                </div>
                                
                                <!-- Fixed Price Method -->
                                <div id="fixedMethod" class="hidden space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                                        <input type="number" id="fixedPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" class="w-full p-2 border rounded-lg text-sm" oninput="calculateProfitFromFixed()">
                                    </div>
                                </div>
                                
                                <!-- ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì -->
                                <div id="pricingResult" class="hidden mt-4 p-3 bg-green-100 rounded-lg border border-green-300">
                                    <h5 class="font-medium text-green-800 mb-2 text-sm">üìà ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h5>
                                    <div id="pricingCalculation" class="text-sm text-green-700 space-y-1">
                                        <!-- Pricing calculation will be shown here -->
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="savePricing()" id="savePricingBtn" class="w-full bg-yellow-500 text-white p-3 rounded-lg hover:bg-yellow-600 text-sm font-medium" disabled>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</button>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ -->
                <div class="bg-white rounded-lg p-4 border-2 border-yellow-100">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-2">
                        <h3 class="text-lg font-semibold text-gray-800">
                            üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢
                        </h3>
                        <div class="text-sm text-gray-600">
                            <span id="pricingCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </div>
                    </div>
                    
                    <!-- Filter Options -->
                    <div class="mb-4">
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterPricing('all')" class="pricing-filter-btn active px-3 py-1 rounded-full text-xs bg-yellow-500 text-white hover:bg-yellow-600">
                                ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button onclick="filterPricing('high-profit')" class="pricing-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏π‡∏á (>50%)
                            </button>
                            <button onclick="filterPricing('medium-profit')" class="pricing-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                üìä ‡∏Å‡∏≥‡πÑ‡∏£‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (20-50%)
                            </button>
                            <button onclick="filterPricing('low-profit')" class="pricing-filter-btn px-3 py-1 rounded-full text-xs bg-gray-200 text-gray-700 hover:bg-gray-300">
                                ‚ö†Ô∏è ‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≥ (<20%)
                            </button>
                        </div>
                    </div>
                    
                    <div id="pricingList" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Pricing list will be displayed here -->
                    </div>
                </div>
            </div>
        </div>


    </div>

    <script>
        // Data storage
        let inventory = JSON.parse(localStorage.getItem('bakery_inventory') || '[]');
        let purchases = JSON.parse(localStorage.getItem('bakery_purchases') || '[]');
        let recipes = JSON.parse(localStorage.getItem('bakery_recipes') || '[]');
        let productions = JSON.parse(localStorage.getItem('bakery_productions') || '[]');
        let sales = JSON.parse(localStorage.getItem('bakery_sales') || '[]');
        let expenses = JSON.parse(localStorage.getItem('bakery_expenses') || '[]');

        let productPricing = JSON.parse(localStorage.getItem('bakery_product_pricing') || '{}');
        
        // Search and filter state
        let currentFilter = 'all';
        let currentSearchTerm = '';
        let filteredInventory = [];
        
        // Recipe filter and view state
        let currentRecipeFilter = 'all';
        let currentRecipeView = 'compact';
        let filteredRecipes = [];
        
        // Pricing filter state
        let currentPricingFilter = 'all';
        let filteredPricing = [];
        
        // Expenses filter state
        let currentExpenseFilter = 'all';
        let filteredExpenses = [];

        // Navigation
        function toggleNavDropdown() {
            const dropdown = document.getElementById('navDropdown');
            const arrow = document.getElementById('dropdownArrow');
            
            if (dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                dropdown.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function selectSection(sectionName, icon, name, category) {
            // Hide dropdown
            document.getElementById('navDropdown').classList.add('hidden');
            document.getElementById('dropdownArrow').style.transform = 'rotate(0deg)';
            
            // Update current section display
            document.getElementById('currentSectionIcon').textContent = icon;
            document.getElementById('currentSectionName').textContent = name;
            document.getElementById('currentSectionCategory').textContent = category;
            
            // Show selected section
            showSection(sectionName);
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName).classList.remove('hidden');
            
            // Refresh data when switching sections
            if (sectionName === 'inventory') updateInventoryDisplay();
            if (sectionName === 'purchase') updatePurchaseOptions();
            if (sectionName === 'recipes') updateRecipeOptions();
            if (sectionName === 'production') updateProductionOptions();
            if (sectionName === 'sales') updateSalesOptions();
            if (sectionName === 'expenses') updateExpensesOptions();
            if (sectionName === 'reports') initializeReports();
            if (sectionName === 'pricing') updatePricingOptions();
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('navDropdown');
            const button = event.target.closest('button[onclick="toggleNavDropdown()"]');
            
            if (!button && !dropdown.contains(event.target)) {
                dropdown.classList.add('hidden');
                document.getElementById('dropdownArrow').style.transform = 'rotate(0deg)';
            }
            
            // Close production recipe dropdown when clicking outside
            const productionDropdown = document.getElementById('productionRecipeDropdown');
            const productionSearch = document.getElementById('productionRecipeSearch');
            
            if (productionDropdown && productionSearch && 
                !productionDropdown.contains(event.target) && 
                event.target !== productionSearch) {
                productionDropdown.classList.add('hidden');
            }
        });

        // Price calculation function
        function calculateUnitPrice() {
            const packageQuantity = parseFloat(document.getElementById('packageQuantity').value);
            const packageUnit = document.getElementById('packageUnit').value;
            const packagePrice = parseFloat(document.getElementById('packagePrice').value);
            const priceCalculation = document.getElementById('priceCalculation');
            const calculationText = document.getElementById('calculationText');
            const unitPriceResult = document.getElementById('unitPriceResult');
            const addItemBtn = document.getElementById('addItemBtn');

            // Check if all required fields are filled
            const itemName = document.getElementById('itemName').value.trim();
            const initialStock = parseFloat(document.getElementById('initialStock').value);

            if (packageQuantity && packageUnit && packagePrice) {
                // Calculate unit price
                const unitPrice = packagePrice / packageQuantity;
                
                // Show calculation
                priceCalculation.classList.remove('hidden');
                calculationText.innerHTML = `
                    <div>üìä ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</div>
                    <div>‡∏£‡∏≤‡∏Ñ‡∏≤ ${packagePrice} ‡∏ö‡∏≤‡∏ó √∑ ${packageQuantity} ${packageUnit} = ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${packageUnit}</div>
                `;
                unitPriceResult.textContent = `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${packageUnit}`;
                
                // Enable button if all fields are filled
                if (itemName && initialStock > 0) {
                    addItemBtn.disabled = false;
                } else {
                    addItemBtn.disabled = true;
                }
            } else {
                // Hide calculation
                priceCalculation.classList.add('hidden');
                addItemBtn.disabled = true;
            }
        }

        // Inventory Management
        function addInventoryItem() {
            const name = document.getElementById('itemName').value.trim();
            const packageQuantity = parseFloat(document.getElementById('packageQuantity').value);
            const packageUnit = document.getElementById('packageUnit').value;
            const packagePrice = parseFloat(document.getElementById('packagePrice').value);
            const initialStock = parseFloat(document.getElementById('initialStock').value);

            if (!name || !packageQuantity || !packageUnit || !packagePrice || !initialStock) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            // Calculate unit price
            const unitPrice = packagePrice / packageQuantity;
            
            // Calculate total quantity in stock (initial stock √ó package quantity)
            const totalQuantity = initialStock * packageQuantity;

            const existingItem = inventory.find(item => item.name === name);
            if (existingItem) {
                // Update existing item
                existingItem.quantity += totalQuantity;
                existingItem.packageQuantity = packageQuantity;
                existingItem.packageUnit = packageUnit;
                existingItem.packagePrice = packagePrice;
                existingItem.unitPrice = unitPrice;
                existingItem.lastUpdated = new Date().toLocaleDateString('th-TH');
            } else {
                // Create new item
                const newItem = {
                    id: Date.now(),
                    name,
                    quantity: totalQuantity,
                    unit: packageUnit,
                    packageQuantity,
                    packageUnit,
                    packagePrice,
                    unitPrice,
                    lastUpdated: new Date().toLocaleDateString('th-TH')
                };
                
                inventory.push(newItem);
            }

            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            updateInventoryDisplay();
            
            // Clear form
            document.getElementById('itemName').value = '';
            document.getElementById('packageQuantity').value = '';
            document.getElementById('packageUnit').value = '';
            document.getElementById('packagePrice').value = '';
            document.getElementById('initialStock').value = '';
            document.getElementById('priceCalculation').classList.add('hidden');
            document.getElementById('addItemBtn').disabled = true;
            
            alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:\n‚Ä¢ ${initialStock} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ √ó ${packageQuantity} ${packageUnit} = ${totalQuantity} ${packageUnit}\n‚Ä¢ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${packageUnit}`);
        }

        // Search and Filter Functions
        function searchInventory() {
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase().trim();
            const clearBtn = document.getElementById('clearSearchBtn');
            
            currentSearchTerm = searchTerm;
            
            // Show/hide clear button
            if (searchTerm) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }
            
            // Show suggestions if search term is not empty but no exact matches
            showSearchSuggestions(searchTerm);
            
            // Apply current filter and search
            applyInventoryFilter();
        }

        function clearInventorySearch() {
            document.getElementById('inventorySearch').value = '';
            document.getElementById('clearSearchBtn').classList.add('hidden');
            document.getElementById('searchSuggestions').classList.add('hidden');
            document.getElementById('searchResults').classList.add('hidden');
            currentSearchTerm = '';
            applyInventoryFilter();
        }

        function showSearchSuggestions(searchTerm) {
            const suggestionsDiv = document.getElementById('searchSuggestions');
            const suggestionsList = document.getElementById('suggestionsList');
            
            if (!searchTerm) {
                suggestionsDiv.classList.add('hidden');
                return;
            }
            
            // Find similar items using fuzzy matching
            const suggestions = findSimilarItems(searchTerm);
            
            if (suggestions.length > 0) {
                suggestionsDiv.classList.remove('hidden');
                suggestionsList.innerHTML = suggestions.map(suggestion => `
                    <button onclick="applySuggestion('${suggestion}')" 
                            class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors">
                        ${suggestion}
                    </button>
                `).join('');
            } else {
                suggestionsDiv.classList.add('hidden');
            }
        }

        function findSimilarItems(searchTerm) {
            if (!searchTerm || searchTerm.length < 2) return [];
            
            const suggestions = new Set();
            
            // Common ingredient keywords and their variations
            const ingredientKeywords = {
                '‡πÅ‡∏õ‡πâ‡∏á': ['‡πÅ‡∏õ‡πâ‡∏á‡∏™‡∏≤‡∏•‡∏µ', '‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏≠‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå', '‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏Ñ‡πâ‡∏Å', '‡πÅ‡∏õ‡πâ‡∏á‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á', '‡πÅ‡∏õ‡πâ‡∏á‡∏°‡∏±‡∏ô'],
                '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•': ['‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ó‡∏£‡∏≤‡∏¢', '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏õ‡πà‡∏ô', '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÑ‡∏≠‡∏ã‡∏¥‡πà‡∏á', '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÅ‡∏î‡∏á'],
                '‡πÄ‡∏ô‡∏¢': ['‡πÄ‡∏ô‡∏¢‡∏à‡∏∑‡∏î', '‡πÄ‡∏ô‡∏¢‡πÄ‡∏Ñ‡πá‡∏°', '‡πÄ‡∏ô‡∏¢‡∏Ç‡∏≤‡∏ß', '‡∏°‡∏≤‡∏Å‡∏≤‡∏£‡∏µ‡∏ô'],
                '‡∏ô‡∏°': ['‡∏ô‡∏°‡∏™‡∏î', '‡∏ô‡∏°‡∏Ç‡πâ‡∏ô‡∏´‡∏ß‡∏≤‡∏ô', '‡∏ô‡∏°‡∏Ç‡πâ‡∏ô‡∏à‡∏∑‡∏î', '‡∏ô‡∏°‡∏ú‡∏á', '‡∏ß‡∏¥‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡∏Ñ‡∏£‡∏µ‡∏°'],
                '‡πÑ‡∏Ç‡πà': ['‡πÑ‡∏Ç‡πà‡πÑ‡∏Å‡πà', '‡πÑ‡∏Ç‡πà‡πÅ‡∏î‡∏á', '‡πÑ‡∏Ç‡πà‡∏Ç‡∏≤‡∏ß'],
                '‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï': ['‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏ä‡∏¥‡∏õ', '‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡∏ú‡∏á', '‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡πÅ‡∏ó‡πà‡∏á'],
                '‡∏ß‡∏ô‡∏¥‡∏•‡∏•‡∏≤': ['‡∏ß‡∏ô‡∏¥‡∏•‡∏•‡∏≤‡πÄ‡∏≠‡∏™‡πÄ‡∏ã‡πâ‡∏ô‡∏™‡πå', '‡∏ß‡∏ô‡∏¥‡∏•‡∏•‡∏≤‡∏™‡∏Å‡∏±‡∏î'],
                '‡πÄ‡∏Å‡∏•‡∏∑‡∏≠': ['‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏õ‡πà‡∏ô', '‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏ó‡∏∞‡πÄ‡∏•'],
                '‡∏ú‡∏á‡∏ü‡∏π': ['‡πÄ‡∏ö‡∏Å‡∏Å‡∏¥‡πâ‡∏á‡πÇ‡∏ã‡∏î‡∏≤', '‡∏ú‡∏á‡∏ü‡∏π‡πÄ‡∏Ñ‡πâ‡∏Å'],
                '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô': ['‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏û‡∏∑‡∏ä', '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏Ñ‡∏≤‡πÇ‡∏ô‡∏•‡∏≤', '‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏°‡∏∞‡∏Å‡∏≠‡∏Å']
            };
            
            // Search in existing inventory
            inventory.forEach(item => {
                const itemName = item.name.toLowerCase();
                
                // Exact match or contains search term
                if (itemName.includes(searchTerm)) {
                    suggestions.add(item.name);
                }
                
                // Fuzzy matching for typos
                if (calculateSimilarity(itemName, searchTerm) > 0.6) {
                    suggestions.add(item.name);
                }
            });
            
            // Search in keyword suggestions
            Object.entries(ingredientKeywords).forEach(([keyword, variations]) => {
                if (keyword.includes(searchTerm) || searchTerm.includes(keyword)) {
                    variations.forEach(variation => {
                        // Only suggest if not already in inventory
                        if (!inventory.some(item => item.name.toLowerCase().includes(variation.toLowerCase()))) {
                            suggestions.add(variation);
                        }
                    });
                }
                
                variations.forEach(variation => {
                    if (variation.toLowerCase().includes(searchTerm) || 
                        calculateSimilarity(variation.toLowerCase(), searchTerm) > 0.6) {
                        suggestions.add(variation);
                    }
                });
            });
            
            return Array.from(suggestions).slice(0, 8); // Limit to 8 suggestions
        }

        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = levenshteinDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }

        function levenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }

        function applySuggestion(suggestion) {
            document.getElementById('inventorySearch').value = suggestion;
            currentSearchTerm = suggestion.toLowerCase();
            document.getElementById('searchSuggestions').classList.add('hidden');
            document.getElementById('clearSearchBtn').classList.remove('hidden');
            applyInventoryFilter();
        }

        function filterInventory(filterType) {
            currentFilter = filterType;
            
            // Update filter button styles
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-blue-500', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            applyInventoryFilter();
        }

        function applyInventoryFilter() {
            let filtered = [...inventory];
            
            // Apply search filter
            if (currentSearchTerm) {
                filtered = filtered.filter(item => {
                    const itemName = item.name.toLowerCase();
                    const unit = item.unit.toLowerCase();
                    
                    return itemName.includes(currentSearchTerm) || 
                           unit.includes(currentSearchTerm) ||
                           calculateSimilarity(itemName, currentSearchTerm) > 0.5;
                });
            }
            
            // Apply category filter
            if (currentFilter !== 'all') {
                filtered = filtered.filter(item => {
                    const itemName = item.name.toLowerCase();
                    
                    switch (currentFilter) {
                        case 'low-stock':
                            const packagesLeft = Math.floor(item.quantity / item.packageQuantity);
                            return packagesLeft < 1;
                        case 'powder':
                            return itemName.includes('‡πÅ‡∏õ‡πâ‡∏á') || itemName.includes('‡∏ú‡∏á') || 
                                   itemName.includes('‡πÇ‡∏Å‡πÇ‡∏Å‡πâ') || itemName.includes('‡∏ú‡∏á‡∏ü‡∏π');
                        case 'liquid':
                            return item.unit.includes('‡∏°‡∏•') || item.unit.includes('‡∏•‡∏¥‡∏ï‡∏£') || 
                                   itemName.includes('‡∏ô‡πâ‡∏≥') || itemName.includes('‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô') ||
                                   itemName.includes('‡πÄ‡∏≠‡∏™‡πÄ‡∏ã‡πâ‡∏ô‡∏™‡πå');
                        case 'dairy':
                            return itemName.includes('‡∏ô‡∏°') || itemName.includes('‡πÄ‡∏ô‡∏¢') || 
                                   itemName.includes('‡∏Ñ‡∏£‡∏µ‡∏°') || itemName.includes('‡∏ä‡∏µ‡∏™') ||
                                   itemName.includes('‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï');
                        case 'sweet':
                            return itemName.includes('‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•') || itemName.includes('‡∏ô‡πâ‡∏≥‡∏ú‡∏∂‡πâ‡∏á') || 
                                   itemName.includes('‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï') || itemName.includes('‡∏´‡∏ß‡∏≤‡∏ô') ||
                                   itemName.includes('‡πÑ‡∏ã‡∏£‡∏±‡∏õ');
                        default:
                            return true;
                    }
                });
            }
            
            filteredInventory = filtered;
            
            // Apply sorting
            sortInventory();
            
            // Show search results info
            showSearchResults();
        }

        function sortInventory() {
            const sortType = document.getElementById('inventorySort').value;
            
            filteredInventory.sort((a, b) => {
                switch (sortType) {
                    case 'name-asc':
                        return a.name.localeCompare(b.name, 'th');
                    case 'name-desc':
                        return b.name.localeCompare(a.name, 'th');
                    case 'stock-low':
                        return a.quantity - b.quantity;
                    case 'stock-high':
                        return b.quantity - a.quantity;
                    case 'updated-new':
                        return new Date(b.lastUpdated) - new Date(a.lastUpdated);
                    case 'updated-old':
                        return new Date(a.lastUpdated) - new Date(b.lastUpdated);
                    default:
                        return 0;
                }
            });
            
            updateInventoryDisplay();
        }

        function showSearchResults() {
            const searchResults = document.getElementById('searchResults');
            const totalItems = inventory.length;
            const filteredCount = filteredInventory.length;
            
            if (currentSearchTerm || currentFilter !== 'all') {
                searchResults.classList.remove('hidden');
                
                let message = `‡∏û‡∏ö ${filteredCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                if (currentSearchTerm) {
                    message += ` ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "${currentSearchTerm}"`;
                }
                if (currentFilter !== 'all') {
                    const filterNames = {
                        'low-stock': '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î',
                        'powder': '‡πÅ‡∏õ‡πâ‡∏á/‡∏ú‡∏á',
                        'liquid': '‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß',
                        'dairy': '‡∏ô‡∏°/‡πÄ‡∏ô‡∏¢',
                        'sweet': '‡∏´‡∏ß‡∏≤‡∏ô'
                    };
                    message += ` ‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î "${filterNames[currentFilter]}"`;
                }
                message += ` ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                
                searchResults.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span>üîç ${message}</span>
                        ${(currentSearchTerm || currentFilter !== 'all') ? 
                            '<button onclick="resetAllFilters()" class="text-blue-800 hover:text-blue-900 underline text-xs">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>' : 
                            ''
                        }
                    </div>
                `;
            } else {
                searchResults.classList.add('hidden');
            }
        }

        function resetAllFilters() {
            // Clear search
            document.getElementById('inventorySearch').value = '';
            document.getElementById('clearSearchBtn').classList.add('hidden');
            currentSearchTerm = '';
            
            // Reset filter to 'all'
            currentFilter = 'all';
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            document.querySelector('.filter-btn').classList.add('active', 'bg-blue-500', 'text-white');
            document.querySelector('.filter-btn').classList.remove('bg-gray-200', 'text-gray-700');
            
            // Reset sort
            document.getElementById('inventorySort').value = 'name-asc';
            
            // Hide suggestions and results
            document.getElementById('searchSuggestions').classList.add('hidden');
            document.getElementById('searchResults').classList.add('hidden');
            
            // Apply filters
            applyInventoryFilter();
        }

        function updateInventoryDisplay() {
            const list = document.getElementById('inventoryList');
            const countElement = document.getElementById('inventoryCount');
            
            // Update count
            countElement.textContent = filteredInventory.length;
            
            if (inventory.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á<br>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            if (filteredInventory.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-lg mb-2">üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
                        <div class="text-sm">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏î‡∏π</div>
                        <button onclick="resetAllFilters()" class="mt-3 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm">
                            ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = filteredInventory.map(item => {
                // Calculate how many packages are left
                const packagesLeft = Math.floor(item.quantity / item.packageQuantity);
                const remainingUnits = item.quantity % item.packageQuantity;
                
                // Warning for low stock (less than 1 package or less than 10% of a package)
                const lowStock = packagesLeft < 1 || (packagesLeft === 0 && remainingUnits < item.packageQuantity * 0.1);
                
                // Highlight search term in item name
                let displayName = item.name;
                if (currentSearchTerm) {
                    const regex = new RegExp(`(${currentSearchTerm})`, 'gi');
                    displayName = item.name.replace(regex, '<mark class="bg-yellow-200 px-1 rounded">$1</mark>');
                }
                
                return `
                    <div class="bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden ${lowStock ? 'ring-2 ring-red-200' : ''}">
                        <!-- Header -->
                        <div class="px-4 py-3 bg-gradient-to-r ${lowStock ? 'from-red-50 to-red-100 border-b border-red-200' : 'from-blue-50 to-indigo-50 border-b border-gray-200'}">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full ${lowStock ? 'bg-red-100' : 'bg-blue-100'} flex items-center justify-center">
                                        <span class="text-lg">${lowStock ? '‚ö†Ô∏è' : 'üì¶'}</span>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-lg text-gray-800">${displayName}</h3>
                                        ${lowStock ? '<span class="inline-block px-2 py-1 bg-red-100 text-red-700 text-xs rounded-full font-medium">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</span>' : ''}
                                    </div>
                                </div>
                                <button onclick="removeInventoryItem(${item.id})" class="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="p-4 space-y-4">
                            <!-- Stock Status -->
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <div class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                                    <div class="text-xl font-bold text-gray-800">${item.quantity.toLocaleString()}</div>
                                    <div class="text-sm text-gray-600">${item.unit}</div>
                                </div>
                                <div class="bg-blue-50 rounded-lg p-3">
                                    <div class="text-xs font-medium text-blue-500 uppercase tracking-wide mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</div>
                                    <div class="text-xl font-bold text-blue-700">${packagesLeft}</div>
                                    <div class="text-sm text-blue-600">
                                        ${remainingUnits > 0 ? `+ ${remainingUnits.toLocaleString()} ${item.unit}` : '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠'}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Purchase Information -->
                            <div class="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-lg p-3 border border-indigo-100">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-indigo-600">üí∞</span>
                                    <h4 class="font-medium text-indigo-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</h4>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠:</span>
                                        <span class="font-medium text-gray-800">${item.packageQuantity.toLocaleString()} ${item.unit}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠:</span>
                                        <span class="font-medium text-gray-800">${item.packagePrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                                    </div>
                                    <div class="flex justify-between sm:col-span-2 pt-2 border-t border-indigo-200">
                                        <span class="text-indigo-600 font-medium">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠${item.unit}:</span>
                                        <span class="font-bold text-indigo-700">${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Last Updated -->
                            <div class="flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100">
                                <span>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
                                <span class="font-medium">${item.lastUpdated}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function removeInventoryItem(id) {
            inventory = inventory.filter(item => item.id !== id);
            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            updateInventoryDisplay();
        }

        // Purchase Management
        function updatePurchaseOptions() {
            const select = document.getElementById('purchaseItem');
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>' + 
                inventory.map(item => `<option value="${item.name}">${item.name} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${item.quantity.toLocaleString()} ${item.unit})</option>`).join('');
            updatePurchaseHistory();
        }

        function updatePurchaseInfo() {
            const itemName = document.getElementById('purchaseItem').value;
            const purchaseInfo = document.getElementById('purchaseInfo');
            const packageDetails = document.getElementById('packageDetails');
            const purchaseUnitDisplay = document.getElementById('purchaseUnitDisplay');
            const makePurchaseBtn = document.getElementById('makePurchaseBtn');
            
            if (!itemName) {
                purchaseInfo.classList.add('hidden');
                makePurchaseBtn.disabled = true;
                return;
            }
            
            const item = inventory.find(i => i.name === itemName);
            if (!item) return;
            
            // Show purchase info section
            purchaseInfo.classList.remove('hidden');
            
            // Display package details
            packageDetails.innerHTML = `
                <div class="space-y-1">
                    <div><strong>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:</strong> ${item.name}</div>
                    <div><strong>1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ =</strong> ${item.packageQuantity.toLocaleString()} ${item.unit}</div>
                    <div><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠:</strong> ${item.packagePrice} ‡∏ö‡∏≤‡∏ó</div>
                    <div><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠${item.unit}:</strong> ${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${item.unit}</div>
                    <div class="text-blue-600"><strong>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á:</strong> ${item.quantity.toLocaleString()} ${item.unit}</div>
                </div>
            `;
            
            // Set unit display
            purchaseUnitDisplay.textContent = '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠';
            
            // Clear previous calculation
            document.getElementById('purchaseQuantity').value = '';
            document.getElementById('purchaseConversion').classList.add('hidden');
            makePurchaseBtn.disabled = true;
        }

        function calculatePurchaseConversion() {
            const itemName = document.getElementById('purchaseItem').value;
            const purchaseQuantity = parseFloat(document.getElementById('purchaseQuantity').value);
            const purchaseConversion = document.getElementById('purchaseConversion');
            const conversionCalculation = document.getElementById('conversionCalculation');
            const totalQuantityResult = document.getElementById('totalQuantityResult');
            const totalCostResult = document.getElementById('totalCostResult');
            const makePurchaseBtn = document.getElementById('makePurchaseBtn');
            
            if (!itemName || !purchaseQuantity || purchaseQuantity <= 0) {
                purchaseConversion.classList.add('hidden');
                makePurchaseBtn.disabled = true;
                return;
            }
            
            const item = inventory.find(i => i.name === itemName);
            if (!item) return;
            
            // Calculate conversion
            const totalQuantityToAdd = purchaseQuantity * item.packageQuantity;
            const totalCost = purchaseQuantity * item.packagePrice;
            
            // Show conversion
            purchaseConversion.classList.remove('hidden');
            
            conversionCalculation.innerHTML = `
                <div>üìä ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</div>
                <div>${purchaseQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ √ó ${item.packageQuantity.toLocaleString()} ${item.unit}/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ = ${totalQuantityToAdd.toLocaleString()} ${item.unit}</div>
                <div>${purchaseQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ √ó ${item.packagePrice} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠ = ${totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
            `;
            
            totalQuantityResult.textContent = `‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ${totalQuantityToAdd.toLocaleString()} ${item.unit}`;
            totalCostResult.textContent = `‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: ${totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            
            // Enable purchase button
            makePurchaseBtn.disabled = false;
        }

        function makePurchase() {
            const itemName = document.getElementById('purchaseItem').value;
            const purchaseQuantity = parseFloat(document.getElementById('purchaseQuantity').value);
            const supplier = document.getElementById('supplier').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

            if (!itemName || !purchaseQuantity || purchaseQuantity <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }

            const item = inventory.find(i => i.name === itemName);
            if (!item) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
                return;
            }

            // Calculate actual quantity to add to inventory
            const actualQuantityToAdd = purchaseQuantity * item.packageQuantity;
            const totalCost = purchaseQuantity * item.packagePrice;

            // Add to inventory
            item.quantity += actualQuantityToAdd;
            item.lastUpdated = new Date().toLocaleDateString('th-TH');

            // Record purchase
            purchases.push({
                id: Date.now(),
                itemName,
                purchaseQuantity: purchaseQuantity,
                packageQuantity: item.packageQuantity,
                packagePrice: item.packagePrice,
                actualQuantityAdded: actualQuantityToAdd,
                unit: item.unit,
                unitPrice: item.unitPrice,
                totalCost: totalCost,
                supplier,
                date: new Date().toLocaleDateString('th-TH'),
                time: new Date().toLocaleTimeString('th-TH')
            });

            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            localStorage.setItem('bakery_purchases', JSON.stringify(purchases));
            
            updatePurchaseHistory();
            updateInventoryDisplay();
            
            // Clear form
            document.getElementById('purchaseQuantity').value = '';
            document.getElementById('supplier').value = '';
            document.getElementById('purchaseConversion').classList.add('hidden');
            document.getElementById('makePurchaseBtn').disabled = true;
            
            alert(`‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
                  `‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö: ${itemName}\n` +
                  `‡∏ã‡∏∑‡πâ‡∏≠: ${purchaseQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠\n` +
                  `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ${actualQuantityToAdd.toLocaleString()} ${item.unit}\n` +
                  `‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà: ${item.quantity.toLocaleString()} ${item.unit}`);
        }

        function updatePurchaseHistory() {
            const list = document.getElementById('purchaseHistory');
            
            if (purchases.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠<br>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            const recentPurchases = purchases.slice(-10).reverse();
            list.innerHTML = recentPurchases.map(purchase => `
                <div class="bg-white border border-green-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden">
                    <!-- Header -->
                    <div class="px-4 py-3 bg-gradient-to-r from-green-50 to-emerald-50 border-b border-green-200">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
                                <span class="text-lg">üõí</span>
                            </div>
                            <div>
                                <h3 class="font-semibold text-lg text-gray-800">${purchase.itemName}</h3>
                                <div class="text-sm text-green-600 font-medium">${purchase.supplier}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-4 space-y-3">
                        <!-- Purchase Details -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-blue-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-blue-500 uppercase tracking-wide mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ã‡∏∑‡πâ‡∏≠</div>
                                <div class="text-lg font-bold text-blue-700">${purchase.purchaseQuantity}</div>
                                <div class="text-sm text-blue-600">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-green-500 uppercase tracking-wide mb-1">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á</div>
                                <div class="text-lg font-bold text-green-700">${purchase.actualQuantityAdded.toLocaleString()}</div>
                                <div class="text-sm text-green-600">${purchase.unit}</div>
                            </div>
                        </div>
                        
                        <!-- Cost Information -->
                        <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-lg p-3 border border-orange-100">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-orange-600">üí∞</span>
                                <h4 class="font-medium text-orange-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h4>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠:</span>
                                    <span class="font-medium text-gray-800">${purchase.packagePrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤/${purchase.unit}:</span>
                                    <span class="font-medium text-gray-800">${purchase.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                                <div class="flex justify-between col-span-2 pt-2 border-t border-orange-200">
                                    <span class="text-orange-600 font-medium">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°:</span>
                                    <span class="font-bold text-orange-700">${purchase.totalCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Timestamp -->
                        <div class="flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100">
                            <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</span>
                            <span class="font-medium">${purchase.date} ${purchase.time}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Production Management
        let selectedProductionRecipe = null;
        let currentProductionRecipeFilter = 'all';
        let filteredProductionRecipes = [];

        function updateProductionOptions() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('productionDate').value = today;
            
            // Initialize filtered recipes
            filteredProductionRecipes = [...recipes];
            updateProductionRecipeList();
            
            updateProductionHistory();
            updateTodayProductionSummary();
        }

        function filterProductionRecipes(category) {
            currentProductionRecipeFilter = category;
            
            // Update filter button styles
            document.querySelectorAll('.production-recipe-filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-indigo-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-indigo-500', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            applyProductionRecipeFilter();
        }

        function applyProductionRecipeFilter() {
            let filtered = [...recipes];
            
            // Apply search filter
            const searchTerm = document.getElementById('productionRecipeSearch').value.toLowerCase().trim();
            if (searchTerm) {
                filtered = filtered.filter(recipe => {
                    const recipeName = recipe.name.toLowerCase();
                    const category = recipe.category.toLowerCase();
                    
                    // Search in recipe name, category, and ingredients
                    let matchesIngredients = false;
                    if (recipe.ingredients) {
                        matchesIngredients = recipe.ingredients.some(ingredient => 
                            ingredient.name.toLowerCase().includes(searchTerm)
                        );
                    }
                    
                    return recipeName.includes(searchTerm) || 
                           category.includes(searchTerm) ||
                           matchesIngredients ||
                           calculateSimilarity(recipeName, searchTerm) > 0.5;
                });
            }
            
            // Apply category filter
            if (currentProductionRecipeFilter !== 'all') {
                filtered = filtered.filter(recipe => 
                    recipe.category === currentProductionRecipeFilter
                );
            }
            
            filteredProductionRecipes = filtered;
            updateProductionRecipeList();
        }

        function searchProductionRecipes() {
            const searchTerm = document.getElementById('productionRecipeSearch').value.toLowerCase().trim();
            const clearBtn = document.getElementById('clearProductionSearchBtn');
            
            // Show/hide clear button
            if (searchTerm) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }
            
            applyProductionRecipeFilter();
            
            // Show dropdown if there's a search term or focus
            if (searchTerm || document.activeElement === document.getElementById('productionRecipeSearch')) {
                showProductionRecipeDropdown();
            }
        }

        function clearProductionRecipeSearch() {
            document.getElementById('productionRecipeSearch').value = '';
            document.getElementById('clearProductionSearchBtn').classList.add('hidden');
            applyProductionRecipeFilter();
            hideProductionRecipeDropdown();
        }

        function showProductionRecipeDropdown() {
            const dropdown = document.getElementById('productionRecipeDropdown');
            dropdown.classList.remove('hidden');
            updateProductionRecipeList();
        }

        function hideProductionRecipeDropdown() {
            // Add a small delay to allow clicking on dropdown items
            setTimeout(() => {
                const dropdown = document.getElementById('productionRecipeDropdown');
                dropdown.classList.add('hidden');
            }, 150);
        }

        function updateProductionRecipeList() {
            const list = document.getElementById('productionRecipeList');
            
            if (filteredProductionRecipes.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-4 text-sm">
                        ${recipes.length === 0 ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö' : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤'}
                    </div>
                `;
                return;
            }
            
            // Sort by relevance (exact matches first, then by name)
            const searchTerm = document.getElementById('productionRecipeSearch').value.toLowerCase().trim();
            const sortedRecipes = [...filteredProductionRecipes].sort((a, b) => {
                if (searchTerm) {
                    const aExact = a.name.toLowerCase().includes(searchTerm);
                    const bExact = b.name.toLowerCase().includes(searchTerm);
                    if (aExact && !bExact) return -1;
                    if (!aExact && bExact) return 1;
                }
                return a.name.localeCompare(b.name, 'th');
            });
            
            list.innerHTML = sortedRecipes.map(recipe => {
                const categoryIcon = getCategoryIcon(recipe.category);
                
                // Highlight search term
                let displayName = recipe.name;
                if (searchTerm) {
                    const regex = new RegExp(`(${searchTerm})`, 'gi');
                    displayName = recipe.name.replace(regex, '<mark class="bg-yellow-200 px-1 rounded">$1</mark>');
                }
                
                return `
                    <div onclick="selectProductionRecipe('${recipe.name}')" 
                         class="p-3 hover:bg-indigo-50 rounded-lg cursor-pointer border border-transparent hover:border-indigo-200 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="text-lg">${categoryIcon}</span>
                                <div>
                                    <div class="font-medium text-gray-800">${displayName}</div>
                                    <div class="text-sm text-gray-600">
                                        ${recipe.category} ‚Ä¢ ‡πÑ‡∏î‡πâ ${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‚Ä¢ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢
                                    </div>
                                    ${recipe.baseRecipeName ? `
                                        <div class="text-xs text-blue-600 mt-1">
                                            üìã ‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£: ${recipe.baseRecipeName}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-medium text-indigo-600">${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                <div class="text-xs text-gray-500">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectProductionRecipe(recipeName) {
            selectedProductionRecipe = recipeName;
            const recipe = recipes.find(r => r.name === recipeName);
            if (!recipe) return;
            
            // Update search input
            document.getElementById('productionRecipeSearch').value = recipeName;
            document.getElementById('clearProductionSearchBtn').classList.remove('hidden');
            
            // Show selected recipe display
            const selectedDisplay = document.getElementById('selectedRecipeDisplay');
            const selectedName = document.getElementById('selectedRecipeName');
            const selectedDetails = document.getElementById('selectedRecipeDetails');
            
            selectedDisplay.classList.remove('hidden');
            selectedName.textContent = recipe.name;
            selectedDetails.innerHTML = `
                ${getCategoryIcon(recipe.category)} ${recipe.category} ‚Ä¢ 
                ‡πÑ‡∏î‡πâ ${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‚Ä¢ 
                ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢
                ${recipe.baseRecipeName ? ` ‚Ä¢ ‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£: ${recipe.baseRecipeName}` : ''}
            `;
            
            // Hide dropdown
            hideProductionRecipeDropdown();
            
            // Update production info
            updateProductionInfo();
        }

        function clearSelectedRecipe() {
            selectedProductionRecipe = null;
            document.getElementById('productionRecipeSearch').value = '';
            document.getElementById('clearProductionSearchBtn').classList.add('hidden');
            document.getElementById('selectedRecipeDisplay').classList.add('hidden');
            
            // Clear production info
            document.getElementById('ingredientNeeds').classList.add('hidden');
            document.getElementById('startProductionBtn').disabled = true;
        }

        function updateProductionInfo() {
            const recipeName = selectedProductionRecipe;
            const ingredientNeeds = document.getElementById('ingredientNeeds');
            
            if (!recipeName) {
                ingredientNeeds.classList.add('hidden');
                document.getElementById('startProductionBtn').disabled = true;
                return;
            }
            
            ingredientNeeds.classList.remove('hidden');
            calculateIngredientNeeds();
        }

        function calculateIngredientNeeds() {
            const recipeName = selectedProductionRecipe;
            const quantity = parseFloat(document.getElementById('productionQuantity').value) || 0;
            
            if (!recipeName || !quantity) {
                document.getElementById('startProductionBtn').disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === recipeName);
            if (!recipe) return;
            
            const multiplier = quantity / recipe.yield;
            const ingredientsList = document.getElementById('ingredientsList');
            const stockCheck = document.getElementById('stockCheck');
            
            let canProduce = true;
            let stockStatus = [];
            
            const ingredientsHtml = recipe.ingredients.map(ingredient => {
                const needed = ingredient.amount * multiplier;
                const inventoryItem = inventory.find(item => item.name === ingredient.name);
                const available = inventoryItem ? inventoryItem.quantity : 0;
                const sufficient = available >= needed;
                
                if (!sufficient) canProduce = false;
                
                stockStatus.push({
                    name: ingredient.name,
                    needed: needed,
                    available: available,
                    sufficient: sufficient,
                    unit: ingredient.unit
                });
                
                return `
                    <div class="flex justify-between items-center p-2 rounded ${sufficient ? 'bg-green-100' : 'bg-red-100'}">
                        <span>${ingredient.name}</span>
                        <span class="text-sm">
                            ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ: ${needed.toFixed(2)} ${ingredient.unit}
                            ${sufficient ? '‚úÖ' : '‚ùå'}
                        </span>
                    </div>
                `;
            }).join('');
            
            ingredientsList.innerHTML = ingredientsHtml;
            
            // Stock check summary
            const insufficientItems = stockStatus.filter(item => !item.sufficient);
            if (insufficientItems.length > 0) {
                stockCheck.innerHTML = `
                    <div class="text-red-600 font-medium mb-2">‚ö†Ô∏è ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠:</div>
                    ${insufficientItems.map(item => `
                        <div class="text-red-600 text-xs">
                            ‚Ä¢ ${item.name}: ‡∏°‡∏µ ${item.available} ${item.unit} ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${item.needed.toFixed(2)} ${item.unit} 
                            (‡∏Ç‡∏≤‡∏î ${(item.needed - item.available).toFixed(2)} ${item.unit})
                        </div>
                    `).join('')}
                `;
            } else {
                stockCheck.innerHTML = '<div class="text-green-600 font-medium">‚úÖ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>';
            }
            
            document.getElementById('startProductionBtn').disabled = !canProduce;
        }

        function startProduction() {
            const recipeName = selectedProductionRecipe;
            const quantity = parseFloat(document.getElementById('productionQuantity').value);
            const productionDate = document.getElementById('productionDate').value;
            
            if (!recipeName || !quantity || !productionDate) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            const recipe = recipes.find(r => r.name === recipeName);
            if (!recipe) return;
            
            const multiplier = quantity / recipe.yield;
            
            // Check stock availability one more time
            let canProduce = true;
            const usedIngredients = [];
            
            // Only check ingredients that are actually in inventory (not base recipe costs)
            for (const ingredient of recipe.ingredients) {
                const needed = ingredient.amount * multiplier;
                const inventoryItem = inventory.find(item => item.name === ingredient.name);
                
                if (!inventoryItem || inventoryItem.quantity < needed) {
                    canProduce = false;
                    break;
                }
                
                usedIngredients.push({
                    name: ingredient.name,
                    amount: needed,
                    unit: ingredient.unit,
                    cost: needed * inventoryItem.unitPrice
                });
            }
            
            if (!canProduce) {
                alert('‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï');
                return;
            }
            
            // Deduct ingredients from inventory
            for (const used of usedIngredients) {
                const inventoryItem = inventory.find(item => item.name === used.name);
                inventoryItem.quantity -= used.amount;
                inventoryItem.lastUpdated = new Date().toLocaleDateString('th-TH');
            }
            
            // Calculate total cost including base recipe cost
            // Use unitPrice from inventory for accurate cost calculation
            const ingredientsCost = usedIngredients.reduce((sum, ingredient) => {
                const inventoryItem = inventory.find(item => item.name === ingredient.name);
                const unitPrice = inventoryItem ? inventoryItem.unitPrice : 0;
                return sum + (ingredient.amount * unitPrice);
            }, 0);
            const baseCostForProduction = recipe.baseCost ? (recipe.baseCost * multiplier) : 0;
            const totalCost = ingredientsCost + baseCostForProduction;
            
            productions.push({
                id: Date.now(),
                recipeName,
                quantity,
                productionDate,
                usedIngredients,
                ingredientsCost,
                baseCost: baseCostForProduction,
                baseRecipeName: recipe.baseRecipeName || null,
                totalCost,
                costPerUnit: totalCost / quantity,
                timestamp: new Date().toLocaleString('th-TH')
            });
            
            // Save data (no need to save product stock anymore)
            localStorage.setItem('bakery_inventory', JSON.stringify(inventory));
            localStorage.setItem('bakery_productions', JSON.stringify(productions));
            
            // Update displays
            updateInventoryDisplay();
            updateProductionHistory();
            updateTodayProductionSummary();
            
            // Clear form
            document.getElementById('productionQuantity').value = '';
            clearSelectedRecipe();
            document.getElementById('ingredientNeeds').classList.add('hidden');
            document.getElementById('startProductionBtn').disabled = true;
            
            // Show detailed cost breakdown
            let message = `‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï ${recipeName} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n`;
            if (baseCostForProduction > 0) {
                message += `üìã ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseCostForProduction.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            }
            if (ingredientsCost > 0) {
                message += `üßÇ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°: ${ingredientsCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            }
            message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${(totalCost / quantity).toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            message += `üßÅ ‡∏Ç‡∏ô‡∏°‡∏™‡∏î‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≤‡∏¢ - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å`;
            
            alert(message);
        }

        function updateProductionHistory() {
            const list = document.getElementById('productionHistory');
            const recentProductions = productions.slice(-10).reverse();
            
            list.innerHTML = recentProductions.map(production => `
                <div class="bg-white border border-indigo-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden">
                    <!-- Header -->
                    <div class="px-4 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 border-b border-indigo-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                                    <span class="text-lg">üè≠</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-lg text-gray-800">${production.recipeName}</h3>
                                    <div class="text-sm text-indigo-600 font-medium">${production.productionDate}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-indigo-700">${production.quantity}</div>
                                <div class="text-xs text-indigo-500">‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-4 space-y-3">
                        <!-- Production Stats -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-orange-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-orange-500 uppercase tracking-wide mb-1">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°</div>
                                <div class="text-lg font-bold text-orange-700">${production.totalCost.toFixed(2)}</div>
                                <div class="text-sm text-orange-600">‡∏ö‡∏≤‡∏ó</div>
                            </div>
                            <div class="bg-purple-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-purple-500 uppercase tracking-wide mb-1">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                <div class="text-lg font-bold text-purple-700">${production.costPerUnit.toFixed(2)}</div>
                                <div class="text-sm text-purple-600">‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                        
                        <!-- Cost Breakdown -->
                        ${production.baseCost > 0 ? `
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-3 border border-blue-100">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-blue-600">üìã</span>
                                <h4 class="font-medium text-blue-800">‡πÅ‡∏¢‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h4>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô:</span>
                                    <span class="font-medium text-gray-800">${production.baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°:</span>
                                    <span class="font-medium text-gray-800">${production.ingredientsCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Ingredients Toggle -->
                        <div class="border-t border-gray-100 pt-3">
                            <button onclick="toggleIngredientDetails(${production.id})" class="w-full flex items-center justify-between p-2 text-sm text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 rounded-lg transition-colors">
                                <span class="font-medium">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</span>
                                <svg class="w-4 h-4 transform transition-transform" id="arrow-${production.id}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="details-${production.id}" class="hidden mt-3 bg-gray-50 rounded-lg p-3 border border-gray-200">
                                <div class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-2">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</div>
                                <div class="space-y-2">
                                    ${production.usedIngredients.map(ing => `
                                        <div class="flex justify-between items-center py-1 px-2 bg-white rounded border">
                                            <span class="text-sm font-medium text-gray-700">${ing.name}</span>
                                            <span class="text-sm text-gray-600">${ing.amount.toFixed(2)} ${ing.unit}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Timestamp -->
                        <div class="flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100">
                            <span>‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡∏•‡∏¥‡∏ï</span>
                            <span class="font-medium">${production.timestamp}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleIngredientDetails(productionId) {
            const details = document.getElementById(`details-${productionId}`);
            const arrow = document.getElementById(`arrow-${productionId}`);
            
            details.classList.toggle('hidden');
            
            if (details.classList.contains('hidden')) {
                arrow.style.transform = 'rotate(0deg)';
            } else {
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        function updateTodayProductionSummary() {
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => p.productionDate === today);
            
            const summary = document.getElementById('todayProduction');
            
            if (todayProductions.length === 0) {
                summary.innerHTML = '<p class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>';
                return;
            }
            
            const totalCost = todayProductions.reduce((sum, p) => sum + p.totalCost, 0);
            const productSummary = {};
            
            todayProductions.forEach(p => {
                if (productSummary[p.recipeName]) {
                    productSummary[p.recipeName] += p.quantity;
                } else {
                    productSummary[p.recipeName] = p.quantity;
                }
            });
            
            summary.innerHTML = `
                <div class="text-sm">
                    <div class="font-medium text-indigo-800 mb-1">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï:</div>
                    ${Object.entries(productSummary).map(([name, qty]) => `
                        <div class="flex justify-between">
                            <span>${name}</span>
                            <span>${qty} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                        </div>
                    `).join('')}
                    <div class="border-t mt-2 pt-2 font-medium">
                        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó
                    </div>
                </div>
            `;
        }

        // Recipe Management
        let editingRecipeId = null;

        function updateRecipeOptions() {
            const selects = document.querySelectorAll('.ingredient-select');
            const options = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>' + 
                inventory.map(item => `<option value="${item.name}">${item.name} (${item.unit})</option>`).join('');
            selects.forEach(select => select.innerHTML = options);
            
            // Update base recipe options
            const baseRecipeSelect = document.getElementById('baseRecipe');
            baseRecipeSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</option>' + 
                recipes.map(recipe => `<option value="${recipe.id}">${recipe.name} (${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢)</option>`).join('');
            
            updateRecipesList();
        }

        function loadBaseRecipe() {
            const baseRecipeId = document.getElementById('baseRecipe').value;
            if (!baseRecipeId) {
                // Clear base recipe cost display if no base recipe selected
                const baseCostDisplay = document.getElementById('baseCostDisplay');
                if (baseCostDisplay) baseCostDisplay.remove();
                return;
            }
            
            const baseRecipe = recipes.find(r => r.id == baseRecipeId);
            if (!baseRecipe) return;
            
            // Don't auto-clear ingredients - let user decide
            // Just show the base recipe information
            
            // Load base recipe data only if yield is empty
            if (!document.getElementById('recipeYield').value) {
                document.getElementById('recipeYield').value = baseRecipe.yield;
            }
            
            // Show base recipe cost information
            showBaseCostInfo(baseRecipe);
            
            // Show suggestion to load ingredients
            const suggestion = document.createElement('div');
            suggestion.id = 'loadIngredientsSuggestion';
            suggestion.className = 'bg-yellow-50 p-3 rounded-lg mb-3 border border-yellow-200';
            suggestion.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-sm font-medium text-yellow-800">üí° ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</div>
                        <div class="text-xs text-yellow-600 mt-1">‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="loadBaseIngredients()" class="bg-yellow-500 text-white px-3 py-1 rounded text-xs hover:bg-yellow-600">‡πÇ‡∏´‡∏•‡∏î</button>
                        <button onclick="removeSuggestion()" class="bg-gray-400 text-white px-3 py-1 rounded text-xs hover:bg-gray-500">‡πÑ‡∏°‡πà</button>
                    </div>
                </div>
            `;
            
            // Remove existing suggestion
            const existingSuggestion = document.getElementById('loadIngredientsSuggestion');
            if (existingSuggestion) existingSuggestion.remove();
            
            // Insert suggestion after base cost display
            const baseCostDisplay = document.getElementById('baseCostDisplay');
            if (baseCostDisplay) {
                baseCostDisplay.parentNode.insertBefore(suggestion, baseCostDisplay.nextSibling);
            }
        }

        function loadBaseIngredients() {
            const baseRecipeId = document.getElementById('baseRecipe').value;
            const baseRecipe = recipes.find(r => r.id == baseRecipeId);
            if (!baseRecipe) return;
            
            // Clear existing ingredients except the first row
            const container = document.getElementById('recipeIngredients');
            const ingredientRows = container.querySelectorAll('.ingredient-row');
            ingredientRows.forEach((row, index) => {
                if (index > 0) row.remove();
            });
            
            // Load ingredients
            baseRecipe.ingredients.forEach((ingredient, index) => {
                let row;
                if (index === 0) {
                    // Use first existing row
                    row = ingredientRows[0];
                } else {
                    // Create new rows
                    addIngredientRow();
                    row = container.lastElementChild;
                }
                
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                select.value = ingredient.name;
                amountInput.value = ingredient.amount;
            });
            
            // Remove suggestion
            removeSuggestion();
        }

        function removeSuggestion() {
            const suggestion = document.getElementById('loadIngredientsSuggestion');
            if (suggestion) suggestion.remove();
        }

        function showBaseCostInfo(baseRecipe) {
            // Remove existing base cost display
            const existingDisplay = document.getElementById('baseCostDisplay');
            if (existingDisplay) existingDisplay.remove();
            
            // Create base cost display
            const baseCostDiv = document.createElement('div');
            baseCostDiv.id = 'baseCostDisplay';
            baseCostDiv.className = 'bg-green-50 p-3 rounded-lg mb-3 border border-green-200';
            baseCostDiv.innerHTML = `
                <h4 class="font-medium text-green-800 mb-2">üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4>
                <div class="text-sm text-green-700">
                    <div class="flex justify-between">
                        <span>‡∏™‡∏π‡∏ï‡∏£: ${baseRecipe.name}</span>
                        <span>‡πÑ‡∏î‡πâ: ${baseRecipe.yield} ‡∏ä‡∏¥‡πâ‡∏ô</span>
                    </div>
                    <div class="flex justify-between font-medium">
                        <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°:</span>
                        <span>${baseRecipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between font-medium text-green-800">
                        <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô:</span>
                        <span>${baseRecipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏¥‡πâ‡∏ô</span>
                    </div>
                </div>
                <p class="text-xs text-green-600 mt-2">üí° ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏£‡∏ß‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
            `;
            
            // Insert after base recipe selection
            const baseRecipeContainer = document.querySelector('#baseRecipe').parentElement;
            baseRecipeContainer.parentNode.insertBefore(baseCostDiv, baseRecipeContainer.nextSibling);
        }

        function clearAllIngredients() {
            const container = document.getElementById('recipeIngredients');
            const ingredientRows = container.querySelectorAll('.ingredient-row');
            
            // Remove all rows except the first one
            ingredientRows.forEach((row, index) => {
                if (index > 0) row.remove();
            });
            
            // Clear the first row
            const firstRow = ingredientRows[0];
            firstRow.querySelector('.ingredient-select').value = '';
            firstRow.querySelector('.ingredient-amount').value = '';
        }

        function addIngredientRow() {
            const container = document.getElementById('recipeIngredients');
            const newRow = document.createElement('div');
            newRow.className = 'ingredient-row flex gap-2';
            newRow.innerHTML = `
                <select class="ingredient-select flex-1 p-2 border rounded">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                    ${inventory.map(item => `<option value="${item.name}">${item.name} (${item.unit})</option>`).join('')}
                </select>
                <input type="number" class="ingredient-amount w-24 p-2 border rounded" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                <button onclick="this.parentElement.remove()" class="bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600">-</button>
            `;
            container.appendChild(newRow);
        }

        function createRecipe() {
            const name = document.getElementById('recipeName').value;
            const category = document.getElementById('recipeCategory').value;
            const yield = parseFloat(document.getElementById('recipeYield').value);
            const baseRecipeId = document.getElementById('baseRecipe').value;
            
            if (!name || !yield) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ');
                return;
            }

            const ingredientRows = document.querySelectorAll('.ingredient-row');
            const ingredients = [];
            let additionalCost = 0;
            let baseCost = 0;
            let baseRecipe = null;
            let costBreakdown = [];

            // Calculate base recipe cost if selected
            if (baseRecipeId) {
                baseRecipe = recipes.find(r => r.id == baseRecipeId);
                if (baseRecipe) {
                    // Calculate base cost proportionally based on yield
                    const yieldRatio = yield / baseRecipe.yield;
                    baseCost = baseRecipe.totalCost * yieldRatio;
                }
            }

            // Calculate additional ingredients cost using inventory unit prices
            ingredientRows.forEach(row => {
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                if (select.value && amountInput.value) {
                    const item = inventory.find(i => i.name === select.value);
                    if (!item) {
                        alert(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö "${select.value}" ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á`);
                        return;
                    }
                    
                    const amount = parseFloat(amountInput.value);
                    // Use unitPrice from inventory (price per unit)
                    const cost = amount * item.unitPrice;
                    
                    ingredients.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                    additionalCost += cost;
                    
                    // Add to cost breakdown for detailed display
                    costBreakdown.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                }
            });

            // For base recipe usage, we need at least the base recipe OR additional ingredients
            if (!baseRecipe && ingredients.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }

            const totalCost = baseCost + additionalCost;
            const costPerUnit = totalCost / yield;

            const newRecipe = {
                id: Date.now(),
                name,
                category: category || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
                yield,
                ingredients,
                additionalCost,
                baseCost,
                baseRecipeId: baseRecipeId || null,
                baseRecipeName: baseRecipe ? baseRecipe.name : null,
                totalCost,
                costPerUnit,
                created: new Date().toLocaleDateString('th-TH')
            };

            recipes.push(newRecipe);
            localStorage.setItem('bakery_recipes', JSON.stringify(recipes));
            updateRecipesList();
            
            // Clear form
            clearRecipeForm();
            
            // Show detailed success message with cost breakdown
            let message = `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£ "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n`;
            
            if (baseRecipe) {
                message += `üìã ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseRecipe.name}\n`;
                message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            if (costBreakdown.length > 0) {
                message += `üßÇ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:\n`;
                costBreakdown.forEach(item => {
                    message += `‚Ä¢ ${item.name}: ${item.amount} ${item.unit} √ó ${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó = ${item.cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                });
                message += `\nüí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏£‡∏ß‡∏°: ${additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            message += `üìä ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üìà ‡πÑ‡∏î‡πâ: ${yield} ‡∏ä‡∏¥‡πâ‡∏ô`;
            
            alert(message);
        }

        function clearRecipeForm() {
            document.getElementById('recipeName').value = '';
            document.getElementById('recipeCategory').value = '';
            document.getElementById('recipeYield').value = '';
            document.getElementById('baseRecipe').value = '';
            
            // Remove base cost display
            const baseCostDisplay = document.getElementById('baseCostDisplay');
            if (baseCostDisplay) baseCostDisplay.remove();
            
            // Remove suggestion
            removeSuggestion();
            
            // Clear ingredients
            document.querySelectorAll('.ingredient-row').forEach((row, index) => {
                if (index > 0) row.remove();
            });
            document.querySelector('.ingredient-select').value = '';
            document.querySelector('.ingredient-amount').value = '';
        }

        // Recipe filtering and view functions
        function filterRecipes(category) {
            currentRecipeFilter = category;
            
            // Update filter button styles
            document.querySelectorAll('.recipe-filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-purple-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-purple-500', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            applyRecipeFilter();
        }

        function toggleRecipeView(viewType) {
            currentRecipeView = viewType;
            
            // Update view button styles
            document.querySelectorAll('#compactViewBtn, #detailedViewBtn').forEach(btn => {
                btn.classList.remove('bg-purple-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            if (viewType === 'compact') {
                document.getElementById('compactViewBtn').classList.add('bg-purple-500', 'text-white');
                document.getElementById('compactViewBtn').classList.remove('bg-gray-200', 'text-gray-700');
            } else {
                document.getElementById('detailedViewBtn').classList.add('bg-purple-500', 'text-white');
                document.getElementById('detailedViewBtn').classList.remove('bg-gray-200', 'text-gray-700');
            }
            
            updateRecipesList();
        }

        function applyRecipeFilter() {
            if (currentRecipeFilter === 'all') {
                filteredRecipes = [...recipes];
            } else {
                filteredRecipes = recipes.filter(recipe => 
                    recipe.category === currentRecipeFilter
                );
            }
            
            updateRecipesList();
        }

        function updateRecipesList() {
            const list = document.getElementById('recipesList');
            const countElement = document.getElementById('recipesCount');
            
            // Update count
            countElement.textContent = filteredRecipes.length;
            
            if (recipes.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö<br>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            if (filteredRecipes.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-lg mb-2">üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</div>
                        <div class="text-sm">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏î‡∏π</div>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = filteredRecipes.map(recipe => {
                if (currentRecipeView === 'compact') {
                    return renderCompactRecipe(recipe);
                } else {
                    return renderDetailedRecipe(recipe);
                }
            }).join('');
        }

        function renderCompactRecipe(recipe) {
            const categoryIcon = getCategoryIcon(recipe.category);
            
            return `
                <div class="p-3 border rounded-lg bg-purple-50 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-lg">${categoryIcon}</span>
                                <div class="font-medium text-lg">${recipe.name}</div>
                                <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">${recipe.category}</span>
                            </div>
                            <div class="flex items-center gap-4 text-sm text-gray-600">
                                <span>üìà ‡πÑ‡∏î‡πâ ${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                                <span class="font-medium text-green-600">üí∞ ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                                <span class="text-purple-600">üìä ‡∏£‡∏ß‡∏° ${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                        </div>
                        <div class="flex gap-1 ml-4">
                            <button onclick="viewRecipeDetails(${recipe.id})" class="text-purple-500 hover:text-purple-700 text-xs px-2 py-1 bg-white rounded border">üëÅÔ∏è</button>
                            <button onclick="copyRecipe(${recipe.id})" class="text-blue-500 hover:text-blue-700 text-xs px-2 py-1 bg-white rounded border">üìã</button>
                            <button onclick="editRecipe(${recipe.id})" class="text-green-500 hover:text-green-700 text-xs px-2 py-1 bg-white rounded border">‚úèÔ∏è</button>
                            <button onclick="removeRecipe(${recipe.id})" class="text-red-500 hover:text-red-700 text-xs px-2 py-1 bg-white rounded border">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDetailedRecipe(recipe) {
            const categoryIcon = getCategoryIcon(recipe.category);
            
            // Create detailed cost breakdown display
            let costBreakdown = '';
            
            // Show base recipe cost if exists
            if (recipe.baseRecipeName && recipe.baseCost > 0) {
                costBreakdown = `
                    <div class="text-xs text-blue-600 mt-1">
                        üìã ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${recipe.baseRecipeName} (${recipe.baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó)
                    </div>
                `;
            }
            
            // Show ingredients breakdown
            if (recipe.ingredients && recipe.ingredients.length > 0) {
                costBreakdown += `
                    <div class="text-xs text-orange-600 mt-1">
                        üßÇ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:
                    </div>
                    <div class="text-xs text-gray-600 ml-2">
                `;
                
                recipe.ingredients.forEach(ingredient => {
                    const unitPrice = ingredient.unitPrice || 0;
                    const cost = ingredient.cost || (ingredient.amount * unitPrice);
                    costBreakdown += `
                        <div class="flex justify-between">
                            <span>‚Ä¢ ${ingredient.name} ${ingredient.amount} ${ingredient.unit}</span>
                            <span>${cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    `;
                });
                
                costBreakdown += `</div>`;
                
                if (recipe.additionalCost > 0) {
                    costBreakdown += `
                        <div class="text-xs text-orange-600 mt-1">
                            ‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö: ${recipe.additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó
                        </div>
                    `;
                }
            }
            
            return `
                <div class="p-3 border rounded-lg bg-purple-50">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xl">${categoryIcon}</span>
                        <div class="font-medium text-lg">${recipe.name}</div>
                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">${recipe.category}</span>
                    </div>
                    <div class="text-sm text-gray-600">‡πÑ‡∏î‡πâ ${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ | ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏° ${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    <div class="text-sm text-green-600 font-medium">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    ${costBreakdown}
                    <div class="text-xs text-gray-500 mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${recipe.created}</div>
                    <div class="mt-2 flex gap-2">
                        <button onclick="viewRecipeDetails(${recipe.id})" class="text-purple-500 hover:text-purple-700 text-sm">üëÅÔ∏è ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                        <button onclick="copyRecipe(${recipe.id})" class="text-blue-500 hover:text-blue-700 text-sm">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
                        <button onclick="editRecipe(${recipe.id})" class="text-green-500 hover:text-green-700 text-sm">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button onclick="removeRecipe(${recipe.id})" class="text-red-500 hover:text-red-700 text-sm">üóëÔ∏è ‡∏•‡∏ö‡∏™‡∏π‡∏ï‡∏£</button>
                    </div>
                </div>
            `;
        }

        function getCategoryIcon(category) {
            const icons = {
                '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á': 'üçû',
                '‡πÇ‡∏î‡∏ô‡∏±‡∏ó': 'üç©',
                '‡πÄ‡∏Ñ‡πâ‡∏Å': 'üéÇ',
                '‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ': 'üç™',
                '‡∏°‡∏±‡∏ü‡∏ü‡∏¥‡∏ô': 'üßÅ',
                '‡∏Ñ‡∏£‡∏±‡∏ß‡∏ã‡∏≠‡∏á': 'ü•ê',
                '‡∏û‡∏≤‡∏¢': 'ü•ß',
                '‡∏Ç‡∏ô‡∏°‡πÑ‡∏ó‡∏¢': 'üçÆ',
                '‡∏≠‡∏∑‡πà‡∏ô‡πÜ': 'üç∞'
            };
            return icons[category] || 'üç∞';
        }

        function updateRecipeOptions() {
            const selects = document.querySelectorAll('.ingredient-select');
            const options = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>' + 
                inventory.map(item => `<option value="${item.name}">${item.name} (${item.unit})</option>`).join('');
            selects.forEach(select => select.innerHTML = options);
            
            // Update base recipe options
            const baseRecipeSelect = document.getElementById('baseRecipe');
            baseRecipeSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</option>' + 
                recipes.map(recipe => `<option value="${recipe.id}">${recipe.name} (${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢)</option>`).join('');
            
            // Initialize filtered recipes and update display
            filteredRecipes = [...recipes];
            updateRecipesList();
        }

        function copyRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            // Reset form to create mode
            resetRecipeForm();
            
            // Fill form with recipe data (with "‡∏™‡∏≥‡πÄ‡∏ô‡∏≤" prefix)
            document.getElementById('recipeName').value = `‡∏™‡∏≥‡πÄ‡∏ô‡∏≤ ${recipe.name}`;
            document.getElementById('recipeCategory').value = recipe.category || '';
            document.getElementById('recipeYield').value = recipe.yield;
            
            // Set base recipe if exists
            if (recipe.baseRecipeId) {
                document.getElementById('baseRecipe').value = recipe.baseRecipeId;
                // Trigger base recipe loading to show cost info
                loadBaseRecipe();
            }
            
            // Clear existing ingredients except first row
            clearAllIngredients();
            
            // Load ingredients
            const container = document.getElementById('recipeIngredients');
            recipe.ingredients.forEach((ingredient, index) => {
                let row;
                if (index === 0) {
                    row = container.querySelector('.ingredient-row');
                } else {
                    addIngredientRow();
                    row = container.lastElementChild;
                }
                
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                select.value = ingredient.name;
                amountInput.value = ingredient.amount;
            });
            
            // Scroll to form
            document.getElementById('recipes').scrollIntoView({ behavior: 'smooth' });
        }

        function editRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            editingRecipeId = id;
            
            // Switch to edit mode
            document.getElementById('createRecipeBtn').classList.add('hidden');
            document.getElementById('updateRecipeBtn').classList.remove('hidden');
            document.getElementById('cancelEditBtn').classList.remove('hidden');
            
            // Fill form with recipe data
            document.getElementById('recipeName').value = recipe.name;
            document.getElementById('recipeCategory').value = recipe.category || '';
            document.getElementById('recipeYield').value = recipe.yield;
            
            // Set base recipe if exists
            if (recipe.baseRecipeId) {
                document.getElementById('baseRecipe').value = recipe.baseRecipeId;
                // Trigger base recipe loading to show cost info
                loadBaseRecipe();
            } else {
                document.getElementById('baseRecipe').value = '';
            }
            
            // Clear existing ingredients except first row
            clearAllIngredients();
            
            // Load ingredients
            const container = document.getElementById('recipeIngredients');
            recipe.ingredients.forEach((ingredient, index) => {
                let row;
                if (index === 0) {
                    row = container.querySelector('.ingredient-row');
                } else {
                    addIngredientRow();
                    row = container.lastElementChild;
                }
                
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                select.value = ingredient.name;
                amountInput.value = ingredient.amount;
            });
            
            // Scroll to form
            document.getElementById('recipes').scrollIntoView({ behavior: 'smooth' });
        }

        function updateRecipe() {
            if (!editingRecipeId) return;
            
            const name = document.getElementById('recipeName').value;
            const category = document.getElementById('recipeCategory').value;
            const yield = parseFloat(document.getElementById('recipeYield').value);
            const baseRecipeId = document.getElementById('baseRecipe').value;
            
            if (!name || !yield) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ');
                return;
            }

            const ingredientRows = document.querySelectorAll('.ingredient-row');
            const ingredients = [];
            let additionalCost = 0;
            let baseCost = 0;
            let baseRecipe = null;
            let costBreakdown = [];

            // Calculate base recipe cost if selected
            if (baseRecipeId) {
                baseRecipe = recipes.find(r => r.id == baseRecipeId);
                if (baseRecipe) {
                    // Calculate base cost proportionally based on yield
                    const yieldRatio = yield / baseRecipe.yield;
                    baseCost = baseRecipe.totalCost * yieldRatio;
                }
            }

            // Calculate additional ingredients cost using inventory unit prices
            ingredientRows.forEach(row => {
                const select = row.querySelector('.ingredient-select');
                const amountInput = row.querySelector('.ingredient-amount');
                
                if (select.value && amountInput.value) {
                    const item = inventory.find(i => i.name === select.value);
                    if (!item) {
                        alert(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö "${select.value}" ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á`);
                        return;
                    }
                    
                    const amount = parseFloat(amountInput.value);
                    // Use unitPrice from inventory (price per unit)
                    const cost = amount * item.unitPrice;
                    
                    ingredients.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                    additionalCost += cost;
                    
                    // Add to cost breakdown for detailed display
                    costBreakdown.push({
                        name: select.value,
                        amount,
                        unit: item.unit,
                        unitPrice: item.unitPrice,
                        cost
                    });
                }
            });

            // For base recipe usage, we need at least the base recipe OR additional ingredients
            if (!baseRecipe && ingredients.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }

            const totalCost = baseCost + additionalCost;
            const costPerUnit = totalCost / yield;

            // Update the recipe
            const recipeIndex = recipes.findIndex(r => r.id === editingRecipeId);
            if (recipeIndex !== -1) {
                recipes[recipeIndex] = {
                    ...recipes[recipeIndex],
                    name,
                    category: category || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
                    yield,
                    ingredients,
                    additionalCost,
                    baseCost,
                    baseRecipeId: baseRecipeId || null,
                    baseRecipeName: baseRecipe ? baseRecipe.name : null,
                    totalCost,
                    costPerUnit,
                    updated: new Date().toLocaleDateString('th-TH')
                };

                localStorage.setItem('bakery_recipes', JSON.stringify(recipes));
                updateRecipesList();
                resetRecipeForm();
                
                // Show detailed success message with cost breakdown
                let message = `‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏π‡∏ï‡∏£ "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n`;
                
                if (baseRecipe) {
                    message += `üìã ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseRecipe.name}\n`;
                    message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
                }
                
                if (costBreakdown.length > 0) {
                    message += `üßÇ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:\n`;
                    costBreakdown.forEach(item => {
                        message += `‚Ä¢ ${item.name}: ${item.amount} ${item.unit} √ó ${item.unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó = ${item.cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                    });
                    message += `\nüí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏£‡∏ß‡∏°: ${additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
                }
                
                message += `üìä ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                message += `üìà ‡πÑ‡∏î‡πâ: ${yield} ‡∏ä‡∏¥‡πâ‡∏ô`;
                
                alert(message);
            }
        }

        function cancelEdit() {
            resetRecipeForm();
        }

        function resetRecipeForm() {
            editingRecipeId = null;
            
            // Switch back to create mode
            document.getElementById('createRecipeBtn').classList.remove('hidden');
            document.getElementById('updateRecipeBtn').classList.add('hidden');
            document.getElementById('cancelEditBtn').classList.add('hidden');
            
            // Clear form
            clearRecipeForm();
        }

        function viewRecipeDetails(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;
            
            const categoryIcon = getCategoryIcon(recipe.category);
            let message = `${categoryIcon} ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏ï‡∏£: ${recipe.name}\n`;
            message += `üè∑Ô∏è ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ${recipe.category}\n`;
            message += `üìà ‡πÑ‡∏î‡πâ: ${recipe.yield} ‡∏ä‡∏¥‡πâ‡∏ô\n\n`;
            
            // Show base recipe if exists
            if (recipe.baseRecipeName && recipe.baseCost > 0) {
                message += `üìã ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${recipe.baseRecipeName}\n`;
                message += `üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ${recipe.baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            // Show ingredients details
            if (recipe.ingredients && recipe.ingredients.length > 0) {
                message += `üßÇ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:\n`;
                recipe.ingredients.forEach(ingredient => {
                    const unitPrice = ingredient.unitPrice || 0;
                    const cost = ingredient.cost || (ingredient.amount * unitPrice);
                    message += `‚Ä¢ ${ingredient.name}: ${ingredient.amount} ${ingredient.unit}\n`;
                    message += `  ‡∏£‡∏≤‡∏Ñ‡∏≤: ${unitPrice.toFixed(4)} ‡∏ö‡∏≤‡∏ó/${ingredient.unit} √ó ${ingredient.amount} = ${cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
                });
                message += `\nüí∞ ‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö: ${recipe.additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            }
            
            message += `üìä ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            message += `üéØ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô: ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n`;
            message += `üìÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${recipe.created}`;
            
            if (recipe.updated) {
                message += `\nüìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${recipe.updated}`;
            }
            
            alert(message);
        }

        function removeRecipe(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ?')) {
                recipes = recipes.filter(recipe => recipe.id !== id);
                localStorage.setItem('bakery_recipes', JSON.stringify(recipes));
                updateRecipesList();
                updateRecipeOptions(); // Update base recipe options
            }
        }

        // Sales Management
        function updateSalesOptions() {
            const select = document.getElementById('saleProduct');
            
            // Show all recipes that have been created (no stock checking needed for daily fresh products)
            if (recipes.length === 0) {
                select.innerHTML = '<option value="">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>';
            } else {
                select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>' + 
                    recipes.map(recipe => `<option value="${recipe.name}" data-cost="${recipe.costPerUnit}">${recipe.name} (‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó)</option>`).join('');
            }
            
            updateTodayProductionList();
            updateSalesHistory();
            updateTodaySummary();
        }

        function updateTodayProductionList() {
            const todayProductionItems = document.getElementById('todayProductionItems');
            const today = new Date().toISOString().split('T')[0];
            
            // Get today's production grouped by product
            const todayProductions = productions.filter(p => p.productionDate === today);
            const productionSummary = {};
            
            todayProductions.forEach(prod => {
                if (productionSummary[prod.recipeName]) {
                    productionSummary[prod.recipeName] += prod.quantity;
                } else {
                    productionSummary[prod.recipeName] = prod.quantity;
                }
            });
            
            // Get today's sales to calculate remaining
            const todaySales = sales.filter(sale => sale.date === new Date().toLocaleDateString('th-TH'));
            const salesSummary = {};
            
            todaySales.forEach(sale => {
                if (salesSummary[sale.productName]) {
                    salesSummary[sale.productName] += sale.quantity;
                } else {
                    salesSummary[sale.productName] = sale.quantity;
                }
            });
            
            if (Object.keys(productionSummary).length === 0) {
                todayProductionItems.innerHTML = `
                    <div class="text-center text-blue-600 py-4">
                        <div class="text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                        <div class="text-xs mt-1">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                    </div>
                `;
                return;
            }
            
            // Sort by remaining quantity (items with remaining stock first)
            const sortedProducts = Object.entries(productionSummary).sort((a, b) => {
                const remainingA = a[1] - (salesSummary[a[0]] || 0);
                const remainingB = b[1] - (salesSummary[b[0]] || 0);
                return remainingB - remainingA; // Descending order
            });
            
            todayProductionItems.innerHTML = sortedProducts.map(([productName, produced]) => {
                const sold = salesSummary[productName] || 0;
                const remaining = produced - sold;
                const sellThroughRate = produced > 0 ? (sold / produced * 100) : 0;
                
                // Determine status styling
                let statusColor = 'text-green-600';
                let statusBg = 'bg-green-100';
                let statusIcon = '‚úÖ';
                let statusText = '‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
                
                if (remaining === 0) {
                    statusColor = 'text-red-600';
                    statusBg = 'bg-red-100';
                    statusIcon = 'üî¥';
                    statusText = '‡∏Ç‡∏≤‡∏¢‡∏´‡∏°‡∏î';
                } else if (remaining <= produced * 0.2) { // Less than 20% remaining
                    statusColor = 'text-orange-600';
                    statusBg = 'bg-orange-100';
                    statusIcon = '‚ö†Ô∏è';
                    statusText = '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î';
                }
                
                return `
                    <div class="bg-white rounded-lg border border-gray-200 p-3 hover:shadow-sm transition-shadow">
                        <div class="flex justify-between items-center">
                            <div class="flex-1">
                                <div class="flex items-center gap-2">
                                    <span class="font-medium text-gray-800">${productName}</span>
                                    <span class="text-xs px-2 py-1 rounded-full ${statusBg} ${statusColor} font-medium">
                                        ${statusIcon} ${statusText}
                                    </span>
                                </div>
                                
                                <!-- Production vs Sales Stats -->
                                <div class="mt-2 grid grid-cols-3 gap-3 text-xs">
                                    <div class="text-center">
                                        <div class="text-gray-500">‡∏ú‡∏•‡∏¥‡∏ï</div>
                                        <div class="font-bold text-indigo-600">${produced}</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-gray-500">‡∏Ç‡∏≤‡∏¢</div>
                                        <div class="font-bold text-green-600">${sold}</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-gray-500">‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                                        <div class="font-bold ${statusColor}">${remaining}</div>
                                    </div>
                                </div>
                                
                                <!-- Progress Bar -->
                                <div class="mt-2">
                                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                                        <span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</span>
                                        <span>${sellThroughRate.toFixed(1)}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="h-2 rounded-full transition-all duration-300 ${
                                            sellThroughRate >= 80 ? 'bg-green-500' :
                                            sellThroughRate >= 50 ? 'bg-yellow-500' :
                                            sellThroughRate > 0 ? 'bg-orange-500' : 'bg-gray-400'
                                        }" style="width: ${Math.min(sellThroughRate, 100)}%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Action Button -->
                            <div class="ml-4">
                                ${remaining > 0 ? `
                                    <button onclick="quickSelectProduct('${productName}', ${remaining})" 
                                            class="bg-blue-500 text-white px-3 py-1 rounded text-xs hover:bg-blue-600 transition-colors">
                                        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                                    </button>
                                ` : `
                                    <button onclick="quickSelectProduct('${productName}', 0)" 
                                            class="bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600 transition-colors">
                                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                                    </button>
                                `}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function quickSelectProduct(productName, remainingQuantity) {
            // Set the product in the dropdown
            document.getElementById('saleProduct').value = productName;
            updateSaleInfo();
            
            // Auto-fill remaining quantity
            document.getElementById('remainingQuantity').value = remainingQuantity;
            calculateSoldQuantity();
            
            // Scroll to the form
            document.getElementById('remainingQuantity').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
            
            // Focus on the price input
            setTimeout(() => {
                document.getElementById('salePrice').focus();
            }, 500);
        }

        function updateSaleInfo() {
            const productName = document.getElementById('saleProduct').value;
            const productInfo = document.getElementById('productInfo');
            const productDetails = document.getElementById('productDetails');
            
            if (!productName) {
                productInfo.classList.add('hidden');
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            const pricing = productPricing[productName];
            
            if (!recipe) return;
            
            productInfo.classList.remove('hidden');
            
            // Get today's production for this product
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => 
                p.productionDate === today && p.recipeName === productName
            );
            const todayProduced = todayProductions.reduce((sum, p) => sum + p.quantity, 0);
            
            // Auto-fill sale price if pricing is set
            if (pricing && pricing.sellingPrice) {
                document.getElementById('salePrice').value = pricing.sellingPrice.toFixed(2);
            }
            
            let pricingInfo = '';
            if (pricing) {
                pricingInfo = `
                    <div class="text-green-600"><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î:</strong> ${pricing.sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    <div class="text-purple-600"><strong>‡∏Å‡∏≥‡πÑ‡∏£‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á:</strong> ${pricing.profitPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó (${pricing.profitMargin.toFixed(1)}%)</div>
                `;
            } else {
                pricingInfo = '<div class="text-orange-600"><strong>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</strong> - ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>';
            }
            
            productDetails.innerHTML = `
                <div class="space-y-1">
                    <div><strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${recipe.name}</div>
                    <div><strong>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</strong> ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    ${pricingInfo}
                    ${todayProduced > 0 ? `
                        <div class="text-green-600 bg-green-50 p-2 rounded border border-green-200">
                            <strong>üè≠ ‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</strong> ${todayProduced} ‡∏´‡∏ô‡πà‡∏ß‡∏¢
                        </div>
                    ` : `
                        <div class="text-orange-600 bg-orange-50 p-2 rounded border border-orange-200">
                            <strong>‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</strong> - ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏Å‡πà‡∏≠‡∏ô
                        </div>
                    `}
                    <div class="text-blue-600 text-sm mt-2 bg-blue-50 p-2 rounded">
                        üí° <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:</strong> ‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    </div>
                </div>
            `;
            
            // Clear previous calculations
            document.getElementById('remainingQuantity').value = '';
            if (!pricing || !pricing.sellingPrice) {
                document.getElementById('salePrice').value = '';
            }
            document.getElementById('saleCalculation').classList.add('hidden');
            document.getElementById('recordSaleBtn').disabled = true;
        }





        function calculateSoldQuantity() {
            const productName = document.getElementById('saleProduct').value;
            const remainingQuantity = parseFloat(document.getElementById('remainingQuantity').value);
            
            if (!productName || isNaN(remainingQuantity) || remainingQuantity < 0) {
                document.getElementById('saleCalculation').classList.add('hidden');
                document.getElementById('recordSaleBtn').disabled = true;
                return;
            }
            
            // Get today's production for this product
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => 
                p.productionDate === today && p.recipeName === productName
            );
            const todayProduced = todayProductions.reduce((sum, p) => sum + p.quantity, 0);
            
            if (todayProduced === 0) {
                alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏Å‡πà‡∏≠‡∏ô');
                document.getElementById('remainingQuantity').value = '';
                return;
            }
            
            if (remainingQuantity > todayProduced) {
                alert(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (${remainingQuantity}) ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (${todayProduced}) ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö`);
                document.getElementById('remainingQuantity').value = '';
                return;
            }
            
            // Calculate sold quantity
            const soldQuantity = todayProduced - remainingQuantity;
            
            // Update the display and trigger price calculation
            calculateSaleTotal(soldQuantity);
        }

        function calculateSaleTotal(soldQuantity = null) {
            const productName = document.getElementById('saleProduct').value;
            const remainingQuantity = parseFloat(document.getElementById('remainingQuantity').value);
            const salePrice = parseFloat(document.getElementById('salePrice').value);
            const saleCalculation = document.getElementById('saleCalculation');
            const saleDetails = document.getElementById('saleDetails');
            const recordSaleBtn = document.getElementById('recordSaleBtn');
            
            if (!productName) {
                saleCalculation.classList.add('hidden');
                recordSaleBtn.disabled = true;
                return;
            }
            
            // Get today's production for this product
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => 
                p.productionDate === today && p.recipeName === productName
            );
            const todayProduced = todayProductions.reduce((sum, p) => sum + p.quantity, 0);
            
            // Calculate sold quantity
            let quantity;
            if (soldQuantity !== null) {
                quantity = soldQuantity;
            } else if (!isNaN(remainingQuantity) && remainingQuantity >= 0) {
                quantity = todayProduced - remainingQuantity;
            } else {
                saleCalculation.classList.add('hidden');
                recordSaleBtn.disabled = true;
                return;
            }
            
            if (isNaN(salePrice) || salePrice <= 0 || quantity < 0) {
                saleCalculation.classList.add('hidden');
                recordSaleBtn.disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) return;
            
            const totalRevenue = quantity * salePrice;
            const totalCost = quantity * recipe.costPerUnit;
            const profit = totalRevenue - totalCost;
            const profitMargin = totalRevenue > 0 ? ((profit / totalRevenue) * 100).toFixed(1) : '0';
            
            saleCalculation.classList.remove('hidden');
            saleDetails.innerHTML = `
                <div class="space-y-2">
                    <!-- Calculation Summary -->
                    <div class="bg-blue-50 p-3 rounded border border-blue-200">
                        <div class="font-medium text-blue-800 mb-2">üìä ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</div>
                        <div class="text-sm text-blue-700 space-y-1">
                            <div class="flex justify-between">
                                <span>‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</span>
                                <span class="font-medium">${todayProduced} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                            </div>
                            <div class="flex justify-between">
                                <span>‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</span>
                                <span class="font-medium">${remainingQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                            </div>
                            <div class="flex justify-between border-t border-blue-300 pt-1">
                                <span class="font-medium">‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ:</span>
                                <span class="font-bold text-blue-800">${quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Financial Summary -->
                    <div class="space-y-1">
                        <div class="flex justify-between">
                            <span>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢:</span>
                            <span class="font-medium">${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between">
                            <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</span>
                            <span>${totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between border-t pt-1">
                            <span>‡∏Å‡∏≥‡πÑ‡∏£:</span>
                            <span class="font-bold ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">${profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between">
                            <span>‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</span>
                            <span class="text-sm">${quantity > 0 ? (profit / quantity).toFixed(2) : '0'} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between">
                            <span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£:</span>
                            <span class="text-sm">${profitMargin}%</span>
                        </div>
                    </div>
                    
                    <div class="text-green-600 text-sm mt-2 bg-green-50 p-2 rounded">
                        ‚úÖ <strong>‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</strong> - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
                    </div>
                </div>
            `;
            
            recordSaleBtn.disabled = false;
        }

        function recordSale() {
            const productName = document.getElementById('saleProduct').value;
            const remainingQuantity = parseFloat(document.getElementById('remainingQuantity').value);
            const salePrice = parseFloat(document.getElementById('salePrice').value);

            if (!productName || isNaN(remainingQuantity) || !salePrice) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }

            // Get today's production for this product
            const today = new Date().toISOString().split('T')[0];
            const todayProductions = productions.filter(p => 
                p.productionDate === today && p.recipeName === productName
            );
            const todayProduced = todayProductions.reduce((sum, p) => sum + p.quantity, 0);

            if (todayProduced === 0) {
                alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ');
                return;
            }

            if (remainingQuantity > todayProduced) {
                alert(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (${remainingQuantity}) ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (${todayProduced})`);
                return;
            }

            // Calculate sold quantity
            const soldQuantity = todayProduced - remainingQuantity;

            if (soldQuantity < 0) {
                alert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÑ‡∏î‡πâ');
                return;
            }

            const totalRevenue = soldQuantity * salePrice;
            const totalCost = soldQuantity * recipe.costPerUnit;
            const profit = totalRevenue - totalCost;

            sales.push({
                id: Date.now(),
                productName,
                quantity: soldQuantity,
                remainingQuantity,
                producedQuantity: todayProduced,
                salePrice,
                totalRevenue,
                totalCost,
                profit,
                calculationMethod: 'remaining', // Mark this as calculated from remaining
                date: new Date().toLocaleDateString('th-TH'),
                time: new Date().toLocaleTimeString('th-TH')
            });

            localStorage.setItem('bakery_sales', JSON.stringify(sales));
            
            updateTodayProductionList(); // Update the production list to reflect new sales
            updateSalesHistory();
            updateTodaySummary();
            
            // Clear form
            document.getElementById('remainingQuantity').value = '';
            document.getElementById('salePrice').value = '';
            document.getElementById('saleCalculation').classList.add('hidden');
            document.getElementById('recordSaleBtn').disabled = true;
            
            alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
                  `‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${productName}\n` +
                  `‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: ${todayProduced} ‡∏´‡∏ô‡πà‡∏ß‡∏¢\n` +
                  `‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${remainingQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢\n` +
                  `‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ${soldQuantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢\n` +
                  `‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: ${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏Å‡∏≥‡πÑ‡∏£: ${profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n\n` +
                  `üí° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ - ‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥!`);
        }



        function updateSalesHistory() {
            const list = document.getElementById('salesHistory');
            
            if (sales.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>';
                return;
            }
            
            const recentSales = sales.slice(-10).reverse();
            list.innerHTML = recentSales.map(sale => `
                <div class="bg-white border ${sale.autoGenerated ? 'border-blue-200' : 'border-pink-200'} rounded-xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden">
                    <!-- Header -->
                    <div class="px-4 py-3 bg-gradient-to-r ${sale.autoGenerated ? 'from-blue-50 to-cyan-50 border-b border-blue-200' : 'from-pink-50 to-rose-50 border-b border-pink-200'}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full ${sale.autoGenerated ? 'bg-blue-100' : 'bg-pink-100'} flex items-center justify-center">
                                    <span class="text-lg">${sale.autoGenerated ? 'ü§ñ' : 'üí∞'}</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-lg text-gray-800">${sale.productName}</h3>
                                    ${sale.autoGenerated ? '<div class="text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded-full font-medium">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>' : ''}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold ${sale.profit > 0 ? 'text-green-600' : 'text-red-600'}">${sale.profit.toFixed(2)}</div>
                                <div class="text-xs ${sale.profit > 0 ? 'text-green-500' : 'text-red-500'}">‡∏ö‡∏≤‡∏ó ‡∏Å‡∏≥‡πÑ‡∏£</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-4 space-y-3">
                        <!-- Sale Details -->
                        ${sale.calculationMethod === 'remaining' ? `
                        <!-- Calculation from Remaining -->
                        <div class="bg-blue-50 rounded-lg p-3 border border-blue-200 mb-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-blue-600">üßÆ</span>
                                <h5 class="font-medium text-blue-800 text-sm">‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h5>
                            </div>
                            <div class="grid grid-cols-3 gap-3 text-sm">
                                <div class="text-center">
                                    <div class="text-xs text-blue-600 mb-1">‡∏ú‡∏•‡∏¥‡∏ï</div>
                                    <div class="font-bold text-blue-700">${sale.producedQuantity || sale.quantity}</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs text-blue-600 mb-1">‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                                    <div class="font-bold text-blue-700">${sale.remainingQuantity || 0}</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs text-blue-600 mb-1">‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ</div>
                                    <div class="font-bold text-blue-800">${sale.quantity}</div>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <div class="grid grid-cols-3 gap-4">
                            <div class="bg-gray-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ</div>
                                <div class="text-lg font-bold text-gray-800">${sale.quantity}</div>
                                <div class="text-sm text-gray-600">‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                            </div>
                            <div class="bg-blue-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-blue-500 uppercase tracking-wide mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                <div class="text-lg font-bold text-blue-700">${sale.salePrice.toFixed(2)}</div>
                                <div class="text-sm text-blue-600">‡∏ö‡∏≤‡∏ó</div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-3">
                                <div class="text-xs font-medium text-green-500 uppercase tracking-wide mb-1">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</div>
                                <div class="text-lg font-bold text-green-700">${sale.totalRevenue.toFixed(2)}</div>
                                <div class="text-sm text-green-600">‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                        
                        <!-- Profit Analysis -->
                        <div class="bg-gradient-to-r ${sale.profit > 0 ? 'from-green-50 to-emerald-50 border border-green-100' : 'from-red-50 to-pink-50 border border-red-100'} rounded-lg p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="${sale.profit > 0 ? 'text-green-600' : 'text-red-600'}">${sale.profit > 0 ? 'üìà' : 'üìâ'}</span>
                                <h4 class="font-medium ${sale.profit > 0 ? 'text-green-800' : 'text-red-800'}">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≥‡πÑ‡∏£</h4>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢:</span>
                                    <span class="font-medium text-gray-800">${sale.totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</span>
                                    <span class="font-medium text-gray-800">${sale.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                                <div class="flex justify-between col-span-2 pt-2 border-t ${sale.profit > 0 ? 'border-green-200' : 'border-red-200'}">
                                    <span class="${sale.profit > 0 ? 'text-green-600' : 'text-red-600'} font-medium">‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô:</span>
                                    <span class="font-bold ${sale.profit > 0 ? 'text-green-700' : 'text-red-700'}">${sale.profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                            </div>
                        </div>
                        
                        ${sale.note ? `
                        <div class="bg-blue-50 rounded-lg p-2 border border-blue-100">
                            <div class="text-xs font-medium text-blue-600 mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</div>
                            <div class="text-sm text-blue-700">${sale.note}</div>
                        </div>
                        ` : ''}
                        
                        <!-- Timestamp -->
                        <div class="flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100">
                            <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</span>
                            <span class="font-medium">${sale.date} ${sale.time}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateTodaySummary() {
            const today = new Date().toLocaleDateString('th-TH');
            const todayISO = new Date().toISOString().split('T')[0];
            
            // ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            const todaySales = sales.filter(sale => sale.date === today);
            const totalRevenue = todaySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            
            // ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            const todayProductions = productions.filter(p => p.productionDate === todayISO);
            const totalProductionCost = todayProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            
            // ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ = ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï
            const netProfit = totalRevenue - totalProductionCost;
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            document.getElementById('todayRevenue').textContent = totalRevenue.toFixed(2) + ' ‡∏ö‡∏≤‡∏ó';
            document.getElementById('todayProductionCost').textContent = totalProductionCost.toFixed(2) + ' ‡∏ö‡∏≤‡∏ó';
            
            const netProfitElement = document.getElementById('todayNetProfit');
            netProfitElement.textContent = netProfit.toFixed(2) + ' ‡∏ö‡∏≤‡∏ó';
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô
            if (netProfit > 0) {
                netProfitElement.className = 'font-bold text-green-600';
            } else if (netProfit < 0) {
                netProfitElement.className = 'font-bold text-red-600';
            } else {
                netProfitElement.className = 'font-bold text-gray-600';
            }
        }

        // Reports Management
        function initializeReports() {
            // Set default dates
            const today = new Date();
            document.getElementById('dailyReportDate').value = today.toISOString().split('T')[0];
            
            const year = today.getFullYear();
            const week = getWeekNumber(today);
            document.getElementById('weeklyReportWeek').value = `${year}-W${week.toString().padStart(2, '0')}`;
            
            const month = today.toISOString().slice(0, 7);
            document.getElementById('monthlyReportMonth').value = month;
            
            // Show daily report by default
            showReport('daily');
        }

        function showReport(reportType) {
            // Hide all reports
            document.querySelectorAll('.report-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected report
            document.getElementById(`${reportType}Report`).classList.remove('hidden');
            
            // Update button styles
            document.querySelectorAll('.report-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2');
            });
            event.target.classList.add('ring-2', 'ring-offset-2');
            
            // Generate report
            if (reportType === 'daily') generateDailyReport();
            if (reportType === 'weekly') generateWeeklyReport();
            if (reportType === 'monthly') generateMonthlyReport();
        }

        function generateDailyReport() {
            const selectedDate = document.getElementById('dailyReportDate').value;
            if (!selectedDate) return;
            
            const dateStr = new Date(selectedDate).toLocaleDateString('th-TH');
            const dailySales = sales.filter(sale => sale.date === dateStr);
            const dailyProductions = productions.filter(p => p.productionDate === selectedDate);
            
            // Calculate statistics
            const totalRevenue = dailySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const totalProfit = dailySales.reduce((sum, sale) => sum + sale.profit, 0);
            const totalCost = dailySales.reduce((sum, sale) => sum + sale.totalCost, 0);
            const totalItems = dailySales.reduce((sum, sale) => sum + sale.quantity, 0);
            const productionCost = dailyProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥
            const netProfit = totalRevenue - productionCost;
            const profitMargin = totalRevenue > 0 ? ((netProfit / totalRevenue) * 100) : 0;
            
            // Display statistics as table
            const statsDiv = document.getElementById('dailyStats');
            statsDiv.innerHTML = `
                <table class="w-full text-sm">
                    <tbody class="divide-y divide-gray-200">
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-3 font-medium text-gray-700">üí∞ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</td>
                            <td class="py-2 px-3 text-right font-bold text-green-600">${totalRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-3 font-medium text-gray-700">üè≠ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</td>
                            <td class="py-2 px-3 text-right font-bold text-orange-600">${productionCost.toLocaleString()} ‡∏ö‡∏≤‡∏ó</td>
                        </tr>
                        <tr class="hover:bg-gray-50 ${netProfit >= 0 ? 'bg-green-50' : 'bg-red-50'}">
                            <td class="py-2 px-3 font-medium ${netProfit >= 0 ? 'text-green-700' : 'text-red-700'}">
                                ${netProfit >= 0 ? 'üìà ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'}
                            </td>
                            <td class="py-2 px-3 text-right font-bold ${netProfit >= 0 ? 'text-green-700' : 'text-red-700'}">
                                ${netProfit.toLocaleString()} ‡∏ö‡∏≤‡∏ó
                            </td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-3 font-medium text-gray-700">üìä ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£</td>
                            <td class="py-2 px-3 text-right font-bold ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${profitMargin.toFixed(1)}%
                            </td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-3 font-medium text-gray-700">üì¶ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</td>
                            <td class="py-2 px-3 text-right font-bold text-purple-600">${totalItems.toLocaleString()} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-3 font-medium text-gray-700">üíµ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏´‡∏ô‡πà‡∏ß‡∏¢</td>
                            <td class="py-2 px-3 text-right font-bold text-blue-600">
                                ${totalItems > 0 ? (totalRevenue / totalItems).toFixed(2) : '0'} ‡∏ö‡∏≤‡∏ó
                            </td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-3 font-medium text-gray-700">üéØ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</td>
                            <td class="py-2 px-3 text-right font-bold text-indigo-600">${dailySales.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</td>
                        </tr>
                    </tbody>
                </table>
            `;
            
            // Calculate production data for the day
            const productionData = {};
            dailyProductions.forEach(prod => {
                if (productionData[prod.recipeName]) {
                    productionData[prod.recipeName] += prod.quantity;
                } else {
                    productionData[prod.recipeName] = prod.quantity;
                }
            });
            
            // Performance Chart
            const performanceChartDiv = document.getElementById('performanceChartContent');
            
            // Top products with detailed sales breakdown and production comparison
            const productSales = {};
            dailySales.forEach(sale => {
                if (productSales[sale.productName]) {
                    productSales[sale.productName].quantity += sale.quantity;
                    productSales[sale.productName].revenue += sale.totalRevenue;
                    productSales[sale.productName].profit += sale.profit;
                    productSales[sale.productName].sales.push(sale);
                } else {
                    productSales[sale.productName] = {
                        quantity: sale.quantity,
                        revenue: sale.totalRevenue,
                        profit: sale.profit,
                        sales: [sale]
                    };
                }
            });
            
            // Combine all products (both produced and sold)
            const allProducts = new Set([...Object.keys(productionData), ...Object.keys(productSales)]);
            const productAnalysis = Array.from(allProducts).map(productName => {
                const produced = productionData[productName] || 0;
                const sold = productSales[productName]?.quantity || 0;
                const salesData = productSales[productName];
                const sellThroughRate = produced > 0 ? (sold / produced * 100) : (sold > 0 ? 100 : 0);
                
                return {
                    name: productName,
                    produced,
                    sold,
                    sellThroughRate,
                    revenue: salesData?.revenue || 0,
                    profit: salesData?.profit || 0,
                    sales: salesData?.sales || []
                };
            }).sort((a, b) => b.sold - a.sold);
            
            // Create performance chart (horizontal bar chart)
            if (productAnalysis.length === 0) {
                performanceChartDiv.innerHTML = '<div class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>';
            } else {
                const maxRevenue = Math.max(...productAnalysis.map(p => p.revenue));
                performanceChartDiv.innerHTML = productAnalysis.slice(0, 5).map(product => {
                    const barWidth = maxRevenue > 0 ? (product.revenue / maxRevenue * 100) : 0;
                    const performanceColor = product.sellThroughRate >= 80 ? 'bg-green-500' :
                                           product.sellThroughRate >= 50 ? 'bg-yellow-500' :
                                           product.sellThroughRate > 0 ? 'bg-orange-500' : 'bg-red-500';
                    
                    return `
                        <div class="mb-3">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-sm font-medium text-gray-700">${product.name}</span>
                                <span class="text-sm font-bold text-green-600">${product.revenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3 relative">
                                <div class="${performanceColor} h-3 rounded-full transition-all duration-500" style="width: ${barWidth}%"></div>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-xs font-medium text-white">${product.sellThroughRate.toFixed(0)}%</span>
                                </div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-600 mt-1">
                                <span>‡∏ú‡∏•‡∏¥‡∏ï: ${product.produced} | ‡∏Ç‡∏≤‡∏¢: ${product.sold}</span>
                                <span>‡∏Å‡∏≥‡πÑ‡∏£: ${product.profit.toFixed(0)} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // Top Products Table
            const topProductsDiv = document.getElementById('dailyTopProducts');
            if (productAnalysis.length === 0) {
                topProductsDiv.innerHTML = '<div class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>';
            } else {
                topProductsDiv.innerHTML = `
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left font-medium text-gray-700">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                    <th class="px-3 py-2 text-left font-medium text-gray-700">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                    <th class="px-3 py-2 text-center font-medium text-gray-700">‡∏ú‡∏•‡∏¥‡∏ï</th>
                                    <th class="px-3 py-2 text-center font-medium text-gray-700">‡∏Ç‡∏≤‡∏¢</th>
                                    <th class="px-3 py-2 text-center font-medium text-gray-700">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ç‡∏≤‡∏¢</th>
                                    <th class="px-3 py-2 text-right font-medium text-gray-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</th>
                                    <th class="px-3 py-2 text-right font-medium text-gray-700">‡∏Å‡∏≥‡πÑ‡∏£</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${productAnalysis.slice(0, 10).map((product, index) => {
                                    const performanceColor = product.sellThroughRate >= 80 ? 'text-green-600' :
                                                           product.sellThroughRate >= 50 ? 'text-yellow-600' :
                                                           product.sellThroughRate > 0 ? 'text-orange-600' : 'text-red-600';
                                    const performanceIcon = product.sellThroughRate >= 80 ? 'üî•' :
                                                          product.sellThroughRate >= 50 ? 'üìà' :
                                                          product.sellThroughRate > 0 ? 'üìä' : '‚ö†Ô∏è';
                                    
                                    return `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-3 py-2 text-center">
                                                <span class="inline-flex items-center justify-center w-6 h-6 rounded-full ${
                                                    index === 0 ? 'bg-yellow-100 text-yellow-800' :
                                                    index === 1 ? 'bg-gray-100 text-gray-800' :
                                                    index === 2 ? 'bg-orange-100 text-orange-800' :
                                                    'bg-blue-100 text-blue-800'
                                                } text-xs font-bold">
                                                    ${index + 1}
                                                </span>
                                            </td>
                                            <td class="px-3 py-2 font-medium text-gray-800">${product.name}</td>
                                            <td class="px-3 py-2 text-center text-indigo-600 font-medium">${product.produced}</td>
                                            <td class="px-3 py-2 text-center text-green-600 font-medium">${product.sold}</td>
                                            <td class="px-3 py-2 text-center ${performanceColor} font-medium">
                                                ${performanceIcon} ${product.sellThroughRate.toFixed(1)}%
                                            </td>
                                            <td class="px-3 py-2 text-right text-green-600 font-bold">${product.revenue.toLocaleString()}</td>
                                            <td class="px-3 py-2 text-right ${product.profit > 0 ? 'text-green-600' : 'text-red-600'} font-bold">
                                                ${product.profit.toLocaleString()}
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
        }

        function generateWeeklyReport() {
            const selectedWeek = document.getElementById('weeklyReportWeek').value;
            if (!selectedWeek) return;
            
            const [year, week] = selectedWeek.split('-W');
            const weekStart = getDateOfWeek(parseInt(year), parseInt(week));
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            // Filter sales for the week
            const weeklySales = sales.filter(sale => {
                const saleDate = parseThaiDate(sale.date);
                return saleDate >= weekStart && saleDate <= weekEnd;
            });
            
            const totalRevenue = weeklySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const totalProfit = weeklySales.reduce((sum, sale) => sum + sale.profit, 0);
            const totalItems = weeklySales.reduce((sum, sale) => sum + sale.quantity, 0);
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
            const weeklyProductions = productions.filter(p => {
                const prodDate = new Date(p.productionDate);
                return prodDate >= weekStart && prodDate <= weekEnd;
            });
            const totalProductionCost = weeklyProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            const netProfit = totalRevenue - totalProductionCost;
            
            // Display statistics
            const statsDiv = document.getElementById('weeklyStats');
            statsDiv.innerHTML = `
                <div class="space-y-3">
                    <div class="p-3 bg-green-100 rounded-lg">
                        <div class="text-sm text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                        <div class="text-xl font-bold text-green-800">${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-orange-100 rounded-lg">
                        <div class="text-sm text-orange-700">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                        <div class="text-xl font-bold text-orange-800">${totalProductionCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 ${netProfit >= 0 ? 'bg-green-100' : 'bg-red-100'} rounded-lg border-2 ${netProfit >= 0 ? 'border-green-300' : 'border-red-300'}">
                        <div class="text-sm ${netProfit >= 0 ? 'text-green-700' : 'text-red-700'}">
                            ${netProfit >= 0 ? 'üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'}
                        </div>
                        <div class="text-xl font-bold ${netProfit >= 0 ? 'text-green-800' : 'text-red-800'}">${netProfit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <div class="text-sm text-purple-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</div>
                        <div class="text-xl font-bold text-purple-800">${totalItems} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    </div>
                    <div class="p-3 bg-gray-100 rounded-lg">
                        <div class="text-sm text-gray-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</div>
                        <div class="text-xl font-bold text-gray-800">${(totalRevenue / 7).toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                </div>
            `;
            
            // Get weekly production data
            const weeklyProductionData = {};
            weeklyProductions.forEach(prod => {
                if (weeklyProductionData[prod.recipeName]) {
                    weeklyProductionData[prod.recipeName] += prod.quantity;
                } else {
                    weeklyProductionData[prod.recipeName] = prod.quantity;
                }
            });

            // Daily analysis within week with product breakdown and production comparison
            const dailyAnalysis = {};
            const days = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
            
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(weekStart);
                currentDate.setDate(currentDate.getDate() + i);
                const dateStr = currentDate.toLocaleDateString('th-TH');
                const dateISO = currentDate.toISOString().split('T')[0];
                const dayName = days[currentDate.getDay()];
                
                const daySales = weeklySales.filter(sale => sale.date === dateStr);
                const dayProductions = weeklyProductions.filter(p => p.productionDate === dateISO);
                const dayRevenue = daySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
                const dayItems = daySales.reduce((sum, sale) => sum + sale.quantity, 0);
                
                // Production data for this day
                const dayProductionData = {};
                dayProductions.forEach(prod => {
                    if (dayProductionData[prod.recipeName]) {
                        dayProductionData[prod.recipeName] += prod.quantity;
                    } else {
                        dayProductionData[prod.recipeName] = prod.quantity;
                    }
                });
                
                // Product breakdown for each day with production comparison
                const dayProductSales = {};
                daySales.forEach(sale => {
                    if (dayProductSales[sale.productName]) {
                        dayProductSales[sale.productName].quantity += sale.quantity;
                        dayProductSales[sale.productName].revenue += sale.totalRevenue;
                    } else {
                        dayProductSales[sale.productName] = {
                            quantity: sale.quantity,
                            revenue: sale.totalRevenue
                        };
                    }
                });
                
                // Combine production and sales data
                const allDayProducts = new Set([...Object.keys(dayProductionData), ...Object.keys(dayProductSales)]);
                const dayProductAnalysis = Array.from(allDayProducts).map(productName => {
                    const produced = dayProductionData[productName] || 0;
                    const sold = dayProductSales[productName]?.quantity || 0;
                    const revenue = dayProductSales[productName]?.revenue || 0;
                    const sellThroughRate = produced > 0 ? (sold / produced * 100) : (sold > 0 ? 100 : 0);
                    
                    return {
                        name: productName,
                        produced,
                        sold,
                        revenue,
                        sellThroughRate
                    };
                }).sort((a, b) => b.sold - a.sold);
                
                dailyAnalysis[dayName] = {
                    date: dateStr,
                    revenue: dayRevenue,
                    items: dayItems,
                    products: dayProductSales,
                    productAnalysis: dayProductAnalysis,
                    salesCount: daySales.length,
                    productionCount: dayProductions.length
                };
            }
            
            const dayAnalysisDiv = document.getElementById('weeklyDayAnalysis');
            dayAnalysisDiv.innerHTML = `
                <div class="space-y-4">
                    <h4 class="font-medium text-gray-800 border-b pb-2">üìÖ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï vs ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢)</h4>
                    ${Object.entries(dailyAnalysis).map(([day, data]) => `
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition-all duration-200">
                            <!-- Day Header -->
                            <div class="bg-gradient-to-r from-teal-50 to-cyan-50 px-4 py-3 border-b">
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center">
                                            <span class="text-sm font-bold text-teal-600">${day.charAt(0)}</span>
                                        </div>
                                        <div>
                                            <div class="font-semibold text-gray-800">${day}</div>
                                            <div class="text-xs text-teal-600">${data.date} ‚Ä¢ ${data.salesCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ç‡∏≤‡∏¢ ‚Ä¢ ${data.productionCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ú‡∏•‡∏¥‡∏ï</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-teal-600">${data.revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                        <div class="text-sm text-gray-600">${data.items} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Product Analysis -->
                            ${data.productAnalysis.length > 0 ? `
                                <div class="p-4">
                                    <div class="space-y-3">
                                        ${data.productAnalysis.map(product => {
                                            // Determine performance styling
                                            let performanceColor = 'text-gray-600';
                                            let performanceBg = 'bg-gray-50';
                                            let performanceIcon = 'üìä';
                                            
                                            if (product.sellThroughRate >= 80) {
                                                performanceColor = 'text-green-600';
                                                performanceBg = 'bg-green-50';
                                                performanceIcon = 'üî•';
                                            } else if (product.sellThroughRate >= 50) {
                                                performanceColor = 'text-yellow-600';
                                                performanceBg = 'bg-yellow-50';
                                                performanceIcon = 'üìà';
                                            } else if (product.sellThroughRate > 0) {
                                                performanceColor = 'text-orange-600';
                                                performanceBg = 'bg-orange-50';
                                                performanceIcon = 'üìâ';
                                            } else if (product.produced > 0) {
                                                performanceColor = 'text-red-600';
                                                performanceBg = 'bg-red-50';
                                                performanceIcon = '‚ö†Ô∏è';
                                            }
                                            
                                            return `
                                                <div class="border border-gray-200 rounded-lg overflow-hidden">
                                                    <!-- Product Header -->
                                                    <div class="bg-gray-50 px-3 py-2 border-b">
                                                        <div class="flex justify-between items-center">
                                                            <div class="font-medium text-gray-800">${product.name}</div>
                                                            <div class="text-sm ${performanceColor} font-medium">
                                                                ${performanceIcon} ${product.sellThroughRate.toFixed(1)}%
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Product Stats -->
                                                    <div class="p-3">
                                                        <div class="grid grid-cols-3 gap-3 mb-3">
                                                            <div class="text-center">
                                                                <div class="text-xs text-gray-500 mb-1">‡∏ú‡∏•‡∏¥‡∏ï</div>
                                                                <div class="font-bold text-indigo-600">${product.produced}</div>
                                                            </div>
                                                            <div class="text-center">
                                                                <div class="text-xs text-gray-500 mb-1">‡∏Ç‡∏≤‡∏¢</div>
                                                                <div class="font-bold text-green-600">${product.sold}</div>
                                                            </div>
                                                            <div class="text-center">
                                                                <div class="text-xs text-gray-500 mb-1">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</div>
                                                                <div class="font-bold text-green-600">${product.revenue.toFixed(2)}</div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Progress Bar -->
                                                        ${product.produced > 0 ? `
                                                            <div class="mt-2">
                                                                <div class="flex justify-between text-xs text-gray-600 mb-1">
                                                                    <span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</span>
                                                                    <span>${product.sold}/${product.produced}</span>
                                                                </div>
                                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                                    <div class="h-2 rounded-full transition-all duration-300 ${
                                                                        product.sellThroughRate >= 80 ? 'bg-green-500' :
                                                                        product.sellThroughRate >= 50 ? 'bg-yellow-500' :
                                                                        product.sellThroughRate > 0 ? 'bg-orange-500' : 'bg-red-500'
                                                                    }" style="width: ${Math.min(product.sellThroughRate, 100)}%"></div>
                                                                </div>
                                                                ${product.produced > product.sold ? `
                                                                    <div class="text-xs text-orange-600 mt-1">
                                                                        ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${product.produced - product.sold} ‡∏´‡∏ô‡πà‡∏ß‡∏¢
                                                                    </div>
                                                                ` : ''}
                                                            </div>
                                                        ` : product.sold > 0 ? `
                                                            <div class="text-xs text-blue-600 bg-blue-50 p-2 rounded">
                                                                ‡∏Ç‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏°
                                                            </div>
                                                        ` : ''}
                                                    </div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            ` : `
                                <div class="p-4 text-center text-gray-500 text-sm">
                                    ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                                </div>
                            `}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateMonthlyReport() {
            const selectedMonth = document.getElementById('monthlyReportMonth').value;
            if (!selectedMonth) return;
            
            const [year, month] = selectedMonth.split('-');
            const monthStart = new Date(parseInt(year), parseInt(month) - 1, 1);
            const monthEnd = new Date(parseInt(year), parseInt(month), 0);
            
            // Filter sales for the month
            const monthlySales = sales.filter(sale => {
                const saleDate = parseThaiDate(sale.date);
                return saleDate >= monthStart && saleDate <= monthEnd;
            });
            
            const totalRevenue = monthlySales.reduce((sum, sale) => sum + sale.totalRevenue, 0);
            const totalProfit = monthlySales.reduce((sum, sale) => sum + sale.profit, 0);
            const totalItems = monthlySales.reduce((sum, sale) => sum + sale.quantity, 0);
            const daysInMonth = monthEnd.getDate();
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
            const monthlyProductions = productions.filter(p => {
                const prodDate = new Date(p.productionDate);
                return prodDate >= monthStart && prodDate <= monthEnd;
            });
            const totalProductionCost = monthlyProductions.reduce((sum, prod) => sum + prod.totalCost, 0);
            const netProfit = totalRevenue - totalProductionCost;
            
            // Display statistics
            const statsDiv = document.getElementById('monthlyStats');
            statsDiv.innerHTML = `
                <div class="space-y-3">
                    <div class="p-3 bg-green-100 rounded-lg">
                        <div class="text-sm text-green-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                        <div class="text-xl font-bold text-green-800">${totalRevenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-orange-100 rounded-lg">
                        <div class="text-sm text-orange-700">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>
                        <div class="text-xl font-bold text-orange-800">${totalProductionCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 ${netProfit >= 0 ? 'bg-green-100' : 'bg-red-100'} rounded-lg border-2 ${netProfit >= 0 ? 'border-green-300' : 'border-red-300'}">
                        <div class="text-sm ${netProfit >= 0 ? 'text-green-700' : 'text-red-700'}">
                            ${netProfit >= 0 ? 'üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'}
                        </div>
                        <div class="text-xl font-bold ${netProfit >= 0 ? 'text-green-800' : 'text-red-800'}">${netProfit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <div class="text-sm text-purple-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</div>
                        <div class="text-xl font-bold text-purple-800">${totalItems} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                    </div>
                    <div class="p-3 bg-gray-100 rounded-lg">
                        <div class="text-sm text-gray-700">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</div>
                        <div class="text-xl font-bold text-gray-800">${(totalRevenue / daysInMonth).toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                </div>
            `;
            
            // Monthly trends with daily breakdown
            const dailyTrends = {};
            
            // Group sales by date
            monthlySales.forEach(sale => {
                const saleDate = sale.date;
                if (!dailyTrends[saleDate]) {
                    dailyTrends[saleDate] = {
                        revenue: 0,
                        items: 0,
                        products: {},
                        salesCount: 0
                    };
                }
                
                dailyTrends[saleDate].revenue += sale.totalRevenue;
                dailyTrends[saleDate].items += sale.quantity;
                dailyTrends[saleDate].salesCount++;
                
                // Product breakdown
                if (dailyTrends[saleDate].products[sale.productName]) {
                    dailyTrends[saleDate].products[sale.productName].quantity += sale.quantity;
                    dailyTrends[saleDate].products[sale.productName].revenue += sale.totalRevenue;
                } else {
                    dailyTrends[saleDate].products[sale.productName] = {
                        quantity: sale.quantity,
                        revenue: sale.totalRevenue
                    };
                }
            });
            
            // Sort by date (most recent first)
            const sortedDailyTrends = Object.entries(dailyTrends)
                .sort((a, b) => parseThaiDate(b[0]) - parseThaiDate(a[0]))
                .slice(0, 15); // Show last 15 days with sales
            
            const trendsDiv = document.getElementById('monthlyTrends');
            if (sortedDailyTrends.length === 0) {
                trendsDiv.innerHTML = '<div class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>';
            } else {
                trendsDiv.innerHTML = `
                    <div class="space-y-3">
                        <h4 class="font-medium text-gray-800 border-b pb-2">üìà ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (15 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h4>
                        ${sortedDailyTrends.map(([date, data]) => `
                            <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                                <!-- Date Header -->
                                <div class="bg-gradient-to-r from-teal-50 to-cyan-50 px-3 py-2 border-b">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <div class="font-medium text-gray-800">${date}</div>
                                            <div class="text-xs text-teal-600">${data.salesCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-bold text-teal-600">${data.revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                            <div class="text-sm text-gray-600">${data.items} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Product Details -->
                                <div class="p-3">
                                    <div class="text-xs text-gray-500 mb-2">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢:</div>
                                    <div class="space-y-1">
                                        ${Object.entries(data.products)
                                            .sort((a, b) => b[1].quantity - a[1].quantity)
                                            .map(([productName, productData]) => `
                                            <div class="flex justify-between items-center text-sm py-1 px-2 bg-gray-50 rounded">
                                                <span class="text-gray-700">${productName}</span>
                                                <div class="flex gap-3 text-xs">
                                                    <span><strong>${productData.quantity}</strong> ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                                                    <span class="text-green-600"><strong>${productData.revenue.toFixed(2)}</strong> ‡∏ö‡∏≤‡∏ó</span>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        
                        ${Object.keys(dailyTrends).length > 15 ? `
                            <div class="text-center text-sm text-gray-500 py-2">
                                ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å ${Object.keys(dailyTrends).length - 15} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢...
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            // Customer analysis (simplified)
            const productAnalysis = {};
            monthlySales.forEach(sale => {
                if (productAnalysis[sale.productName]) {
                    productAnalysis[sale.productName].quantity += sale.quantity;
                    productAnalysis[sale.productName].revenue += sale.totalRevenue;
                    productAnalysis[sale.productName].profit += sale.profit;
                } else {
                    productAnalysis[sale.productName] = {
                        quantity: sale.quantity,
                        revenue: sale.totalRevenue,
                        profit: sale.profit
                    };
                }
            });
            
            const topProducts = Object.entries(productAnalysis)
                .sort((a, b) => b[1].revenue - a[1].revenue)
                .slice(0, 5);
            
            // Cost Analysis Report
            const costAnalysisDiv = document.getElementById('costAnalysisReport');
            const profitMargin = totalRevenue > 0 ? ((netProfit / totalRevenue) * 100).toFixed(1) : '0';
            const avgDailyProduction = totalProductionCost / daysInMonth;
            const avgDailySales = totalRevenue / daysInMonth;
            
            costAnalysisDiv.innerHTML = `
                <div class="p-3 bg-white rounded border">
                    <h5 class="font-medium text-red-800 mb-2">üí∞ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h5>
                    <div class="text-2xl font-bold ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'}">${profitMargin}%</div>
                    <div class="text-xs text-gray-600 mt-1">
                        ${netProfit >= 0 ? '‡∏Å‡∏≥‡πÑ‡∏£' : '‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô'} ${Math.abs(netProfit).toFixed(2)} ‡∏ö‡∏≤‡∏ó
                    </div>
                </div>
                <div class="p-3 bg-white rounded border">
                    <h5 class="font-medium text-red-800 mb-2">üìà ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</h5>
                    <div class="text-2xl font-bold text-orange-600">${avgDailyProduction.toFixed(2)}</div>
                    <div class="text-xs text-gray-600 mt-1">‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô</div>
                </div>
                <div class="p-3 bg-white rounded border">
                    <h5 class="font-medium text-red-800 mb-2">üíµ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</h5>
                    <div class="text-2xl font-bold text-green-600">${avgDailySales.toFixed(2)}</div>
                    <div class="text-xs text-gray-600 mt-1">‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô</div>
                </div>
            `;
            
            const customerAnalysisDiv = document.getElementById('customerAnalysis');
            customerAnalysisDiv.innerHTML = `
                <div>
                    <h4 class="font-medium text-purple-800 mb-3">üèÜ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ Top 5</h4>
                    <div class="space-y-2">
                        ${topProducts.map((product, index) => `
                            <div class="p-3 bg-white rounded border">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-medium">${index + 1}. ${product[0]}</div>
                                        <div class="text-sm text-gray-600">‡∏Å‡∏≥‡πÑ‡∏£: ${product[1].profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-purple-600">${product[1].revenue.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                                        <div class="text-sm text-gray-600">${product[1].quantity} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div>
                    <h4 class="font-medium text-purple-800 mb-3">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</h4>
                    <div class="space-y-2 text-sm">
                        <div class="p-2 bg-white rounded">
                            <strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:</strong> ${topProducts[0] ? topProducts[0][0] : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
                        </div>
                        <div class="p-2 bg-white rounded">
                            <strong>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</strong> ${monthlySales.length > 0 ? (totalRevenue / monthlySales.length).toFixed(2) : '0'} ‡∏ö‡∏≤‡∏ó
                        </div>
                        <div class="p-2 bg-white rounded">
                            <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${monthlySales.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </div>
                        <div class="p-2 bg-white rounded ${netProfit >= 0 ? 'bg-green-50' : 'bg-red-50'}">
                            <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> 
                            <span class="${netProfit >= 0 ? 'text-green-600' : 'text-red-600'} font-medium">
                                ${netProfit >= 0 ? 'üìà ‡∏°‡∏µ‡∏Å‡∏≥‡πÑ‡∏£' : 'üìâ ‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô'} ${Math.abs(netProfit).toFixed(2)} ‡∏ö‡∏≤‡∏ó
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Helper functions for date calculations
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function getDateOfWeek(year, week) {
            // Create January 4th of the given year (always in week 1)
            const jan4 = new Date(year, 0, 4);
            
            // Find the Monday of week 1
            const jan4Day = jan4.getDay() || 7; // Convert Sunday (0) to 7
            const mondayOfWeek1 = new Date(jan4);
            mondayOfWeek1.setDate(jan4.getDate() - jan4Day + 1);
            
            // Calculate the Monday of the requested week
            const mondayOfRequestedWeek = new Date(mondayOfWeek1);
            mondayOfRequestedWeek.setDate(mondayOfWeek1.getDate() + (week - 1) * 7);
            
            return mondayOfRequestedWeek;
        }

        function parseThaiDate(thaiDateStr) {
            // Convert Thai date string back to Date object
            const parts = thaiDateStr.split('/');
            if (parts.length === 3) {
                // Assuming format is DD/MM/YYYY (Thai format)
                const day = parseInt(parts[0]);
                const month = parseInt(parts[1]) - 1; // Month is 0-indexed
                let year = parseInt(parts[2]);
                
                // Check if year is in Buddhist era (> 2500) and convert to Gregorian
                if (year > 2500) {
                    year = year - 543;
                }
                
                return new Date(year, month, day);
            }
            return new Date();
        }

        // Expenses Management
        function updateExpensesOptions() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('expenseDate').value = today;
            
            // Initialize filtered expenses and update display
            filteredExpenses = [...expenses];
            updateExpensesList();
            updateMonthlyExpensesSummary();
        }

        function updateExpenseTypeInfo() {
            const expenseType = document.getElementById('expenseType').value;
            const descriptionInput = document.getElementById('expenseDescription');
            
            // Auto-suggest description based on type
            const suggestions = {
                'rent': '‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô/‡∏ö‡πâ‡∏≤‡∏ô',
                'utilities': '‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤/‡∏ô‡πâ‡∏≥‡∏õ‡∏£‡∏∞‡∏õ‡∏≤/‡πÅ‡∏Å‡πä‡∏™',
                'insurance': '‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢',
                'equipment': '‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå',
                'license': '‡∏Ñ‡πà‡∏≤‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï/‡∏†‡∏≤‡∏©‡∏µ',
                'marketing': '‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤/‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î',
                'salary': '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á',
                'maintenance': '‡∏Ñ‡πà‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤',
                'other': '‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
            };
            
            if (expenseType && suggestions[expenseType]) {
                descriptionInput.placeholder = `‡πÄ‡∏ä‡πà‡∏ô ${suggestions[expenseType]} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${new Date().toLocaleDateString('th-TH', { month: 'long' })}`;
            }
            
            validateExpenseForm();
        }

        function updateExpenseFrequency() {
            calculateExpenseImpact();
        }

        function calculateExpenseImpact() {
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const frequency = document.querySelector('input[name="expenseFrequency"]:checked')?.value;
            const expenseImpact = document.getElementById('expenseImpact');
            const impactCalculation = document.getElementById('impactCalculation');
            
            if (!amount || !frequency || amount <= 0) {
                expenseImpact.classList.add('hidden');
                validateExpenseForm();
                return;
            }
            
            // Calculate monthly impact
            let monthlyImpact = 0;
            let dailyImpact = 0;
            let explanation = '';
            
            switch (frequency) {
                case 'monthly':
                    monthlyImpact = amount;
                    dailyImpact = amount / 30;
                    explanation = `‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ${amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
                    break;
                case 'yearly':
                    monthlyImpact = amount / 12;
                    dailyImpact = amount / 365;
                    explanation = `‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ${amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ = ${monthlyImpact.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
                    break;
                case 'one-time':
                    monthlyImpact = 0;
                    dailyImpact = 0;
                    explanation = `‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ${amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó (‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥)`;
                    break;
            }
            
            expenseImpact.classList.remove('hidden');
            impactCalculation.innerHTML = `
                <div class="space-y-2">
                    <div><strong>üìä ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</strong> ${explanation}</div>
                    ${frequency !== 'one-time' ? `
                        <div><strong>üí∞ ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</strong> ${monthlyImpact.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                        <div><strong>üìÖ ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô:</strong> ${dailyImpact.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-orange-600 bg-orange-50 p-2 rounded text-xs mt-2">
                            üí° <strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                        </div>
                    ` : `
                        <div class="text-blue-600 bg-blue-50 p-2 rounded text-xs mt-2">
                            üí° <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥
                        </div>
                    `}
                </div>
            `;
            
            validateExpenseForm();
        }

        function validateExpenseForm() {
            const expenseType = document.getElementById('expenseType').value;
            const description = document.getElementById('expenseDescription').value.trim();
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const date = document.getElementById('expenseDate').value;
            const addExpenseBtn = document.getElementById('addExpenseBtn');
            
            const isValid = expenseType && description && amount > 0 && date;
            addExpenseBtn.disabled = !isValid;
        }

        function addExpense() {
            const expenseType = document.getElementById('expenseType').value;
            const description = document.getElementById('expenseDescription').value.trim();
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const frequency = document.querySelector('input[name="expenseFrequency"]:checked').value;
            const date = document.getElementById('expenseDate').value;
            
            if (!expenseType || !description || !amount || !frequency || !date) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            // Calculate monthly impact for budgeting
            let monthlyImpact = 0;
            switch (frequency) {
                case 'monthly':
                    monthlyImpact = amount;
                    break;
                case 'yearly':
                    monthlyImpact = amount / 12;
                    break;
                case 'one-time':
                    monthlyImpact = 0;
                    break;
            }
            
            const newExpense = {
                id: Date.now(),
                type: expenseType,
                description,
                amount,
                frequency,
                monthlyImpact,
                date,
                dateAdded: new Date().toLocaleDateString('th-TH'),
                timeAdded: new Date().toLocaleTimeString('th-TH')
            };
            
            expenses.push(newExpense);
            localStorage.setItem('bakery_expenses', JSON.stringify(expenses));
            
            // Update displays
            updateExpensesList();
            updateMonthlyExpensesSummary();
            
            // Clear form
            clearExpenseForm();
            
            // Show success message
            let message = `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ "${description}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n`;
            message += `‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${getExpenseTypeName(expenseType)}\n`;
            message += `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
            message += `‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢: ${getFrequencyName(frequency)}\n`;
            if (monthlyImpact > 0) {
                message += `‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${monthlyImpact.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n`;
            }
            message += `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢: ${new Date(date).toLocaleDateString('th-TH')}`;
            
            alert(message);
        }

        function clearExpenseForm() {
            document.getElementById('expenseType').value = '';
            document.getElementById('expenseDescription').value = '';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
            document.querySelector('input[name="expenseFrequency"][value="monthly"]').checked = true;
            document.getElementById('expenseImpact').classList.add('hidden');
            document.getElementById('addExpenseBtn').disabled = true;
        }

        function getExpenseTypeName(type) {
            const names = {
                'rent': 'üè† ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô/‡∏ö‡πâ‡∏≤‡∏ô',
                'utilities': '‚ö° ‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ',
                'insurance': 'üõ°Ô∏è ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢',
                'equipment': 'üîß ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå',
                'license': 'üìã ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï/‡∏†‡∏≤‡∏©‡∏µ',
                'marketing': 'üì¢ ‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤/‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î',
                'salary': 'üë• ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á',
                'maintenance': 'üî® ‡∏Ñ‡πà‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤',
                'other': 'üìù ‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
            };
            return names[type] || type;
        }

        function getFrequencyName(frequency) {
            const names = {
                'monthly': '‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
                'yearly': '‡∏£‡∏≤‡∏¢‡∏õ‡∏µ',
                'one-time': '‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß'
            };
            return names[frequency] || frequency;
        }

        function filterExpenses(filterType) {
            currentExpenseFilter = filterType;
            
            // Update filter button styles
            document.querySelectorAll('.expense-filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-slate-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-slate-500', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            applyExpenseFilter();
        }

        function applyExpenseFilter() {
            if (currentExpenseFilter === 'all') {
                filteredExpenses = [...expenses];
            } else {
                filteredExpenses = expenses.filter(expense => {
                    if (currentExpenseFilter === 'monthly' || currentExpenseFilter === 'yearly' || currentExpenseFilter === 'one-time') {
                        return expense.frequency === currentExpenseFilter;
                    } else {
                        return expense.type === currentExpenseFilter;
                    }
                });
            }
            
            updateExpensesList();
        }

        function updateExpensesList() {
            const list = document.getElementById('expensesList');
            const countElement = document.getElementById('expensesCount');
            
            // Update count
            countElement.textContent = filteredExpenses.length;
            
            if (expenses.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö<br>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            if (filteredExpenses.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-lg mb-2">üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</div>
                        <div class="text-sm">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏î‡∏π</div>
                    </div>
                `;
                return;
            }
            
            // Sort by date (newest first)
            const sortedExpenses = [...filteredExpenses].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            list.innerHTML = sortedExpenses.map(expense => {
                const frequencyColor = {
                    'monthly': 'text-red-600 bg-red-50',
                    'yearly': 'text-blue-600 bg-blue-50',
                    'one-time': 'text-green-600 bg-green-50'
                };
                
                return `
                    <div class="bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden">
                        <!-- Header -->
                        <div class="px-4 py-3 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-slate-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center">
                                        <span class="text-lg">${getExpenseTypeIcon(expense.type)}</span>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-lg text-gray-800">${expense.description}</h3>
                                        <div class="text-sm text-slate-600">${getExpenseTypeName(expense.type)}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-red-600">${expense.amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                    <div class="text-xs ${frequencyColor[expense.frequency]} px-2 py-1 rounded-full font-medium">
                                        ${getFrequencyName(expense.frequency)}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="p-4 space-y-3">
                            <!-- Impact Analysis -->
                            ${expense.monthlyImpact > 0 ? `
                                <div class="bg-orange-50 rounded-lg p-3 border border-orange-200">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-orange-600">üìä</span>
                                        <h4 class="font-medium text-orange-800 text-sm">‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h4>
                                    </div>
                                    <div class="grid grid-cols-2 gap-3 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
                                            <span class="font-medium text-orange-700">${expense.monthlyImpact.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô:</span>
                                            <span class="font-medium text-orange-700">${(expense.monthlyImpact / 30).toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                        </div>
                                    </div>
                                </div>
                            ` : `
                                <div class="bg-blue-50 rounded-lg p-3 border border-blue-200">
                                    <div class="text-sm text-blue-700">
                                        üí° ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß - ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥
                                    </div>
                                </div>
                            `}
                            
                            <!-- Date Information -->
                            <div class="flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100">
                                <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢: ${new Date(expense.date).toLocaleDateString('th-TH')}</span>
                                <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${expense.dateAdded} ${expense.timeAdded}</span>
                            </div>
                            
                            <!-- Actions -->
                            <div class="flex justify-end gap-2 pt-2">
                                <button onclick="editExpense(${expense.id})" class="text-blue-500 hover:text-blue-700 text-sm px-3 py-1 bg-blue-50 rounded hover:bg-blue-100 transition-colors">
                                    ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                </button>
                                <button onclick="removeExpense(${expense.id})" class="text-red-500 hover:text-red-700 text-sm px-3 py-1 bg-red-50 rounded hover:bg-red-100 transition-colors">
                                    üóëÔ∏è ‡∏•‡∏ö
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getExpenseTypeIcon(type) {
            const icons = {
                'rent': 'üè†',
                'utilities': '‚ö°',
                'insurance': 'üõ°Ô∏è',
                'equipment': 'üîß',
                'license': 'üìã',
                'marketing': 'üì¢',
                'salary': 'üë•',
                'maintenance': 'üî®',
                'other': 'üìù'
            };
            return icons[type] || 'üíº';
        }

        function updateMonthlyExpensesSummary() {
            const summaryDiv = document.getElementById('monthlyExpensesSummary');
            
            // Calculate monthly expenses by type
            const monthlyByType = {};
            let totalMonthly = 0;
            
            expenses.forEach(expense => {
                if (expense.monthlyImpact > 0) {
                    const typeName = getExpenseTypeName(expense.type);
                    if (monthlyByType[typeName]) {
                        monthlyByType[typeName] += expense.monthlyImpact;
                    } else {
                        monthlyByType[typeName] = expense.monthlyImpact;
                    }
                    totalMonthly += expense.monthlyImpact;
                }
            });
            
            if (totalMonthly === 0) {
                summaryDiv.innerHTML = '<div class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥</div>';
                return;
            }
            
            // Sort by amount (highest first)
            const sortedTypes = Object.entries(monthlyByType).sort((a, b) => b[1] - a[1]);
            
            summaryDiv.innerHTML = `
                <div class="space-y-2">
                    ${sortedTypes.map(([typeName, amount]) => `
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-700">${typeName}</span>
                            <span class="font-medium text-red-600">${amount.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    `).join('')}
                    <div class="border-t border-red-300 pt-2 mt-2">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-red-800">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
                            <span class="font-bold text-red-800 text-lg">${totalMonthly.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="text-xs text-red-600 mt-1">
                            ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô: ${(totalMonthly / 30).toFixed(2)} ‡∏ö‡∏≤‡∏ó
                        </div>
                    </div>
                </div>
            `;
        }

        function editExpense(id) {
            const expense = expenses.find(e => e.id === id);
            if (!expense) return;
            
            // Fill form with expense data
            document.getElementById('expenseType').value = expense.type;
            document.getElementById('expenseDescription').value = expense.description;
            document.getElementById('expenseAmount').value = expense.amount;
            document.getElementById('expenseDate').value = expense.date;
            document.querySelector(`input[name="expenseFrequency"][value="${expense.frequency}"]`).checked = true;
            
            // Update form
            updateExpenseTypeInfo();
            calculateExpenseImpact();
            
            // Remove the old expense
            removeExpense(id, false);
            
            // Scroll to form
            document.getElementById('expenses').scrollIntoView({ behavior: 'smooth' });
        }

        function removeExpense(id, confirm = true) {
            if (confirm && !window.confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ô‡∏µ‡πâ?')) {
                return;
            }
            
            expenses = expenses.filter(expense => expense.id !== id);
            localStorage.setItem('bakery_expenses', JSON.stringify(expenses));
            
            // Update displays
            updateExpensesList();
            updateMonthlyExpensesSummary();
        }

        // Pricing Management
        function updatePricingOptions() {
            const select = document.getElementById('pricingProduct');
            if (select) {
                // Show all recipes (no stock checking needed for daily fresh products)
                if (recipes.length === 0) {
                    select.innerHTML = '<option value="">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>';
                } else {
                    select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>' + 
                        recipes.map(recipe => `<option value="${recipe.name}">${recipe.name} (‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó)</option>`).join('');
                }
            }
            
            // Initialize filtered pricing and update display
            applyPricingFilter();
            updatePricingList();
        }

        function updatePricingInfo() {
            const productName = document.getElementById('pricingProduct')?.value;
            const costInfo = document.getElementById('costInfo');
            const costDetails = document.getElementById('costDetails');
            const pricingSection = document.getElementById('pricingSection');
            
            if (!productName) {
                if (costInfo) costInfo.classList.add('hidden');
                if (pricingSection) pricingSection.classList.add('hidden');
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) {
                console.log('Recipe not found:', productName);
                return;
            }
            
            // Show cost information
            if (costInfo) costInfo.classList.remove('hidden');
            if (pricingSection) pricingSection.classList.remove('hidden');
            
            // Display cost breakdown
            let costBreakdown = `
                <div class="flex justify-between">
                    <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</span>
                    <span class="font-bold">${recipe.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                </div>
                <div class="flex justify-between">
                    <span>‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£:</span>
                    <span>${recipe.yield} ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                </div>
                <div class="flex justify-between">
                    <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°:</span>
                    <span>${recipe.totalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                </div>
            `;
            
            // Show base recipe cost if exists
            if (recipe.baseRecipeName && recipe.baseCost > 0) {
                costBreakdown += `
                    <div class="border-t pt-2 mt-2">
                        <div class="text-xs text-blue-600 mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</div>
                        <div class="flex justify-between text-xs">
                            <span>‚Ä¢ ‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (${recipe.baseRecipeName}):</span>
                            <span>${recipe.baseCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span>‚Ä¢ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</span>
                            <span>${recipe.additionalCost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    </div>
                `;
            }
            
            if (costDetails) costDetails.innerHTML = costBreakdown;
            
            // Load existing pricing if available
            const existingPricing = productPricing[productName];
            if (existingPricing) {
                // Set the pricing method
                const methodRadio = document.querySelector(`input[name="pricingMethod"][value="${existingPricing.method}"]`);
                if (methodRadio) {
                    methodRadio.checked = true;
                    updatePricingMethod();
                    
                    // Set the values with a small delay to ensure DOM is ready
                    setTimeout(() => {
                        if (existingPricing.method === 'markup') {
                            const markupInput = document.getElementById('markupPercent');
                            if (markupInput) {
                                markupInput.value = existingPricing.markupPercent;
                                calculatePriceFromMarkup();
                            }
                        } else if (existingPricing.method === 'margin') {
                            const marginInput = document.getElementById('marginPercent');
                            if (marginInput) {
                                marginInput.value = existingPricing.marginPercent;
                                calculatePriceFromMargin();
                            }
                        } else if (existingPricing.method === 'fixed') {
                            const fixedInput = document.getElementById('fixedPrice');
                            if (fixedInput) {
                                fixedInput.value = existingPricing.sellingPrice;
                                calculateProfitFromFixed();
                            }
                        }
                    }, 100);
                }
            } else {
                // Reset to default method and clear values
                const markupRadio = document.querySelector('input[name="pricingMethod"][value="markup"]');
                if (markupRadio) {
                    markupRadio.checked = true;
                    updatePricingMethod();
                }
            }
        }

        function updatePricingMethod() {
            const methodRadio = document.querySelector('input[name="pricingMethod"]:checked');
            if (!methodRadio) return;
            
            const method = methodRadio.value;
            
            // Hide all method sections
            const markupMethod = document.getElementById('markupMethod');
            const marginMethod = document.getElementById('marginMethod');
            const fixedMethod = document.getElementById('fixedMethod');
            const pricingResult = document.getElementById('pricingResult');
            const savePricingBtn = document.getElementById('savePricingBtn');
            
            if (markupMethod) markupMethod.classList.add('hidden');
            if (marginMethod) marginMethod.classList.add('hidden');
            if (fixedMethod) fixedMethod.classList.add('hidden');
            if (pricingResult) pricingResult.classList.add('hidden');
            
            // Show selected method
            if (method === 'markup' && markupMethod) {
                markupMethod.classList.remove('hidden');
            } else if (method === 'margin' && marginMethod) {
                marginMethod.classList.remove('hidden');
            } else if (method === 'fixed' && fixedMethod) {
                fixedMethod.classList.remove('hidden');
            }
            
            // Clear inputs
            const markupPercent = document.getElementById('markupPercent');
            const marginPercent = document.getElementById('marginPercent');
            const fixedPrice = document.getElementById('fixedPrice');
            
            if (markupPercent) markupPercent.value = '';
            if (marginPercent) marginPercent.value = '';
            if (fixedPrice) fixedPrice.value = '';
            
            if (savePricingBtn) savePricingBtn.disabled = true;
        }

        function calculatePriceFromMarkup() {
            const productName = document.getElementById('pricingProduct').value;
            const markupPercent = parseFloat(document.getElementById('markupPercent').value);
            
            if (!productName || isNaN(markupPercent) || markupPercent < 0) {
                document.getElementById('pricingResult').classList.add('hidden');
                document.getElementById('savePricingBtn').disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) return;
            
            const costPerUnit = recipe.costPerUnit;
            const sellingPrice = costPerUnit * (1 + markupPercent / 100);
            const profitPerUnit = sellingPrice - costPerUnit;
            const profitMargin = (profitPerUnit / sellingPrice) * 100;
            
            showPricingResult({
                method: 'markup',
                costPerUnit,
                sellingPrice,
                profitPerUnit,
                profitMargin,
                markupPercent,
                calculation: `‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó √ó (1 + ${markupPercent}%) = ${sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó`
            });
        }

        function calculatePriceFromMargin() {
            const productName = document.getElementById('pricingProduct').value;
            const marginPercent = parseFloat(document.getElementById('marginPercent').value);
            
            if (!productName || isNaN(marginPercent) || marginPercent < 0 || marginPercent >= 100) {
                document.getElementById('pricingResult').classList.add('hidden');
                document.getElementById('savePricingBtn').disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) return;
            
            const costPerUnit = recipe.costPerUnit;
            const sellingPrice = costPerUnit / (1 - marginPercent / 100);
            const profitPerUnit = sellingPrice - costPerUnit;
            const markupPercent = (profitPerUnit / costPerUnit) * 100;
            
            showPricingResult({
                method: 'margin',
                costPerUnit,
                sellingPrice,
                profitPerUnit,
                profitMargin: marginPercent,
                markupPercent,
                calculation: `‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó √∑ (1 - ${marginPercent}%) = ${sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó`
            });
        }

        function calculateProfitFromFixed() {
            const productName = document.getElementById('pricingProduct').value;
            const fixedPrice = parseFloat(document.getElementById('fixedPrice').value);
            
            if (!productName || isNaN(fixedPrice) || fixedPrice <= 0) {
                document.getElementById('pricingResult').classList.add('hidden');
                document.getElementById('savePricingBtn').disabled = true;
                return;
            }
            
            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) return;
            
            const costPerUnit = recipe.costPerUnit;
            const sellingPrice = fixedPrice;
            const profitPerUnit = sellingPrice - costPerUnit;
            const profitMargin = sellingPrice > 0 ? (profitPerUnit / sellingPrice) * 100 : 0;
            const markupPercent = costPerUnit > 0 ? (profitPerUnit / costPerUnit) * 100 : 0;
            
            showPricingResult({
                method: 'fixed',
                costPerUnit,
                sellingPrice,
                profitPerUnit,
                profitMargin,
                markupPercent,
                calculation: `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ ${sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ${costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó = ‡∏Å‡∏≥‡πÑ‡∏£ ${profitPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó`
            });
        }

        function showPricingResult(data) {
            const pricingResult = document.getElementById('pricingResult');
            const pricingCalculation = document.getElementById('pricingCalculation');
            const savePricingBtn = document.getElementById('savePricingBtn');
            
            if (!pricingResult || !pricingCalculation) return;
            
            pricingResult.classList.remove('hidden');
            
            const profitColor = data.profitPerUnit > 0 ? 'text-green-700' : 'text-red-700';
            
            pricingCalculation.innerHTML = `
                <div class="font-medium mb-2">üìä ${data.calculation}</div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <div class="text-xs text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</div>
                        <div class="font-bold text-blue-700">${data.sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-600">‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
                        <div class="font-bold ${profitColor}">${data.profitPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-600">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£ (Margin)</div>
                        <div class="font-bold ${profitColor}">${data.profitMargin.toFixed(1)}%</div>
                    </div>
                    <div>
                        <div class="text-xs text-gray-600">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≥‡πÑ‡∏£ (Markup)</div>
                        <div class="font-bold ${profitColor}">${data.markupPercent.toFixed(1)}%</div>
                    </div>
                </div>
                ${data.profitPerUnit <= 0 ? '<div class="mt-2 text-red-600 text-xs">‚ö†Ô∏è ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô ‡∏à‡∏∞‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô!</div>' : ''}
            `;
            
            if (savePricingBtn) savePricingBtn.disabled = false;
        }

        function savePricing() {
            const productName = document.getElementById('pricingProduct').value;
            const methodRadio = document.querySelector('input[name="pricingMethod"]:checked');
            
            if (!productName) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }
            
            if (!methodRadio) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤');
                return;
            }
            
            const method = methodRadio.value;
            const recipe = recipes.find(r => r.name === productName);
            if (!recipe) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }
            
            let pricingData = {
                productName,
                method,
                costPerUnit: recipe.costPerUnit,
                updated: new Date().toLocaleDateString('th-TH')
            };
            
            // Get pricing data based on method
            if (method === 'markup') {
                const markupPercent = parseFloat(document.getElementById('markupPercent').value);
                if (isNaN(markupPercent) || markupPercent < 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≥‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    return;
                }
                
                const sellingPrice = recipe.costPerUnit * (1 + markupPercent / 100);
                const profitPerUnit = sellingPrice - recipe.costPerUnit;
                const profitMargin = (profitPerUnit / sellingPrice) * 100;
                
                pricingData = {
                    ...pricingData,
                    markupPercent,
                    sellingPrice,
                    profitPerUnit,
                    profitMargin
                };
            } else if (method === 'margin') {
                const marginPercent = parseFloat(document.getElementById('marginPercent').value);
                if (isNaN(marginPercent) || marginPercent < 0 || marginPercent >= 100) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 0-99%');
                    return;
                }
                
                const sellingPrice = recipe.costPerUnit / (1 - marginPercent / 100);
                const profitPerUnit = sellingPrice - recipe.costPerUnit;
                const markupPercent = (profitPerUnit / recipe.costPerUnit) * 100;
                
                pricingData = {
                    ...pricingData,
                    marginPercent,
                    markupPercent,
                    sellingPrice,
                    profitPerUnit,
                    profitMargin: marginPercent
                };
            } else if (method === 'fixed') {
                const sellingPrice = parseFloat(document.getElementById('fixedPrice').value);
                if (isNaN(sellingPrice) || sellingPrice <= 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    return;
                }
                
                const profitPerUnit = sellingPrice - recipe.costPerUnit;
                const profitMargin = sellingPrice > 0 ? (profitPerUnit / sellingPrice) * 100 : 0;
                const markupPercent = recipe.costPerUnit > 0 ? (profitPerUnit / recipe.costPerUnit) * 100 : 0;
                
                pricingData = {
                    ...pricingData,
                    sellingPrice,
                    profitPerUnit,
                    profitMargin,
                    markupPercent
                };
            }
            
            // Save to storage
            productPricing[productName] = pricingData;
            localStorage.setItem('bakery_product_pricing', JSON.stringify(productPricing));
            
            // Update display
            updatePricingOptions();
            
            // Clear form
            clearPricingForm();
            
            alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ "${productName}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n` +
                  `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢: ${pricingData.sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${pricingData.profitPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£: ${pricingData.profitMargin.toFixed(1)}%`);
        }

        function clearPricingForm() {
            const productSelect = document.getElementById('pricingProduct');
            const costInfo = document.getElementById('costInfo');
            const pricingSection = document.getElementById('pricingSection');
            const pricingResult = document.getElementById('pricingResult');
            const savePricingBtn = document.getElementById('savePricingBtn');
            
            if (productSelect) productSelect.value = '';
            if (costInfo) costInfo.classList.add('hidden');
            if (pricingSection) pricingSection.classList.add('hidden');
            if (pricingResult) pricingResult.classList.add('hidden');
            if (savePricingBtn) savePricingBtn.disabled = true;
            
            // Reset to markup method
            const markupRadio = document.querySelector('input[name="pricingMethod"][value="markup"]');
            if (markupRadio) {
                markupRadio.checked = true;
                updatePricingMethod();
            }
        }

        function filterPricing(filterType) {
            currentPricingFilter = filterType;
            
            // Update filter button styles
            document.querySelectorAll('.pricing-filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-yellow-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-yellow-500', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            applyPricingFilter();
        }

        function applyPricingFilter() {
            const allPricing = Object.entries(productPricing).map(([productName, pricing]) => ({
                productName,
                ...pricing
            }));
            
            if (currentPricingFilter === 'all') {
                filteredPricing = allPricing;
            } else {
                filteredPricing = allPricing.filter(pricing => {
                    const margin = pricing.profitMargin || 0;
                    
                    switch (currentPricingFilter) {
                        case 'high-profit':
                            return margin > 50;
                        case 'medium-profit':
                            return margin >= 20 && margin <= 50;
                        case 'low-profit':
                            return margin < 20;
                        default:
                            return true;
                    }
                });
            }
            
            updatePricingList();
        }

        function updatePricingList() {
            const list = document.getElementById('pricingList');
            const countElement = document.getElementById('pricingCount');
            
            // Update count
            countElement.textContent = filteredPricing.length;
            
            if (Object.keys(productPricing).length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢<br>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</div>';
                return;
            }
            
            if (filteredPricing.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-lg mb-2">üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</div>
                        <div class="text-sm">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏î‡∏π</div>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = filteredPricing.map(pricing => {
                const profitColor = pricing.profitPerUnit > 0 ? 'text-green-600' : 'text-red-600';
                const profitIcon = pricing.profitPerUnit > 0 ? 'üìà' : 'üìâ';
                
                // Determine profit level for styling
                let profitLevel = 'low';
                let profitBg = 'bg-red-50 border-red-200';
                if (pricing.profitMargin > 50) {
                    profitLevel = 'high';
                    profitBg = 'bg-green-50 border-green-200';
                } else if (pricing.profitMargin >= 20) {
                    profitLevel = 'medium';
                    profitBg = 'bg-yellow-50 border-yellow-200';
                }
                
                return `
                    <div class="p-4 border rounded-lg ${profitBg} hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="font-medium text-lg">${pricing.productName}</div>
                                <div class="text-sm text-gray-600 mt-1">
                                    ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${pricing.costPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢
                                </div>
                                
                                <!-- Pricing Information -->
                                <div class="mt-2 space-y-1">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢:</span>
                                        <span class="font-bold text-blue-600">${pricing.sellingPrice.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm">‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</span>
                                        <span class="font-medium ${profitColor}">${profitIcon} ${pricing.profitPerUnit.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£:</span>
                                        <span class="font-medium ${profitColor}">${pricing.profitMargin.toFixed(1)}%</span>
                                    </div>
                                </div>
                                
                                <!-- Method Information -->
                                <div class="mt-2 p-2 bg-blue-100 rounded text-xs">
                                    <div class="font-medium text-blue-800">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤:</div>
                                    <div class="text-blue-700">
                                        ${pricing.method === 'markup' ? `Markup ${pricing.markupPercent}%` : 
                                          pricing.method === 'margin' ? `Margin ${pricing.profitMargin.toFixed(1)}%` : 
                                          '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà'}
                                    </div>
                                </div>
                                
                                <div class="text-xs text-gray-500 mt-2">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${pricing.updated}</div>
                            </div>
                            
                            <div class="text-right ml-4">
                                <button onclick="editPricing('${pricing.productName}')" class="text-green-500 hover:text-green-700 p-1 mr-1">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="removePricing('${pricing.productName}')" class="text-red-500 hover:text-red-700 p-1">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function editPricing(productName) {
            // Set the product
            document.getElementById('pricingProduct').value = productName;
            updatePricingInfo();
            
            // Scroll to form
            document.getElementById('pricing').scrollIntoView({ behavior: 'smooth' });
        }

        function removePricing(productName) {
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≠‡∏á "${productName}"?`)) {
                delete productPricing[productName];
                localStorage.setItem('bakery_product_pricing', JSON.stringify(productPricing));
                updatePricingOptions();
            }
        }



        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date in header
            const currentDate = new Date().toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('currentDate').textContent = currentDate;
            
            // Set today's date for production
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('productionDate').value = today;
            
            // Show inventory section by default
            selectSection('inventory', 'üì¶', '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö');
            
            // Initialize filters
            filteredInventory = [...inventory];
            filteredRecipes = [...recipes];
            filteredPricing = Object.entries(productPricing).map(([productName, pricing]) => ({
                productName,
                ...pricing
            }));
            filteredExpenses = [...expenses];
            
            // Update all displays
            updateInventoryDisplay();
            updatePurchaseOptions();
            updateRecipeOptions();
            updateProductionOptions();
            updateSalesOptions();
            updateExpensesOptions();
            updatePricingOptions();

        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96bfb9c6b2de45bd',t:'MTc1NDY2MzU3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
